(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();function yx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Sy={exports:{}},nm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jv;function eA(){if(jv)return nm;jv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(i,r,c){var f=null;if(c!==void 0&&(f=""+c),r.key!==void 0&&(f=""+r.key),"key"in r){c={};for(var a in r)a!=="key"&&(c[a]=r[a])}else c=r;return r=c.ref,{$$typeof:t,type:i,key:f,ref:r!==void 0?r:null,props:c}}return nm.Fragment=e,nm.jsx=n,nm.jsxs=n,nm}var $v;function tA(){return $v||($v=1,Sy.exports=eA()),Sy.exports}var Yn=tA(),Ey={exports:{}},Bn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hv;function nA(){if(Hv)return Bn;Hv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),R=Symbol.iterator;function I(X){return X===null||typeof X!="object"?null:(X=R&&X[R]||X["@@iterator"],typeof X=="function"?X:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,H={};function ie(X,Ke,Tt){this.props=X,this.context=Ke,this.refs=H,this.updater=Tt||N}ie.prototype.isReactComponent={},ie.prototype.setState=function(X,Ke){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,Ke,"setState")},ie.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function ne(){}ne.prototype=ie.prototype;function he(X,Ke,Tt){this.props=X,this.context=Ke,this.refs=H,this.updater=Tt||N}var re=he.prototype=new ne;re.constructor=he,L(re,ie.prototype),re.isPureReactComponent=!0;var ge=Array.isArray,_e={H:null,A:null,T:null,S:null,V:null},pe=Object.prototype.hasOwnProperty;function it(X,Ke,Tt,ce,zt,qt){return Tt=qt.ref,{$$typeof:t,type:X,key:Ke,ref:Tt!==void 0?Tt:null,props:qt}}function mt(X,Ke){return it(X.type,Ke,void 0,void 0,void 0,X.props)}function nt(X){return typeof X=="object"&&X!==null&&X.$$typeof===t}function Ce(X){var Ke={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(Tt){return Ke[Tt]})}var ht=/\/+/g;function Me(X,Ke){return typeof X=="object"&&X!==null&&X.key!=null?Ce(""+X.key):Ke.toString(36)}function Ve(){}function Le(X){switch(X.status){case"fulfilled":return X.value;case"rejected":throw X.reason;default:switch(typeof X.status=="string"?X.then(Ve,Ve):(X.status="pending",X.then(function(Ke){X.status==="pending"&&(X.status="fulfilled",X.value=Ke)},function(Ke){X.status==="pending"&&(X.status="rejected",X.reason=Ke)})),X.status){case"fulfilled":return X.value;case"rejected":throw X.reason}}throw X}function lt(X,Ke,Tt,ce,zt){var qt=typeof X;(qt==="undefined"||qt==="boolean")&&(X=null);var Ot=!1;if(X===null)Ot=!0;else switch(qt){case"bigint":case"string":case"number":Ot=!0;break;case"object":switch(X.$$typeof){case t:case e:Ot=!0;break;case S:return Ot=X._init,lt(Ot(X._payload),Ke,Tt,ce,zt)}}if(Ot)return zt=zt(X),Ot=ce===""?"."+Me(X,0):ce,ge(zt)?(Tt="",Ot!=null&&(Tt=Ot.replace(ht,"$&/")+"/"),lt(zt,Ke,Tt,"",function(Qn){return Qn})):zt!=null&&(nt(zt)&&(zt=mt(zt,Tt+(zt.key==null||X&&X.key===zt.key?"":(""+zt.key).replace(ht,"$&/")+"/")+Ot)),Ke.push(zt)),1;Ot=0;var Fn=ce===""?".":ce+":";if(ge(X))for(var vn=0;vn<X.length;vn++)ce=X[vn],qt=Fn+Me(ce,vn),Ot+=lt(ce,Ke,Tt,qt,zt);else if(vn=I(X),typeof vn=="function")for(X=vn.call(X),vn=0;!(ce=X.next()).done;)ce=ce.value,qt=Fn+Me(ce,vn++),Ot+=lt(ce,Ke,Tt,qt,zt);else if(qt==="object"){if(typeof X.then=="function")return lt(Le(X),Ke,Tt,ce,zt);throw Ke=String(X),Error("Objects are not valid as a React child (found: "+(Ke==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":Ke)+"). If you meant to render a collection of children, use an array instead.")}return Ot}function we(X,Ke,Tt){if(X==null)return X;var ce=[],zt=0;return lt(X,ce,"","",function(qt){return Ke.call(Tt,qt,zt++)}),ce}function Ye(X){if(X._status===-1){var Ke=X._result;Ke=Ke(),Ke.then(function(Tt){(X._status===0||X._status===-1)&&(X._status=1,X._result=Tt)},function(Tt){(X._status===0||X._status===-1)&&(X._status=2,X._result=Tt)}),X._status===-1&&(X._status=0,X._result=Ke)}if(X._status===1)return X._result.default;throw X._result}var gt=typeof reportError=="function"?reportError:function(X){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ke=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof X=="object"&&X!==null&&typeof X.message=="string"?String(X.message):String(X),error:X});if(!window.dispatchEvent(Ke))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",X);return}console.error(X)};function Dt(){}return Bn.Children={map:we,forEach:function(X,Ke,Tt){we(X,function(){Ke.apply(this,arguments)},Tt)},count:function(X){var Ke=0;return we(X,function(){Ke++}),Ke},toArray:function(X){return we(X,function(Ke){return Ke})||[]},only:function(X){if(!nt(X))throw Error("React.Children.only expected to receive a single React element child.");return X}},Bn.Component=ie,Bn.Fragment=n,Bn.Profiler=r,Bn.PureComponent=he,Bn.StrictMode=i,Bn.Suspense=_,Bn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_e,Bn.__COMPILER_RUNTIME={__proto__:null,c:function(X){return _e.H.useMemoCache(X)}},Bn.cache=function(X){return function(){return X.apply(null,arguments)}},Bn.cloneElement=function(X,Ke,Tt){if(X==null)throw Error("The argument must be a React element, but you passed "+X+".");var ce=L({},X.props),zt=X.key,qt=void 0;if(Ke!=null)for(Ot in Ke.ref!==void 0&&(qt=void 0),Ke.key!==void 0&&(zt=""+Ke.key),Ke)!pe.call(Ke,Ot)||Ot==="key"||Ot==="__self"||Ot==="__source"||Ot==="ref"&&Ke.ref===void 0||(ce[Ot]=Ke[Ot]);var Ot=arguments.length-2;if(Ot===1)ce.children=Tt;else if(1<Ot){for(var Fn=Array(Ot),vn=0;vn<Ot;vn++)Fn[vn]=arguments[vn+2];ce.children=Fn}return it(X.type,zt,void 0,void 0,qt,ce)},Bn.createContext=function(X){return X={$$typeof:f,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null},X.Provider=X,X.Consumer={$$typeof:c,_context:X},X},Bn.createElement=function(X,Ke,Tt){var ce,zt={},qt=null;if(Ke!=null)for(ce in Ke.key!==void 0&&(qt=""+Ke.key),Ke)pe.call(Ke,ce)&&ce!=="key"&&ce!=="__self"&&ce!=="__source"&&(zt[ce]=Ke[ce]);var Ot=arguments.length-2;if(Ot===1)zt.children=Tt;else if(1<Ot){for(var Fn=Array(Ot),vn=0;vn<Ot;vn++)Fn[vn]=arguments[vn+2];zt.children=Fn}if(X&&X.defaultProps)for(ce in Ot=X.defaultProps,Ot)zt[ce]===void 0&&(zt[ce]=Ot[ce]);return it(X,qt,void 0,void 0,null,zt)},Bn.createRef=function(){return{current:null}},Bn.forwardRef=function(X){return{$$typeof:a,render:X}},Bn.isValidElement=nt,Bn.lazy=function(X){return{$$typeof:S,_payload:{_status:-1,_result:X},_init:Ye}},Bn.memo=function(X,Ke){return{$$typeof:x,type:X,compare:Ke===void 0?null:Ke}},Bn.startTransition=function(X){var Ke=_e.T,Tt={};_e.T=Tt;try{var ce=X(),zt=_e.S;zt!==null&&zt(Tt,ce),typeof ce=="object"&&ce!==null&&typeof ce.then=="function"&&ce.then(Dt,gt)}catch(qt){gt(qt)}finally{_e.T=Ke}},Bn.unstable_useCacheRefresh=function(){return _e.H.useCacheRefresh()},Bn.use=function(X){return _e.H.use(X)},Bn.useActionState=function(X,Ke,Tt){return _e.H.useActionState(X,Ke,Tt)},Bn.useCallback=function(X,Ke){return _e.H.useCallback(X,Ke)},Bn.useContext=function(X){return _e.H.useContext(X)},Bn.useDebugValue=function(){},Bn.useDeferredValue=function(X,Ke){return _e.H.useDeferredValue(X,Ke)},Bn.useEffect=function(X,Ke,Tt){var ce=_e.H;if(typeof Tt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ce.useEffect(X,Ke)},Bn.useId=function(){return _e.H.useId()},Bn.useImperativeHandle=function(X,Ke,Tt){return _e.H.useImperativeHandle(X,Ke,Tt)},Bn.useInsertionEffect=function(X,Ke){return _e.H.useInsertionEffect(X,Ke)},Bn.useLayoutEffect=function(X,Ke){return _e.H.useLayoutEffect(X,Ke)},Bn.useMemo=function(X,Ke){return _e.H.useMemo(X,Ke)},Bn.useOptimistic=function(X,Ke){return _e.H.useOptimistic(X,Ke)},Bn.useReducer=function(X,Ke,Tt){return _e.H.useReducer(X,Ke,Tt)},Bn.useRef=function(X){return _e.H.useRef(X)},Bn.useState=function(X){return _e.H.useState(X)},Bn.useSyncExternalStore=function(X,Ke,Tt){return _e.H.useSyncExternalStore(X,Ke,Tt)},Bn.useTransition=function(){return _e.H.useTransition()},Bn.version="19.1.1",Bn}var qv;function zm(){return qv||(qv=1,Ey.exports=nA()),Ey.exports}var St=zm(),Ay={exports:{}},im={},Cy={exports:{}},Ry={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wv;function iA(){return Wv||(Wv=1,function(t){function e(we,Ye){var gt=we.length;we.push(Ye);e:for(;0<gt;){var Dt=gt-1>>>1,X=we[Dt];if(0<r(X,Ye))we[Dt]=Ye,we[gt]=X,gt=Dt;else break e}}function n(we){return we.length===0?null:we[0]}function i(we){if(we.length===0)return null;var Ye=we[0],gt=we.pop();if(gt!==Ye){we[0]=gt;e:for(var Dt=0,X=we.length,Ke=X>>>1;Dt<Ke;){var Tt=2*(Dt+1)-1,ce=we[Tt],zt=Tt+1,qt=we[zt];if(0>r(ce,gt))zt<X&&0>r(qt,ce)?(we[Dt]=qt,we[zt]=gt,Dt=zt):(we[Dt]=ce,we[Tt]=gt,Dt=Tt);else if(zt<X&&0>r(qt,gt))we[Dt]=qt,we[zt]=gt,Dt=zt;else break e}}return Ye}function r(we,Ye){var gt=we.sortIndex-Ye.sortIndex;return gt!==0?gt:we.id-Ye.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var f=Date,a=f.now();t.unstable_now=function(){return f.now()-a}}var _=[],x=[],S=1,R=null,I=3,N=!1,L=!1,H=!1,ie=!1,ne=typeof setTimeout=="function"?setTimeout:null,he=typeof clearTimeout=="function"?clearTimeout:null,re=typeof setImmediate<"u"?setImmediate:null;function ge(we){for(var Ye=n(x);Ye!==null;){if(Ye.callback===null)i(x);else if(Ye.startTime<=we)i(x),Ye.sortIndex=Ye.expirationTime,e(_,Ye);else break;Ye=n(x)}}function _e(we){if(H=!1,ge(we),!L)if(n(_)!==null)L=!0,pe||(pe=!0,Me());else{var Ye=n(x);Ye!==null&&lt(_e,Ye.startTime-we)}}var pe=!1,it=-1,mt=5,nt=-1;function Ce(){return ie?!0:!(t.unstable_now()-nt<mt)}function ht(){if(ie=!1,pe){var we=t.unstable_now();nt=we;var Ye=!0;try{e:{L=!1,H&&(H=!1,he(it),it=-1),N=!0;var gt=I;try{t:{for(ge(we),R=n(_);R!==null&&!(R.expirationTime>we&&Ce());){var Dt=R.callback;if(typeof Dt=="function"){R.callback=null,I=R.priorityLevel;var X=Dt(R.expirationTime<=we);if(we=t.unstable_now(),typeof X=="function"){R.callback=X,ge(we),Ye=!0;break t}R===n(_)&&i(_),ge(we)}else i(_);R=n(_)}if(R!==null)Ye=!0;else{var Ke=n(x);Ke!==null&&lt(_e,Ke.startTime-we),Ye=!1}}break e}finally{R=null,I=gt,N=!1}Ye=void 0}}finally{Ye?Me():pe=!1}}}var Me;if(typeof re=="function")Me=function(){re(ht)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,Le=Ve.port2;Ve.port1.onmessage=ht,Me=function(){Le.postMessage(null)}}else Me=function(){ne(ht,0)};function lt(we,Ye){it=ne(function(){we(t.unstable_now())},Ye)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(we){we.callback=null},t.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):mt=0<we?Math.floor(1e3/we):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_next=function(we){switch(I){case 1:case 2:case 3:var Ye=3;break;default:Ye=I}var gt=I;I=Ye;try{return we()}finally{I=gt}},t.unstable_requestPaint=function(){ie=!0},t.unstable_runWithPriority=function(we,Ye){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var gt=I;I=we;try{return Ye()}finally{I=gt}},t.unstable_scheduleCallback=function(we,Ye,gt){var Dt=t.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?Dt+gt:Dt):gt=Dt,we){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=gt+X,we={id:S++,callback:Ye,priorityLevel:we,startTime:gt,expirationTime:X,sortIndex:-1},gt>Dt?(we.sortIndex=gt,e(x,we),n(_)===null&&we===n(x)&&(H?(he(it),it=-1):H=!0,lt(_e,gt-Dt))):(we.sortIndex=X,e(_,we),L||N||(L=!0,pe||(pe=!0,Me()))),we},t.unstable_shouldYield=Ce,t.unstable_wrapCallback=function(we){var Ye=I;return function(){var gt=I;I=Ye;try{return we.apply(this,arguments)}finally{I=gt}}}}(Ry)),Ry}var Xv;function rA(){return Xv||(Xv=1,Cy.exports=iA()),Cy.exports}var ky={exports:{}},Ns={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zv;function sA(){if(Zv)return Ns;Zv=1;var t=zm();function e(_){var x="https://react.dev/errors/"+_;if(1<arguments.length){x+="?args[]="+encodeURIComponent(arguments[1]);for(var S=2;S<arguments.length;S++)x+="&args[]="+encodeURIComponent(arguments[S])}return"Minified React error #"+_+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(_,x,S){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:R==null?null:""+R,children:_,containerInfo:x,implementation:S}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(_,x){if(_==="font")return"";if(typeof x=="string")return x==="use-credentials"?x:""}return Ns.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ns.createPortal=function(_,x){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!x||x.nodeType!==1&&x.nodeType!==9&&x.nodeType!==11)throw Error(e(299));return c(_,x,null,S)},Ns.flushSync=function(_){var x=f.T,S=i.p;try{if(f.T=null,i.p=2,_)return _()}finally{f.T=x,i.p=S,i.d.f()}},Ns.preconnect=function(_,x){typeof _=="string"&&(x?(x=x.crossOrigin,x=typeof x=="string"?x==="use-credentials"?x:"":void 0):x=null,i.d.C(_,x))},Ns.prefetchDNS=function(_){typeof _=="string"&&i.d.D(_)},Ns.preinit=function(_,x){if(typeof _=="string"&&x&&typeof x.as=="string"){var S=x.as,R=a(S,x.crossOrigin),I=typeof x.integrity=="string"?x.integrity:void 0,N=typeof x.fetchPriority=="string"?x.fetchPriority:void 0;S==="style"?i.d.S(_,typeof x.precedence=="string"?x.precedence:void 0,{crossOrigin:R,integrity:I,fetchPriority:N}):S==="script"&&i.d.X(_,{crossOrigin:R,integrity:I,fetchPriority:N,nonce:typeof x.nonce=="string"?x.nonce:void 0})}},Ns.preinitModule=function(_,x){if(typeof _=="string")if(typeof x=="object"&&x!==null){if(x.as==null||x.as==="script"){var S=a(x.as,x.crossOrigin);i.d.M(_,{crossOrigin:S,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0})}}else x==null&&i.d.M(_)},Ns.preload=function(_,x){if(typeof _=="string"&&typeof x=="object"&&x!==null&&typeof x.as=="string"){var S=x.as,R=a(S,x.crossOrigin);i.d.L(_,S,{crossOrigin:R,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0,type:typeof x.type=="string"?x.type:void 0,fetchPriority:typeof x.fetchPriority=="string"?x.fetchPriority:void 0,referrerPolicy:typeof x.referrerPolicy=="string"?x.referrerPolicy:void 0,imageSrcSet:typeof x.imageSrcSet=="string"?x.imageSrcSet:void 0,imageSizes:typeof x.imageSizes=="string"?x.imageSizes:void 0,media:typeof x.media=="string"?x.media:void 0})}},Ns.preloadModule=function(_,x){if(typeof _=="string")if(x){var S=a(x.as,x.crossOrigin);i.d.m(_,{as:typeof x.as=="string"&&x.as!=="script"?x.as:void 0,crossOrigin:S,integrity:typeof x.integrity=="string"?x.integrity:void 0})}else i.d.m(_)},Ns.requestFormReset=function(_){i.d.r(_)},Ns.unstable_batchedUpdates=function(_,x){return _(x)},Ns.useFormState=function(_,x,S){return f.H.useFormState(_,x,S)},Ns.useFormStatus=function(){return f.H.useHostTransitionStatus()},Ns.version="19.1.1",Ns}var Yv;function r2(){if(Yv)return ky.exports;Yv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),ky.exports=sA(),ky.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gv;function aA(){if(Gv)return im;Gv=1;var t=rA(),e=zm(),n=r2();function i(l){var h="https://react.dev/errors/"+l;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function c(l){var h=l,m=l;if(l.alternate)for(;h.return;)h=h.return;else{l=h;do h=l,(h.flags&4098)!==0&&(m=h.return),l=h.return;while(l)}return h.tag===3?m:null}function f(l){if(l.tag===13){var h=l.memoizedState;if(h===null&&(l=l.alternate,l!==null&&(h=l.memoizedState)),h!==null)return h.dehydrated}return null}function a(l){if(c(l)!==l)throw Error(i(188))}function _(l){var h=l.alternate;if(!h){if(h=c(l),h===null)throw Error(i(188));return h!==l?null:l}for(var m=l,b=h;;){var k=m.return;if(k===null)break;var D=k.alternate;if(D===null){if(b=k.return,b!==null){m=b;continue}break}if(k.child===D.child){for(D=k.child;D;){if(D===m)return a(k),l;if(D===b)return a(k),h;D=D.sibling}throw Error(i(188))}if(m.return!==b.return)m=k,b=D;else{for(var q=!1,te=k.child;te;){if(te===m){q=!0,m=k,b=D;break}if(te===b){q=!0,b=k,m=D;break}te=te.sibling}if(!q){for(te=D.child;te;){if(te===m){q=!0,m=D,b=k;break}if(te===b){q=!0,b=D,m=k;break}te=te.sibling}if(!q)throw Error(i(189))}}if(m.alternate!==b)throw Error(i(190))}if(m.tag!==3)throw Error(i(188));return m.stateNode.current===m?l:h}function x(l){var h=l.tag;if(h===5||h===26||h===27||h===6)return l;for(l=l.child;l!==null;){if(h=x(l),h!==null)return h;l=l.sibling}return null}var S=Object.assign,R=Symbol.for("react.element"),I=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),ie=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),he=Symbol.for("react.consumer"),re=Symbol.for("react.context"),ge=Symbol.for("react.forward_ref"),_e=Symbol.for("react.suspense"),pe=Symbol.for("react.suspense_list"),it=Symbol.for("react.memo"),mt=Symbol.for("react.lazy"),nt=Symbol.for("react.activity"),Ce=Symbol.for("react.memo_cache_sentinel"),ht=Symbol.iterator;function Me(l){return l===null||typeof l!="object"?null:(l=ht&&l[ht]||l["@@iterator"],typeof l=="function"?l:null)}var Ve=Symbol.for("react.client.reference");function Le(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===Ve?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case L:return"Fragment";case ie:return"Profiler";case H:return"StrictMode";case _e:return"Suspense";case pe:return"SuspenseList";case nt:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case N:return"Portal";case re:return(l.displayName||"Context")+".Provider";case he:return(l._context.displayName||"Context")+".Consumer";case ge:var h=l.render;return l=l.displayName,l||(l=h.displayName||h.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case it:return h=l.displayName||null,h!==null?h:Le(l.type)||"Memo";case mt:h=l._payload,l=l._init;try{return Le(l(h))}catch{}}return null}var lt=Array.isArray,we=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ye=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,gt={pending:!1,data:null,method:null,action:null},Dt=[],X=-1;function Ke(l){return{current:l}}function Tt(l){0>X||(l.current=Dt[X],Dt[X]=null,X--)}function ce(l,h){X++,Dt[X]=l.current,l.current=h}var zt=Ke(null),qt=Ke(null),Ot=Ke(null),Fn=Ke(null);function vn(l,h){switch(ce(Ot,h),ce(qt,l),ce(zt,null),h.nodeType){case 9:case 11:l=(l=h.documentElement)&&(l=l.namespaceURI)?fo(l):0;break;default:if(l=h.tagName,h=h.namespaceURI)h=fo(h),l=Pu(h,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}Tt(zt),ce(zt,l)}function Qn(){Tt(zt),Tt(qt),Tt(Ot)}function Yi(l){l.memoizedState!==null&&ce(Fn,l);var h=zt.current,m=Pu(h,l.type);h!==m&&(ce(qt,l),ce(zt,m))}function Pr(l){qt.current===l&&(Tt(zt),Tt(qt)),Fn.current===l&&(Tt(Fn),Kp._currentValue=gt)}var Sr=Object.prototype.hasOwnProperty,tr=t.unstable_scheduleCallback,ia=t.unstable_cancelCallback,nr=t.unstable_shouldYield,xs=t.unstable_requestPaint,ir=t.unstable_now,$s=t.unstable_getCurrentPriorityLevel,wn=t.unstable_ImmediatePriority,qr=t.unstable_UserBlockingPriority,ra=t.unstable_NormalPriority,sa=t.unstable_LowPriority,Ta=t.unstable_IdlePriority,vs=t.log,aa=t.unstable_setDisableYieldValue,ft=null,Ee=null;function at(l){if(typeof vs=="function"&&aa(l),Ee&&typeof Ee.setStrictMode=="function")try{Ee.setStrictMode(ft,l)}catch{}}var nn=Math.clz32?Math.clz32:Jn,Cn=Math.log,Mn=Math.LN2;function Jn(l){return l>>>=0,l===0?32:31-(Cn(l)/Mn|0)|0}var ri=256,Wr=4194304;function li(l){var h=l&42;if(h!==0)return h;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function wt(l,h,m){var b=l.pendingLanes;if(b===0)return 0;var k=0,D=l.suspendedLanes,q=l.pingedLanes;l=l.warmLanes;var te=b&134217727;return te!==0?(b=te&~D,b!==0?k=li(b):(q&=te,q!==0?k=li(q):m||(m=te&~l,m!==0&&(k=li(m))))):(te=b&~D,te!==0?k=li(te):q!==0?k=li(q):m||(m=b&~l,m!==0&&(k=li(m)))),k===0?0:h!==0&&h!==k&&(h&D)===0&&(D=k&-k,m=h&-h,D>=m||D===32&&(m&4194048)!==0)?h:k}function rn(l,h){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&h)===0}function tn(l,h){switch(l){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dr(){var l=ri;return ri<<=1,(ri&4194048)===0&&(ri=256),l}function ts(){var l=Wr;return Wr<<=1,(Wr&62914560)===0&&(Wr=4194304),l}function fn(l){for(var h=[],m=0;31>m;m++)h.push(l);return h}function Xr(l,h){l.pendingLanes|=h,h!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function oa(l,h,m,b,k,D){var q=l.pendingLanes;l.pendingLanes=m,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=m,l.entangledLanes&=m,l.errorRecoveryDisabledLanes&=m,l.shellSuspendCounter=0;var te=l.entanglements,Te=l.expirationTimes,Ze=l.hiddenUpdates;for(m=q&~m;0<m;){var pt=31-nn(m),xt=1<<pt;te[pt]=0,Te[pt]=-1;var Je=Ze[pt];if(Je!==null)for(Ze[pt]=null,pt=0;pt<Je.length;pt++){var tt=Je[pt];tt!==null&&(tt.lane&=-536870913)}m&=~xt}b!==0&&Er(l,b,0),D!==0&&k===0&&l.tag!==0&&(l.suspendedLanes|=D&~(q&~h))}function Er(l,h,m){l.pendingLanes|=h,l.suspendedLanes&=~h;var b=31-nn(h);l.entangledLanes|=h,l.entanglements[b]=l.entanglements[b]|1073741824|m&4194090}function Sa(l,h){var m=l.entangledLanes|=h;for(l=l.entanglements;m;){var b=31-nn(m),k=1<<b;k&h|l[b]&h&&(l[b]|=h),m&=~k}}function ni(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function ii(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function Va(){var l=Ye.p;return l!==0?l:(l=window.event,l===void 0?32:Nv(l.type))}function la(l,h){var m=Ye.p;try{return Ye.p=l,h()}finally{Ye.p=m}}var Zr=Math.random().toString(36).slice(2),wi="__reactFiber$"+Zr,ur="__reactProps$"+Zr,ca="__reactContainer$"+Zr,Hs="__reactEvents$"+Zr,ae="__reactListeners$"+Zr,V="__reactHandles$"+Zr,Z="__reactResources$"+Zr,Q="__reactMarker$"+Zr;function le(l){delete l[wi],delete l[ur],delete l[Hs],delete l[ae],delete l[V]}function be(l){var h=l[wi];if(h)return h;for(var m=l.parentNode;m;){if(h=m[ca]||m[wi]){if(m=h.alternate,h.child!==null||m!==null&&m.child!==null)for(l=Qh(l);l!==null;){if(m=l[wi])return m;l=Qh(l)}return h}l=m,m=l.parentNode}return null}function Ae(l){if(l=l[wi]||l[ca]){var h=l.tag;if(h===5||h===6||h===13||h===26||h===27||h===3)return l}return null}function Se(l){var h=l.tag;if(h===5||h===26||h===27||h===6)return l.stateNode;throw Error(i(33))}function xe(l){var h=l[Z];return h||(h=l[Z]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function ke(l){l[Q]=!0}var et=new Set,ct={};function ot(l,h){Ft(l,h),Ft(l+"Capture",h)}function Ft(l,h){for(ct[l]=h,l=0;l<h.length;l++)et.add(h[l])}var Lt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wt={},Qt={};function _n(l){return Sr.call(Qt,l)?!0:Sr.call(Wt,l)?!1:Lt.test(l)?Qt[l]=!0:(Wt[l]=!0,!1)}function gn(l,h,m){if(_n(h))if(m===null)l.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":l.removeAttribute(h);return;case"boolean":var b=h.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){l.removeAttribute(h);return}}l.setAttribute(h,""+m)}}function dn(l,h,m){if(m===null)l.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(h);return}l.setAttribute(h,""+m)}}function an(l,h,m,b){if(b===null)l.removeAttribute(m);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(m);return}l.setAttributeNS(h,m,""+b)}}var ln,Di;function ci(l){if(ln===void 0)try{throw Error()}catch(m){var h=m.stack.trim().match(/\n( *(at )?)/);ln=h&&h[1]||"",Di=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ln+l+Di}var Oi=!1;function rr(l,h){if(!l||Oi)return"";Oi=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(h){var xt=function(){throw Error()};if(Object.defineProperty(xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xt,[])}catch(tt){var Je=tt}Reflect.construct(l,[],xt)}else{try{xt.call()}catch(tt){Je=tt}l.call(xt.prototype)}}else{try{throw Error()}catch(tt){Je=tt}(xt=l())&&typeof xt.catch=="function"&&xt.catch(function(){})}}catch(tt){if(tt&&Je&&typeof tt.stack=="string")return[tt.stack,Je.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=b.DetermineComponentFrameRoot(),q=D[0],te=D[1];if(q&&te){var Te=q.split(`
`),Ze=te.split(`
`);for(k=b=0;b<Te.length&&!Te[b].includes("DetermineComponentFrameRoot");)b++;for(;k<Ze.length&&!Ze[k].includes("DetermineComponentFrameRoot");)k++;if(b===Te.length||k===Ze.length)for(b=Te.length-1,k=Ze.length-1;1<=b&&0<=k&&Te[b]!==Ze[k];)k--;for(;1<=b&&0<=k;b--,k--)if(Te[b]!==Ze[k]){if(b!==1||k!==1)do if(b--,k--,0>k||Te[b]!==Ze[k]){var pt=`
`+Te[b].replace(" at new "," at ");return l.displayName&&pt.includes("<anonymous>")&&(pt=pt.replace("<anonymous>",l.displayName)),pt}while(1<=b&&0<=k);break}}}finally{Oi=!1,Error.prepareStackTrace=m}return(m=l?l.displayName||l.name:"")?ci(m):""}function Ju(l){switch(l.tag){case 26:case 27:case 5:return ci(l.type);case 16:return ci("Lazy");case 13:return ci("Suspense");case 19:return ci("SuspenseList");case 0:case 15:return rr(l.type,!1);case 11:return rr(l.type.render,!1);case 1:return rr(l.type,!0);case 31:return ci("Activity");default:return""}}function il(l){try{var h="";do h+=Ju(l),l=l.return;while(l);return h}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}function Tn(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function xf(l){var h=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Hc(l){var h=xf(l)?"checked":"value",m=Object.getOwnPropertyDescriptor(l.constructor.prototype,h),b=""+l[h];if(!l.hasOwnProperty(h)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var k=m.get,D=m.set;return Object.defineProperty(l,h,{configurable:!0,get:function(){return k.call(this)},set:function(q){b=""+q,D.call(this,q)}}),Object.defineProperty(l,h,{enumerable:m.enumerable}),{getValue:function(){return b},setValue:function(q){b=""+q},stopTracking:function(){l._valueTracker=null,delete l[h]}}}}function qc(l){l._valueTracker||(l._valueTracker=Hc(l))}function Wc(l){if(!l)return!1;var h=l._valueTracker;if(!h)return!0;var m=h.getValue(),b="";return l&&(b=xf(l)?l.checked?"true":"false":l.value),l=b,l!==m?(h.setValue(l),!0):!1}function ic(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var eh=/[\n"\\]/g;function ns(l){return l.replace(eh,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function rc(l,h,m,b,k,D,q,te){l.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?l.type=q:l.removeAttribute("type"),h!=null?q==="number"?(h===0&&l.value===""||l.value!=h)&&(l.value=""+Tn(h)):l.value!==""+Tn(h)&&(l.value=""+Tn(h)):q!=="submit"&&q!=="reset"||l.removeAttribute("value"),h!=null?Xc(l,q,Tn(h)):m!=null?Xc(l,q,Tn(m)):b!=null&&l.removeAttribute("value"),k==null&&D!=null&&(l.defaultChecked=!!D),k!=null&&(l.checked=k&&typeof k!="function"&&typeof k!="symbol"),te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"?l.name=""+Tn(te):l.removeAttribute("name")}function th(l,h,m,b,k,D,q,te){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(l.type=D),h!=null||m!=null){if(!(D!=="submit"&&D!=="reset"||h!=null))return;m=m!=null?""+Tn(m):"",h=h!=null?""+Tn(h):m,te||h===l.value||(l.value=h),l.defaultValue=h}b=b??k,b=typeof b!="function"&&typeof b!="symbol"&&!!b,l.checked=te?l.checked:!!b,l.defaultChecked=!!b,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(l.name=q)}function Xc(l,h,m){h==="number"&&ic(l.ownerDocument)===l||l.defaultValue===""+m||(l.defaultValue=""+m)}function ws(l,h,m,b){if(l=l.options,h){h={};for(var k=0;k<m.length;k++)h["$"+m[k]]=!0;for(m=0;m<l.length;m++)k=h.hasOwnProperty("$"+l[m].value),l[m].selected!==k&&(l[m].selected=k),k&&b&&(l[m].defaultSelected=!0)}else{for(m=""+Tn(m),h=null,k=0;k<l.length;k++){if(l[k].value===m){l[k].selected=!0,b&&(l[k].defaultSelected=!0);return}h!==null||l[k].disabled||(h=l[k])}h!==null&&(h.selected=!0)}}function sc(l,h,m){if(h!=null&&(h=""+Tn(h),h!==l.value&&(l.value=h),m==null)){l.defaultValue!==h&&(l.defaultValue=h);return}l.defaultValue=m!=null?""+Tn(m):""}function To(l,h,m,b){if(h==null){if(b!=null){if(m!=null)throw Error(i(92));if(lt(b)){if(1<b.length)throw Error(i(93));b=b[0]}m=b}m==null&&(m=""),h=m}m=Tn(h),l.defaultValue=m,b=l.textContent,b===m&&b!==""&&b!==null&&(l.value=b)}function ua(l,h){if(h){var m=l.firstChild;if(m&&m===l.lastChild&&m.nodeType===3){m.nodeValue=h;return}}l.textContent=h}var Zc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ac(l,h,m){var b=h.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?b?l.setProperty(h,""):h==="float"?l.cssFloat="":l[h]="":b?l.setProperty(h,m):typeof m!="number"||m===0||Zc.has(h)?h==="float"?l.cssFloat=m:l[h]=(""+m).trim():l[h]=m+"px"}function rl(l,h,m){if(h!=null&&typeof h!="object")throw Error(i(62));if(l=l.style,m!=null){for(var b in m)!m.hasOwnProperty(b)||h!=null&&h.hasOwnProperty(b)||(b.indexOf("--")===0?l.setProperty(b,""):b==="float"?l.cssFloat="":l[b]="");for(var k in h)b=h[k],h.hasOwnProperty(k)&&m[k]!==b&&ac(l,k,b)}else for(var D in h)h.hasOwnProperty(D)&&ac(l,D,h[D])}function sl(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ti=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ja(l){return Ti.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var lc=null;function Yc(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var So=null,Ea=null;function Gc(l){var h=Ae(l);if(h&&(l=h.stateNode)){var m=l[ur]||null;e:switch(l=h.stateNode,h.type){case"input":if(rc(l,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),h=m.name,m.type==="radio"&&h!=null){for(m=l;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+ns(""+h)+'"][type="radio"]'),h=0;h<m.length;h++){var b=m[h];if(b!==l&&b.form===l.form){var k=b[ur]||null;if(!k)throw Error(i(90));rc(b,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name)}}for(h=0;h<m.length;h++)b=m[h],b.form===l.form&&Wc(b)}break e;case"textarea":sc(l,m.value,m.defaultValue);break e;case"select":h=m.value,h!=null&&ws(l,!!m.multiple,h,!1)}}}var nh=!1;function vf(l,h,m){if(nh)return l(h,m);nh=!0;try{var b=l(h);return b}finally{if(nh=!1,(So!==null||Ea!==null)&&(Yh(),So&&(h=So,l=Ea,Ea=So=null,Gc(h),l)))for(h=0;h<l.length;h++)Gc(l[h])}}function Eo(l,h){var m=l.stateNode;if(m===null)return null;var b=m[ur]||null;if(b===null)return null;m=b[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(l=l.type,b=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!b;break e;default:l=!1}if(l)return null;if(m&&typeof m!="function")throw Error(i(231,h,typeof m));return m}var qs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cc=!1;if(qs)try{var Ao={};Object.defineProperty(Ao,"passive",{get:function(){cc=!0}}),window.addEventListener("test",Ao,Ao),window.removeEventListener("test",Ao,Ao)}catch{cc=!1}var Aa=null,Un=null,Kc=null;function al(){if(Kc)return Kc;var l,h=Un,m=h.length,b,k="value"in Aa?Aa.value:Aa.textContent,D=k.length;for(l=0;l<m&&h[l]===k[l];l++);var q=m-l;for(b=1;b<=q&&h[m-b]===k[D-b];b++);return Kc=k.slice(l,1<b?1-b:void 0)}function $a(l){var h=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&h===13&&(l=13)):l=h,l===10&&(l=13),32<=l||l===13?l:0}function uc(){return!0}function is(){return!1}function Or(l){function h(m,b,k,D,q){this._reactName=m,this._targetInst=k,this.type=b,this.nativeEvent=D,this.target=q,this.currentTarget=null;for(var te in l)l.hasOwnProperty(te)&&(m=l[te],this[te]=m?m(D):D[te]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?uc:is,this.isPropagationStopped=is,this}return S(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=uc)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=uc)},persist:function(){},isPersistent:uc}),h}var ha={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Co=Or(ha),Ro=S({},ha,{view:0,detail:0}),ih=Or(Ro),ol,hc,ko,Io=S({},Ro,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qc,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==ko&&(ko&&l.type==="mousemove"?(ol=l.screenX-ko.screenX,hc=l.screenY-ko.screenY):hc=ol=0,ko=l),ol)},movementY:function(l){return"movementY"in l?l.movementY:hc}}),rh=Or(Io),wf=S({},Io,{dataTransfer:0}),ll=Or(wf),Hd=S({},Ro,{relatedTarget:0}),sh=Or(Hd),qd=S({},ha,{animationName:0,elapsedTime:0,pseudoElement:0}),Wd=Or(qd),Xd=S({},ha,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Zd=Or(Xd),ah=S({},ha,{data:0}),fc=Or(ah),oh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tf(l){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(l):(l=cl[l])?!!h[l]:!1}function Qc(){return Tf}var ch=S({},Ro,{key:function(l){if(l.key){var h=oh[l.key]||l.key;if(h!=="Unidentified")return h}return l.type==="keypress"?(l=$a(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?lh[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qc,charCode:function(l){return l.type==="keypress"?$a(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?$a(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Ha=Or(ch),Sf=S({},Io,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mo=Or(Sf),ul=S({},Ro,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qc}),Bi=Or(ul),uh=S({},ha,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xt=Or(uh),hl=S({},Io,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),Si=Or(hl),_i=S({},ha,{newState:0,oldState:0}),qa=Or(_i),Ef=[9,13,27,32],hh=qs&&"CompositionEvent"in window,fl=null;qs&&"documentMode"in document&&(fl=document.documentMode);var Yd=qs&&"TextEvent"in window&&!fl,Jc=qs&&(!hh||fl&&8<fl&&11>=fl),dl=" ",pl=!1;function dc(l,h){switch(l){case"keyup":return Ef.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ml(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Po=!1;function eu(l,h){switch(l){case"compositionend":return ml(h);case"keypress":return h.which!==32?null:(pl=!0,dl);case"textInput":return l=h.data,l===dl&&pl?null:l;default:return null}}function tu(l,h){if(Po)return l==="compositionend"||!hh&&dc(l,h)?(l=al(),Kc=Un=Aa=null,Po=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Jc&&h.locale!=="ko"?null:h.data;default:return null}}var Ws={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fh(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h==="input"?!!Ws[l.type]:h==="textarea"}function nu(l,h,m,b){So?Ea?Ea.push(b):Ea=[b]:So=b,h=Fr(h,"onChange"),0<h.length&&(m=new Co("onChange","change",null,m,b),l.push({event:m,listeners:h}))}var gl=null,fa=null;function pc(l){lr(l,0)}function Do(l){var h=Se(l);if(Wc(h))return l}function mc(l,h){if(l==="change")return h}var iu=!1;if(qs){var ru;if(qs){var gc="oninput"in document;if(!gc){var _c=document.createElement("div");_c.setAttribute("oninput","return;"),gc=typeof _c.oninput=="function"}ru=gc}else ru=!1;iu=ru&&(!document.documentMode||9<document.documentMode)}function yc(){gl&&(gl.detachEvent("onpropertychange",dh),fa=gl=null)}function dh(l){if(l.propertyName==="value"&&Do(fa)){var h=[];nu(h,fa,l,Yc(l)),vf(pc,h)}}function su(l,h,m){l==="focusin"?(yc(),gl=h,fa=m,gl.attachEvent("onpropertychange",dh)):l==="focusout"&&yc()}function Oo(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Do(fa)}function bc(l,h){if(l==="click")return Do(h)}function au(l,h){if(l==="input"||l==="change")return Do(h)}function Af(l,h){return l===h&&(l!==0||1/l===1/h)||l!==l&&h!==h}var Ar=typeof Object.is=="function"?Object.is:Af;function _l(l,h){if(Ar(l,h))return!0;if(typeof l!="object"||l===null||typeof h!="object"||h===null)return!1;var m=Object.keys(l),b=Object.keys(h);if(m.length!==b.length)return!1;for(b=0;b<m.length;b++){var k=m[b];if(!Sr.call(h,k)||!Ar(l[k],h[k]))return!1}return!0}function ph(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function Bo(l,h){var m=ph(l);l=0;for(var b;m;){if(m.nodeType===3){if(b=l+m.textContent.length,l<=h&&b>=h)return{node:m,offset:h-l};l=b}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=ph(m)}}function mh(l,h){return l&&h?l===h?!0:l&&l.nodeType===3?!1:h&&h.nodeType===3?mh(l,h.parentNode):"contains"in l?l.contains(h):l.compareDocumentPosition?!!(l.compareDocumentPosition(h)&16):!1:!1}function gh(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var h=ic(l.document);h instanceof l.HTMLIFrameElement;){try{var m=typeof h.contentWindow.location.href=="string"}catch{m=!1}if(m)l=h.contentWindow;else break;h=ic(l.document)}return h}function No(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h&&(h==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||h==="textarea"||l.contentEditable==="true")}var xc=qs&&"documentMode"in document&&11>=document.documentMode,hr=null,fr=null,vc=null,da=!1;function _h(l,h,m){var b=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;da||hr==null||hr!==ic(b)||(b=hr,"selectionStart"in b&&No(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),vc&&_l(vc,b)||(vc=b,b=Fr(fr,"onSelect"),0<b.length&&(h=new Co("onSelect","select",null,h,m),l.push({event:h,listeners:b}),h.target=hr)))}function fs(l,h){var m={};return m[l.toLowerCase()]=h.toLowerCase(),m["Webkit"+l]="webkit"+h,m["Moz"+l]="moz"+h,m}var Ts={animationend:fs("Animation","AnimationEnd"),animationiteration:fs("Animation","AnimationIteration"),animationstart:fs("Animation","AnimationStart"),transitionrun:fs("Transition","TransitionRun"),transitionstart:fs("Transition","TransitionStart"),transitioncancel:fs("Transition","TransitionCancel"),transitionend:fs("Transition","TransitionEnd")},yh={},ou={};qs&&(ou=document.createElement("div").style,"AnimationEvent"in window||(delete Ts.animationend.animation,delete Ts.animationiteration.animation,delete Ts.animationstart.animation),"TransitionEvent"in window||delete Ts.transitionend.transition);function zo(l){if(yh[l])return yh[l];if(!Ts[l])return l;var h=Ts[l],m;for(m in h)if(h.hasOwnProperty(m)&&m in ou)return yh[l]=h[m];return l}var bh=zo("animationend"),Wa=zo("animationiteration"),Ca=zo("animationstart"),jt=zo("transitionrun"),xh=zo("transitionstart"),wc=zo("transitioncancel"),Xa=zo("transitionend"),yl=new Map,It="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");It.push("scrollEnd");function ds(l,h){yl.set(l,h),ot(h,[l])}var vh=new WeakMap;function Ss(l,h){if(typeof l=="object"&&l!==null){var m=vh.get(l);return m!==void 0?m:(h={value:l,source:h,stack:il(h)},vh.set(l,h),h)}return{value:l,source:h,stack:il(h)}}var Br=[],Lo=0,lu=0;function cu(){for(var l=Lo,h=lu=Lo=0;h<l;){var m=Br[h];Br[h++]=null;var b=Br[h];Br[h++]=null;var k=Br[h];Br[h++]=null;var D=Br[h];if(Br[h++]=null,b!==null&&k!==null){var q=b.pending;q===null?k.next=k:(k.next=q.next,q.next=k),b.pending=k}D!==0&&hu(m,k,D)}}function uu(l,h,m,b){Br[Lo++]=l,Br[Lo++]=h,Br[Lo++]=m,Br[Lo++]=b,lu|=b,l.lanes|=b,l=l.alternate,l!==null&&(l.lanes|=b)}function bl(l,h,m,b){return uu(l,h,m,b),xl(l)}function Za(l,h){return uu(l,null,null,h),xl(l)}function hu(l,h,m){l.lanes|=m;var b=l.alternate;b!==null&&(b.lanes|=m);for(var k=!1,D=l.return;D!==null;)D.childLanes|=m,b=D.alternate,b!==null&&(b.childLanes|=m),D.tag===22&&(l=D.stateNode,l===null||l._visibility&1||(k=!0)),l=D,D=D.return;return l.tag===3?(D=l.stateNode,k&&h!==null&&(k=31-nn(m),l=D.hiddenUpdates,b=l[k],b===null?l[k]=[h]:b.push(h),h.lane=m|536870912),D):null}function xl(l){if(50<Iu)throw Iu=0,Qf=null,Error(i(185));for(var h=l.return;h!==null;)l=h,h=l.return;return l.tag===3?l.stateNode:null}var sr={};function Ya(l,h,m,b){this.tag=l,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rs(l,h,m,b){return new Ya(l,h,m,b)}function Tc(l){return l=l.prototype,!(!l||!l.isReactComponent)}function ss(l,h){var m=l.alternate;return m===null?(m=rs(l.tag,h,l.key,l.mode),m.elementType=l.elementType,m.type=l.type,m.stateNode=l.stateNode,m.alternate=l,l.alternate=m):(m.pendingProps=h,m.type=l.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=l.flags&65011712,m.childLanes=l.childLanes,m.lanes=l.lanes,m.child=l.child,m.memoizedProps=l.memoizedProps,m.memoizedState=l.memoizedState,m.updateQueue=l.updateQueue,h=l.dependencies,m.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},m.sibling=l.sibling,m.index=l.index,m.ref=l.ref,m.refCleanup=l.refCleanup,m}function fu(l,h){l.flags&=65011714;var m=l.alternate;return m===null?(l.childLanes=0,l.lanes=h,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=m.childLanes,l.lanes=m.lanes,l.child=m.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=m.memoizedProps,l.memoizedState=m.memoizedState,l.updateQueue=m.updateQueue,l.type=m.type,h=m.dependencies,l.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),l}function Fo(l,h,m,b,k,D){var q=0;if(b=l,typeof l=="function")Tc(l)&&(q=1);else if(typeof l=="string")q=VE(l,m,zt.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case nt:return l=rs(31,m,h,k),l.elementType=nt,l.lanes=D,l;case L:return dr(m.children,k,D,h);case H:q=8,k|=24;break;case ie:return l=rs(12,m,h,k|2),l.elementType=ie,l.lanes=D,l;case _e:return l=rs(13,m,h,k),l.elementType=_e,l.lanes=D,l;case pe:return l=rs(19,m,h,k),l.elementType=pe,l.lanes=D,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case ne:case re:q=10;break e;case he:q=9;break e;case ge:q=11;break e;case it:q=14;break e;case mt:q=16,b=null;break e}q=29,m=Error(i(130,l===null?"null":typeof l,"")),b=null}return h=rs(q,m,h,k),h.elementType=l,h.type=b,h.lanes=D,h}function dr(l,h,m,b){return l=rs(7,l,b,h),l.lanes=m,l}function ui(l,h,m){return l=rs(6,l,null,h),l.lanes=m,l}function vl(l,h,m){return h=rs(4,l.children!==null?l.children:[],l.key,h),h.lanes=m,h.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},h}var Ra=[],Ga=0,Sc=null,Ec=0,Es=[],Hi=0,pa=null,$t=1,Gt="";function Xs(l,h){Ra[Ga++]=Ec,Ra[Ga++]=Sc,Sc=l,Ec=h}function wl(l,h,m){Es[Hi++]=$t,Es[Hi++]=Gt,Es[Hi++]=pa,pa=l;var b=$t;l=Gt;var k=32-nn(b)-1;b&=~(1<<k),m+=1;var D=32-nn(h)+k;if(30<D){var q=k-k%5;D=(b&(1<<q)-1).toString(32),b>>=q,k-=q,$t=1<<32-nn(h)+k|m<<k|b,Gt=D+l}else $t=1<<D|m<<k|b,Gt=l}function Ac(l){l.return!==null&&(Xs(l,1),wl(l,1,0))}function qi(l){for(;l===Sc;)Sc=Ra[--Ga],Ra[Ga]=null,Ec=Ra[--Ga],Ra[Ga]=null;for(;l===pa;)pa=Es[--Hi],Es[Hi]=null,Gt=Es[--Hi],Es[Hi]=null,$t=Es[--Hi],Es[Hi]=null}var Wi=null,Vn=null,Gn=!1,Zs=null,jn=!1,Ni=Error(i(519));function Ka(l){var h=Error(i(418,""));throw y(Ss(h,l)),Ni}function Uo(l){var h=l.stateNode,m=l.type,b=l.memoizedProps;switch(h[wi]=l,h[ur]=b,m){case"dialog":on("cancel",h),on("close",h);break;case"iframe":case"object":case"embed":on("load",h);break;case"video":case"audio":for(m=0;m<Qi.length;m++)on(Qi[m],h);break;case"source":on("error",h);break;case"img":case"image":case"link":on("error",h),on("load",h);break;case"details":on("toggle",h);break;case"input":on("invalid",h),th(h,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0),qc(h);break;case"select":on("invalid",h);break;case"textarea":on("invalid",h),To(h,b.value,b.defaultValue,b.children),qc(h)}m=b.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||h.textContent===""+m||b.suppressHydrationWarning===!0||Ir(h.textContent,m)?(b.popover!=null&&(on("beforetoggle",h),on("toggle",h)),b.onScroll!=null&&on("scroll",h),b.onScrollEnd!=null&&on("scrollend",h),b.onClick!=null&&(h.onclick=vr),h=!0):h=!1,h||Ka(l)}function Tl(l){for(Wi=l.return;Wi;)switch(Wi.tag){case 5:case 13:jn=!1;return;case 27:case 3:jn=!0;return;default:Wi=Wi.return}}function v(l){if(l!==Wi)return!1;if(!Gn)return Tl(l),Gn=!0,!1;var h=l.tag,m;if((m=h!==3&&h!==27)&&((m=h===5)&&(m=l.type,m=!(m!=="form"&&m!=="button")||id(l.type,l.memoizedProps)),m=!m),m&&Vn&&Ka(l),Tl(l),h===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(i(317));e:{for(l=l.nextSibling,h=0;l;){if(l.nodeType===8)if(m=l.data,m==="/$"){if(h===0){Vn=Oa(l.nextSibling);break e}h--}else m!=="$"&&m!=="$!"&&m!=="$?"||h++;l=l.nextSibling}Vn=null}}else h===27?(h=Vn,Wl(l.type)?(l=Js,Js=null,Vn=l):Vn=h):Vn=Wi?Oa(l.stateNode.nextSibling):null;return!0}function o(){Vn=Wi=null,Gn=!1}function p(){var l=Zs;return l!==null&&(Ps===null?Ps=l:Ps.push.apply(Ps,l),Zs=null),l}function y(l){Zs===null?Zs=[l]:Zs.push(l)}var T=Ke(null),A=null,M=null;function B(l,h,m){ce(T,h._currentValue),h._currentValue=m}function z(l){l._currentValue=T.current,Tt(T)}function U(l,h,m){for(;l!==null;){var b=l.alternate;if((l.childLanes&h)!==h?(l.childLanes|=h,b!==null&&(b.childLanes|=h)):b!==null&&(b.childLanes&h)!==h&&(b.childLanes|=h),l===m)break;l=l.return}}function $(l,h,m,b){var k=l.child;for(k!==null&&(k.return=l);k!==null;){var D=k.dependencies;if(D!==null){var q=k.child;D=D.firstContext;e:for(;D!==null;){var te=D;D=k;for(var Te=0;Te<h.length;Te++)if(te.context===h[Te]){D.lanes|=m,te=D.alternate,te!==null&&(te.lanes|=m),U(D.return,m,l),b||(q=null);break e}D=te.next}}else if(k.tag===18){if(q=k.return,q===null)throw Error(i(341));q.lanes|=m,D=q.alternate,D!==null&&(D.lanes|=m),U(q,m,l),q=null}else q=k.child;if(q!==null)q.return=k;else for(q=k;q!==null;){if(q===l){q=null;break}if(k=q.sibling,k!==null){k.return=q.return,q=k;break}q=q.return}k=q}}function Y(l,h,m,b){l=null;for(var k=h,D=!1;k!==null;){if(!D){if((k.flags&524288)!==0)D=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var q=k.alternate;if(q===null)throw Error(i(387));if(q=q.memoizedProps,q!==null){var te=k.type;Ar(k.pendingProps.value,q.value)||(l!==null?l.push(te):l=[te])}}else if(k===Fn.current){if(q=k.alternate,q===null)throw Error(i(387));q.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(l!==null?l.push(Kp):l=[Kp])}k=k.return}l!==null&&$(h,l,m,b),h.flags|=262144}function K(l){for(l=l.firstContext;l!==null;){if(!Ar(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function fe(l){A=l,M=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function se(l){return Re(A,l)}function ue(l,h){return A===null&&fe(l),Re(l,h)}function Re(l,h){var m=h._currentValue;if(h={context:h,memoizedValue:m,next:null},M===null){if(l===null)throw Error(i(308));M=h,l.dependencies={lanes:0,firstContext:h},l.flags|=524288}else M=M.next=h;return m}var Pe=typeof AbortController<"u"?AbortController:function(){var l=[],h=this.signal={aborted:!1,addEventListener:function(m,b){l.push(b)}};this.abort=function(){h.aborted=!0,l.forEach(function(m){return m()})}},$e=t.unstable_scheduleCallback,me=t.unstable_NormalPriority,Fe={$$typeof:re,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function He(){return{controller:new Pe,data:new Map,refCount:0}}function rt(l){l.refCount--,l.refCount===0&&$e(me,function(){l.controller.abort()})}var st=null,bt=0,Qe=0,Mt=null;function kt(l,h){if(st===null){var m=st=[];bt=0,Qe=vt(),Mt={status:"pending",value:void 0,then:function(b){m.push(b)}}}return bt++,h.then(Ut,Ut),h}function Ut(){if(--bt===0&&st!==null){Mt!==null&&(Mt.status="fulfilled");var l=st;st=null,Qe=0,Mt=null;for(var h=0;h<l.length;h++)(0,l[h])()}}function un(l,h){var m=[],b={status:"pending",value:null,reason:null,then:function(k){m.push(k)}};return l.then(function(){b.status="fulfilled",b.value=h;for(var k=0;k<m.length;k++)(0,m[k])(h)},function(k){for(b.status="rejected",b.reason=k,k=0;k<m.length;k++)(0,m[k])(void 0)}),b}var yn=we.S;we.S=function(l,h){typeof h=="object"&&h!==null&&typeof h.then=="function"&&kt(l,h),yn!==null&&yn(l,h)};var Kt=Ke(null);function Wn(){var l=Kt.current;return l!==null?l:yi.pooledCache}function $n(l,h){h===null?ce(Kt,Kt.current):ce(Kt,h.pool)}function Pn(){var l=Wn();return l===null?null:{parent:Fe._currentValue,pool:l}}var En=Error(i(460)),zn=Error(i(474)),Nr=Error(i(542)),As={then:function(){}};function Cs(l){return l=l.status,l==="fulfilled"||l==="rejected"}function as(){}function Qa(l,h,m){switch(m=l[m],m===void 0?l.push(h):m!==h&&(h.then(as,as),h=m),h.status){case"fulfilled":return h.value;case"rejected":throw l=h.reason,Ja(l),l;default:if(typeof h.status=="string")h.then(as,as);else{if(l=yi,l!==null&&100<l.shellSuspendCounter)throw Error(i(482));l=h,l.status="pending",l.then(function(b){if(h.status==="pending"){var k=h;k.status="fulfilled",k.value=b}},function(b){if(h.status==="pending"){var k=h;k.status="rejected",k.reason=b}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw l=h.reason,Ja(l),l}throw Xi=h,En}}var Xi=null;function Rs(){if(Xi===null)throw Error(i(459));var l=Xi;return Xi=null,l}function Ja(l){if(l===En||l===Nr)throw Error(i(483))}var Ys=!1;function Dn(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function si(l,h){l=l.updateQueue,h.updateQueue===l&&(h.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function Sn(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function hi(l,h,m){var b=l.updateQueue;if(b===null)return null;if(b=b.shared,(Zn&2)!==0){var k=b.pending;return k===null?h.next=h:(h.next=k.next,k.next=h),b.pending=h,h=xl(l),hu(l,null,m),h}return uu(l,b,h,m),xl(l)}function pr(l,h,m){if(h=h.updateQueue,h!==null&&(h=h.shared,(m&4194048)!==0)){var b=h.lanes;b&=l.pendingLanes,m|=b,h.lanes=m,Sa(l,m)}}function fi(l,h){var m=l.updateQueue,b=l.alternate;if(b!==null&&(b=b.updateQueue,m===b)){var k=null,D=null;if(m=m.firstBaseUpdate,m!==null){do{var q={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};D===null?k=D=q:D=D.next=q,m=m.next}while(m!==null);D===null?k=D=h:D=D.next=h}else k=D=h;m={baseState:b.baseState,firstBaseUpdate:k,lastBaseUpdate:D,shared:b.shared,callbacks:b.callbacks},l.updateQueue=m;return}l=m.lastBaseUpdate,l===null?m.firstBaseUpdate=h:l.next=h,m.lastBaseUpdate=h}var os=!1;function ma(){if(os){var l=Mt;if(l!==null)throw l}}function ga(l,h,m,b){os=!1;var k=l.updateQueue;Ys=!1;var D=k.firstBaseUpdate,q=k.lastBaseUpdate,te=k.shared.pending;if(te!==null){k.shared.pending=null;var Te=te,Ze=Te.next;Te.next=null,q===null?D=Ze:q.next=Ze,q=Te;var pt=l.alternate;pt!==null&&(pt=pt.updateQueue,te=pt.lastBaseUpdate,te!==q&&(te===null?pt.firstBaseUpdate=Ze:te.next=Ze,pt.lastBaseUpdate=Te))}if(D!==null){var xt=k.baseState;q=0,pt=Ze=Te=null,te=D;do{var Je=te.lane&-536870913,tt=Je!==te.lane;if(tt?(Hn&Je)===Je:(b&Je)===Je){Je!==0&&Je===Qe&&(os=!0),pt!==null&&(pt=pt.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var bn=l,hn=te;Je=h;var Ai=m;switch(hn.tag){case 1:if(bn=hn.payload,typeof bn=="function"){xt=bn.call(Ai,xt,Je);break e}xt=bn;break e;case 3:bn.flags=bn.flags&-65537|128;case 0:if(bn=hn.payload,Je=typeof bn=="function"?bn.call(Ai,xt,Je):bn,Je==null)break e;xt=S({},xt,Je);break e;case 2:Ys=!0}}Je=te.callback,Je!==null&&(l.flags|=64,tt&&(l.flags|=8192),tt=k.callbacks,tt===null?k.callbacks=[Je]:tt.push(Je))}else tt={lane:Je,tag:te.tag,payload:te.payload,callback:te.callback,next:null},pt===null?(Ze=pt=tt,Te=xt):pt=pt.next=tt,q|=Je;if(te=te.next,te===null){if(te=k.shared.pending,te===null)break;tt=te,te=tt.next,tt.next=null,k.lastBaseUpdate=tt,k.shared.pending=null}}while(!0);pt===null&&(Te=xt),k.baseState=Te,k.firstBaseUpdate=Ze,k.lastBaseUpdate=pt,D===null&&(k.shared.lanes=0),Da|=q,l.lanes=q,l.memoizedState=xt}}function Cc(l,h){if(typeof l!="function")throw Error(i(191,l));l.call(h)}function du(l,h){var m=l.callbacks;if(m!==null)for(l.callbacks=null,l=0;l<m.length;l++)Cc(m[l],h)}var ka=Ke(null),ls=Ke(0);function Rc(l,h){l=Zo,ce(ls,l),ce(ka,h),Zo=l|h.baseLanes}function Vo(){ce(ls,Zo),ce(ka,ka.current)}function Sl(){Zo=ls.current,Tt(ka),Tt(ls)}var El=0,Rn=null,ei=null,Ii=null,_a=!1,cs=!1,ks=!1,wh=0,Ia=0,pu=null,Zm=0;function kn(){throw Error(i(321))}function Th(l,h){if(h===null)return!1;for(var m=0;m<h.length&&m<l.length;m++)if(!Ar(l[m],h[m]))return!1;return!0}function Cf(l,h,m,b,k,D){return El=D,Rn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,we.H=l===null||l.memoizedState===null?Nf:cg,ks=!1,D=m(b,k),ks=!1,cs&&(D=Cl(h,m,b,k)),Al(l),D}function Al(l){we.H=yu;var h=ei!==null&&ei.next!==null;if(El=0,Ii=ei=Rn=null,_a=!1,Ia=0,pu=null,h)throw Error(i(300));l===null||zr||(l=l.dependencies,l!==null&&K(l)&&(zr=!0))}function Cl(l,h,m,b){Rn=l;var k=0;do{if(cs&&(pu=null),Ia=0,cs=!1,25<=k)throw Error(i(301));if(k+=1,Ii=ei=null,l.updateQueue!=null){var D=l.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}we.H=ug,D=h(m,b)}while(cs);return D}function Rf(){var l=we.H,h=l.useState()[0];return h=typeof h.then=="function"?Ah(h):h,l=l.useState()[0],(ei!==null?ei.memoizedState:null)!==l&&(Rn.flags|=1024),h}function Sh(){var l=wh!==0;return wh=0,l}function kf(l,h,m){h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~m}function Gd(l){if(_a){for(l=l.memoizedState;l!==null;){var h=l.queue;h!==null&&(h.pending=null),l=l.next}_a=!1}El=0,Ii=ei=Rn=null,cs=!1,Ia=wh=0,pu=null}function ps(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?Rn.memoizedState=Ii=l:Ii=Ii.next=l,Ii}function mr(){if(ei===null){var l=Rn.alternate;l=l!==null?l.memoizedState:null}else l=ei.next;var h=Ii===null?Rn.memoizedState:Ii.next;if(h!==null)Ii=h,ei=l;else{if(l===null)throw Rn.alternate===null?Error(i(467)):Error(i(310));ei=l,l={memoizedState:ei.memoizedState,baseState:ei.baseState,baseQueue:ei.baseQueue,queue:ei.queue,next:null},Ii===null?Rn.memoizedState=Ii=l:Ii=Ii.next=l}return Ii}function Eh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ah(l){var h=Ia;return Ia+=1,pu===null&&(pu=[]),l=Qa(pu,l,h),h=Rn,(Ii===null?h.memoizedState:Ii.next)===null&&(h=h.alternate,we.H=h===null||h.memoizedState===null?Nf:cg),l}function mu(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Ah(l);if(l.$$typeof===re)return se(l)}throw Error(i(438,String(l)))}function If(l){var h=null,m=Rn.updateQueue;if(m!==null&&(h=m.memoCache),h==null){var b=Rn.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(h={data:b.data.map(function(k){return k.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),m===null&&(m=Eh(),Rn.updateQueue=m),m.memoCache=h,m=h.data[h.index],m===void 0)for(m=h.data[h.index]=Array(l),b=0;b<l;b++)m[b]=Ce;return h.index++,m}function eo(l,h){return typeof h=="function"?h(l):h}function jo(l){var h=mr();return Kd(h,ei,l)}function Kd(l,h,m){var b=l.queue;if(b===null)throw Error(i(311));b.lastRenderedReducer=m;var k=l.baseQueue,D=b.pending;if(D!==null){if(k!==null){var q=k.next;k.next=D.next,D.next=q}h.baseQueue=k=D,b.pending=null}if(D=l.baseState,k===null)l.memoizedState=D;else{h=k.next;var te=q=null,Te=null,Ze=h,pt=!1;do{var xt=Ze.lane&-536870913;if(xt!==Ze.lane?(Hn&xt)===xt:(El&xt)===xt){var Je=Ze.revertLane;if(Je===0)Te!==null&&(Te=Te.next={lane:0,revertLane:0,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null}),xt===Qe&&(pt=!0);else if((El&Je)===Je){Ze=Ze.next,Je===Qe&&(pt=!0);continue}else xt={lane:0,revertLane:Ze.revertLane,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null},Te===null?(te=Te=xt,q=D):Te=Te.next=xt,Rn.lanes|=Je,Da|=Je;xt=Ze.action,ks&&m(D,xt),D=Ze.hasEagerState?Ze.eagerState:m(D,xt)}else Je={lane:xt,revertLane:Ze.revertLane,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null},Te===null?(te=Te=Je,q=D):Te=Te.next=Je,Rn.lanes|=xt,Da|=xt;Ze=Ze.next}while(Ze!==null&&Ze!==h);if(Te===null?q=D:Te.next=te,!Ar(D,l.memoizedState)&&(zr=!0,pt&&(m=Mt,m!==null)))throw m;l.memoizedState=D,l.baseState=q,l.baseQueue=Te,b.lastRenderedState=D}return k===null&&(b.lanes=0),[l.memoizedState,b.dispatch]}function kc(l){var h=mr(),m=h.queue;if(m===null)throw Error(i(311));m.lastRenderedReducer=l;var b=m.dispatch,k=m.pending,D=h.memoizedState;if(k!==null){m.pending=null;var q=k=k.next;do D=l(D,q.action),q=q.next;while(q!==k);Ar(D,h.memoizedState)||(zr=!0),h.memoizedState=D,h.baseQueue===null&&(h.baseState=D),m.lastRenderedState=D}return[D,b]}function Ch(l,h,m){var b=Rn,k=mr(),D=Gn;if(D){if(m===void 0)throw Error(i(407));m=m()}else m=h();var q=!Ar((ei||k).memoizedState,m);q&&(k.memoizedState=m,zr=!0),k=k.queue;var te=Gm.bind(null,b,k,l);if(Mh(2048,8,te,[l]),k.getSnapshot!==h||q||Ii!==null&&Ii.memoizedState.tag&1){if(b.flags|=2048,Rl(9,kl(),Ym.bind(null,b,k,m,h),null),yi===null)throw Error(i(349));D||(El&124)!==0||Rh(b,h,m)}return m}function Rh(l,h,m){l.flags|=16384,l={getSnapshot:h,value:m},h=Rn.updateQueue,h===null?(h=Eh(),Rn.updateQueue=h,h.stores=[l]):(m=h.stores,m===null?h.stores=[l]:m.push(l))}function Ym(l,h,m,b){h.value=m,h.getSnapshot=b,Yr(h)&&Gr(l)}function Gm(l,h,m){return m(function(){Yr(h)&&Gr(l)})}function Yr(l){var h=l.getSnapshot;l=l.value;try{var m=h();return!Ar(l,m)}catch{return!0}}function Gr(l){var h=Za(l,2);h!==null&&Os(h,l,2)}function Mf(l){var h=ps();if(typeof l=="function"){var m=l;if(l=m(),ks){at(!0);try{m()}finally{at(!1)}}}return h.memoizedState=h.baseState=l,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:eo,lastRenderedState:l},h}function Pf(l,h,m,b){return l.baseState=m,Kd(l,ei,typeof b=="function"?b:eo)}function Km(l,h,m,b,k){if(Bh(l))throw Error(i(485));if(l=h.action,l!==null){var D={payload:k,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){D.listeners.push(q)}};we.T!==null?m(!0):D.isTransition=!1,b(D),m=h.pending,m===null?(D.next=h.pending=D,gu(h,D)):(D.next=m.next,h.pending=m.next=D)}}function gu(l,h){var m=h.action,b=h.payload,k=l.state;if(h.isTransition){var D=we.T,q={};we.T=q;try{var te=m(k,b),Te=we.S;Te!==null&&Te(q,te),Qm(l,h,te)}catch(Ze){Df(l,h,Ze)}finally{we.T=D}}else try{D=m(k,b),Qm(l,h,D)}catch(Ze){Df(l,h,Ze)}}function Qm(l,h,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(b){Qd(l,h,b)},function(b){return Df(l,h,b)}):Qd(l,h,m)}function Qd(l,h,m){h.status="fulfilled",h.value=m,kh(h),l.state=m,h=l.pending,h!==null&&(m=h.next,m===h?l.pending=null:(m=m.next,h.next=m,gu(l,m)))}function Df(l,h,m){var b=l.pending;if(l.pending=null,b!==null){b=b.next;do h.status="rejected",h.reason=m,kh(h),h=h.next;while(h!==b)}l.action=null}function kh(l){l=l.listeners;for(var h=0;h<l.length;h++)(0,l[h])()}function Jd(l,h){return h}function ep(l,h){if(Gn){var m=yi.formState;if(m!==null){e:{var b=Rn;if(Gn){if(Vn){t:{for(var k=Vn,D=jn;k.nodeType!==8;){if(!D){k=null;break t}if(k=Oa(k.nextSibling),k===null){k=null;break t}}D=k.data,k=D==="F!"||D==="F"?k:null}if(k){Vn=Oa(k.nextSibling),b=k.data==="F!";break e}}Ka(b)}b=!1}b&&(h=m[0])}}return m=ps(),m.memoizedState=m.baseState=h,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jd,lastRenderedState:h},m.queue=b,m=Oh.bind(null,Rn,b),b.dispatch=m,b=Mf(!1),D=Mc.bind(null,Rn,!1,b.queue),b=ps(),k={state:h,dispatch:null,action:l,pending:null},b.queue=k,m=Km.bind(null,Rn,k,D,m),k.dispatch=m,b.memoizedState=l,[h,m,!1]}function tp(l){var h=mr();return Jm(h,ei,l)}function Jm(l,h,m){if(h=Kd(l,h,Jd)[0],l=jo(eo)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var b=Ah(h)}catch(q){throw q===En?Nr:q}else b=h;h=mr();var k=h.queue,D=k.dispatch;return m!==h.memoizedState&&(Rn.flags|=2048,Rl(9,kl(),np.bind(null,k,m),null)),[b,D,l]}function np(l,h){l.action=h}function ip(l){var h=mr(),m=ei;if(m!==null)return Jm(h,m,l);mr(),h=h.memoizedState,m=mr();var b=m.queue.dispatch;return m.memoizedState=l,[h,b,!1]}function Rl(l,h,m,b){return l={tag:l,create:m,deps:b,inst:h,next:null},h=Rn.updateQueue,h===null&&(h=Eh(),Rn.updateQueue=h),m=h.lastEffect,m===null?h.lastEffect=l.next=l:(b=m.next,m.next=l,l.next=b,h.lastEffect=l),l}function kl(){return{destroy:void 0,resource:void 0}}function Is(){return mr().memoizedState}function Ih(l,h,m,b){var k=ps();b=b===void 0?null:b,Rn.flags|=l,k.memoizedState=Rl(1|h,kl(),m,b)}function Mh(l,h,m,b){var k=mr();b=b===void 0?null:b;var D=k.memoizedState.inst;ei!==null&&b!==null&&Th(b,ei.memoizedState.deps)?k.memoizedState=Rl(h,D,m,b):(Rn.flags|=l,k.memoizedState=Rl(1|h,D,m,b))}function eg(l,h){Ih(8390656,8,l,h)}function tg(l,h){Mh(2048,8,l,h)}function Ph(l,h){return Mh(4,2,l,h)}function Dh(l,h){return Mh(4,4,l,h)}function rp(l,h){if(typeof h=="function"){l=l();var m=h(l);return function(){typeof m=="function"?m():h(null)}}if(h!=null)return l=l(),h.current=l,function(){h.current=null}}function Il(l,h,m){m=m!=null?m.concat([l]):null,Mh(4,4,rp.bind(null,h,l),m)}function Ic(){}function ng(l,h){var m=mr();h=h===void 0?null:h;var b=m.memoizedState;return h!==null&&Th(h,b[1])?b[0]:(m.memoizedState=[l,h],l)}function ig(l,h){var m=mr();h=h===void 0?null:h;var b=m.memoizedState;if(h!==null&&Th(h,b[1]))return b[0];if(b=l(),ks){at(!0);try{l()}finally{at(!1)}}return m.memoizedState=[b,h],b}function sp(l,h,m){return m===void 0||(El&1073741824)!==0?l.memoizedState=h:(l.memoizedState=m,l=Lp(),Rn.lanes|=l,Da|=l,m)}function rg(l,h,m,b){return Ar(m,h)?m:ka.current!==null?(l=sp(l,m,b),Ar(l,h)||(zr=!0),l):(El&42)===0?(zr=!0,l.memoizedState=m):(l=Lp(),Rn.lanes|=l,Da|=l,h)}function sg(l,h,m,b,k){var D=Ye.p;Ye.p=D!==0&&8>D?D:8;var q=we.T,te={};we.T=te,Mc(l,!1,h,m);try{var Te=k(),Ze=we.S;if(Ze!==null&&Ze(te,Te),Te!==null&&typeof Te=="object"&&typeof Te.then=="function"){var pt=un(Te,b);Pl(l,h,pt,Ds(l))}else Pl(l,h,b,Ds(l))}catch(xt){Pl(l,h,{then:function(){},status:"rejected",reason:xt},Ds())}finally{Ye.p=D,we.T=q}}function ay(){}function ap(l,h,m,b){if(l.tag!==5)throw Error(i(476));var k=Of(l).queue;sg(l,k,h,gt,m===null?ay:function(){return ag(l),m(b)})}function Of(l){var h=l.memoizedState;if(h!==null)return h;h={memoizedState:gt,baseState:gt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:eo,lastRenderedState:gt},next:null};var m={};return h.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:eo,lastRenderedState:m},next:null},l.memoizedState=h,l=l.alternate,l!==null&&(l.memoizedState=h),h}function ag(l){var h=Of(l).next.queue;Pl(l,h,{},Ds())}function Ml(){return se(Kp)}function og(){return mr().memoizedState}function zi(){return mr().memoizedState}function Bf(l){for(var h=l.return;h!==null;){switch(h.tag){case 24:case 3:var m=Ds();l=Sn(m);var b=hi(h,l,m);b!==null&&(Os(b,h,m),pr(b,h,m)),h={cache:He()},l.payload=h;return}h=h.return}}function lg(l,h,m){var b=Ds();m={lane:b,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null},Bh(l)?op(h,m):(m=bl(l,h,m,b),m!==null&&(Os(m,l,b),_u(m,h,b)))}function Oh(l,h,m){var b=Ds();Pl(l,h,m,b)}function Pl(l,h,m,b){var k={lane:b,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null};if(Bh(l))op(h,k);else{var D=l.alternate;if(l.lanes===0&&(D===null||D.lanes===0)&&(D=h.lastRenderedReducer,D!==null))try{var q=h.lastRenderedState,te=D(q,m);if(k.hasEagerState=!0,k.eagerState=te,Ar(te,q))return uu(l,h,k,0),yi===null&&cu(),!1}catch{}finally{}if(m=bl(l,h,k,b),m!==null)return Os(m,l,b),_u(m,h,b),!0}return!1}function Mc(l,h,m,b){if(b={lane:2,revertLane:vt(),action:b,hasEagerState:!1,eagerState:null,next:null},Bh(l)){if(h)throw Error(i(479))}else h=bl(l,m,b,2),h!==null&&Os(h,l,2)}function Bh(l){var h=l.alternate;return l===Rn||h!==null&&h===Rn}function op(l,h){cs=_a=!0;var m=l.pending;m===null?h.next=h:(h.next=m.next,m.next=h),l.pending=h}function _u(l,h,m){if((m&4194048)!==0){var b=h.lanes;b&=l.pendingLanes,m|=b,h.lanes=m,Sa(l,m)}}var yu={readContext:se,use:mu,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useLayoutEffect:kn,useInsertionEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useSyncExternalStore:kn,useId:kn,useHostTransitionStatus:kn,useFormState:kn,useActionState:kn,useOptimistic:kn,useMemoCache:kn,useCacheRefresh:kn},Nf={readContext:se,use:mu,useCallback:function(l,h){return ps().memoizedState=[l,h===void 0?null:h],l},useContext:se,useEffect:eg,useImperativeHandle:function(l,h,m){m=m!=null?m.concat([l]):null,Ih(4194308,4,rp.bind(null,h,l),m)},useLayoutEffect:function(l,h){return Ih(4194308,4,l,h)},useInsertionEffect:function(l,h){Ih(4,2,l,h)},useMemo:function(l,h){var m=ps();h=h===void 0?null:h;var b=l();if(ks){at(!0);try{l()}finally{at(!1)}}return m.memoizedState=[b,h],b},useReducer:function(l,h,m){var b=ps();if(m!==void 0){var k=m(h);if(ks){at(!0);try{m(h)}finally{at(!1)}}}else k=h;return b.memoizedState=b.baseState=k,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:k},b.queue=l,l=l.dispatch=lg.bind(null,Rn,l),[b.memoizedState,l]},useRef:function(l){var h=ps();return l={current:l},h.memoizedState=l},useState:function(l){l=Mf(l);var h=l.queue,m=Oh.bind(null,Rn,h);return h.dispatch=m,[l.memoizedState,m]},useDebugValue:Ic,useDeferredValue:function(l,h){var m=ps();return sp(m,l,h)},useTransition:function(){var l=Mf(!1);return l=sg.bind(null,Rn,l.queue,!0,!1),ps().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,h,m){var b=Rn,k=ps();if(Gn){if(m===void 0)throw Error(i(407));m=m()}else{if(m=h(),yi===null)throw Error(i(349));(Hn&124)!==0||Rh(b,h,m)}k.memoizedState=m;var D={value:m,getSnapshot:h};return k.queue=D,eg(Gm.bind(null,b,D,l),[l]),b.flags|=2048,Rl(9,kl(),Ym.bind(null,b,D,m,h),null),m},useId:function(){var l=ps(),h=yi.identifierPrefix;if(Gn){var m=Gt,b=$t;m=(b&~(1<<32-nn(b)-1)).toString(32)+m,h=""+h+"R"+m,m=wh++,0<m&&(h+="H"+m.toString(32)),h+=""}else m=Zm++,h=""+h+"r"+m.toString(32)+"";return l.memoizedState=h},useHostTransitionStatus:Ml,useFormState:ep,useActionState:ep,useOptimistic:function(l){var h=ps();h.memoizedState=h.baseState=l;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=m,h=Mc.bind(null,Rn,!0,m),m.dispatch=h,[l,h]},useMemoCache:If,useCacheRefresh:function(){return ps().memoizedState=Bf.bind(null,Rn)}},cg={readContext:se,use:mu,useCallback:ng,useContext:se,useEffect:tg,useImperativeHandle:Il,useInsertionEffect:Ph,useLayoutEffect:Dh,useMemo:ig,useReducer:jo,useRef:Is,useState:function(){return jo(eo)},useDebugValue:Ic,useDeferredValue:function(l,h){var m=mr();return rg(m,ei.memoizedState,l,h)},useTransition:function(){var l=jo(eo)[0],h=mr().memoizedState;return[typeof l=="boolean"?l:Ah(l),h]},useSyncExternalStore:Ch,useId:og,useHostTransitionStatus:Ml,useFormState:tp,useActionState:tp,useOptimistic:function(l,h){var m=mr();return Pf(m,ei,l,h)},useMemoCache:If,useCacheRefresh:zi},ug={readContext:se,use:mu,useCallback:ng,useContext:se,useEffect:tg,useImperativeHandle:Il,useInsertionEffect:Ph,useLayoutEffect:Dh,useMemo:ig,useReducer:kc,useRef:Is,useState:function(){return kc(eo)},useDebugValue:Ic,useDeferredValue:function(l,h){var m=mr();return ei===null?sp(m,l,h):rg(m,ei.memoizedState,l,h)},useTransition:function(){var l=kc(eo)[0],h=mr().memoizedState;return[typeof l=="boolean"?l:Ah(l),h]},useSyncExternalStore:Ch,useId:og,useHostTransitionStatus:Ml,useFormState:ip,useActionState:ip,useOptimistic:function(l,h){var m=mr();return ei!==null?Pf(m,ei,l,h):(m.baseState=l,[l,m.queue.dispatch])},useMemoCache:If,useCacheRefresh:zi},to=null,Nh=0;function bu(l){var h=Nh;return Nh+=1,to===null&&(to=[]),Qa(to,l,h)}function zh(l,h){h=h.props.ref,l.ref=h!==void 0?h:null}function xu(l,h){throw h.$$typeof===R?Error(i(525)):(l=Object.prototype.toString.call(h),Error(i(31,l==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":l)))}function zf(l){var h=l._init;return h(l._payload)}function Lf(l){function h(Ue,Ie){if(l){var We=Ue.deletions;We===null?(Ue.deletions=[Ie],Ue.flags|=16):We.push(Ie)}}function m(Ue,Ie){if(!l)return null;for(;Ie!==null;)h(Ue,Ie),Ie=Ie.sibling;return null}function b(Ue){for(var Ie=new Map;Ue!==null;)Ue.key!==null?Ie.set(Ue.key,Ue):Ie.set(Ue.index,Ue),Ue=Ue.sibling;return Ie}function k(Ue,Ie){return Ue=ss(Ue,Ie),Ue.index=0,Ue.sibling=null,Ue}function D(Ue,Ie,We){return Ue.index=We,l?(We=Ue.alternate,We!==null?(We=We.index,We<Ie?(Ue.flags|=67108866,Ie):We):(Ue.flags|=67108866,Ie)):(Ue.flags|=1048576,Ie)}function q(Ue){return l&&Ue.alternate===null&&(Ue.flags|=67108866),Ue}function te(Ue,Ie,We,_t){return Ie===null||Ie.tag!==6?(Ie=ui(We,Ue.mode,_t),Ie.return=Ue,Ie):(Ie=k(Ie,We),Ie.return=Ue,Ie)}function Te(Ue,Ie,We,_t){var en=We.type;return en===L?pt(Ue,Ie,We.props.children,_t,We.key):Ie!==null&&(Ie.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===mt&&zf(en)===Ie.type)?(Ie=k(Ie,We.props),zh(Ie,We),Ie.return=Ue,Ie):(Ie=Fo(We.type,We.key,We.props,null,Ue.mode,_t),zh(Ie,We),Ie.return=Ue,Ie)}function Ze(Ue,Ie,We,_t){return Ie===null||Ie.tag!==4||Ie.stateNode.containerInfo!==We.containerInfo||Ie.stateNode.implementation!==We.implementation?(Ie=vl(We,Ue.mode,_t),Ie.return=Ue,Ie):(Ie=k(Ie,We.children||[]),Ie.return=Ue,Ie)}function pt(Ue,Ie,We,_t,en){return Ie===null||Ie.tag!==7?(Ie=dr(We,Ue.mode,_t,en),Ie.return=Ue,Ie):(Ie=k(Ie,We),Ie.return=Ue,Ie)}function xt(Ue,Ie,We){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Ie=ui(""+Ie,Ue.mode,We),Ie.return=Ue,Ie;if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case I:return We=Fo(Ie.type,Ie.key,Ie.props,null,Ue.mode,We),zh(We,Ie),We.return=Ue,We;case N:return Ie=vl(Ie,Ue.mode,We),Ie.return=Ue,Ie;case mt:var _t=Ie._init;return Ie=_t(Ie._payload),xt(Ue,Ie,We)}if(lt(Ie)||Me(Ie))return Ie=dr(Ie,Ue.mode,We,null),Ie.return=Ue,Ie;if(typeof Ie.then=="function")return xt(Ue,bu(Ie),We);if(Ie.$$typeof===re)return xt(Ue,ue(Ue,Ie),We);xu(Ue,Ie)}return null}function Je(Ue,Ie,We,_t){var en=Ie!==null?Ie.key:null;if(typeof We=="string"&&We!==""||typeof We=="number"||typeof We=="bigint")return en!==null?null:te(Ue,Ie,""+We,_t);if(typeof We=="object"&&We!==null){switch(We.$$typeof){case I:return We.key===en?Te(Ue,Ie,We,_t):null;case N:return We.key===en?Ze(Ue,Ie,We,_t):null;case mt:return en=We._init,We=en(We._payload),Je(Ue,Ie,We,_t)}if(lt(We)||Me(We))return en!==null?null:pt(Ue,Ie,We,_t,null);if(typeof We.then=="function")return Je(Ue,Ie,bu(We),_t);if(We.$$typeof===re)return Je(Ue,Ie,ue(Ue,We),_t);xu(Ue,We)}return null}function tt(Ue,Ie,We,_t,en){if(typeof _t=="string"&&_t!==""||typeof _t=="number"||typeof _t=="bigint")return Ue=Ue.get(We)||null,te(Ie,Ue,""+_t,en);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case I:return Ue=Ue.get(_t.key===null?We:_t.key)||null,Te(Ie,Ue,_t,en);case N:return Ue=Ue.get(_t.key===null?We:_t.key)||null,Ze(Ie,Ue,_t,en);case mt:var qn=_t._init;return _t=qn(_t._payload),tt(Ue,Ie,We,_t,en)}if(lt(_t)||Me(_t))return Ue=Ue.get(We)||null,pt(Ie,Ue,_t,en,null);if(typeof _t.then=="function")return tt(Ue,Ie,We,bu(_t),en);if(_t.$$typeof===re)return tt(Ue,Ie,We,ue(Ie,_t),en);xu(Ie,_t)}return null}function bn(Ue,Ie,We,_t){for(var en=null,qn=null,sn=Ie,pn=Ie=0,us=null;sn!==null&&pn<We.length;pn++){sn.index>pn?(us=sn,sn=null):us=sn.sibling;var oi=Je(Ue,sn,We[pn],_t);if(oi===null){sn===null&&(sn=us);break}l&&sn&&oi.alternate===null&&h(Ue,sn),Ie=D(oi,Ie,pn),qn===null?en=oi:qn.sibling=oi,qn=oi,sn=us}if(pn===We.length)return m(Ue,sn),Gn&&Xs(Ue,pn),en;if(sn===null){for(;pn<We.length;pn++)sn=xt(Ue,We[pn],_t),sn!==null&&(Ie=D(sn,Ie,pn),qn===null?en=sn:qn.sibling=sn,qn=sn);return Gn&&Xs(Ue,pn),en}for(sn=b(sn);pn<We.length;pn++)us=tt(sn,Ue,pn,We[pn],_t),us!==null&&(l&&us.alternate!==null&&sn.delete(us.key===null?pn:us.key),Ie=D(us,Ie,pn),qn===null?en=us:qn.sibling=us,qn=us);return l&&sn.forEach(function(Lu){return h(Ue,Lu)}),Gn&&Xs(Ue,pn),en}function hn(Ue,Ie,We,_t){if(We==null)throw Error(i(151));for(var en=null,qn=null,sn=Ie,pn=Ie=0,us=null,oi=We.next();sn!==null&&!oi.done;pn++,oi=We.next()){sn.index>pn?(us=sn,sn=null):us=sn.sibling;var Lu=Je(Ue,sn,oi.value,_t);if(Lu===null){sn===null&&(sn=us);break}l&&sn&&Lu.alternate===null&&h(Ue,sn),Ie=D(Lu,Ie,pn),qn===null?en=Lu:qn.sibling=Lu,qn=Lu,sn=us}if(oi.done)return m(Ue,sn),Gn&&Xs(Ue,pn),en;if(sn===null){for(;!oi.done;pn++,oi=We.next())oi=xt(Ue,oi.value,_t),oi!==null&&(Ie=D(oi,Ie,pn),qn===null?en=oi:qn.sibling=oi,qn=oi);return Gn&&Xs(Ue,pn),en}for(sn=b(sn);!oi.done;pn++,oi=We.next())oi=tt(sn,Ue,pn,oi.value,_t),oi!==null&&(l&&oi.alternate!==null&&sn.delete(oi.key===null?pn:oi.key),Ie=D(oi,Ie,pn),qn===null?en=oi:qn.sibling=oi,qn=oi);return l&&sn.forEach(function(JE){return h(Ue,JE)}),Gn&&Xs(Ue,pn),en}function Ai(Ue,Ie,We,_t){if(typeof We=="object"&&We!==null&&We.type===L&&We.key===null&&(We=We.props.children),typeof We=="object"&&We!==null){switch(We.$$typeof){case I:e:{for(var en=We.key;Ie!==null;){if(Ie.key===en){if(en=We.type,en===L){if(Ie.tag===7){m(Ue,Ie.sibling),_t=k(Ie,We.props.children),_t.return=Ue,Ue=_t;break e}}else if(Ie.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===mt&&zf(en)===Ie.type){m(Ue,Ie.sibling),_t=k(Ie,We.props),zh(_t,We),_t.return=Ue,Ue=_t;break e}m(Ue,Ie);break}else h(Ue,Ie);Ie=Ie.sibling}We.type===L?(_t=dr(We.props.children,Ue.mode,_t,We.key),_t.return=Ue,Ue=_t):(_t=Fo(We.type,We.key,We.props,null,Ue.mode,_t),zh(_t,We),_t.return=Ue,Ue=_t)}return q(Ue);case N:e:{for(en=We.key;Ie!==null;){if(Ie.key===en)if(Ie.tag===4&&Ie.stateNode.containerInfo===We.containerInfo&&Ie.stateNode.implementation===We.implementation){m(Ue,Ie.sibling),_t=k(Ie,We.children||[]),_t.return=Ue,Ue=_t;break e}else{m(Ue,Ie);break}else h(Ue,Ie);Ie=Ie.sibling}_t=vl(We,Ue.mode,_t),_t.return=Ue,Ue=_t}return q(Ue);case mt:return en=We._init,We=en(We._payload),Ai(Ue,Ie,We,_t)}if(lt(We))return bn(Ue,Ie,We,_t);if(Me(We)){if(en=Me(We),typeof en!="function")throw Error(i(150));return We=en.call(We),hn(Ue,Ie,We,_t)}if(typeof We.then=="function")return Ai(Ue,Ie,bu(We),_t);if(We.$$typeof===re)return Ai(Ue,Ie,ue(Ue,We),_t);xu(Ue,We)}return typeof We=="string"&&We!==""||typeof We=="number"||typeof We=="bigint"?(We=""+We,Ie!==null&&Ie.tag===6?(m(Ue,Ie.sibling),_t=k(Ie,We),_t.return=Ue,Ue=_t):(m(Ue,Ie),_t=ui(We,Ue.mode,_t),_t.return=Ue,Ue=_t),q(Ue)):m(Ue,Ie)}return function(Ue,Ie,We,_t){try{Nh=0;var en=Ai(Ue,Ie,We,_t);return to=null,en}catch(sn){if(sn===En||sn===Nr)throw sn;var qn=rs(29,sn,null,Ue.mode);return qn.lanes=_t,qn.return=Ue,qn}finally{}}}var vu=Lf(!0),hg=Lf(!1),ya=Ke(null),no=null;function Dl(l){var h=l.alternate;ce(Li,Li.current&1),ce(ya,l),no===null&&(h===null||ka.current!==null||h.memoizedState!==null)&&(no=l)}function $o(l){if(l.tag===22){if(ce(Li,Li.current),ce(ya,l),no===null){var h=l.alternate;h!==null&&h.memoizedState!==null&&(no=l)}}else Ol()}function Ol(){ce(Li,Li.current),ce(ya,ya.current)}function io(l){Tt(ya),no===l&&(no=null),Tt(Li)}var Li=Ke(0);function Ff(l){for(var h=l;h!==null;){if(h.tag===13){var m=h.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||Wp(m)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}function lp(l,h,m,b){h=l.memoizedState,m=m(b,h),m=m==null?h:S({},h,m),l.memoizedState=m,l.lanes===0&&(l.updateQueue.baseState=m)}var cp={enqueueSetState:function(l,h,m){l=l._reactInternals;var b=Ds(),k=Sn(b);k.payload=h,m!=null&&(k.callback=m),h=hi(l,k,b),h!==null&&(Os(h,l,b),pr(h,l,b))},enqueueReplaceState:function(l,h,m){l=l._reactInternals;var b=Ds(),k=Sn(b);k.tag=1,k.payload=h,m!=null&&(k.callback=m),h=hi(l,k,b),h!==null&&(Os(h,l,b),pr(h,l,b))},enqueueForceUpdate:function(l,h){l=l._reactInternals;var m=Ds(),b=Sn(m);b.tag=2,h!=null&&(b.callback=h),h=hi(l,b,m),h!==null&&(Os(h,l,m),pr(h,l,m))}};function up(l,h,m,b,k,D,q){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(b,D,q):h.prototype&&h.prototype.isPureReactComponent?!_l(m,b)||!_l(k,D):!0}function hp(l,h,m,b){l=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(m,b),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(m,b),h.state!==l&&cp.enqueueReplaceState(h,h.state,null)}function Pc(l,h){var m=h;if("ref"in h){m={};for(var b in h)b!=="ref"&&(m[b]=h[b])}if(l=l.defaultProps){m===h&&(m=S({},m));for(var k in l)m[k]===void 0&&(m[k]=l[k])}return m}var Uf=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function fg(l){Uf(l)}function dg(l){console.error(l)}function Vf(l){Uf(l)}function Bl(l,h){try{var m=l.onUncaughtError;m(h.value,{componentStack:h.stack})}catch(b){setTimeout(function(){throw b})}}function jf(l,h,m){try{var b=l.onCaughtError;b(m.value,{componentStack:m.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function fp(l,h,m){return m=Sn(m),m.tag=3,m.payload={element:null},m.callback=function(){Bl(l,h)},m}function pg(l){return l=Sn(l),l.tag=3,l}function mg(l,h,m,b){var k=m.type.getDerivedStateFromError;if(typeof k=="function"){var D=b.value;l.payload=function(){return k(D)},l.callback=function(){jf(h,m,b)}}var q=m.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(l.callback=function(){jf(h,m,b),typeof k!="function"&&(jl===null?jl=new Set([this]):jl.add(this));var te=b.stack;this.componentDidCatch(b.value,{componentStack:te!==null?te:""})})}function Lh(l,h,m,b,k){if(m.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(h=m.alternate,h!==null&&Y(h,m,k,!0),m=ya.current,m!==null){switch(m.tag){case 13:return no===null?ed():m.alternate===null&&Ki===0&&(Ki=3),m.flags&=-257,m.flags|=65536,m.lanes=k,b===As?m.flags|=16384:(h=m.updateQueue,h===null?m.updateQueue=new Set([b]):h.add(b),j(l,b,k)),!1;case 22:return m.flags|=65536,b===As?m.flags|=16384:(h=m.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([b])},m.updateQueue=h):(m=h.retryQueue,m===null?h.retryQueue=new Set([b]):m.add(b)),j(l,b,k)),!1}throw Error(i(435,m.tag))}return j(l,b,k),ed(),!1}if(Gn)return h=ya.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=k,b!==Ni&&(l=Error(i(422),{cause:b}),y(Ss(l,m)))):(b!==Ni&&(h=Error(i(423),{cause:b}),y(Ss(h,m))),l=l.current.alternate,l.flags|=65536,k&=-k,l.lanes|=k,b=Ss(b,m),k=fp(l.stateNode,b,k),fi(l,k),Ki!==4&&(Ki=2)),!1;var D=Error(i(520),{cause:b});if(D=Ss(D,m),co===null?co=[D]:co.push(D),Ki!==4&&(Ki=2),h===null)return!0;b=Ss(b,m),m=h;do{switch(m.tag){case 3:return m.flags|=65536,l=k&-k,m.lanes|=l,l=fp(m.stateNode,b,l),fi(m,l),!1;case 1:if(h=m.type,D=m.stateNode,(m.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(jl===null||!jl.has(D))))return m.flags|=65536,k&=-k,m.lanes|=k,k=pg(k),mg(k,l,m,b),fi(m,k),!1}m=m.return}while(m!==null);return!1}var dp=Error(i(461)),zr=!1;function Kr(l,h,m,b){h.child=l===null?hg(h,null,m,b):vu(h,l.child,m,b)}function gg(l,h,m,b,k){m=m.render;var D=h.ref;if("ref"in b){var q={};for(var te in b)te!=="ref"&&(q[te]=b[te])}else q=b;return fe(h),b=Cf(l,h,m,q,D,k),te=Sh(),l!==null&&!zr?(kf(l,h,k),ro(l,h,k)):(Gn&&te&&Ac(h),h.flags|=1,Kr(l,h,b,k),h.child)}function _g(l,h,m,b,k){if(l===null){var D=m.type;return typeof D=="function"&&!Tc(D)&&D.defaultProps===void 0&&m.compare===null?(h.tag=15,h.type=D,yg(l,h,D,b,k)):(l=Fo(m.type,null,b,h,h.mode,k),l.ref=h.ref,l.return=h,h.child=l)}if(D=l.child,!Kn(l,k)){var q=D.memoizedProps;if(m=m.compare,m=m!==null?m:_l,m(q,b)&&l.ref===h.ref)return ro(l,h,k)}return h.flags|=1,l=ss(D,b),l.ref=h.ref,l.return=h,h.child=l}function yg(l,h,m,b,k){if(l!==null){var D=l.memoizedProps;if(_l(D,b)&&l.ref===h.ref)if(zr=!1,h.pendingProps=b=D,Kn(l,k))(l.flags&131072)!==0&&(zr=!0);else return h.lanes=l.lanes,ro(l,h,k)}return mp(l,h,m,b,k)}function bg(l,h,m){var b=h.pendingProps,k=b.children,D=l!==null?l.memoizedState:null;if(b.mode==="hidden"){if((h.flags&128)!==0){if(b=D!==null?D.baseLanes|m:m,l!==null){for(k=h.child=l.child,D=0;k!==null;)D=D|k.lanes|k.childLanes,k=k.sibling;h.childLanes=D&~b}else h.childLanes=0,h.child=null;return pp(l,h,b,m)}if((m&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},l!==null&&$n(h,D!==null?D.cachePool:null),D!==null?Rc(h,D):Vo(),$o(h);else return h.lanes=h.childLanes=536870912,pp(l,h,D!==null?D.baseLanes|m:m,m)}else D!==null?($n(h,D.cachePool),Rc(h,D),Ol(),h.memoizedState=null):(l!==null&&$n(h,null),Vo(),Ol());return Kr(l,h,k,m),h.child}function pp(l,h,m,b){var k=Wn();return k=k===null?null:{parent:Fe._currentValue,pool:k},h.memoizedState={baseLanes:m,cachePool:k},l!==null&&$n(h,null),Vo(),$o(h),l!==null&&Y(l,h,b,!0),null}function wu(l,h){var m=h.ref;if(m===null)l!==null&&l.ref!==null&&(h.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(i(284));(l===null||l.ref!==m)&&(h.flags|=4194816)}}function mp(l,h,m,b,k){return fe(h),m=Cf(l,h,m,b,void 0,k),b=Sh(),l!==null&&!zr?(kf(l,h,k),ro(l,h,k)):(Gn&&b&&Ac(h),h.flags|=1,Kr(l,h,m,k),h.child)}function gp(l,h,m,b,k,D){return fe(h),h.updateQueue=null,m=Cl(h,b,m,k),Al(l),b=Sh(),l!==null&&!zr?(kf(l,h,D),ro(l,h,D)):(Gn&&b&&Ac(h),h.flags|=1,Kr(l,h,m,D),h.child)}function _p(l,h,m,b,k){if(fe(h),h.stateNode===null){var D=sr,q=m.contextType;typeof q=="object"&&q!==null&&(D=se(q)),D=new m(b,D),h.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=cp,h.stateNode=D,D._reactInternals=h,D=h.stateNode,D.props=b,D.state=h.memoizedState,D.refs={},Dn(h),q=m.contextType,D.context=typeof q=="object"&&q!==null?se(q):sr,D.state=h.memoizedState,q=m.getDerivedStateFromProps,typeof q=="function"&&(lp(h,m,q,b),D.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(q=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),q!==D.state&&cp.enqueueReplaceState(D,D.state,null),ga(h,b,D,k),ma(),D.state=h.memoizedState),typeof D.componentDidMount=="function"&&(h.flags|=4194308),b=!0}else if(l===null){D=h.stateNode;var te=h.memoizedProps,Te=Pc(m,te);D.props=Te;var Ze=D.context,pt=m.contextType;q=sr,typeof pt=="object"&&pt!==null&&(q=se(pt));var xt=m.getDerivedStateFromProps;pt=typeof xt=="function"||typeof D.getSnapshotBeforeUpdate=="function",te=h.pendingProps!==te,pt||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(te||Ze!==q)&&hp(h,D,b,q),Ys=!1;var Je=h.memoizedState;D.state=Je,ga(h,b,D,k),ma(),Ze=h.memoizedState,te||Je!==Ze||Ys?(typeof xt=="function"&&(lp(h,m,xt,b),Ze=h.memoizedState),(Te=Ys||up(h,m,Te,b,Je,Ze,q))?(pt||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(h.flags|=4194308)):(typeof D.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=b,h.memoizedState=Ze),D.props=b,D.state=Ze,D.context=q,b=Te):(typeof D.componentDidMount=="function"&&(h.flags|=4194308),b=!1)}else{D=h.stateNode,si(l,h),q=h.memoizedProps,pt=Pc(m,q),D.props=pt,xt=h.pendingProps,Je=D.context,Ze=m.contextType,Te=sr,typeof Ze=="object"&&Ze!==null&&(Te=se(Ze)),te=m.getDerivedStateFromProps,(Ze=typeof te=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q!==xt||Je!==Te)&&hp(h,D,b,Te),Ys=!1,Je=h.memoizedState,D.state=Je,ga(h,b,D,k),ma();var tt=h.memoizedState;q!==xt||Je!==tt||Ys||l!==null&&l.dependencies!==null&&K(l.dependencies)?(typeof te=="function"&&(lp(h,m,te,b),tt=h.memoizedState),(pt=Ys||up(h,m,pt,b,Je,tt,Te)||l!==null&&l.dependencies!==null&&K(l.dependencies))?(Ze||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(b,tt,Te),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(b,tt,Te)),typeof D.componentDidUpdate=="function"&&(h.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof D.componentDidUpdate!="function"||q===l.memoizedProps&&Je===l.memoizedState||(h.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===l.memoizedProps&&Je===l.memoizedState||(h.flags|=1024),h.memoizedProps=b,h.memoizedState=tt),D.props=b,D.state=tt,D.context=Te,b=pt):(typeof D.componentDidUpdate!="function"||q===l.memoizedProps&&Je===l.memoizedState||(h.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===l.memoizedProps&&Je===l.memoizedState||(h.flags|=1024),b=!1)}return D=b,wu(l,h),b=(h.flags&128)!==0,D||b?(D=h.stateNode,m=b&&typeof m.getDerivedStateFromError!="function"?null:D.render(),h.flags|=1,l!==null&&b?(h.child=vu(h,l.child,null,k),h.child=vu(h,null,m,k)):Kr(l,h,m,k),h.memoizedState=D.state,l=h.child):l=ro(l,h,k),l}function yp(l,h,m,b){return o(),h.flags|=256,Kr(l,h,m,b),h.child}var bp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xp(l){return{baseLanes:l,cachePool:Pn()}}function vp(l,h,m){return l=l!==null?l.childLanes&~m:0,h&&(l|=Ms),l}function wp(l,h,m){var b=h.pendingProps,k=!1,D=(h.flags&128)!==0,q;if((q=D)||(q=l!==null&&l.memoizedState===null?!1:(Li.current&2)!==0),q&&(k=!0,h.flags&=-129),q=(h.flags&32)!==0,h.flags&=-33,l===null){if(Gn){if(k?Dl(h):Ol(),Gn){var te=Vn,Te;if(Te=te){e:{for(Te=te,te=jn;Te.nodeType!==8;){if(!te){te=null;break e}if(Te=Oa(Te.nextSibling),Te===null){te=null;break e}}te=Te}te!==null?(h.memoizedState={dehydrated:te,treeContext:pa!==null?{id:$t,overflow:Gt}:null,retryLane:536870912,hydrationErrors:null},Te=rs(18,null,null,0),Te.stateNode=te,Te.return=h,h.child=Te,Wi=h,Vn=null,Te=!0):Te=!1}Te||Ka(h)}if(te=h.memoizedState,te!==null&&(te=te.dehydrated,te!==null))return Wp(te)?h.lanes=32:h.lanes=536870912,null;io(h)}return te=b.children,b=b.fallback,k?(Ol(),k=h.mode,te=$f({mode:"hidden",children:te},k),b=dr(b,k,m,null),te.return=h,b.return=h,te.sibling=b,h.child=te,k=h.child,k.memoizedState=xp(m),k.childLanes=vp(l,q,m),h.memoizedState=bp,b):(Dl(h),Tp(h,te))}if(Te=l.memoizedState,Te!==null&&(te=Te.dehydrated,te!==null)){if(D)h.flags&256?(Dl(h),h.flags&=-257,h=Dc(l,h,m)):h.memoizedState!==null?(Ol(),h.child=l.child,h.flags|=128,h=null):(Ol(),k=b.fallback,te=h.mode,b=$f({mode:"visible",children:b.children},te),k=dr(k,te,m,null),k.flags|=2,b.return=h,k.return=h,b.sibling=k,h.child=b,vu(h,l.child,null,m),b=h.child,b.memoizedState=xp(m),b.childLanes=vp(l,q,m),h.memoizedState=bp,h=k);else if(Dl(h),Wp(te)){if(q=te.nextSibling&&te.nextSibling.dataset,q)var Ze=q.dgst;q=Ze,b=Error(i(419)),b.stack="",b.digest=q,y({value:b,source:null,stack:null}),h=Dc(l,h,m)}else if(zr||Y(l,h,m,!1),q=(m&l.childLanes)!==0,zr||q){if(q=yi,q!==null&&(b=m&-m,b=(b&42)!==0?1:ni(b),b=(b&(q.suspendedLanes|m))!==0?0:b,b!==0&&b!==Te.retryLane))throw Te.retryLane=b,Za(l,b),Os(q,l,b),dp;te.data==="$?"||ed(),h=Dc(l,h,m)}else te.data==="$?"?(h.flags|=192,h.child=l.child,h=null):(l=Te.treeContext,Vn=Oa(te.nextSibling),Wi=h,Gn=!0,Zs=null,jn=!1,l!==null&&(Es[Hi++]=$t,Es[Hi++]=Gt,Es[Hi++]=pa,$t=l.id,Gt=l.overflow,pa=h),h=Tp(h,b.children),h.flags|=4096);return h}return k?(Ol(),k=b.fallback,te=h.mode,Te=l.child,Ze=Te.sibling,b=ss(Te,{mode:"hidden",children:b.children}),b.subtreeFlags=Te.subtreeFlags&65011712,Ze!==null?k=ss(Ze,k):(k=dr(k,te,m,null),k.flags|=2),k.return=h,b.return=h,b.sibling=k,h.child=b,b=k,k=h.child,te=l.child.memoizedState,te===null?te=xp(m):(Te=te.cachePool,Te!==null?(Ze=Fe._currentValue,Te=Te.parent!==Ze?{parent:Ze,pool:Ze}:Te):Te=Pn(),te={baseLanes:te.baseLanes|m,cachePool:Te}),k.memoizedState=te,k.childLanes=vp(l,q,m),h.memoizedState=bp,b):(Dl(h),m=l.child,l=m.sibling,m=ss(m,{mode:"visible",children:b.children}),m.return=h,m.sibling=null,l!==null&&(q=h.deletions,q===null?(h.deletions=[l],h.flags|=16):q.push(l)),h.child=m,h.memoizedState=null,m)}function Tp(l,h){return h=$f({mode:"visible",children:h},l.mode),h.return=l,l.child=h}function $f(l,h){return l=rs(22,l,null,h),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function Dc(l,h,m){return vu(h,l.child,null,m),l=Tp(h,h.pendingProps.children),l.flags|=2,h.memoizedState=null,l}function gr(l,h,m){l.lanes|=h;var b=l.alternate;b!==null&&(b.lanes|=h),U(l.return,h,m)}function Fh(l,h,m,b,k){var D=l.memoizedState;D===null?l.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:b,tail:m,tailMode:k}:(D.isBackwards=h,D.rendering=null,D.renderingStartTime=0,D.last=b,D.tail=m,D.tailMode=k)}function Sp(l,h,m){var b=h.pendingProps,k=b.revealOrder,D=b.tail;if(Kr(l,h,b.children,m),b=Li.current,(b&2)!==0)b=b&1|2,h.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=h.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&gr(l,m,h);else if(l.tag===19)gr(l,m,h);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===h)break e;for(;l.sibling===null;){if(l.return===null||l.return===h)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}b&=1}switch(ce(Li,b),k){case"forwards":for(m=h.child,k=null;m!==null;)l=m.alternate,l!==null&&Ff(l)===null&&(k=m),m=m.sibling;m=k,m===null?(k=h.child,h.child=null):(k=m.sibling,m.sibling=null),Fh(h,!1,k,m,D);break;case"backwards":for(m=null,k=h.child,h.child=null;k!==null;){if(l=k.alternate,l!==null&&Ff(l)===null){h.child=k;break}l=k.sibling,k.sibling=m,m=k,k=l}Fh(h,!0,m,null,D);break;case"together":Fh(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function ro(l,h,m){if(l!==null&&(h.dependencies=l.dependencies),Da|=h.lanes,(m&h.childLanes)===0)if(l!==null){if(Y(l,h,m,!1),(m&h.childLanes)===0)return null}else return null;if(l!==null&&h.child!==l.child)throw Error(i(153));if(h.child!==null){for(l=h.child,m=ss(l,l.pendingProps),h.child=m,m.return=h;l.sibling!==null;)l=l.sibling,m=m.sibling=ss(l,l.pendingProps),m.return=h;m.sibling=null}return h.child}function Kn(l,h){return(l.lanes&h)!==0?!0:(l=l.dependencies,!!(l!==null&&K(l)))}function Nl(l,h,m){switch(h.tag){case 3:vn(h,h.stateNode.containerInfo),B(h,Fe,l.memoizedState.cache),o();break;case 27:case 5:Yi(h);break;case 4:vn(h,h.stateNode.containerInfo);break;case 10:B(h,h.type,h.memoizedProps.value);break;case 13:var b=h.memoizedState;if(b!==null)return b.dehydrated!==null?(Dl(h),h.flags|=128,null):(m&h.child.childLanes)!==0?wp(l,h,m):(Dl(h),l=ro(l,h,m),l!==null?l.sibling:null);Dl(h);break;case 19:var k=(l.flags&128)!==0;if(b=(m&h.childLanes)!==0,b||(Y(l,h,m,!1),b=(m&h.childLanes)!==0),k){if(b)return Sp(l,h,m);h.flags|=128}if(k=h.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),ce(Li,Li.current),b)break;return null;case 22:case 23:return h.lanes=0,bg(l,h,m);case 24:B(h,Fe,l.memoizedState.cache)}return ro(l,h,m)}function Hf(l,h,m){if(l!==null)if(l.memoizedProps!==h.pendingProps)zr=!0;else{if(!Kn(l,m)&&(h.flags&128)===0)return zr=!1,Nl(l,h,m);zr=(l.flags&131072)!==0}else zr=!1,Gn&&(h.flags&1048576)!==0&&wl(h,Ec,h.index);switch(h.lanes=0,h.tag){case 16:e:{l=h.pendingProps;var b=h.elementType,k=b._init;if(b=k(b._payload),h.type=b,typeof b=="function")Tc(b)?(l=Pc(b,l),h.tag=1,h=_p(null,h,b,l,m)):(h.tag=0,h=mp(null,h,b,l,m));else{if(b!=null){if(k=b.$$typeof,k===ge){h.tag=11,h=gg(null,h,b,l,m);break e}else if(k===it){h.tag=14,h=_g(null,h,b,l,m);break e}}throw h=Le(b)||b,Error(i(306,h,""))}}return h;case 0:return mp(l,h,h.type,h.pendingProps,m);case 1:return b=h.type,k=Pc(b,h.pendingProps),_p(l,h,b,k,m);case 3:e:{if(vn(h,h.stateNode.containerInfo),l===null)throw Error(i(387));b=h.pendingProps;var D=h.memoizedState;k=D.element,si(l,h),ga(h,b,null,m);var q=h.memoizedState;if(b=q.cache,B(h,Fe,b),b!==D.cache&&$(h,[Fe],m,!0),ma(),b=q.element,D.isDehydrated)if(D={element:b,isDehydrated:!1,cache:q.cache},h.updateQueue.baseState=D,h.memoizedState=D,h.flags&256){h=yp(l,h,b,m);break e}else if(b!==k){k=Ss(Error(i(424)),h),y(k),h=yp(l,h,b,m);break e}else{switch(l=h.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(Vn=Oa(l.firstChild),Wi=h,Gn=!0,Zs=null,jn=!0,m=hg(h,null,b,m),h.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(o(),b===k){h=ro(l,h,m);break e}Kr(l,h,b,m)}h=h.child}return h;case 26:return wu(l,h),l===null?(m=Ev(h.type,null,h.pendingProps,null))?h.memoizedState=m:Gn||(m=h.type,l=h.pendingProps,b=Ur(Ot.current).createElement(m),b[wi]=h,b[ur]=l,vi(b,m,l),ke(b),h.stateNode=b):h.memoizedState=Ev(h.type,l.memoizedProps,h.pendingProps,l.memoizedState),null;case 27:return Yi(h),l===null&&Gn&&(b=h.stateNode=Xp(h.type,h.pendingProps,Ot.current),Wi=h,jn=!0,k=Vn,Wl(h.type)?(Js=k,Vn=Oa(b.firstChild)):Vn=k),Kr(l,h,h.pendingProps.children,m),wu(l,h),l===null&&(h.flags|=4194304),h.child;case 5:return l===null&&Gn&&((k=b=Vn)&&(b=fy(b,h.type,h.pendingProps,jn),b!==null?(h.stateNode=b,Wi=h,Vn=Oa(b.firstChild),jn=!1,k=!0):k=!1),k||Ka(h)),Yi(h),k=h.type,D=h.pendingProps,q=l!==null?l.memoizedProps:null,b=D.children,id(k,D)?b=null:q!==null&&id(k,q)&&(h.flags|=32),h.memoizedState!==null&&(k=Cf(l,h,Rf,null,null,m),Kp._currentValue=k),wu(l,h),Kr(l,h,b,m),h.child;case 6:return l===null&&Gn&&((l=m=Vn)&&(m=dy(m,h.pendingProps,jn),m!==null?(h.stateNode=m,Wi=h,Vn=null,l=!0):l=!1),l||Ka(h)),null;case 13:return wp(l,h,m);case 4:return vn(h,h.stateNode.containerInfo),b=h.pendingProps,l===null?h.child=vu(h,null,b,m):Kr(l,h,b,m),h.child;case 11:return gg(l,h,h.type,h.pendingProps,m);case 7:return Kr(l,h,h.pendingProps,m),h.child;case 8:return Kr(l,h,h.pendingProps.children,m),h.child;case 12:return Kr(l,h,h.pendingProps.children,m),h.child;case 10:return b=h.pendingProps,B(h,h.type,b.value),Kr(l,h,b.children,m),h.child;case 9:return k=h.type._context,b=h.pendingProps.children,fe(h),k=se(k),b=b(k),h.flags|=1,Kr(l,h,b,m),h.child;case 14:return _g(l,h,h.type,h.pendingProps,m);case 15:return yg(l,h,h.type,h.pendingProps,m);case 19:return Sp(l,h,m);case 31:return b=h.pendingProps,m=h.mode,b={mode:b.mode,children:b.children},l===null?(m=$f(b,m),m.ref=h.ref,h.child=m,m.return=h,h=m):(m=ss(l.child,b),m.ref=h.ref,h.child=m,m.return=h,h=m),h;case 22:return bg(l,h,m);case 24:return fe(h),b=se(Fe),l===null?(k=Wn(),k===null&&(k=yi,D=He(),k.pooledCache=D,D.refCount++,D!==null&&(k.pooledCacheLanes|=m),k=D),h.memoizedState={parent:b,cache:k},Dn(h),B(h,Fe,k)):((l.lanes&m)!==0&&(si(l,h),ga(h,null,null,m),ma()),k=l.memoizedState,D=h.memoizedState,k.parent!==b?(k={parent:b,cache:b},h.memoizedState=k,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=k),B(h,Fe,b)):(b=D.cache,B(h,Fe,b),b!==k.cache&&$(h,[Fe],m,!0))),Kr(l,h,h.pendingProps.children,m),h.child;case 29:throw h.pendingProps}throw Error(i(156,h.tag))}function so(l){l.flags|=4}function Ep(l,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!Iv(h)){if(h=ya.current,h!==null&&((Hn&4194048)===Hn?no!==null:(Hn&62914560)!==Hn&&(Hn&536870912)===0||h!==no))throw Xi=As,zn;l.flags|=8192}}function ba(l,h){h!==null&&(l.flags|=4),l.flags&16384&&(h=l.tag!==22?ts():536870912,l.lanes|=h,Vl|=h)}function ao(l,h){if(!Gn)switch(l.tailMode){case"hidden":h=l.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l.tail=null:m.sibling=null;break;case"collapsed":m=l.tail;for(var b=null;m!==null;)m.alternate!==null&&(b=m),m=m.sibling;b===null?h||l.tail===null?l.tail=null:l.tail.sibling=null:b.sibling=null}}function Fi(l){var h=l.alternate!==null&&l.alternate.child===l.child,m=0,b=0;if(h)for(var k=l.child;k!==null;)m|=k.lanes|k.childLanes,b|=k.subtreeFlags&65011712,b|=k.flags&65011712,k.return=l,k=k.sibling;else for(k=l.child;k!==null;)m|=k.lanes|k.childLanes,b|=k.subtreeFlags,b|=k.flags,k.return=l,k=k.sibling;return l.subtreeFlags|=b,l.childLanes=m,h}function oy(l,h,m){var b=h.pendingProps;switch(qi(h),h.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(h),null;case 1:return Fi(h),null;case 3:return m=h.stateNode,b=null,l!==null&&(b=l.memoizedState.cache),h.memoizedState.cache!==b&&(h.flags|=2048),z(Fe),Qn(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(l===null||l.child===null)&&(v(h)?so(h):l===null||l.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,p())),Fi(h),null;case 26:return m=h.memoizedState,l===null?(so(h),m!==null?(Fi(h),Ep(h,m)):(Fi(h),h.flags&=-16777217)):m?m!==l.memoizedState?(so(h),Fi(h),Ep(h,m)):(Fi(h),h.flags&=-16777217):(l.memoizedProps!==b&&so(h),Fi(h),h.flags&=-16777217),null;case 27:Pr(h),m=Ot.current;var k=h.type;if(l!==null&&h.stateNode!=null)l.memoizedProps!==b&&so(h);else{if(!b){if(h.stateNode===null)throw Error(i(166));return Fi(h),null}l=zt.current,v(h)?Uo(h):(l=Xp(k,b,m),h.stateNode=l,so(h))}return Fi(h),null;case 5:if(Pr(h),m=h.type,l!==null&&h.stateNode!=null)l.memoizedProps!==b&&so(h);else{if(!b){if(h.stateNode===null)throw Error(i(166));return Fi(h),null}if(l=zt.current,v(h))Uo(h);else{switch(k=Ur(Ot.current),l){case 1:l=k.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:l=k.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":l=k.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":l=k.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":l=k.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof b.is=="string"?k.createElement("select",{is:b.is}):k.createElement("select"),b.multiple?l.multiple=!0:b.size&&(l.size=b.size);break;default:l=typeof b.is=="string"?k.createElement(m,{is:b.is}):k.createElement(m)}}l[wi]=h,l[ur]=b;e:for(k=h.child;k!==null;){if(k.tag===5||k.tag===6)l.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===h)break e;for(;k.sibling===null;){if(k.return===null||k.return===h)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}h.stateNode=l;e:switch(vi(l,m,b),m){case"button":case"input":case"select":case"textarea":l=!!b.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&so(h)}}return Fi(h),h.flags&=-16777217,null;case 6:if(l&&h.stateNode!=null)l.memoizedProps!==b&&so(h);else{if(typeof b!="string"&&h.stateNode===null)throw Error(i(166));if(l=Ot.current,v(h)){if(l=h.stateNode,m=h.memoizedProps,b=null,k=Wi,k!==null)switch(k.tag){case 27:case 5:b=k.memoizedProps}l[wi]=h,l=!!(l.nodeValue===m||b!==null&&b.suppressHydrationWarning===!0||Ir(l.nodeValue,m)),l||Ka(h)}else l=Ur(l).createTextNode(b),l[wi]=h,h.stateNode=l}return Fi(h),null;case 13:if(b=h.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(k=v(h),b!==null&&b.dehydrated!==null){if(l===null){if(!k)throw Error(i(318));if(k=h.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(i(317));k[wi]=h}else o(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Fi(h),k=!1}else k=p(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=k),k=!0;if(!k)return h.flags&256?(io(h),h):(io(h),null)}if(io(h),(h.flags&128)!==0)return h.lanes=m,h;if(m=b!==null,l=l!==null&&l.memoizedState!==null,m){b=h.child,k=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(k=b.alternate.memoizedState.cachePool.pool);var D=null;b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(D=b.memoizedState.cachePool.pool),D!==k&&(b.flags|=2048)}return m!==l&&m&&(h.child.flags|=8192),ba(h,h.updateQueue),Fi(h),null;case 4:return Qn(),l===null&&Ui(h.stateNode.containerInfo),Fi(h),null;case 10:return z(h.type),Fi(h),null;case 19:if(Tt(Li),k=h.memoizedState,k===null)return Fi(h),null;if(b=(h.flags&128)!==0,D=k.rendering,D===null)if(b)ao(k,!1);else{if(Ki!==0||l!==null&&(l.flags&128)!==0)for(l=h.child;l!==null;){if(D=Ff(l),D!==null){for(h.flags|=128,ao(k,!1),l=D.updateQueue,h.updateQueue=l,ba(h,l),h.subtreeFlags=0,l=m,m=h.child;m!==null;)fu(m,l),m=m.sibling;return ce(Li,Li.current&1|2),h.child}l=l.sibling}k.tail!==null&&ir()>Nc&&(h.flags|=128,b=!0,ao(k,!1),h.lanes=4194304)}else{if(!b)if(l=Ff(D),l!==null){if(h.flags|=128,b=!0,l=l.updateQueue,h.updateQueue=l,ba(h,l),ao(k,!0),k.tail===null&&k.tailMode==="hidden"&&!D.alternate&&!Gn)return Fi(h),null}else 2*ir()-k.renderingStartTime>Nc&&m!==536870912&&(h.flags|=128,b=!0,ao(k,!1),h.lanes=4194304);k.isBackwards?(D.sibling=h.child,h.child=D):(l=k.last,l!==null?l.sibling=D:h.child=D,k.last=D)}return k.tail!==null?(h=k.tail,k.rendering=h,k.tail=h.sibling,k.renderingStartTime=ir(),h.sibling=null,l=Li.current,ce(Li,b?l&1|2:l&1),h):(Fi(h),null);case 22:case 23:return io(h),Sl(),b=h.memoizedState!==null,l!==null?l.memoizedState!==null!==b&&(h.flags|=8192):b&&(h.flags|=8192),b?(m&536870912)!==0&&(h.flags&128)===0&&(Fi(h),h.subtreeFlags&6&&(h.flags|=8192)):Fi(h),m=h.updateQueue,m!==null&&ba(h,m.retryQueue),m=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),b=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),b!==m&&(h.flags|=2048),l!==null&&Tt(Kt),null;case 24:return m=null,l!==null&&(m=l.memoizedState.cache),h.memoizedState.cache!==m&&(h.flags|=2048),z(Fe),Fi(h),null;case 25:return null;case 30:return null}throw Error(i(156,h.tag))}function ly(l,h){switch(qi(h),h.tag){case 1:return l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 3:return z(Fe),Qn(),l=h.flags,(l&65536)!==0&&(l&128)===0?(h.flags=l&-65537|128,h):null;case 26:case 27:case 5:return Pr(h),null;case 13:if(io(h),l=h.memoizedState,l!==null&&l.dehydrated!==null){if(h.alternate===null)throw Error(i(340));o()}return l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 19:return Tt(Li),null;case 4:return Qn(),null;case 10:return z(h.type),null;case 22:case 23:return io(h),Sl(),l!==null&&Tt(Kt),l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 24:return z(Fe),null;case 25:return null;default:return null}}function xg(l,h){switch(qi(h),h.tag){case 3:z(Fe),Qn();break;case 26:case 27:case 5:Pr(h);break;case 4:Qn();break;case 13:io(h);break;case 19:Tt(Li);break;case 10:z(h.type);break;case 22:case 23:io(h),Sl(),l!==null&&Tt(Kt);break;case 24:z(Fe)}}function Uh(l,h){try{var m=h.updateQueue,b=m!==null?m.lastEffect:null;if(b!==null){var k=b.next;m=k;do{if((m.tag&l)===l){b=void 0;var D=m.create,q=m.inst;b=D(),q.destroy=b}m=m.next}while(m!==k)}}catch(te){F(h,h.return,te)}}function zl(l,h,m){try{var b=h.updateQueue,k=b!==null?b.lastEffect:null;if(k!==null){var D=k.next;b=D;do{if((b.tag&l)===l){var q=b.inst,te=q.destroy;if(te!==void 0){q.destroy=void 0,k=h;var Te=m,Ze=te;try{Ze()}catch(pt){F(k,Te,pt)}}}b=b.next}while(b!==D)}}catch(pt){F(h,h.return,pt)}}function vg(l){var h=l.updateQueue;if(h!==null){var m=l.stateNode;try{du(h,m)}catch(b){F(l,l.return,b)}}}function wg(l,h,m){m.props=Pc(l.type,l.memoizedProps),m.state=l.memoizedState;try{m.componentWillUnmount()}catch(b){F(l,h,b)}}function Vh(l,h){try{var m=l.ref;if(m!==null){switch(l.tag){case 26:case 27:case 5:var b=l.stateNode;break;case 30:b=l.stateNode;break;default:b=l.stateNode}typeof m=="function"?l.refCleanup=m(b):m.current=b}}catch(k){F(l,h,k)}}function oo(l,h){var m=l.ref,b=l.refCleanup;if(m!==null)if(typeof b=="function")try{b()}catch(k){F(l,h,k)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(k){F(l,h,k)}else m.current=null}function jh(l){var h=l.type,m=l.memoizedProps,b=l.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":m.autoFocus&&b.focus();break e;case"img":m.src?b.src=m.src:m.srcSet&&(b.srcset=m.srcSet)}}catch(k){F(l,l.return,k)}}function Ll(l,h,m){try{var b=l.stateNode;Go(b,l.type,m,h),b[ur]=h}catch(k){F(l,l.return,k)}}function Ap(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&Wl(l.type)||l.tag===4}function Cp(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||Ap(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&Wl(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Rp(l,h,m){var b=l.tag;if(b===5||b===6)l=l.stateNode,h?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(l,h):(h=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,h.appendChild(l),m=m._reactRootContainer,m!=null||h.onclick!==null||(h.onclick=vr));else if(b!==4&&(b===27&&Wl(l.type)&&(m=l.stateNode,h=null),l=l.child,l!==null))for(Rp(l,h,m),l=l.sibling;l!==null;)Rp(l,h,m),l=l.sibling}function qf(l,h,m){var b=l.tag;if(b===5||b===6)l=l.stateNode,h?m.insertBefore(l,h):m.appendChild(l);else if(b!==4&&(b===27&&Wl(l.type)&&(m=l.stateNode),l=l.child,l!==null))for(qf(l,h,m),l=l.sibling;l!==null;)qf(l,h,m),l=l.sibling}function kp(l){var h=l.stateNode,m=l.memoizedProps;try{for(var b=l.type,k=h.attributes;k.length;)h.removeAttributeNode(k[0]);vi(h,b,m),h[wi]=l,h[ur]=m}catch(D){F(l,l.return,D)}}var Ma=!1,Gi=!1,Tu=!1,Su=typeof WeakSet=="function"?WeakSet:Set,Zi=null;function Wf(l,h){if(l=l.containerInfo,Bs=Bg,l=gh(l),No(l)){if("selectionStart"in l)var m={start:l.selectionStart,end:l.selectionEnd};else e:{m=(m=l.ownerDocument)&&m.defaultView||window;var b=m.getSelection&&m.getSelection();if(b&&b.rangeCount!==0){m=b.anchorNode;var k=b.anchorOffset,D=b.focusNode;b=b.focusOffset;try{m.nodeType,D.nodeType}catch{m=null;break e}var q=0,te=-1,Te=-1,Ze=0,pt=0,xt=l,Je=null;t:for(;;){for(var tt;xt!==m||k!==0&&xt.nodeType!==3||(te=q+k),xt!==D||b!==0&&xt.nodeType!==3||(Te=q+b),xt.nodeType===3&&(q+=xt.nodeValue.length),(tt=xt.firstChild)!==null;)Je=xt,xt=tt;for(;;){if(xt===l)break t;if(Je===m&&++Ze===k&&(te=q),Je===D&&++pt===b&&(Te=q),(tt=xt.nextSibling)!==null)break;xt=Je,Je=xt.parentNode}xt=tt}m=te===-1||Te===-1?null:{start:te,end:Te}}else m=null}m=m||{start:0,end:0}}else m=null;for(bs={focusedElem:l,selectionRange:m},Bg=!1,Zi=h;Zi!==null;)if(h=Zi,l=h.child,(h.subtreeFlags&1024)!==0&&l!==null)l.return=h,Zi=l;else for(;Zi!==null;){switch(h=Zi,D=h.alternate,l=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&D!==null){l=void 0,m=h,k=D.memoizedProps,D=D.memoizedState,b=m.stateNode;try{var bn=Pc(m.type,k,m.elementType===m.type);l=b.getSnapshotBeforeUpdate(bn,D),b.__reactInternalSnapshotBeforeUpdate=l}catch(hn){F(m,m.return,hn)}}break;case 3:if((l&1024)!==0){if(l=h.stateNode.containerInfo,m=l.nodeType,m===9)qp(l);else if(m===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":qp(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(i(163))}if(l=h.sibling,l!==null){l.return=h.return,Zi=l;break}Zi=h.return}}function $h(l,h,m){var b=m.flags;switch(m.tag){case 0:case 11:case 15:gs(l,m),b&4&&Uh(5,m);break;case 1:if(gs(l,m),b&4)if(l=m.stateNode,h===null)try{l.componentDidMount()}catch(q){F(m,m.return,q)}else{var k=Pc(m.type,h.memoizedProps);h=h.memoizedState;try{l.componentDidUpdate(k,h,l.__reactInternalSnapshotBeforeUpdate)}catch(q){F(m,m.return,q)}}b&64&&vg(m),b&512&&Vh(m,m.return);break;case 3:if(gs(l,m),b&64&&(l=m.updateQueue,l!==null)){if(h=null,m.child!==null)switch(m.child.tag){case 27:case 5:h=m.child.stateNode;break;case 1:h=m.child.stateNode}try{du(l,h)}catch(q){F(m,m.return,q)}}break;case 27:h===null&&b&4&&kp(m);case 26:case 5:gs(l,m),h===null&&b&4&&jh(m),b&512&&Vh(m,m.return);break;case 12:gs(l,m);break;case 13:gs(l,m),b&4&&Mp(l,m),b&64&&(l=m.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(m=J.bind(null,m),py(l,m))));break;case 22:if(b=m.memoizedState!==null||Ma,!b){h=h!==null&&h.memoizedState!==null||Gi,k=Ma;var D=Gi;Ma=b,(Gi=h)&&!D?qo(l,m,(m.subtreeFlags&8772)!==0):gs(l,m),Ma=k,Gi=D}break;case 30:break;default:gs(l,m)}}function Tg(l){var h=l.alternate;h!==null&&(l.alternate=null,Tg(h)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(h=l.stateNode,h!==null&&le(h)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var Mi=null,ms=!1;function Ho(l,h,m){for(m=m.child;m!==null;)Ip(l,h,m),m=m.sibling}function Ip(l,h,m){if(Ee&&typeof Ee.onCommitFiberUnmount=="function")try{Ee.onCommitFiberUnmount(ft,m)}catch{}switch(m.tag){case 26:Gi||oo(m,h),Ho(l,h,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:Gi||oo(m,h);var b=Mi,k=ms;Wl(m.type)&&(Mi=m.stateNode,ms=!1),Ho(l,h,m),Mr(m.stateNode),Mi=b,ms=k;break;case 5:Gi||oo(m,h);case 6:if(b=Mi,k=ms,Mi=null,Ho(l,h,m),Mi=b,ms=k,Mi!==null)if(ms)try{(Mi.nodeType===9?Mi.body:Mi.nodeName==="HTML"?Mi.ownerDocument.body:Mi).removeChild(m.stateNode)}catch(D){F(m,h,D)}else try{Mi.removeChild(m.stateNode)}catch(D){F(m,h,D)}break;case 18:Mi!==null&&(ms?(l=Mi,Ig(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,m.stateNode),tm(l)):Ig(Mi,m.stateNode));break;case 4:b=Mi,k=ms,Mi=m.stateNode.containerInfo,ms=!0,Ho(l,h,m),Mi=b,ms=k;break;case 0:case 11:case 14:case 15:Gi||zl(2,m,h),Gi||zl(4,m,h),Ho(l,h,m);break;case 1:Gi||(oo(m,h),b=m.stateNode,typeof b.componentWillUnmount=="function"&&wg(m,h,b)),Ho(l,h,m);break;case 21:Ho(l,h,m);break;case 22:Gi=(b=Gi)||m.memoizedState!==null,Ho(l,h,m),Gi=b;break;default:Ho(l,h,m)}}function Mp(l,h){if(h.memoizedState===null&&(l=h.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{tm(l)}catch(m){F(h,h.return,m)}}function Pp(l){switch(l.tag){case 13:case 19:var h=l.stateNode;return h===null&&(h=l.stateNode=new Su),h;case 22:return l=l.stateNode,h=l._retryCache,h===null&&(h=l._retryCache=new Su),h;default:throw Error(i(435,l.tag))}}function Hh(l,h){var m=Pp(l);h.forEach(function(b){var k=ee.bind(null,l,b);m.has(b)||(m.add(b),b.then(k,k))})}function Gs(l,h){var m=h.deletions;if(m!==null)for(var b=0;b<m.length;b++){var k=m[b],D=l,q=h,te=q;e:for(;te!==null;){switch(te.tag){case 27:if(Wl(te.type)){Mi=te.stateNode,ms=!1;break e}break;case 5:Mi=te.stateNode,ms=!1;break e;case 3:case 4:Mi=te.stateNode.containerInfo,ms=!0;break e}te=te.return}if(Mi===null)throw Error(i(160));Ip(D,q,k),Mi=null,ms=!1,D=k.alternate,D!==null&&(D.return=null),k.return=null}if(h.subtreeFlags&13878)for(h=h.child;h!==null;)Dp(h,l),h=h.sibling}var Pa=null;function Dp(l,h){var m=l.alternate,b=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Gs(h,l),ar(l),b&4&&(zl(3,l,l.return),Uh(3,l),zl(5,l,l.return));break;case 1:Gs(h,l),ar(l),b&512&&(Gi||m===null||oo(m,m.return)),b&64&&Ma&&(l=l.updateQueue,l!==null&&(b=l.callbacks,b!==null&&(m=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=m===null?b:m.concat(b))));break;case 26:var k=Pa;if(Gs(h,l),ar(l),b&512&&(Gi||m===null||oo(m,m.return)),b&4){var D=m!==null?m.memoizedState:null;if(b=l.memoizedState,m===null)if(b===null)if(l.stateNode===null){e:{b=l.type,m=l.memoizedProps,k=k.ownerDocument||k;t:switch(b){case"title":D=k.getElementsByTagName("title")[0],(!D||D[Q]||D[wi]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=k.createElement(b),k.head.insertBefore(D,k.querySelector("head > title"))),vi(D,b,m),D[wi]=l,ke(D),b=D;break e;case"link":var q=Rv("link","href",k).get(b+(m.href||""));if(q){for(var te=0;te<q.length;te++)if(D=q[te],D.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&D.getAttribute("rel")===(m.rel==null?null:m.rel)&&D.getAttribute("title")===(m.title==null?null:m.title)&&D.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){q.splice(te,1);break t}}D=k.createElement(b),vi(D,b,m),k.head.appendChild(D);break;case"meta":if(q=Rv("meta","content",k).get(b+(m.content||""))){for(te=0;te<q.length;te++)if(D=q[te],D.getAttribute("content")===(m.content==null?null:""+m.content)&&D.getAttribute("name")===(m.name==null?null:m.name)&&D.getAttribute("property")===(m.property==null?null:m.property)&&D.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&D.getAttribute("charset")===(m.charSet==null?null:m.charSet)){q.splice(te,1);break t}}D=k.createElement(b),vi(D,b,m),k.head.appendChild(D);break;default:throw Error(i(468,b))}D[wi]=l,ke(D),b=D}l.stateNode=b}else kv(k,l.type,l.stateNode);else l.stateNode=Cv(k,b,l.memoizedProps);else D!==b?(D===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):D.count--,b===null?kv(k,l.type,l.stateNode):Cv(k,b,l.memoizedProps)):b===null&&l.stateNode!==null&&Ll(l,l.memoizedProps,m.memoizedProps)}break;case 27:Gs(h,l),ar(l),b&512&&(Gi||m===null||oo(m,m.return)),m!==null&&b&4&&Ll(l,l.memoizedProps,m.memoizedProps);break;case 5:if(Gs(h,l),ar(l),b&512&&(Gi||m===null||oo(m,m.return)),l.flags&32){k=l.stateNode;try{ua(k,"")}catch(tt){F(l,l.return,tt)}}b&4&&l.stateNode!=null&&(k=l.memoizedProps,Ll(l,k,m!==null?m.memoizedProps:k)),b&1024&&(Tu=!0);break;case 6:if(Gs(h,l),ar(l),b&4){if(l.stateNode===null)throw Error(i(162));b=l.memoizedProps,m=l.stateNode;try{m.nodeValue=b}catch(tt){F(l,l.return,tt)}}break;case 3:if(Pg=null,k=Pa,Pa=Xl(h.containerInfo),Gs(h,l),Pa=k,ar(l),b&4&&m!==null&&m.memoizedState.isDehydrated)try{tm(h.containerInfo)}catch(tt){F(l,l.return,tt)}Tu&&(Tu=!1,Op(l));break;case 4:b=Pa,Pa=Xl(l.stateNode.containerInfo),Gs(h,l),ar(l),Pa=b;break;case 12:Gs(h,l),ar(l);break;case 13:Gs(h,l),ar(l),l.child.flags&8192&&l.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(Gf=ir()),b&4&&(b=l.updateQueue,b!==null&&(l.updateQueue=null,Hh(l,b)));break;case 22:k=l.memoizedState!==null;var Te=m!==null&&m.memoizedState!==null,Ze=Ma,pt=Gi;if(Ma=Ze||k,Gi=pt||Te,Gs(h,l),Gi=pt,Ma=Ze,ar(l),b&8192)e:for(h=l.stateNode,h._visibility=k?h._visibility&-2:h._visibility|1,k&&(m===null||Te||Ma||Gi||Fl(l)),m=null,h=l;;){if(h.tag===5||h.tag===26){if(m===null){Te=m=h;try{if(D=Te.stateNode,k)q=D.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{te=Te.stateNode;var xt=Te.memoizedProps.style,Je=xt!=null&&xt.hasOwnProperty("display")?xt.display:null;te.style.display=Je==null||typeof Je=="boolean"?"":(""+Je).trim()}}catch(tt){F(Te,Te.return,tt)}}}else if(h.tag===6){if(m===null){Te=h;try{Te.stateNode.nodeValue=k?"":Te.memoizedProps}catch(tt){F(Te,Te.return,tt)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===l)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break e;for(;h.sibling===null;){if(h.return===null||h.return===l)break e;m===h&&(m=null),h=h.return}m===h&&(m=null),h.sibling.return=h.return,h=h.sibling}b&4&&(b=l.updateQueue,b!==null&&(m=b.retryQueue,m!==null&&(b.retryQueue=null,Hh(l,m))));break;case 19:Gs(h,l),ar(l),b&4&&(b=l.updateQueue,b!==null&&(l.updateQueue=null,Hh(l,b)));break;case 30:break;case 21:break;default:Gs(h,l),ar(l)}}function ar(l){var h=l.flags;if(h&2){try{for(var m,b=l.return;b!==null;){if(Ap(b)){m=b;break}b=b.return}if(m==null)throw Error(i(160));switch(m.tag){case 27:var k=m.stateNode,D=Cp(l);qf(l,D,k);break;case 5:var q=m.stateNode;m.flags&32&&(ua(q,""),m.flags&=-33);var te=Cp(l);qf(l,te,q);break;case 3:case 4:var Te=m.stateNode.containerInfo,Ze=Cp(l);Rp(l,Ze,Te);break;default:throw Error(i(161))}}catch(pt){F(l,l.return,pt)}l.flags&=-3}h&4096&&(l.flags&=-4097)}function Op(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var h=l;Op(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),l=l.sibling}}function gs(l,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)$h(l,h.alternate,h),h=h.sibling}function Fl(l){for(l=l.child;l!==null;){var h=l;switch(h.tag){case 0:case 11:case 14:case 15:zl(4,h,h.return),Fl(h);break;case 1:oo(h,h.return);var m=h.stateNode;typeof m.componentWillUnmount=="function"&&wg(h,h.return,m),Fl(h);break;case 27:Mr(h.stateNode);case 26:case 5:oo(h,h.return),Fl(h);break;case 22:h.memoizedState===null&&Fl(h);break;case 30:Fl(h);break;default:Fl(h)}l=l.sibling}}function qo(l,h,m){for(m=m&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var b=h.alternate,k=l,D=h,q=D.flags;switch(D.tag){case 0:case 11:case 15:qo(k,D,m),Uh(4,D);break;case 1:if(qo(k,D,m),b=D,k=b.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(Ze){F(b,b.return,Ze)}if(b=D,k=b.updateQueue,k!==null){var te=b.stateNode;try{var Te=k.shared.hiddenCallbacks;if(Te!==null)for(k.shared.hiddenCallbacks=null,k=0;k<Te.length;k++)Cc(Te[k],te)}catch(Ze){F(b,b.return,Ze)}}m&&q&64&&vg(D),Vh(D,D.return);break;case 27:kp(D);case 26:case 5:qo(k,D,m),m&&b===null&&q&4&&jh(D),Vh(D,D.return);break;case 12:qo(k,D,m);break;case 13:qo(k,D,m),m&&q&4&&Mp(k,D);break;case 22:D.memoizedState===null&&qo(k,D,m),Vh(D,D.return);break;case 30:break;default:qo(k,D,m)}h=h.sibling}}function Xf(l,h){var m=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),l=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(l=h.memoizedState.cachePool.pool),l!==m&&(l!=null&&l.refCount++,m!=null&&rt(m))}function Zf(l,h){l=null,h.alternate!==null&&(l=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==l&&(h.refCount++,l!=null&&rt(l))}function lo(l,h,m,b){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Sg(l,h,m,b),h=h.sibling}function Sg(l,h,m,b){var k=h.flags;switch(h.tag){case 0:case 11:case 15:lo(l,h,m,b),k&2048&&Uh(9,h);break;case 1:lo(l,h,m,b);break;case 3:lo(l,h,m,b),k&2048&&(l=null,h.alternate!==null&&(l=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==l&&(h.refCount++,l!=null&&rt(l)));break;case 12:if(k&2048){lo(l,h,m,b),l=h.stateNode;try{var D=h.memoizedProps,q=D.id,te=D.onPostCommit;typeof te=="function"&&te(q,h.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(Te){F(h,h.return,Te)}}else lo(l,h,m,b);break;case 13:lo(l,h,m,b);break;case 23:break;case 22:D=h.stateNode,q=h.alternate,h.memoizedState!==null?D._visibility&2?lo(l,h,m,b):Eu(l,h):D._visibility&2?lo(l,h,m,b):(D._visibility|=2,Oc(l,h,m,b,(h.subtreeFlags&10256)!==0)),k&2048&&Xf(q,h);break;case 24:lo(l,h,m,b),k&2048&&Zf(h.alternate,h);break;default:lo(l,h,m,b)}}function Oc(l,h,m,b,k){for(k=k&&(h.subtreeFlags&10256)!==0,h=h.child;h!==null;){var D=l,q=h,te=m,Te=b,Ze=q.flags;switch(q.tag){case 0:case 11:case 15:Oc(D,q,te,Te,k),Uh(8,q);break;case 23:break;case 22:var pt=q.stateNode;q.memoizedState!==null?pt._visibility&2?Oc(D,q,te,Te,k):Eu(D,q):(pt._visibility|=2,Oc(D,q,te,Te,k)),k&&Ze&2048&&Xf(q.alternate,q);break;case 24:Oc(D,q,te,Te,k),k&&Ze&2048&&Zf(q.alternate,q);break;default:Oc(D,q,te,Te,k)}h=h.sibling}}function Eu(l,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var m=l,b=h,k=b.flags;switch(b.tag){case 22:Eu(m,b),k&2048&&Xf(b.alternate,b);break;case 24:Eu(m,b),k&2048&&Zf(b.alternate,b);break;default:Eu(m,b)}h=h.sibling}}var Au=8192;function Wo(l){if(l.subtreeFlags&Au)for(l=l.child;l!==null;)Bp(l),l=l.sibling}function Bp(l){switch(l.tag){case 26:Wo(l),l.flags&Au&&l.memoizedState!==null&&$E(Pa,l.memoizedState,l.memoizedProps);break;case 5:Wo(l);break;case 3:case 4:var h=Pa;Pa=Xl(l.stateNode.containerInfo),Wo(l),Pa=h;break;case 22:l.memoizedState===null&&(h=l.alternate,h!==null&&h.memoizedState!==null?(h=Au,Au=16777216,Wo(l),Au=h):Wo(l));break;default:Wo(l)}}function qh(l){var h=l.alternate;if(h!==null&&(l=h.child,l!==null)){h.child=null;do h=l.sibling,l.sibling=null,l=h;while(l!==null)}}function Ul(l){var h=l.deletions;if((l.flags&16)!==0){if(h!==null)for(var m=0;m<h.length;m++){var b=h[m];Zi=b,Eg(b,l)}qh(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)Wh(l),l=l.sibling}function Wh(l){switch(l.tag){case 0:case 11:case 15:Ul(l),l.flags&2048&&zl(9,l,l.return);break;case 3:Ul(l);break;case 12:Ul(l);break;case 22:var h=l.stateNode;l.memoizedState!==null&&h._visibility&2&&(l.return===null||l.return.tag!==13)?(h._visibility&=-3,Yf(l)):Ul(l);break;default:Ul(l)}}function Yf(l){var h=l.deletions;if((l.flags&16)!==0){if(h!==null)for(var m=0;m<h.length;m++){var b=h[m];Zi=b,Eg(b,l)}qh(l)}for(l=l.child;l!==null;){switch(h=l,h.tag){case 0:case 11:case 15:zl(8,h,h.return),Yf(h);break;case 22:m=h.stateNode,m._visibility&2&&(m._visibility&=-3,Yf(h));break;default:Yf(h)}l=l.sibling}}function Eg(l,h){for(;Zi!==null;){var m=Zi;switch(m.tag){case 0:case 11:case 15:zl(8,m,h);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var b=m.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:rt(m.memoizedState.cache)}if(b=m.child,b!==null)b.return=m,Zi=b;else e:for(m=l;Zi!==null;){b=Zi;var k=b.sibling,D=b.return;if(Tg(b),b===m){Zi=null;break e}if(k!==null){k.return=D,Zi=k;break e}Zi=D}}}var cy={getCacheForType:function(l){var h=se(Fe),m=h.data.get(l);return m===void 0&&(m=l(),h.data.set(l,m)),m}},uy=typeof WeakMap=="function"?WeakMap:Map,Zn=0,yi=null,Ln=null,Hn=0,di=0,_r=null,Xo=!1,Bc=!1,Np=!1,Zo=0,Ki=0,Da=0,Yo=0,zp=0,Ms=0,Vl=0,co=null,Ps=null,Xh=!1,Gf=0,Nc=1/0,Cu=null,jl=null,Qr=0,$l=null,Ru=null,ku=0,Kf=0,Ei=null,Hl=null,Iu=0,Qf=null;function Ds(){if((Zn&2)!==0&&Hn!==0)return Hn&-Hn;if(we.T!==null){var l=Qe;return l!==0?l:vt()}return Va()}function Lp(){Ms===0&&(Ms=(Hn&536870912)===0||Gn?Dr():536870912);var l=ya.current;return l!==null&&(l.flags|=32),Ms}function Os(l,h,m){(l===yi&&(di===2||di===9)||l.cancelPendingCommit!==null)&&(ho(l,0),uo(l,Hn,Ms,!1)),Xr(l,m),((Zn&2)===0||l!==yi)&&(l===yi&&((Zn&2)===0&&(Yo|=m),Ki===4&&uo(l,Hn,Ms,!1)),ut(l))}function Jf(l,h,m){if((Zn&6)!==0)throw Error(i(327));var b=!m&&(h&124)===0&&(h&l.expiredLanes)===0||rn(l,h),k=b?hy(l,h):td(l,h,!0),D=b;do{if(k===0){Bc&&!b&&uo(l,h,0,!1);break}else{if(m=l.current.alternate,D&&!Ag(m)){k=td(l,h,!1),D=!1;continue}if(k===2){if(D=h,l.errorRecoveryDisabledLanes&D)var q=0;else q=l.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){h=q;e:{var te=l;k=co;var Te=te.current.memoizedState.isDehydrated;if(Te&&(ho(te,q).flags|=256),q=td(te,q,!1),q!==2){if(Np&&!Te){te.errorRecoveryDisabledLanes|=D,Yo|=D,k=4;break e}D=Ps,Ps=k,D!==null&&(Ps===null?Ps=D:Ps.push.apply(Ps,D))}k=q}if(D=!1,k!==2)continue}}if(k===1){ho(l,0),uo(l,h,0,!0);break}e:{switch(b=l,D=k,D){case 0:case 1:throw Error(i(345));case 4:if((h&4194048)!==h)break;case 6:uo(b,h,Ms,!Xo);break e;case 2:Ps=null;break;case 3:case 5:break;default:throw Error(i(329))}if((h&62914560)===h&&(k=Gf+300-ir(),10<k)){if(uo(b,h,Ms,!Xo),wt(b,0,!0)!==0)break e;b.timeoutHandle=po(Zh.bind(null,b,m,Ps,Cu,Xh,h,Ms,Yo,Vl,Xo,D,2,-0,0),k);break e}Zh(b,m,Ps,Cu,Xh,h,Ms,Yo,Vl,Xo,D,0,-0,0)}}break}while(!0);ut(l)}function Zh(l,h,m,b,k,D,q,te,Te,Ze,pt,xt,Je,tt){if(l.timeoutHandle=-1,xt=h.subtreeFlags,(xt&8192||(xt&16785408)===16785408)&&(Gp={stylesheets:null,count:0,unsuspend:jE},Bp(h),xt=HE(),xt!==null)){l.cancelPendingCommit=xt(s.bind(null,l,h,D,m,b,k,q,te,Te,pt,1,Je,tt)),uo(l,D,q,!Ze);return}s(l,h,D,m,b,k,q,te,Te)}function Ag(l){for(var h=l;;){var m=h.tag;if((m===0||m===11||m===15)&&h.flags&16384&&(m=h.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var b=0;b<m.length;b++){var k=m[b],D=k.getSnapshot;k=k.value;try{if(!Ar(D(),k))return!1}catch{return!1}}if(m=h.child,h.subtreeFlags&16384&&m!==null)m.return=h,h=m;else{if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function uo(l,h,m,b){h&=~zp,h&=~Yo,l.suspendedLanes|=h,l.pingedLanes&=~h,b&&(l.warmLanes|=h),b=l.expirationTimes;for(var k=h;0<k;){var D=31-nn(k),q=1<<D;b[D]=-1,k&=~q}m!==0&&Er(l,m,h)}function Yh(){return(Zn&6)===0?(Vt(0),!1):!0}function _s(){if(Ln!==null){if(di===0)var l=Ln.return;else l=Ln,M=A=null,Gd(l),to=null,Nh=0,l=Ln;for(;l!==null;)xg(l.alternate,l),l=l.return;Ln=null}}function ho(l,h){var m=l.timeoutHandle;m!==-1&&(l.timeoutHandle=-1,Rg(m)),m=l.cancelPendingCommit,m!==null&&(l.cancelPendingCommit=null,m()),_s(),yi=l,Ln=m=ss(l.current,null),Hn=h,di=0,_r=null,Xo=!1,Bc=rn(l,h),Np=!1,Vl=Ms=zp=Yo=Da=Ki=0,Ps=co=null,Xh=!1,(h&8)!==0&&(h|=h&32);var b=l.entangledLanes;if(b!==0)for(l=l.entanglements,b&=h;0<b;){var k=31-nn(b),D=1<<k;h|=l[k],b&=~D}return Zo=h,cu(),m}function Fp(l,h){Rn=null,we.H=yu,h===En||h===Nr?(h=Rs(),di=3):h===zn?(h=Rs(),di=4):di=h===dp?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,_r=h,Ln===null&&(Ki=1,Bl(l,Ss(h,l.current)))}function Up(){var l=we.H;return we.H=yu,l===null?yu:l}function Vp(){var l=we.A;return we.A=cy,l}function ed(){Ki=4,Xo||(Hn&4194048)!==Hn&&ya.current!==null||(Bc=!0),(Da&134217727)===0&&(Yo&134217727)===0||yi===null||uo(yi,Hn,Ms,!1)}function td(l,h,m){var b=Zn;Zn|=2;var k=Up(),D=Vp();(yi!==l||Hn!==h)&&(Cu=null,ho(l,h)),h=!1;var q=Ki;e:do try{if(di!==0&&Ln!==null){var te=Ln,Te=_r;switch(di){case 8:_s(),q=6;break e;case 3:case 2:case 9:case 6:ya.current===null&&(h=!0);var Ze=di;if(di=0,_r=null,ql(l,te,Te,Ze),m&&Bc){q=0;break e}break;default:Ze=di,di=0,_r=null,ql(l,te,Te,Ze)}}Cg(),q=Ki;break}catch(pt){Fp(l,pt)}while(!0);return h&&l.shellSuspendCounter++,M=A=null,Zn=b,we.H=k,we.A=D,Ln===null&&(yi=null,Hn=0,cu()),q}function Cg(){for(;Ln!==null;)Gh(Ln)}function hy(l,h){var m=Zn;Zn|=2;var b=Up(),k=Vp();yi!==l||Hn!==h?(Cu=null,Nc=ir()+500,ho(l,h)):Bc=rn(l,h);e:do try{if(di!==0&&Ln!==null){h=Ln;var D=_r;t:switch(di){case 1:di=0,_r=null,ql(l,h,D,1);break;case 2:case 9:if(Cs(D)){di=0,_r=null,Mu(h);break}h=function(){di!==2&&di!==9||yi!==l||(di=7),ut(l)},D.then(h,h);break e;case 3:di=7;break e;case 4:di=5;break e;case 7:Cs(D)?(di=0,_r=null,Mu(h)):(di=0,_r=null,ql(l,h,D,7));break;case 5:var q=null;switch(Ln.tag){case 26:q=Ln.memoizedState;case 5:case 27:var te=Ln;if(!q||Iv(q)){di=0,_r=null;var Te=te.sibling;if(Te!==null)Ln=Te;else{var Ze=te.return;Ze!==null?(Ln=Ze,nd(Ze)):Ln=null}break t}}di=0,_r=null,ql(l,h,D,5);break;case 6:di=0,_r=null,ql(l,h,D,6);break;case 8:_s(),Ki=6;break e;default:throw Error(i(462))}}jp();break}catch(pt){Fp(l,pt)}while(!0);return M=A=null,we.H=b,we.A=k,Zn=m,Ln!==null?0:(yi=null,Hn=0,cu(),Ki)}function jp(){for(;Ln!==null&&!nr();)Gh(Ln)}function Gh(l){var h=Hf(l.alternate,l,Zo);l.memoizedProps=l.pendingProps,h===null?nd(l):Ln=h}function Mu(l){var h=l,m=h.alternate;switch(h.tag){case 15:case 0:h=gp(m,h,h.pendingProps,h.type,void 0,Hn);break;case 11:h=gp(m,h,h.pendingProps,h.type.render,h.ref,Hn);break;case 5:Gd(h);default:xg(m,h),h=Ln=fu(h,Zo),h=Hf(m,h,Zo)}l.memoizedProps=l.pendingProps,h===null?nd(l):Ln=h}function ql(l,h,m,b){M=A=null,Gd(h),to=null,Nh=0;var k=h.return;try{if(Lh(l,k,h,m,Hn)){Ki=1,Bl(l,Ss(m,l.current)),Ln=null;return}}catch(D){if(k!==null)throw Ln=k,D;Ki=1,Bl(l,Ss(m,l.current)),Ln=null;return}h.flags&32768?(Gn||b===1?l=!0:Bc||(Hn&536870912)!==0?l=!1:(Xo=l=!0,(b===2||b===9||b===3||b===6)&&(b=ya.current,b!==null&&b.tag===13&&(b.flags|=16384))),u(h,l)):nd(h)}function nd(l){var h=l;do{if((h.flags&32768)!==0){u(h,Xo);return}l=h.return;var m=oy(h.alternate,h,Zo);if(m!==null){Ln=m;return}if(h=h.sibling,h!==null){Ln=h;return}Ln=h=l}while(h!==null);Ki===0&&(Ki=5)}function u(l,h){do{var m=ly(l.alternate,l);if(m!==null){m.flags&=32767,Ln=m;return}if(m=l.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!h&&(l=l.sibling,l!==null)){Ln=l;return}Ln=l=m}while(l!==null);Ki=6,Ln=null}function s(l,h,m,b,k,D,q,te,Te){l.cancelPendingCommit=null;do C();while(Qr!==0);if((Zn&6)!==0)throw Error(i(327));if(h!==null){if(h===l.current)throw Error(i(177));if(D=h.lanes|h.childLanes,D|=lu,oa(l,m,D,q,te,Te),l===yi&&(Ln=yi=null,Hn=0),Ru=h,$l=l,ku=m,Kf=D,Ei=k,Hl=b,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,ve(ra,function(){return P(),null})):(l.callbackNode=null,l.callbackPriority=0),b=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||b){b=we.T,we.T=null,k=Ye.p,Ye.p=2,q=Zn,Zn|=4;try{Wf(l,h,m)}finally{Zn=q,Ye.p=k,we.T=b}}Qr=1,d(),g(),w()}}function d(){if(Qr===1){Qr=0;var l=$l,h=Ru,m=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||m){m=we.T,we.T=null;var b=Ye.p;Ye.p=2;var k=Zn;Zn|=4;try{Dp(h,l);var D=bs,q=gh(l.containerInfo),te=D.focusedElem,Te=D.selectionRange;if(q!==te&&te&&te.ownerDocument&&mh(te.ownerDocument.documentElement,te)){if(Te!==null&&No(te)){var Ze=Te.start,pt=Te.end;if(pt===void 0&&(pt=Ze),"selectionStart"in te)te.selectionStart=Ze,te.selectionEnd=Math.min(pt,te.value.length);else{var xt=te.ownerDocument||document,Je=xt&&xt.defaultView||window;if(Je.getSelection){var tt=Je.getSelection(),bn=te.textContent.length,hn=Math.min(Te.start,bn),Ai=Te.end===void 0?hn:Math.min(Te.end,bn);!tt.extend&&hn>Ai&&(q=Ai,Ai=hn,hn=q);var Ue=Bo(te,hn),Ie=Bo(te,Ai);if(Ue&&Ie&&(tt.rangeCount!==1||tt.anchorNode!==Ue.node||tt.anchorOffset!==Ue.offset||tt.focusNode!==Ie.node||tt.focusOffset!==Ie.offset)){var We=xt.createRange();We.setStart(Ue.node,Ue.offset),tt.removeAllRanges(),hn>Ai?(tt.addRange(We),tt.extend(Ie.node,Ie.offset)):(We.setEnd(Ie.node,Ie.offset),tt.addRange(We))}}}}for(xt=[],tt=te;tt=tt.parentNode;)tt.nodeType===1&&xt.push({element:tt,left:tt.scrollLeft,top:tt.scrollTop});for(typeof te.focus=="function"&&te.focus(),te=0;te<xt.length;te++){var _t=xt[te];_t.element.scrollLeft=_t.left,_t.element.scrollTop=_t.top}}Bg=!!Bs,bs=Bs=null}finally{Zn=k,Ye.p=b,we.T=m}}l.current=h,Qr=2}}function g(){if(Qr===2){Qr=0;var l=$l,h=Ru,m=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||m){m=we.T,we.T=null;var b=Ye.p;Ye.p=2;var k=Zn;Zn|=4;try{$h(l,h.alternate,h)}finally{Zn=k,Ye.p=b,we.T=m}}Qr=3}}function w(){if(Qr===4||Qr===3){Qr=0,xs();var l=$l,h=Ru,m=ku,b=Hl;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?Qr=5:(Qr=0,Ru=$l=null,E(l,l.pendingLanes));var k=l.pendingLanes;if(k===0&&(jl=null),ii(m),h=h.stateNode,Ee&&typeof Ee.onCommitFiberRoot=="function")try{Ee.onCommitFiberRoot(ft,h,void 0,(h.current.flags&128)===128)}catch{}if(b!==null){h=we.T,k=Ye.p,Ye.p=2,we.T=null;try{for(var D=l.onRecoverableError,q=0;q<b.length;q++){var te=b[q];D(te.value,{componentStack:te.stack})}}finally{we.T=h,Ye.p=k}}(ku&3)!==0&&C(),ut(l),k=l.pendingLanes,(m&4194090)!==0&&(k&42)!==0?l===Qf?Iu++:(Iu=0,Qf=l):Iu=0,Vt(0)}}function E(l,h){(l.pooledCacheLanes&=h)===0&&(h=l.pooledCache,h!=null&&(l.pooledCache=null,rt(h)))}function C(l){return d(),g(),w(),P()}function P(){if(Qr!==5)return!1;var l=$l,h=Kf;Kf=0;var m=ii(ku),b=we.T,k=Ye.p;try{Ye.p=32>m?32:m,we.T=null,m=Ei,Ei=null;var D=$l,q=ku;if(Qr=0,Ru=$l=null,ku=0,(Zn&6)!==0)throw Error(i(331));var te=Zn;if(Zn|=4,Wh(D.current),Sg(D,D.current,q,m),Zn=te,Vt(0,!1),Ee&&typeof Ee.onPostCommitFiberRoot=="function")try{Ee.onPostCommitFiberRoot(ft,D)}catch{}return!0}finally{Ye.p=k,we.T=b,E(l,h)}}function O(l,h,m){h=Ss(m,h),h=fp(l.stateNode,h,2),l=hi(l,h,2),l!==null&&(Xr(l,2),ut(l))}function F(l,h,m){if(l.tag===3)O(l,l,m);else for(;h!==null;){if(h.tag===3){O(h,l,m);break}else if(h.tag===1){var b=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(jl===null||!jl.has(b))){l=Ss(m,l),m=pg(2),b=hi(h,m,2),b!==null&&(mg(m,b,h,l),Xr(b,2),ut(b));break}}h=h.return}}function j(l,h,m){var b=l.pingCache;if(b===null){b=l.pingCache=new uy;var k=new Set;b.set(h,k)}else k=b.get(h),k===void 0&&(k=new Set,b.set(h,k));k.has(m)||(Np=!0,k.add(m),l=W.bind(null,l,h,m),h.then(l,l))}function W(l,h,m){var b=l.pingCache;b!==null&&b.delete(h),l.pingedLanes|=l.suspendedLanes&m,l.warmLanes&=~m,yi===l&&(Hn&m)===m&&(Ki===4||Ki===3&&(Hn&62914560)===Hn&&300>ir()-Gf?(Zn&2)===0&&ho(l,0):zp|=m,Vl===Hn&&(Vl=0)),ut(l)}function G(l,h){h===0&&(h=ts()),l=Za(l,h),l!==null&&(Xr(l,h),ut(l))}function J(l){var h=l.memoizedState,m=0;h!==null&&(m=h.retryLane),G(l,m)}function ee(l,h){var m=0;switch(l.tag){case 13:var b=l.stateNode,k=l.memoizedState;k!==null&&(m=k.retryLane);break;case 19:b=l.stateNode;break;case 22:b=l.stateNode._retryCache;break;default:throw Error(i(314))}b!==null&&b.delete(h),G(l,m)}function ve(l,h){return tr(l,h)}var ye=null,Ne=null,Ge=!1,De=!1,Xe=!1,dt=0;function ut(l){l!==Ne&&l.next===null&&(Ne===null?ye=Ne=l:Ne=Ne.next=l),De=!0,Ge||(Ge=!0,Pt())}function Vt(l,h){if(!Xe&&De){Xe=!0;do for(var m=!1,b=ye;b!==null;){if(l!==0){var k=b.pendingLanes;if(k===0)var D=0;else{var q=b.suspendedLanes,te=b.pingedLanes;D=(1<<31-nn(42|l)+1)-1,D&=k&~(q&~te),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(m=!0,Nt(b,D))}else D=Hn,D=wt(b,b===yi?D:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(D&3)===0||rn(b,D)||(m=!0,Nt(b,D));b=b.next}while(m);Xe=!1}}function Zt(){Bt()}function Bt(){De=Ge=!1;var l=0;dt!==0&&($p()&&(l=dt),dt=0);for(var h=ir(),m=null,b=ye;b!==null;){var k=b.next,D=Ct(b,h);D===0?(b.next=null,m===null?ye=k:m.next=k,k===null&&(Ne=m)):(m=b,(l!==0||(D&3)!==0)&&(De=!0)),b=k}Vt(l)}function Ct(l,h){for(var m=l.suspendedLanes,b=l.pingedLanes,k=l.expirationTimes,D=l.pendingLanes&-62914561;0<D;){var q=31-nn(D),te=1<<q,Te=k[q];Te===-1?((te&m)===0||(te&b)!==0)&&(k[q]=tn(te,h)):Te<=h&&(l.expiredLanes|=te),D&=~te}if(h=yi,m=Hn,m=wt(l,l===h?m:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),b=l.callbackNode,m===0||l===h&&(di===2||di===9)||l.cancelPendingCommit!==null)return b!==null&&b!==null&&ia(b),l.callbackNode=null,l.callbackPriority=0;if((m&3)===0||rn(l,m)){if(h=m&-m,h===l.callbackPriority)return h;switch(b!==null&&ia(b),ii(m)){case 2:case 8:m=qr;break;case 32:m=ra;break;case 268435456:m=Ta;break;default:m=ra}return b=Et.bind(null,l),m=tr(m,b),l.callbackPriority=h,l.callbackNode=m,h}return b!==null&&b!==null&&ia(b),l.callbackPriority=2,l.callbackNode=null,2}function Et(l,h){if(Qr!==0&&Qr!==5)return l.callbackNode=null,l.callbackPriority=0,null;var m=l.callbackNode;if(C()&&l.callbackNode!==m)return null;var b=Hn;return b=wt(l,l===yi?b:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),b===0?null:(Jf(l,b,h),Ct(l,ir()),l.callbackNode!=null&&l.callbackNode===m?Et.bind(null,l):null)}function Nt(l,h){if(C())return null;Jf(l,h,!0)}function Pt(){Hp(function(){(Zn&6)!==0?tr(wn,Zt):Bt()})}function vt(){return dt===0&&(dt=Dr()),dt}function Jt(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:ja(""+l)}function Yt(l,h){var m=h.ownerDocument.createElement("input");return m.name=h.name,m.value=h.value,l.id&&m.setAttribute("form",l.id),h.parentNode.insertBefore(m,h),l=new FormData(l),m.parentNode.removeChild(m),l}function xn(l,h,m,b,k){if(h==="submit"&&m&&m.stateNode===k){var D=Jt((k[ur]||null).action),q=b.submitter;q&&(h=(h=q[ur]||null)?Jt(h.formAction):q.getAttribute("formAction"),h!==null&&(D=h,q=null));var te=new Co("action","action",null,b,k);l.push({event:te,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(dt!==0){var Te=q?Yt(k,q):new FormData(k);ap(m,{pending:!0,data:Te,method:k.method,action:D},null,Te)}}else typeof D=="function"&&(te.preventDefault(),Te=q?Yt(k,q):new FormData(k),ap(m,{pending:!0,data:Te,method:k.method,action:D},D,Te))},currentTarget:k}]})}}for(var ai=0;ai<It.length;ai++){var pi=It[ai],or=pi.toLowerCase(),Ks=pi[0].toUpperCase()+pi.slice(1);ds(or,"on"+Ks)}ds(bh,"onAnimationEnd"),ds(Wa,"onAnimationIteration"),ds(Ca,"onAnimationStart"),ds("dblclick","onDoubleClick"),ds("focusin","onFocus"),ds("focusout","onBlur"),ds(jt,"onTransitionRun"),ds(xh,"onTransitionStart"),ds(wc,"onTransitionCancel"),ds(Xa,"onTransitionEnd"),Ft("onMouseEnter",["mouseout","mouseover"]),Ft("onMouseLeave",["mouseout","mouseover"]),Ft("onPointerEnter",["pointerout","pointerover"]),Ft("onPointerLeave",["pointerout","pointerover"]),ot("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ot("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ot("onBeforeInput",["compositionend","keypress","textInput","paste"]),ot("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ji=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qi));function lr(l,h){h=(h&4)!==0;for(var m=0;m<l.length;m++){var b=l[m],k=b.event;b=b.listeners;e:{var D=void 0;if(h)for(var q=b.length-1;0<=q;q--){var te=b[q],Te=te.instance,Ze=te.currentTarget;if(te=te.listener,Te!==D&&k.isPropagationStopped())break e;D=te,k.currentTarget=Ze;try{D(k)}catch(pt){Uf(pt)}k.currentTarget=null,D=Te}else for(q=0;q<b.length;q++){if(te=b[q],Te=te.instance,Ze=te.currentTarget,te=te.listener,Te!==D&&k.isPropagationStopped())break e;D=te,k.currentTarget=Ze;try{D(k)}catch(pt){Uf(pt)}k.currentTarget=null,D=Te}}}}function on(l,h){var m=h[Hs];m===void 0&&(m=h[Hs]=new Set);var b=l+"__bubble";m.has(b)||(Rr(h,l,2,!1),m.add(b))}function Cr(l,h,m){var b=0;h&&(b|=4),Rr(m,l,b,h)}var Lr="_reactListening"+Math.random().toString(36).slice(2);function Ui(l){if(!l[Lr]){l[Lr]=!0,et.forEach(function(m){m!=="selectionchange"&&(Ji.has(m)||Cr(m,!1,l),Cr(m,!0,l))});var h=l.nodeType===9?l:l.ownerDocument;h===null||h[Lr]||(h[Lr]=!0,Cr("selectionchange",!1,h))}}function Rr(l,h,m,b){switch(Nv(h)){case 2:var k=XE;break;case 8:k=ZE;break;default:k=by}m=k.bind(null,h,m,l),k=void 0,!cc||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(k=!0),b?k!==void 0?l.addEventListener(h,m,{capture:!0,passive:k}):l.addEventListener(h,m,!0):k!==void 0?l.addEventListener(h,m,{passive:k}):l.addEventListener(h,m,!1)}function kr(l,h,m,b,k){var D=b;if((h&1)===0&&(h&2)===0&&b!==null)e:for(;;){if(b===null)return;var q=b.tag;if(q===3||q===4){var te=b.stateNode.containerInfo;if(te===k)break;if(q===4)for(q=b.return;q!==null;){var Te=q.tag;if((Te===3||Te===4)&&q.stateNode.containerInfo===k)return;q=q.return}for(;te!==null;){if(q=be(te),q===null)return;if(Te=q.tag,Te===5||Te===6||Te===26||Te===27){b=D=q;continue e}te=te.parentNode}}b=b.return}vf(function(){var Ze=D,pt=Yc(m),xt=[];e:{var Je=yl.get(l);if(Je!==void 0){var tt=Co,bn=l;switch(l){case"keypress":if($a(m)===0)break e;case"keydown":case"keyup":tt=Ha;break;case"focusin":bn="focus",tt=sh;break;case"focusout":bn="blur",tt=sh;break;case"beforeblur":case"afterblur":tt=sh;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=rh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=ll;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=Bi;break;case bh:case Wa:case Ca:tt=Wd;break;case Xa:tt=Xt;break;case"scroll":case"scrollend":tt=ih;break;case"wheel":tt=Si;break;case"copy":case"cut":case"paste":tt=Zd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=Mo;break;case"toggle":case"beforetoggle":tt=qa}var hn=(h&4)!==0,Ai=!hn&&(l==="scroll"||l==="scrollend"),Ue=hn?Je!==null?Je+"Capture":null:Je;hn=[];for(var Ie=Ze,We;Ie!==null;){var _t=Ie;if(We=_t.stateNode,_t=_t.tag,_t!==5&&_t!==26&&_t!==27||We===null||Ue===null||(_t=Eo(Ie,Ue),_t!=null&&hn.push(yr(Ie,_t,We))),Ai)break;Ie=Ie.return}0<hn.length&&(Je=new tt(Je,bn,null,m,pt),xt.push({event:Je,listeners:hn}))}}if((h&7)===0){e:{if(Je=l==="mouseover"||l==="pointerover",tt=l==="mouseout"||l==="pointerout",Je&&m!==lc&&(bn=m.relatedTarget||m.fromElement)&&(be(bn)||bn[ca]))break e;if((tt||Je)&&(Je=pt.window===pt?pt:(Je=pt.ownerDocument)?Je.defaultView||Je.parentWindow:window,tt?(bn=m.relatedTarget||m.toElement,tt=Ze,bn=bn?be(bn):null,bn!==null&&(Ai=c(bn),hn=bn.tag,bn!==Ai||hn!==5&&hn!==27&&hn!==6)&&(bn=null)):(tt=null,bn=Ze),tt!==bn)){if(hn=rh,_t="onMouseLeave",Ue="onMouseEnter",Ie="mouse",(l==="pointerout"||l==="pointerover")&&(hn=Mo,_t="onPointerLeave",Ue="onPointerEnter",Ie="pointer"),Ai=tt==null?Je:Se(tt),We=bn==null?Je:Se(bn),Je=new hn(_t,Ie+"leave",tt,m,pt),Je.target=Ai,Je.relatedTarget=We,_t=null,be(pt)===Ze&&(hn=new hn(Ue,Ie+"enter",bn,m,pt),hn.target=We,hn.relatedTarget=Ai,_t=hn),Ai=_t,tt&&bn)t:{for(hn=tt,Ue=bn,Ie=0,We=hn;We;We=br(We))Ie++;for(We=0,_t=Ue;_t;_t=br(_t))We++;for(;0<Ie-We;)hn=br(hn),Ie--;for(;0<We-Ie;)Ue=br(Ue),We--;for(;Ie--;){if(hn===Ue||Ue!==null&&hn===Ue.alternate)break t;hn=br(hn),Ue=br(Ue)}hn=null}else hn=null;tt!==null&&xi(xt,Je,tt,hn,!1),bn!==null&&Ai!==null&&xi(xt,Ai,bn,hn,!0)}}e:{if(Je=Ze?Se(Ze):window,tt=Je.nodeName&&Je.nodeName.toLowerCase(),tt==="select"||tt==="input"&&Je.type==="file")var en=mc;else if(fh(Je))if(iu)en=au;else{en=Oo;var qn=su}else tt=Je.nodeName,!tt||tt.toLowerCase()!=="input"||Je.type!=="checkbox"&&Je.type!=="radio"?Ze&&sl(Ze.elementType)&&(en=mc):en=bc;if(en&&(en=en(l,Ze))){nu(xt,en,m,pt);break e}qn&&qn(l,Je,Ze),l==="focusout"&&Ze&&Je.type==="number"&&Ze.memoizedProps.value!=null&&Xc(Je,"number",Je.value)}switch(qn=Ze?Se(Ze):window,l){case"focusin":(fh(qn)||qn.contentEditable==="true")&&(hr=qn,fr=Ze,vc=null);break;case"focusout":vc=fr=hr=null;break;case"mousedown":da=!0;break;case"contextmenu":case"mouseup":case"dragend":da=!1,_h(xt,m,pt);break;case"selectionchange":if(xc)break;case"keydown":case"keyup":_h(xt,m,pt)}var sn;if(hh)e:{switch(l){case"compositionstart":var pn="onCompositionStart";break e;case"compositionend":pn="onCompositionEnd";break e;case"compositionupdate":pn="onCompositionUpdate";break e}pn=void 0}else Po?dc(l,m)&&(pn="onCompositionEnd"):l==="keydown"&&m.keyCode===229&&(pn="onCompositionStart");pn&&(Jc&&m.locale!=="ko"&&(Po||pn!=="onCompositionStart"?pn==="onCompositionEnd"&&Po&&(sn=al()):(Aa=pt,Un="value"in Aa?Aa.value:Aa.textContent,Po=!0)),qn=Fr(Ze,pn),0<qn.length&&(pn=new fc(pn,l,null,m,pt),xt.push({event:pn,listeners:qn}),sn?pn.data=sn:(sn=ml(m),sn!==null&&(pn.data=sn)))),(sn=Yd?eu(l,m):tu(l,m))&&(pn=Fr(Ze,"onBeforeInput"),0<pn.length&&(qn=new fc("onBeforeInput","beforeinput",null,m,pt),xt.push({event:qn,listeners:pn}),qn.data=sn)),xn(xt,l,Ze,m,pt)}lr(xt,h)})}function yr(l,h,m){return{instance:l,listener:h,currentTarget:m}}function Fr(l,h){for(var m=h+"Capture",b=[];l!==null;){var k=l,D=k.stateNode;if(k=k.tag,k!==5&&k!==26&&k!==27||D===null||(k=Eo(l,m),k!=null&&b.unshift(yr(l,k,D)),k=Eo(l,h),k!=null&&b.push(yr(l,k,D))),l.tag===3)return b;l=l.return}return[]}function br(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function xi(l,h,m,b,k){for(var D=h._reactName,q=[];m!==null&&m!==b;){var te=m,Te=te.alternate,Ze=te.stateNode;if(te=te.tag,Te!==null&&Te===b)break;te!==5&&te!==26&&te!==27||Ze===null||(Te=Ze,k?(Ze=Eo(m,D),Ze!=null&&q.unshift(yr(m,Ze,Te))):k||(Ze=Eo(m,D),Ze!=null&&q.push(yr(m,Ze,Te)))),m=m.return}q.length!==0&&l.push({event:h,listeners:q})}var xr=/\r\n?/g,An=/\u0000|\uFFFD/g;function ys(l){return(typeof l=="string"?l:""+l).replace(xr,`
`).replace(An,"")}function Ir(l,h){return h=ys(h),ys(l)===h}function vr(){}function On(l,h,m,b,k,D){switch(m){case"children":typeof b=="string"?h==="body"||h==="textarea"&&b===""||ua(l,b):(typeof b=="number"||typeof b=="bigint")&&h!=="body"&&ua(l,""+b);break;case"className":dn(l,"class",b);break;case"tabIndex":dn(l,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":dn(l,m,b);break;case"style":rl(l,b,D);break;case"data":if(h!=="object"){dn(l,"data",b);break}case"src":case"href":if(b===""&&(h!=="a"||m!=="href")){l.removeAttribute(m);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){l.removeAttribute(m);break}b=ja(""+b),l.setAttribute(m,b);break;case"action":case"formAction":if(typeof b=="function"){l.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(m==="formAction"?(h!=="input"&&On(l,h,"name",k.name,k,null),On(l,h,"formEncType",k.formEncType,k,null),On(l,h,"formMethod",k.formMethod,k,null),On(l,h,"formTarget",k.formTarget,k,null)):(On(l,h,"encType",k.encType,k,null),On(l,h,"method",k.method,k,null),On(l,h,"target",k.target,k,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){l.removeAttribute(m);break}b=ja(""+b),l.setAttribute(m,b);break;case"onClick":b!=null&&(l.onclick=vr);break;case"onScroll":b!=null&&on("scroll",l);break;case"onScrollEnd":b!=null&&on("scrollend",l);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(i(61));if(m=b.__html,m!=null){if(k.children!=null)throw Error(i(60));l.innerHTML=m}}break;case"multiple":l.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":l.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){l.removeAttribute("xlink:href");break}m=ja(""+b),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?l.setAttribute(m,""+b):l.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?l.setAttribute(m,""):l.removeAttribute(m);break;case"capture":case"download":b===!0?l.setAttribute(m,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?l.setAttribute(m,b):l.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?l.setAttribute(m,b):l.removeAttribute(m);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?l.removeAttribute(m):l.setAttribute(m,b);break;case"popover":on("beforetoggle",l),on("toggle",l),gn(l,"popover",b);break;case"xlinkActuate":an(l,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":an(l,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":an(l,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":an(l,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":an(l,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":an(l,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":an(l,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":an(l,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":an(l,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":gn(l,"is",b);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=oc.get(m)||m,gn(l,m,b))}}function Qs(l,h,m,b,k,D){switch(m){case"style":rl(l,b,D);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(i(61));if(m=b.__html,m!=null){if(k.children!=null)throw Error(i(60));l.innerHTML=m}}break;case"children":typeof b=="string"?ua(l,b):(typeof b=="number"||typeof b=="bigint")&&ua(l,""+b);break;case"onScroll":b!=null&&on("scroll",l);break;case"onScrollEnd":b!=null&&on("scrollend",l);break;case"onClick":b!=null&&(l.onclick=vr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ct.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(k=m.endsWith("Capture"),h=m.slice(2,k?m.length-7:void 0),D=l[ur]||null,D=D!=null?D[m]:null,typeof D=="function"&&l.removeEventListener(h,D,k),typeof b=="function")){typeof D!="function"&&D!==null&&(m in l?l[m]=null:l.hasAttribute(m)&&l.removeAttribute(m)),l.addEventListener(h,b,k);break e}m in l?l[m]=b:b===!0?l.setAttribute(m,""):gn(l,m,b)}}}function vi(l,h,m){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":on("error",l),on("load",l);var b=!1,k=!1,D;for(D in m)if(m.hasOwnProperty(D)){var q=m[D];if(q!=null)switch(D){case"src":b=!0;break;case"srcSet":k=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,h));default:On(l,h,D,q,m,null)}}k&&On(l,h,"srcSet",m.srcSet,m,null),b&&On(l,h,"src",m.src,m,null);return;case"input":on("invalid",l);var te=D=q=k=null,Te=null,Ze=null;for(b in m)if(m.hasOwnProperty(b)){var pt=m[b];if(pt!=null)switch(b){case"name":k=pt;break;case"type":q=pt;break;case"checked":Te=pt;break;case"defaultChecked":Ze=pt;break;case"value":D=pt;break;case"defaultValue":te=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(i(137,h));break;default:On(l,h,b,pt,m,null)}}th(l,D,te,Te,Ze,q,k,!1),qc(l);return;case"select":on("invalid",l),b=q=D=null;for(k in m)if(m.hasOwnProperty(k)&&(te=m[k],te!=null))switch(k){case"value":D=te;break;case"defaultValue":q=te;break;case"multiple":b=te;default:On(l,h,k,te,m,null)}h=D,m=q,l.multiple=!!b,h!=null?ws(l,!!b,h,!1):m!=null&&ws(l,!!b,m,!0);return;case"textarea":on("invalid",l),D=k=b=null;for(q in m)if(m.hasOwnProperty(q)&&(te=m[q],te!=null))switch(q){case"value":b=te;break;case"defaultValue":k=te;break;case"children":D=te;break;case"dangerouslySetInnerHTML":if(te!=null)throw Error(i(91));break;default:On(l,h,q,te,m,null)}To(l,b,k,D),qc(l);return;case"option":for(Te in m)if(m.hasOwnProperty(Te)&&(b=m[Te],b!=null))switch(Te){case"selected":l.selected=b&&typeof b!="function"&&typeof b!="symbol";break;default:On(l,h,Te,b,m,null)}return;case"dialog":on("beforetoggle",l),on("toggle",l),on("cancel",l),on("close",l);break;case"iframe":case"object":on("load",l);break;case"video":case"audio":for(b=0;b<Qi.length;b++)on(Qi[b],l);break;case"image":on("error",l),on("load",l);break;case"details":on("toggle",l);break;case"embed":case"source":case"link":on("error",l),on("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ze in m)if(m.hasOwnProperty(Ze)&&(b=m[Ze],b!=null))switch(Ze){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,h));default:On(l,h,Ze,b,m,null)}return;default:if(sl(h)){for(pt in m)m.hasOwnProperty(pt)&&(b=m[pt],b!==void 0&&Qs(l,h,pt,b,m,void 0));return}}for(te in m)m.hasOwnProperty(te)&&(b=m[te],b!=null&&On(l,h,te,b,m,null))}function Go(l,h,m,b){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var k=null,D=null,q=null,te=null,Te=null,Ze=null,pt=null;for(tt in m){var xt=m[tt];if(m.hasOwnProperty(tt)&&xt!=null)switch(tt){case"checked":break;case"value":break;case"defaultValue":Te=xt;default:b.hasOwnProperty(tt)||On(l,h,tt,null,b,xt)}}for(var Je in b){var tt=b[Je];if(xt=m[Je],b.hasOwnProperty(Je)&&(tt!=null||xt!=null))switch(Je){case"type":D=tt;break;case"name":k=tt;break;case"checked":Ze=tt;break;case"defaultChecked":pt=tt;break;case"value":q=tt;break;case"defaultValue":te=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(i(137,h));break;default:tt!==xt&&On(l,h,Je,tt,b,xt)}}rc(l,q,te,Te,Ze,pt,D,k);return;case"select":tt=q=te=Je=null;for(D in m)if(Te=m[D],m.hasOwnProperty(D)&&Te!=null)switch(D){case"value":break;case"multiple":tt=Te;default:b.hasOwnProperty(D)||On(l,h,D,null,b,Te)}for(k in b)if(D=b[k],Te=m[k],b.hasOwnProperty(k)&&(D!=null||Te!=null))switch(k){case"value":Je=D;break;case"defaultValue":te=D;break;case"multiple":q=D;default:D!==Te&&On(l,h,k,D,b,Te)}h=te,m=q,b=tt,Je!=null?ws(l,!!m,Je,!1):!!b!=!!m&&(h!=null?ws(l,!!m,h,!0):ws(l,!!m,m?[]:"",!1));return;case"textarea":tt=Je=null;for(te in m)if(k=m[te],m.hasOwnProperty(te)&&k!=null&&!b.hasOwnProperty(te))switch(te){case"value":break;case"children":break;default:On(l,h,te,null,b,k)}for(q in b)if(k=b[q],D=m[q],b.hasOwnProperty(q)&&(k!=null||D!=null))switch(q){case"value":Je=k;break;case"defaultValue":tt=k;break;case"children":break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(i(91));break;default:k!==D&&On(l,h,q,k,b,D)}sc(l,Je,tt);return;case"option":for(var bn in m)if(Je=m[bn],m.hasOwnProperty(bn)&&Je!=null&&!b.hasOwnProperty(bn))switch(bn){case"selected":l.selected=!1;break;default:On(l,h,bn,null,b,Je)}for(Te in b)if(Je=b[Te],tt=m[Te],b.hasOwnProperty(Te)&&Je!==tt&&(Je!=null||tt!=null))switch(Te){case"selected":l.selected=Je&&typeof Je!="function"&&typeof Je!="symbol";break;default:On(l,h,Te,Je,b,tt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var hn in m)Je=m[hn],m.hasOwnProperty(hn)&&Je!=null&&!b.hasOwnProperty(hn)&&On(l,h,hn,null,b,Je);for(Ze in b)if(Je=b[Ze],tt=m[Ze],b.hasOwnProperty(Ze)&&Je!==tt&&(Je!=null||tt!=null))switch(Ze){case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(i(137,h));break;default:On(l,h,Ze,Je,b,tt)}return;default:if(sl(h)){for(var Ai in m)Je=m[Ai],m.hasOwnProperty(Ai)&&Je!==void 0&&!b.hasOwnProperty(Ai)&&Qs(l,h,Ai,void 0,b,Je);for(pt in b)Je=b[pt],tt=m[pt],!b.hasOwnProperty(pt)||Je===tt||Je===void 0&&tt===void 0||Qs(l,h,pt,Je,b,tt);return}}for(var Ue in m)Je=m[Ue],m.hasOwnProperty(Ue)&&Je!=null&&!b.hasOwnProperty(Ue)&&On(l,h,Ue,null,b,Je);for(xt in b)Je=b[xt],tt=m[xt],!b.hasOwnProperty(xt)||Je===tt||Je==null&&tt==null||On(l,h,xt,Je,b,tt)}var Bs=null,bs=null;function Ur(l){return l.nodeType===9?l:l.ownerDocument}function fo(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Pu(l,h){if(l===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&h==="foreignObject"?0:l}function id(l,h){return l==="textarea"||l==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var Kh=null;function $p(){var l=window.event;return l&&l.type==="popstate"?l===Kh?!1:(Kh=l,!0):(Kh=null,!1)}var po=typeof setTimeout=="function"?setTimeout:void 0,Rg=typeof clearTimeout=="function"?clearTimeout:void 0,rd=typeof Promise=="function"?Promise:void 0,Hp=typeof queueMicrotask=="function"?queueMicrotask:typeof rd<"u"?function(l){return rd.resolve(null).then(l).catch(kg)}:po;function kg(l){setTimeout(function(){throw l})}function Wl(l){return l==="head"}function Ig(l,h){var m=h,b=0,k=0;do{var D=m.nextSibling;if(l.removeChild(m),D&&D.nodeType===8)if(m=D.data,m==="/$"){if(0<b&&8>b){m=b;var q=l.ownerDocument;if(m&1&&Mr(q.documentElement),m&2&&Mr(q.body),m&4)for(m=q.head,Mr(m),q=m.firstChild;q;){var te=q.nextSibling,Te=q.nodeName;q[Q]||Te==="SCRIPT"||Te==="STYLE"||Te==="LINK"&&q.rel.toLowerCase()==="stylesheet"||m.removeChild(q),q=te}}if(k===0){l.removeChild(D),tm(h);return}k--}else m==="$"||m==="$?"||m==="$!"?k++:b=m.charCodeAt(0)-48;else b=0;m=D}while(m);tm(h)}function qp(l){var h=l.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var m=h;switch(h=h.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":qp(m),le(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}l.removeChild(m)}}function fy(l,h,m,b){for(;l.nodeType===1;){var k=m;if(l.nodeName.toLowerCase()!==h.toLowerCase()){if(!b&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(b){if(!l[Q])switch(h){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(D=l.getAttribute("rel"),D==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(D!==k.rel||l.getAttribute("href")!==(k.href==null||k.href===""?null:k.href)||l.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin)||l.getAttribute("title")!==(k.title==null?null:k.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(D=l.getAttribute("src"),(D!==(k.src==null?null:k.src)||l.getAttribute("type")!==(k.type==null?null:k.type)||l.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin))&&D&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(h==="input"&&l.type==="hidden"){var D=k.name==null?null:""+k.name;if(k.type==="hidden"&&l.getAttribute("name")===D)return l}else return l;if(l=Oa(l.nextSibling),l===null)break}return null}function dy(l,h,m){if(h==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!m||(l=Oa(l.nextSibling),l===null))return null;return l}function Wp(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function py(l,h){var m=l.ownerDocument;if(l.data!=="$?"||m.readyState==="complete")h();else{var b=function(){h(),m.removeEventListener("DOMContentLoaded",b)};m.addEventListener("DOMContentLoaded",b),l._reactRetry=b}}function Oa(l){for(;l!=null;l=l.nextSibling){var h=l.nodeType;if(h===1||h===3)break;if(h===8){if(h=l.data,h==="$"||h==="$!"||h==="$?"||h==="F!"||h==="F")break;if(h==="/$")return null}}return l}var Js=null;function Qh(l){l=l.previousSibling;for(var h=0;l;){if(l.nodeType===8){var m=l.data;if(m==="$"||m==="$!"||m==="$?"){if(h===0)return l;h--}else m==="/$"&&h++}l=l.previousSibling}return null}function Xp(l,h,m){switch(h=Ur(m),l){case"html":if(l=h.documentElement,!l)throw Error(i(452));return l;case"head":if(l=h.head,!l)throw Error(i(453));return l;case"body":if(l=h.body,!l)throw Error(i(454));return l;default:throw Error(i(451))}}function Mr(l){for(var h=l.attributes;h.length;)l.removeAttributeNode(h[0]);le(l)}var cr=new Map,Du=new Set;function Xl(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var mo=Ye.d;Ye.d={f:zc,r:PE,D:DE,C:OE,L:BE,m:NE,X:LE,S:zE,M:FE};function zc(){var l=mo.f(),h=Yh();return l||h}function PE(l){var h=Ae(l);h!==null&&h.tag===5&&h.type==="form"?ag(h):mo.r(l)}var sd=typeof document>"u"?null:document;function Sv(l,h,m){var b=sd;if(b&&typeof h=="string"&&h){var k=ns(h);k='link[rel="'+l+'"][href="'+k+'"]',typeof m=="string"&&(k+='[crossorigin="'+m+'"]'),Du.has(k)||(Du.add(k),l={rel:l,crossOrigin:m,href:h},b.querySelector(k)===null&&(h=b.createElement("link"),vi(h,"link",l),ke(h),b.head.appendChild(h)))}}function DE(l){mo.D(l),Sv("dns-prefetch",l,null)}function OE(l,h){mo.C(l,h),Sv("preconnect",l,h)}function BE(l,h,m){mo.L(l,h,m);var b=sd;if(b&&l&&h){var k='link[rel="preload"][as="'+ns(h)+'"]';h==="image"&&m&&m.imageSrcSet?(k+='[imagesrcset="'+ns(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(k+='[imagesizes="'+ns(m.imageSizes)+'"]')):k+='[href="'+ns(l)+'"]';var D=k;switch(h){case"style":D=ad(l);break;case"script":D=od(l)}cr.has(D)||(l=S({rel:"preload",href:h==="image"&&m&&m.imageSrcSet?void 0:l,as:h},m),cr.set(D,l),b.querySelector(k)!==null||h==="style"&&b.querySelector(Zp(D))||h==="script"&&b.querySelector(Yp(D))||(h=b.createElement("link"),vi(h,"link",l),ke(h),b.head.appendChild(h)))}}function NE(l,h){mo.m(l,h);var m=sd;if(m&&l){var b=h&&typeof h.as=="string"?h.as:"script",k='link[rel="modulepreload"][as="'+ns(b)+'"][href="'+ns(l)+'"]',D=k;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=od(l)}if(!cr.has(D)&&(l=S({rel:"modulepreload",href:l},h),cr.set(D,l),m.querySelector(k)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(Yp(D)))return}b=m.createElement("link"),vi(b,"link",l),ke(b),m.head.appendChild(b)}}}function zE(l,h,m){mo.S(l,h,m);var b=sd;if(b&&l){var k=xe(b).hoistableStyles,D=ad(l);h=h||"default";var q=k.get(D);if(!q){var te={loading:0,preload:null};if(q=b.querySelector(Zp(D)))te.loading=5;else{l=S({rel:"stylesheet",href:l,"data-precedence":h},m),(m=cr.get(D))&&my(l,m);var Te=q=b.createElement("link");ke(Te),vi(Te,"link",l),Te._p=new Promise(function(Ze,pt){Te.onload=Ze,Te.onerror=pt}),Te.addEventListener("load",function(){te.loading|=1}),Te.addEventListener("error",function(){te.loading|=2}),te.loading|=4,Mg(q,h,b)}q={type:"stylesheet",instance:q,count:1,state:te},k.set(D,q)}}}function LE(l,h){mo.X(l,h);var m=sd;if(m&&l){var b=xe(m).hoistableScripts,k=od(l),D=b.get(k);D||(D=m.querySelector(Yp(k)),D||(l=S({src:l,async:!0},h),(h=cr.get(k))&&gy(l,h),D=m.createElement("script"),ke(D),vi(D,"link",l),m.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},b.set(k,D))}}function FE(l,h){mo.M(l,h);var m=sd;if(m&&l){var b=xe(m).hoistableScripts,k=od(l),D=b.get(k);D||(D=m.querySelector(Yp(k)),D||(l=S({src:l,async:!0,type:"module"},h),(h=cr.get(k))&&gy(l,h),D=m.createElement("script"),ke(D),vi(D,"link",l),m.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},b.set(k,D))}}function Ev(l,h,m,b){var k=(k=Ot.current)?Xl(k):null;if(!k)throw Error(i(446));switch(l){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(h=ad(m.href),m=xe(k).hoistableStyles,b=m.get(h),b||(b={type:"style",instance:null,count:0,state:null},m.set(h,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){l=ad(m.href);var D=xe(k).hoistableStyles,q=D.get(l);if(q||(k=k.ownerDocument||k,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(l,q),(D=k.querySelector(Zp(l)))&&!D._p&&(q.instance=D,q.state.loading=5),cr.has(l)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},cr.set(l,m),D||UE(k,l,m,q.state))),h&&b===null)throw Error(i(528,""));return q}if(h&&b!==null)throw Error(i(529,""));return null;case"script":return h=m.async,m=m.src,typeof m=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=od(m),m=xe(k).hoistableScripts,b=m.get(h),b||(b={type:"script",instance:null,count:0,state:null},m.set(h,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,l))}}function ad(l){return'href="'+ns(l)+'"'}function Zp(l){return'link[rel="stylesheet"]['+l+"]"}function Av(l){return S({},l,{"data-precedence":l.precedence,precedence:null})}function UE(l,h,m,b){l.querySelector('link[rel="preload"][as="style"]['+h+"]")?b.loading=1:(h=l.createElement("link"),b.preload=h,h.addEventListener("load",function(){return b.loading|=1}),h.addEventListener("error",function(){return b.loading|=2}),vi(h,"link",m),ke(h),l.head.appendChild(h))}function od(l){return'[src="'+ns(l)+'"]'}function Yp(l){return"script[async]"+l}function Cv(l,h,m){if(h.count++,h.instance===null)switch(h.type){case"style":var b=l.querySelector('style[data-href~="'+ns(m.href)+'"]');if(b)return h.instance=b,ke(b),b;var k=S({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return b=(l.ownerDocument||l).createElement("style"),ke(b),vi(b,"style",k),Mg(b,m.precedence,l),h.instance=b;case"stylesheet":k=ad(m.href);var D=l.querySelector(Zp(k));if(D)return h.state.loading|=4,h.instance=D,ke(D),D;b=Av(m),(k=cr.get(k))&&my(b,k),D=(l.ownerDocument||l).createElement("link"),ke(D);var q=D;return q._p=new Promise(function(te,Te){q.onload=te,q.onerror=Te}),vi(D,"link",b),h.state.loading|=4,Mg(D,m.precedence,l),h.instance=D;case"script":return D=od(m.src),(k=l.querySelector(Yp(D)))?(h.instance=k,ke(k),k):(b=m,(k=cr.get(D))&&(b=S({},m),gy(b,k)),l=l.ownerDocument||l,k=l.createElement("script"),ke(k),vi(k,"link",b),l.head.appendChild(k),h.instance=k);case"void":return null;default:throw Error(i(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(b=h.instance,h.state.loading|=4,Mg(b,m.precedence,l));return h.instance}function Mg(l,h,m){for(var b=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),k=b.length?b[b.length-1]:null,D=k,q=0;q<b.length;q++){var te=b[q];if(te.dataset.precedence===h)D=te;else if(D!==k)break}D?D.parentNode.insertBefore(l,D.nextSibling):(h=m.nodeType===9?m.head:m,h.insertBefore(l,h.firstChild))}function my(l,h){l.crossOrigin==null&&(l.crossOrigin=h.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=h.referrerPolicy),l.title==null&&(l.title=h.title)}function gy(l,h){l.crossOrigin==null&&(l.crossOrigin=h.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=h.referrerPolicy),l.integrity==null&&(l.integrity=h.integrity)}var Pg=null;function Rv(l,h,m){if(Pg===null){var b=new Map,k=Pg=new Map;k.set(m,b)}else k=Pg,b=k.get(m),b||(b=new Map,k.set(m,b));if(b.has(l))return b;for(b.set(l,null),m=m.getElementsByTagName(l),k=0;k<m.length;k++){var D=m[k];if(!(D[Q]||D[wi]||l==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var q=D.getAttribute(h)||"";q=l+q;var te=b.get(q);te?te.push(D):b.set(q,[D])}}return b}function kv(l,h,m){l=l.ownerDocument||l,l.head.insertBefore(m,h==="title"?l.querySelector("head > title"):null)}function VE(l,h,m){if(m===1||h.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return l=h.disabled,typeof h.precedence=="string"&&l==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function Iv(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var Gp=null;function jE(){}function $E(l,h,m){if(Gp===null)throw Error(i(475));var b=Gp;if(h.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var k=ad(m.href),D=l.querySelector(Zp(k));if(D){l=D._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(b.count++,b=Dg.bind(b),l.then(b,b)),h.state.loading|=4,h.instance=D,ke(D);return}D=l.ownerDocument||l,m=Av(m),(k=cr.get(k))&&my(m,k),D=D.createElement("link"),ke(D);var q=D;q._p=new Promise(function(te,Te){q.onload=te,q.onerror=Te}),vi(D,"link",m),h.instance=D}b.stylesheets===null&&(b.stylesheets=new Map),b.stylesheets.set(h,l),(l=h.state.preload)&&(h.state.loading&3)===0&&(b.count++,h=Dg.bind(b),l.addEventListener("load",h),l.addEventListener("error",h))}}function HE(){if(Gp===null)throw Error(i(475));var l=Gp;return l.stylesheets&&l.count===0&&_y(l,l.stylesheets),0<l.count?function(h){var m=setTimeout(function(){if(l.stylesheets&&_y(l,l.stylesheets),l.unsuspend){var b=l.unsuspend;l.unsuspend=null,b()}},6e4);return l.unsuspend=h,function(){l.unsuspend=null,clearTimeout(m)}}:null}function Dg(){if(this.count--,this.count===0){if(this.stylesheets)_y(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var Og=null;function _y(l,h){l.stylesheets=null,l.unsuspend!==null&&(l.count++,Og=new Map,h.forEach(qE,l),Og=null,Dg.call(l))}function qE(l,h){if(!(h.state.loading&4)){var m=Og.get(l);if(m)var b=m.get(null);else{m=new Map,Og.set(l,m);for(var k=l.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<k.length;D++){var q=k[D];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(m.set(q.dataset.precedence,q),b=q)}b&&m.set(null,b)}k=h.instance,q=k.getAttribute("data-precedence"),D=m.get(q)||b,D===b&&m.set(null,k),m.set(q,k),this.count++,b=Dg.bind(this),k.addEventListener("load",b),k.addEventListener("error",b),D?D.parentNode.insertBefore(k,D.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(k,l.firstChild)),h.state.loading|=4}}var Kp={$$typeof:re,Provider:null,Consumer:null,_currentValue:gt,_currentValue2:gt,_threadCount:0};function WE(l,h,m,b,k,D,q,te){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fn(0),this.hiddenUpdates=fn(null),this.identifierPrefix=b,this.onUncaughtError=k,this.onCaughtError=D,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=te,this.incompleteTransitions=new Map}function Mv(l,h,m,b,k,D,q,te,Te,Ze,pt,xt){return l=new WE(l,h,m,q,te,Te,Ze,xt),h=1,D===!0&&(h|=24),D=rs(3,null,null,h),l.current=D,D.stateNode=l,h=He(),h.refCount++,l.pooledCache=h,h.refCount++,D.memoizedState={element:b,isDehydrated:m,cache:h},Dn(D),l}function Pv(l){return l?(l=sr,l):sr}function Dv(l,h,m,b,k,D){k=Pv(k),b.context===null?b.context=k:b.pendingContext=k,b=Sn(h),b.payload={element:m},D=D===void 0?null:D,D!==null&&(b.callback=D),m=hi(l,b,h),m!==null&&(Os(m,l,h),pr(m,l,h))}function Ov(l,h){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var m=l.retryLane;l.retryLane=m!==0&&m<h?m:h}}function yy(l,h){Ov(l,h),(l=l.alternate)&&Ov(l,h)}function Bv(l){if(l.tag===13){var h=Za(l,67108864);h!==null&&Os(h,l,67108864),yy(l,67108864)}}var Bg=!0;function XE(l,h,m,b){var k=we.T;we.T=null;var D=Ye.p;try{Ye.p=2,by(l,h,m,b)}finally{Ye.p=D,we.T=k}}function ZE(l,h,m,b){var k=we.T;we.T=null;var D=Ye.p;try{Ye.p=8,by(l,h,m,b)}finally{Ye.p=D,we.T=k}}function by(l,h,m,b){if(Bg){var k=xy(b);if(k===null)kr(l,h,b,Ng,m),zv(l,b);else if(GE(k,l,h,m,b))b.stopPropagation();else if(zv(l,b),h&4&&-1<YE.indexOf(l)){for(;k!==null;){var D=Ae(k);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var q=li(D.pendingLanes);if(q!==0){var te=D;for(te.pendingLanes|=2,te.entangledLanes|=2;q;){var Te=1<<31-nn(q);te.entanglements[1]|=Te,q&=~Te}ut(D),(Zn&6)===0&&(Nc=ir()+500,Vt(0))}}break;case 13:te=Za(D,2),te!==null&&Os(te,D,2),Yh(),yy(D,2)}if(D=xy(b),D===null&&kr(l,h,b,Ng,m),D===k)break;k=D}k!==null&&b.stopPropagation()}else kr(l,h,b,null,m)}}function xy(l){return l=Yc(l),vy(l)}var Ng=null;function vy(l){if(Ng=null,l=be(l),l!==null){var h=c(l);if(h===null)l=null;else{var m=h.tag;if(m===13){if(l=f(h),l!==null)return l;l=null}else if(m===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;l=null}else h!==l&&(l=null)}}return Ng=l,null}function Nv(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch($s()){case wn:return 2;case qr:return 8;case ra:case sa:return 32;case Ta:return 268435456;default:return 32}default:return 32}}var wy=!1,Ou=null,Bu=null,Nu=null,Qp=new Map,Jp=new Map,zu=[],YE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zv(l,h){switch(l){case"focusin":case"focusout":Ou=null;break;case"dragenter":case"dragleave":Bu=null;break;case"mouseover":case"mouseout":Nu=null;break;case"pointerover":case"pointerout":Qp.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jp.delete(h.pointerId)}}function em(l,h,m,b,k,D){return l===null||l.nativeEvent!==D?(l={blockedOn:h,domEventName:m,eventSystemFlags:b,nativeEvent:D,targetContainers:[k]},h!==null&&(h=Ae(h),h!==null&&Bv(h)),l):(l.eventSystemFlags|=b,h=l.targetContainers,k!==null&&h.indexOf(k)===-1&&h.push(k),l)}function GE(l,h,m,b,k){switch(h){case"focusin":return Ou=em(Ou,l,h,m,b,k),!0;case"dragenter":return Bu=em(Bu,l,h,m,b,k),!0;case"mouseover":return Nu=em(Nu,l,h,m,b,k),!0;case"pointerover":var D=k.pointerId;return Qp.set(D,em(Qp.get(D)||null,l,h,m,b,k)),!0;case"gotpointercapture":return D=k.pointerId,Jp.set(D,em(Jp.get(D)||null,l,h,m,b,k)),!0}return!1}function Lv(l){var h=be(l.target);if(h!==null){var m=c(h);if(m!==null){if(h=m.tag,h===13){if(h=f(m),h!==null){l.blockedOn=h,la(l.priority,function(){if(m.tag===13){var b=Ds();b=ni(b);var k=Za(m,b);k!==null&&Os(k,m,b),yy(m,b)}});return}}else if(h===3&&m.stateNode.current.memoizedState.isDehydrated){l.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}l.blockedOn=null}function zg(l){if(l.blockedOn!==null)return!1;for(var h=l.targetContainers;0<h.length;){var m=xy(l.nativeEvent);if(m===null){m=l.nativeEvent;var b=new m.constructor(m.type,m);lc=b,m.target.dispatchEvent(b),lc=null}else return h=Ae(m),h!==null&&Bv(h),l.blockedOn=m,!1;h.shift()}return!0}function Fv(l,h,m){zg(l)&&m.delete(h)}function KE(){wy=!1,Ou!==null&&zg(Ou)&&(Ou=null),Bu!==null&&zg(Bu)&&(Bu=null),Nu!==null&&zg(Nu)&&(Nu=null),Qp.forEach(Fv),Jp.forEach(Fv)}function Lg(l,h){l.blockedOn===h&&(l.blockedOn=null,wy||(wy=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,KE)))}var Fg=null;function Uv(l){Fg!==l&&(Fg=l,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Fg===l&&(Fg=null);for(var h=0;h<l.length;h+=3){var m=l[h],b=l[h+1],k=l[h+2];if(typeof b!="function"){if(vy(b||m)===null)continue;break}var D=Ae(m);D!==null&&(l.splice(h,3),h-=3,ap(D,{pending:!0,data:k,method:m.method,action:b},b,k))}}))}function tm(l){function h(Te){return Lg(Te,l)}Ou!==null&&Lg(Ou,l),Bu!==null&&Lg(Bu,l),Nu!==null&&Lg(Nu,l),Qp.forEach(h),Jp.forEach(h);for(var m=0;m<zu.length;m++){var b=zu[m];b.blockedOn===l&&(b.blockedOn=null)}for(;0<zu.length&&(m=zu[0],m.blockedOn===null);)Lv(m),m.blockedOn===null&&zu.shift();if(m=(l.ownerDocument||l).$$reactFormReplay,m!=null)for(b=0;b<m.length;b+=3){var k=m[b],D=m[b+1],q=k[ur]||null;if(typeof D=="function")q||Uv(m);else if(q){var te=null;if(D&&D.hasAttribute("formAction")){if(k=D,q=D[ur]||null)te=q.formAction;else if(vy(k)!==null)continue}else te=q.action;typeof te=="function"?m[b+1]=te:(m.splice(b,3),b-=3),Uv(m)}}}function Ty(l){this._internalRoot=l}Ug.prototype.render=Ty.prototype.render=function(l){var h=this._internalRoot;if(h===null)throw Error(i(409));var m=h.current,b=Ds();Dv(m,b,l,h,null,null)},Ug.prototype.unmount=Ty.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var h=l.containerInfo;Dv(l.current,2,null,l,null,null),Yh(),h[ca]=null}};function Ug(l){this._internalRoot=l}Ug.prototype.unstable_scheduleHydration=function(l){if(l){var h=Va();l={blockedOn:null,target:l,priority:h};for(var m=0;m<zu.length&&h!==0&&h<zu[m].priority;m++);zu.splice(m,0,l),m===0&&Lv(l)}};var Vv=e.version;if(Vv!=="19.1.1")throw Error(i(527,Vv,"19.1.1"));Ye.findDOMNode=function(l){var h=l._reactInternals;if(h===void 0)throw typeof l.render=="function"?Error(i(188)):(l=Object.keys(l).join(","),Error(i(268,l)));return l=_(h),l=l!==null?x(l):null,l=l===null?null:l.stateNode,l};var QE={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:we,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vg.isDisabled&&Vg.supportsFiber)try{ft=Vg.inject(QE),Ee=Vg}catch{}}return im.createRoot=function(l,h){if(!r(l))throw Error(i(299));var m=!1,b="",k=fg,D=dg,q=Vf,te=null;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(k=h.onUncaughtError),h.onCaughtError!==void 0&&(D=h.onCaughtError),h.onRecoverableError!==void 0&&(q=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(te=h.unstable_transitionCallbacks)),h=Mv(l,1,!1,null,null,m,b,k,D,q,te,null),l[ca]=h.current,Ui(l),new Ty(h)},im.hydrateRoot=function(l,h,m){if(!r(l))throw Error(i(299));var b=!1,k="",D=fg,q=dg,te=Vf,Te=null,Ze=null;return m!=null&&(m.unstable_strictMode===!0&&(b=!0),m.identifierPrefix!==void 0&&(k=m.identifierPrefix),m.onUncaughtError!==void 0&&(D=m.onUncaughtError),m.onCaughtError!==void 0&&(q=m.onCaughtError),m.onRecoverableError!==void 0&&(te=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(Te=m.unstable_transitionCallbacks),m.formState!==void 0&&(Ze=m.formState)),h=Mv(l,1,!0,h,m??null,b,k,D,q,te,Te,Ze),h.context=Pv(null),m=h.current,b=Ds(),b=ni(b),k=Sn(b),k.callback=null,hi(m,k,b),m=b,h.current.lanes=m,Xr(h,m),ut(h),l[ca]=h.current,Ui(l),new Ug(h)},im.version="19.1.1",im}var Kv;function oA(){if(Kv)return Ay.exports;Kv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ay.exports=aA(),Ay.exports}var lA=oA(),a_={exports:{}},cA=a_.exports,Qv;function uA(){return Qv||(Qv=1,function(t,e){(function(n,i){t.exports=i()})(cA,function(){var n,i,r;function c(a,_){if(!n)n=_;else if(!i)i=_;else{var x="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),r=_(S),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}c(["exports"],function(a){var _=x;function x(u,s,d,g){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(g-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=d,this.p2y=g}function S(u,s,d,g){const w=new _(u,s,d,g);return function(E){return w.solve(E)}}x.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var d=u,g=0;g<8;g++){var w=this.sampleCurveX(d)-u;if(Math.abs(w)<s)return d;var E=this.sampleCurveDerivativeX(d);if(Math.abs(E)<1e-6)break;d-=w/E}var C=0,P=1;for(d=u,g=0;g<20&&(w=this.sampleCurveX(d),!(Math.abs(w-u)<s));g++)u>w?C=d:P=d,d=.5*(P-C)+C;return d},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};const R=S(.25,.1,.25,1);function I(u,s,d){return Math.min(d,Math.max(s,u))}function N(u,s,d){const g=d-s,w=((u-s)%g+g)%g+s;return w===s?d:w}function L(u,...s){for(const d of s)for(const g in d)u[g]=d[g];return u}let H=1;function ie(u,s){u.forEach(d=>{s[d]&&(s[d]=s[d].bind(s))})}function ne(u,s,d){const g={};for(const w in u)g[w]=s.call(d||this,u[w],w,u);return g}function he(u,s,d){const g={};for(const w in u)s.call(d||this,u[w],w,u)&&(g[w]=u[w]);return g}function re(u){return Array.isArray(u)?u.map(re):typeof u=="object"&&u?ne(u,re):u}const ge={};function _e(u){ge[u]||(typeof console<"u"&&console.warn(u),ge[u]=!0)}function pe(u,s,d){return(d.y-u.y)*(s.x-u.x)>(s.y-u.y)*(d.x-u.x)}function it(u){let s=0;for(let d,g,w=0,E=u.length,C=E-1;w<E;C=w++)d=u[w],g=u[C],s+=(g.x-d.x)*(d.y+g.y);return s}function mt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function nt(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,g,w,E)=>{const C=w||E;return s[g]=!C||C.toLowerCase(),""}),s["max-age"]){const d=parseInt(s["max-age"],10);isNaN(d)?delete s["max-age"]:s["max-age"]=d}return s}let Ce,ht,Me=null;function Ve(u){if(Me==null){const s=u.navigator?u.navigator.userAgent:null;Me=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Me}function Le(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const lt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(u){const s=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(u,s=0){const d=window.document.createElement("canvas"),g=d.getContext("2d");if(!g)throw new Error("failed to create canvas 2d context");return d.width=u.width,d.height=u.height,g.drawImage(u,0,0,u.width,u.height),g.getImageData(-s,-s,u.width+2*s,u.height+2*s)},resolveURL:u=>(Ce||(Ce=document.createElement("a")),Ce.href=u,Ce.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ht==null&&(ht=matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)}};var we=Ye;function Ye(u,s){this.x=u,this.y=s}Ye.prototype={clone:function(){return new Ye(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,s){return this.clone()._rotateAround(u,s)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var s=u.x-this.x,d=u.y-this.y;return s*s+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult:function(u){var s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var s=Math.cos(u),d=Math.sin(u),g=d*this.x+s*this.y;return this.x=s*this.x-d*this.y,this.y=g,this},_rotateAround:function(u,s){var d=Math.cos(u),g=Math.sin(u),w=s.y+g*(this.x-s.x)+d*(this.y-s.y);return this.x=s.x+d*(this.x-s.x)-g*(this.y-s.y),this.y=w,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ye.convert=function(u){return u instanceof Ye?u:Array.isArray(u)?new Ye(u[0],u[1]):u};const gt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Dt="mapbox-tiles";let X,Ke=500,Tt=50;function ce(){typeof caches>"u"||X||(X=caches.open(Dt))}let zt=1/0;const qt={supported:!1,testSupport:function(u){!vn&&Fn&&(Qn?Yi(u):Ot=u)}};let Ot,Fn,vn=!1,Qn=!1;function Yi(u){const s=u.createTexture();u.bindTexture(u.TEXTURE_2D,s);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Fn),u.isContextLost())return;qt.supported=!0}catch{}u.deleteTexture(s),vn=!0}typeof document<"u"&&(Fn=document.createElement("img"),Fn.onload=function(){Ot&&Yi(Ot),Ot=null,Qn=!0},Fn.onerror=function(){vn=!0,Ot=null},Fn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Pr);class Sr extends Error{constructor(s,d,g,w){super(`AJAXError: ${d} (${s}): ${g}`),this.status=s,this.statusText=d,this.url=g,this.body=w}}const tr=mt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ia(u,s){const d=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:tr(),signal:d.signal});let w=!1,E=!1;return u.type==="json"&&g.headers.set("Accept","application/json"),((C,P,O)=>{E||fetch(g).then(F=>F.ok?((j,W,G)=>{(u.type==="arrayBuffer"?j.arrayBuffer():u.type==="json"?j.json():j.text()).then(J=>{E||(w=!0,s(null,J,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(J=>{E||s(new Error(J.message))})})(F):F.blob().then(j=>s(new Sr(F.status,F.statusText,u.url,j)))).catch(F=>{F.code!==20&&s(new Error(F.message))})})(),{cancel:()=>{E=!0,w||d.abort()}}}const nr=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){if(mt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,s);if(!mt()){const g=u.url.substring(0,u.url.indexOf("://"));return(gt.REGISTERED_PROTOCOLS[g]||ia)(u,s)}}if(!(/^file:/.test(d=u.url)||/^file:/.test(tr())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ia(u,s);if(mt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,s,void 0,!0)}var d;return function(g,w){const E=new XMLHttpRequest;E.open(g.method||"GET",g.url,!0),g.type==="arrayBuffer"&&(E.responseType="arraybuffer");for(const C in g.headers)E.setRequestHeader(C,g.headers[C]);return g.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=g.credentials==="include",E.onerror=()=>{w(new Error(E.statusText))},E.onload=()=>{if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let C=E.response;if(g.type==="json")try{C=JSON.parse(E.response)}catch(P){return w(P)}w(null,C,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else{const C=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});w(new Sr(E.status,E.statusText,g.url,C))}},E.send(g.body),{cancel:()=>E.abort()}}(u,s)},xs=function(u,s){return nr(L(u,{type:"arrayBuffer"}),s)};function ir(u){const s=window.document.createElement("a");return s.href=u,s.protocol===window.document.location.protocol&&s.host===window.document.location.host}const $s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let wn,qr;wn=[],qr=0;const ra=function(u,s){if(qt.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),qr>=gt.MAX_PARALLEL_IMAGE_REQUESTS){const E={requestParameters:u,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return wn.push(E),E}qr++;let d=!1;const g=()=>{if(!d)for(d=!0,qr--;wn.length&&qr<gt.MAX_PARALLEL_IMAGE_REQUESTS;){const E=wn.shift(),{requestParameters:C,callback:P,cancelled:O}=E;O||(E.cancel=ra(C,P).cancel)}},w=xs(u,(E,C,P,O)=>{g(),E?s(E):C&&function(F,j){typeof createImageBitmap=="function"?function(W,G){const J=new Blob([new Uint8Array(W)],{type:"image/png"});createImageBitmap(J).then(ee=>{G(null,ee)}).catch(ee=>{G(new Error(`Could not load image because of ${ee.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(F,j):function(W,G){const J=new Image;J.onload=()=>{G(null,J),URL.revokeObjectURL(J.src),J.onload=null,window.requestAnimationFrame(()=>{J.src=$s})},J.onerror=()=>G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ee=new Blob([new Uint8Array(W)],{type:"image/png"});J.src=W.byteLength?URL.createObjectURL(ee):$s}(F,j)}(C,(F,j)=>{F!=null?s(F):j!=null&&s(null,j,{cacheControl:P,expires:O})})});return{cancel:()=>{w.cancel(),g()}}};function sa(u,s,d){d[u]&&d[u].indexOf(s)!==-1||(d[u]=d[u]||[],d[u].push(s))}function Ta(u,s,d){if(d&&d[u]){const g=d[u].indexOf(s);g!==-1&&d[u].splice(g,1)}}class vs{constructor(s,d={}){L(this,d),this.type=s}}class aa extends vs{constructor(s,d={}){super("error",L({error:s},d))}}class ft{on(s,d){return this._listeners=this._listeners||{},sa(s,d,this._listeners),this}off(s,d){return Ta(s,d,this._listeners),Ta(s,d,this._oneTimeListeners),this}once(s,d){return this._oneTimeListeners=this._oneTimeListeners||{},sa(s,d,this._oneTimeListeners),this}fire(s,d){typeof s=="string"&&(s=new vs(s,d||{}));const g=s.type;if(this.listens(g)){s.target=this;const w=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const P of w)P.call(this,s);const E=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const P of E)Ta(g,P,this._oneTimeListeners),P.call(this,s);const C=this._eventedParent;C&&(L(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(s))}else s instanceof aa&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,d){return this._eventedParent=s,this._eventedParentData=d,this}}var Ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class at{constructor(s,d,g,w){this.message=(s?`${s}: `:"")+g,w&&(this.identifier=w),d!=null&&d.__line__&&(this.line=d.__line__)}}function nn(u){const s=u.value;return s?[new at(u.key,s,"constants have been deprecated as of v8")]:[]}function Cn(u,...s){for(const d of s)for(const g in d)u[g]=d[g];return u}function Mn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Jn(u){if(Array.isArray(u))return u.map(Jn);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const d in u)s[d]=Jn(u[d]);return s}return Mn(u)}class ri extends Error{constructor(s,d){super(d),this.message=d,this.key=s}}class Wr{constructor(s,d=[]){this.parent=s,this.bindings={};for(const[g,w]of d)this.bindings[g]=w}concat(s){return new Wr(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const li={kind:"null"},wt={kind:"number"},rn={kind:"string"},tn={kind:"boolean"},Dr={kind:"color"},ts={kind:"object"},fn={kind:"value"},Xr={kind:"collator"},oa={kind:"formatted"},Er={kind:"padding"},Sa={kind:"resolvedImage"};function ni(u,s){return{kind:"array",itemType:u,N:s}}function ii(u){if(u.kind==="array"){const s=ii(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const Va=[li,wt,rn,tn,Dr,oa,ts,ni(fn),Er,Sa];function la(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!la(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const d of Va)if(!la(d,s))return null}}return`Expected ${ii(u)} but found ${ii(s)} instead.`}function Zr(u,s){return s.some(d=>d.kind===u.kind)}function wi(u,s){return s.some(d=>d==="null"?u===null:d==="array"?Array.isArray(u):d==="object"?u&&!Array.isArray(u)&&typeof u=="object":d===typeof u)}var ur,ca={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Hs(u){return(u=Math.round(u))<0?0:u>255?255:u}function ae(u){return Hs(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function V(u){return(s=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:s>1?1:s;var s}function Z(u,s,d){return d<0?d+=1:d>1&&(d-=1),6*d<1?u+(s-u)*d*6:2*d<1?s:3*d<2?u+(s-u)*(2/3-d)*6:u}try{ur={}.parseCSSColor=function(u){var s,d=u.replace(/ /g,"").toLowerCase();if(d in ca)return ca[d].slice();if(d[0]==="#")return d.length===4?(s=parseInt(d.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:d.length===7&&(s=parseInt(d.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var g=d.indexOf("("),w=d.indexOf(")");if(g!==-1&&w+1===d.length){var E=d.substr(0,g),C=d.substr(g+1,w-(g+1)).split(","),P=1;switch(E){case"rgba":if(C.length!==4)return null;P=V(C.pop());case"rgb":return C.length!==3?null:[ae(C[0]),ae(C[1]),ae(C[2]),P];case"hsla":if(C.length!==4)return null;P=V(C.pop());case"hsl":if(C.length!==3)return null;var O=(parseFloat(C[0])%360+360)%360/360,F=V(C[1]),j=V(C[2]),W=j<=.5?j*(F+1):j+F-j*F,G=2*j-W;return[Hs(255*Z(G,W,O+1/3)),Hs(255*Z(G,W,O)),Hs(255*Z(G,W,O-1/3)),P];default:return null}}return null}}catch{}class Q{constructor(s,d,g,w=1){this.r=s,this.g=d,this.b=g,this.a=w}static parse(s){if(!s)return;if(s instanceof Q)return s;if(typeof s!="string")return;const d=ur(s);return d?new Q(d[0]/255*d[3],d[1]/255*d[3],d[2]/255*d[3],d[3]):void 0}toString(){const[s,d,g,w]=this.toArray();return`rgba(${Math.round(s)},${Math.round(d)},${Math.round(g)},${w})`}toArray(){const{r:s,g:d,b:g,a:w}=this;return w===0?[0,0,0,0]:[255*s/w,255*d/w,255*g/w,w]}}Q.black=new Q(0,0,0,1),Q.white=new Q(1,1,1,1),Q.transparent=new Q(0,0,0,0),Q.red=new Q(1,0,0,1);class le{constructor(s,d,g){this.sensitivity=s?d?"variant":"case":d?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,d){return this.collator.compare(s,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class be{constructor(s,d,g,w,E){this.text=s,this.image=d,this.scale=g,this.fontStack=w,this.textColor=E}}class Ae{constructor(s){this.sections=s}static fromString(s){return new Ae([new be(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Ae?s:Ae.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Se{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Se)return s;if(typeof s=="number")return new Se([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const d of s)if(typeof d!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Se(s)}}toString(){return JSON.stringify(this.values)}}class xe{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new xe({name:s,available:!1}):null}}function ke(u,s,d,g){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof d=="number"&&d>=0&&d<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[u,s,d,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[u,s,d,g]:[u,s,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function et(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Q||u instanceof le||u instanceof Ae||u instanceof Se||u instanceof xe)return!0;if(Array.isArray(u)){for(const s of u)if(!et(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!et(u[s]))return!1;return!0}return!1}function ct(u){if(u===null)return li;if(typeof u=="string")return rn;if(typeof u=="boolean")return tn;if(typeof u=="number")return wt;if(u instanceof Q)return Dr;if(u instanceof le)return Xr;if(u instanceof Ae)return oa;if(u instanceof Se)return Er;if(u instanceof xe)return Sa;if(Array.isArray(u)){const s=u.length;let d;for(const g of u){const w=ct(g);if(d){if(d===w)continue;d=fn;break}d=w}return ni(d||fn,s)}return ts}function ot(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof Q||u instanceof Ae||u instanceof Se||u instanceof xe?u.toString():JSON.stringify(u)}class Ft{constructor(s,d){this.type=s,this.value=d}static parse(s,d){if(s.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!et(s[1]))return d.error("invalid value");const g=s[1];let w=ct(g);const E=d.expectedType;return w.kind!=="array"||w.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(w=E),new Ft(w,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Lt{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Wt={string:rn,number:wt,boolean:tn,object:ts};class Qt{constructor(s,d){this.type=s,this.args=d}static parse(s,d){if(s.length<2)return d.error("Expected at least one argument.");let g,w=1;const E=s[0];if(E==="array"){let P,O;if(s.length>2){const F=s[1];if(typeof F!="string"||!(F in Wt)||F==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);P=Wt[F],w++}else P=fn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return d.error('The length argument to "array" must be a positive integer literal',2);O=s[2],w++}g=ni(P,O)}else{if(!Wt[E])throw new Error(`Types doesn't contain name = ${E}`);g=Wt[E]}const C=[];for(;w<s.length;w++){const P=d.parse(s[w],w,fn);if(!P)return null;C.push(P)}return new Qt(g,C)}evaluate(s){for(let d=0;d<this.args.length;d++){const g=this.args[d].evaluate(s);if(!la(this.type,ct(g)))return g;if(d===this.args.length-1)throw new Lt(`Expected value to be of type ${ii(this.type)}, but found ${ii(ct(g))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const _n={"to-boolean":tn,"to-color":Dr,"to-number":wt,"to-string":rn};class gn{constructor(s,d){this.type=s,this.args=d}static parse(s,d){if(s.length<2)return d.error("Expected at least one argument.");const g=s[0];if(!_n[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&s.length!==2)return d.error("Expected one argument.");const w=_n[g],E=[];for(let C=1;C<s.length;C++){const P=d.parse(s[C],C,fn);if(!P)return null;E.push(P)}return new gn(w,E)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let d,g;for(const w of this.args){if(d=w.evaluate(s),g=null,d instanceof Q)return d;if(typeof d=="string"){const E=s.parseColor(d);if(E)return E}else if(Array.isArray(d)&&(g=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:ke(d[0],d[1],d[2],d[3]),!g))return new Q(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new Lt(g||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}if(this.type.kind==="padding"){let d;for(const g of this.args){d=g.evaluate(s);const w=Se.parse(d);if(w)return w}throw new Lt(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}if(this.type.kind==="number"){let d=null;for(const g of this.args){if(d=g.evaluate(s),d===null)return 0;const w=Number(d);if(!isNaN(w))return w}throw new Lt(`Could not convert ${JSON.stringify(d)} to number.`)}return this.type.kind==="formatted"?Ae.fromString(ot(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?xe.fromString(ot(this.args[0].evaluate(s))):ot(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const dn=["Unknown","Point","LineString","Polygon"];class an{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let d=this._parseColorCache[s];return d||(d=this._parseColorCache[s]=Q.parse(s)),d}}class ln{constructor(s,d,g,w){this.name=s,this.type=d,this._evaluate=g,this.args=w}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,d){const g=s[0],w=ln.definitions[g];if(!w)return d.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(w)?w[0]:w.type,C=Array.isArray(w)?[[w[1],w[2]]]:w.overloads,P=C.filter(([F])=>!Array.isArray(F)||F.length===s.length-1);let O=null;for(const[F,j]of P){O=new ac(d.registry,d.path,null,d.scope);const W=[];let G=!1;for(let J=1;J<s.length;J++){const ee=s[J],ve=Array.isArray(F)?F[J-1]:F.type,ye=O.parse(ee,1+W.length,ve);if(!ye){G=!0;break}W.push(ye)}if(!G)if(Array.isArray(F)&&F.length!==W.length)O.error(`Expected ${F.length} arguments, but found ${W.length} instead.`);else{for(let J=0;J<W.length;J++){const ee=Array.isArray(F)?F[J]:F.type,ve=W[J];O.concat(J+1).checkSubtype(ee,ve.type)}if(O.errors.length===0)return new ln(g,E,j,W)}}if(P.length===1)d.errors.push(...O.errors);else{const F=(P.length?P:C).map(([W])=>{return G=W,Array.isArray(G)?`(${G.map(ii).join(", ")})`:`(${ii(G.type)}...)`;var G}).join(" | "),j=[];for(let W=1;W<s.length;W++){const G=d.parse(s[W],1+j.length);if(!G)return null;j.push(ii(G.type))}d.error(`Expected arguments of type ${F}, but found (${j.join(", ")}) instead.`)}return null}static register(s,d){ln.definitions=d;for(const g in d)s[g]=ln}}class Di{constructor(s,d,g){this.type=Xr,this.locale=g,this.caseSensitive=s,this.diacriticSensitive=d}static parse(s,d){if(s.length!==2)return d.error("Expected one argument.");const g=s[1];if(typeof g!="object"||Array.isArray(g))return d.error("Collator options argument must be an object.");const w=d.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,tn);if(!w)return null;const E=d.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,tn);if(!E)return null;let C=null;return g.locale&&(C=d.parse(g.locale,1,rn),!C)?null:new Di(w,E,C)}evaluate(s){return new le(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const ci=8192;function Oi(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function rr(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Ju(u,s){const d=(180+u[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,w=Math.pow(2,s.z);return[Math.round(d*w*ci),Math.round(g*w*ci)]}function il(u,s,d){const g=u[0]-s[0],w=u[1]-s[1],E=u[0]-d[0],C=u[1]-d[1];return g*C-E*w==0&&g*E<=0&&w*C<=0}function Tn(u,s){let d=!1;for(let C=0,P=s.length;C<P;C++){const O=s[C];for(let F=0,j=O.length;F<j-1;F++){if(il(u,O[F],O[F+1]))return!1;(w=O[F])[1]>(g=u)[1]!=(E=O[F+1])[1]>g[1]&&g[0]<(E[0]-w[0])*(g[1]-w[1])/(E[1]-w[1])+w[0]&&(d=!d)}}var g,w,E;return d}function xf(u,s){for(let d=0;d<s.length;d++)if(Tn(u,s[d]))return!0;return!1}function Hc(u,s,d,g){const w=g[0]-d[0],E=g[1]-d[1],C=(u[0]-d[0])*E-w*(u[1]-d[1]),P=(s[0]-d[0])*E-w*(s[1]-d[1]);return C>0&&P<0||C<0&&P>0}function qc(u,s,d){for(const F of d)for(let j=0;j<F.length-1;++j)if((P=[(C=F[j+1])[0]-(E=F[j])[0],C[1]-E[1]])[0]*(O=[(w=s)[0]-(g=u)[0],w[1]-g[1]])[1]-P[1]*O[0]!=0&&Hc(g,w,E,C)&&Hc(E,C,g,w))return!0;var g,w,E,C,P,O;return!1}function Wc(u,s){for(let d=0;d<u.length;++d)if(!Tn(u[d],s))return!1;for(let d=0;d<u.length-1;++d)if(qc(u[d],u[d+1],s))return!1;return!0}function ic(u,s){for(let d=0;d<s.length;d++)if(Wc(u,s[d]))return!0;return!1}function eh(u,s,d){const g=[];for(let w=0;w<u.length;w++){const E=[];for(let C=0;C<u[w].length;C++){const P=Ju(u[w][C],d);Oi(s,P),E.push(P)}g.push(E)}return g}function ns(u,s,d){const g=[];for(let w=0;w<u.length;w++){const E=eh(u[w],s,d);g.push(E)}return g}function rc(u,s,d,g){if(u[0]<d[0]||u[0]>d[2]){const w=.5*g;let E=u[0]-d[0]>w?-g:d[0]-u[0]>w?g:0;E===0&&(E=u[0]-d[2]>w?-g:d[2]-u[0]>w?g:0),u[0]+=E}Oi(s,u)}function th(u,s,d,g){const w=Math.pow(2,g.z)*ci,E=[g.x*ci,g.y*ci],C=[];for(const P of u)for(const O of P){const F=[O.x+E[0],O.y+E[1]];rc(F,s,d,w),C.push(F)}return C}function Xc(u,s,d,g){const w=Math.pow(2,g.z)*ci,E=[g.x*ci,g.y*ci],C=[];for(const O of u){const F=[];for(const j of O){const W=[j.x+E[0],j.y+E[1]];Oi(s,W),F.push(W)}C.push(F)}if(s[2]-s[0]<=w/2){(P=s)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const O of C)for(const F of O)rc(F,s,d,w)}var P;return C}class ws{constructor(s,d){this.type=tn,this.geojson=s,this.geometries=d}static parse(s,d){if(s.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(et(s[1])){const g=s[1];if(g.type==="FeatureCollection")for(let w=0;w<g.features.length;++w){const E=g.features[w].geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new ws(g,g.features[w].geometry)}else if(g.type==="Feature"){const w=g.geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new ws(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ws(g,g)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(d,g){const w=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],C=d.canonicalID();if(g.type==="Polygon"){const P=eh(g.coordinates,E,C),O=th(d.geometry(),w,E,C);if(!rr(w,E))return!1;for(const F of O)if(!Tn(F,P))return!1}if(g.type==="MultiPolygon"){const P=ns(g.coordinates,E,C),O=th(d.geometry(),w,E,C);if(!rr(w,E))return!1;for(const F of O)if(!xf(F,P))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(d,g){const w=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],C=d.canonicalID();if(g.type==="Polygon"){const P=eh(g.coordinates,E,C),O=Xc(d.geometry(),w,E,C);if(!rr(w,E))return!1;for(const F of O)if(!Wc(F,P))return!1}if(g.type==="MultiPolygon"){const P=ns(g.coordinates,E,C),O=Xc(d.geometry(),w,E,C);if(!rr(w,E))return!1;for(const F of O)if(!ic(F,P))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function sc(u){if(u instanceof ln&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ws)return!1;let s=!0;return u.eachChild(d=>{s&&!sc(d)&&(s=!1)}),s}function To(u){if(u instanceof ln&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(d=>{s&&!To(d)&&(s=!1)}),s}function ua(u,s){if(u instanceof ln&&s.indexOf(u.name)>=0)return!1;let d=!0;return u.eachChild(g=>{d&&!ua(g,s)&&(d=!1)}),d}class Zc{constructor(s,d){this.type=d.type,this.name=s,this.boundExpression=d}static parse(s,d){if(s.length!==2||typeof s[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const g=s[1];return d.scope.has(g)?new Zc(g,d.scope.get(g)):d.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class ac{constructor(s,d=[],g,w=new Wr,E=[]){this.registry=s,this.path=d,this.key=d.map(C=>`[${C}]`).join(""),this.scope=w,this.errors=E,this.expectedType=g}parse(s,d,g,w,E={}){return d?this.concat(d,g,w)._parse(s,E):this._parse(s,E)}_parse(s,d){function g(w,E,C){return C==="assert"?new Qt(E,[w]):C==="coerce"?new gn(E,[w]):w}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const w=s[0];if(typeof w!="string")return this.error(`Expression name must be a string, but found ${typeof w} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[w];if(E){let C=E.parse(s,this);if(!C)return null;if(this.expectedType){const P=this.expectedType,O=C.type;if(P.kind!=="string"&&P.kind!=="number"&&P.kind!=="boolean"&&P.kind!=="object"&&P.kind!=="array"||O.kind!=="value")if(P.kind!=="color"&&P.kind!=="formatted"&&P.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string")if(P.kind!=="padding"||O.kind!=="value"&&O.kind!=="number"&&O.kind!=="array"){if(this.checkSubtype(P,O))return null}else C=g(C,P,d.typeAnnotation||"coerce");else C=g(C,P,d.typeAnnotation||"coerce");else C=g(C,P,d.typeAnnotation||"assert")}if(!(C instanceof Ft)&&C.type.kind!=="resolvedImage"&&rl(C)){const P=new an;try{C=new Ft(C.type,C.evaluate(P))}catch(O){return this.error(O.message),null}}return C}return this.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,d,g){const w=typeof s=="number"?this.path.concat(s):this.path,E=g?this.scope.concat(g):this.scope;return new ac(this.registry,w,d||null,E,this.errors)}error(s,...d){const g=`${this.key}${d.map(w=>`[${w}]`).join("")}`;this.errors.push(new ri(g,s))}checkSubtype(s,d){const g=la(s,d);return g&&this.error(g),g}}function rl(u){if(u instanceof Zc)return rl(u.boundExpression);if(u instanceof ln&&u.name==="error"||u instanceof Di||u instanceof ws)return!1;const s=u instanceof gn||u instanceof Qt;let d=!0;return u.eachChild(g=>{d=s?d&&rl(g):d&&g instanceof Ft}),!!d&&sc(u)&&ua(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function sl(u,s){const d=u.length-1;let g,w,E=0,C=d,P=0;for(;E<=C;)if(P=Math.floor((E+C)/2),g=u[P],w=u[P+1],g<=s){if(P===d||s<w)return P;E=P+1}else{if(!(g>s))throw new Lt("Input is not a number.");C=P-1}return 0}class oc{constructor(s,d,g){this.type=s,this.input=d,this.labels=[],this.outputs=[];for(const[w,E]of g)this.labels.push(w),this.outputs.push(E)}static parse(s,d){if(s.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return d.error("Expected an even number of arguments.");const g=d.parse(s[1],1,wt);if(!g)return null;const w=[];let E=null;d.expectedType&&d.expectedType.kind!=="value"&&(E=d.expectedType);for(let C=1;C<s.length;C+=2){const P=C===1?-1/0:s[C],O=s[C+1],F=C,j=C+1;if(typeof P!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=P)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const W=d.parse(O,j,E);if(!W)return null;E=E||W.type,w.push([P,W])}return new oc(E,g,w)}evaluate(s){const d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(s);const w=this.input.evaluate(s);if(w<=d[0])return g[0].evaluate(s);const E=d.length;return w>=d[E-1]?g[E-1].evaluate(s):g[sl(d,w)].evaluate(s)}eachChild(s){s(this.input);for(const d of this.outputs)s(d)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Ti(u,s,d){return u*(1-d)+s*d}var ja=Object.freeze({__proto__:null,number:Ti,color:function(u,s,d){return new Q(Ti(u.r,s.r,d),Ti(u.g,s.g,d),Ti(u.b,s.b,d),Ti(u.a,s.a,d))},array:function(u,s,d){return u.map((g,w)=>Ti(g,s[w],d))},padding:function(u,s,d){const g=u.values,w=s.values;return new Se([Ti(g[0],w[0],d),Ti(g[1],w[1],d),Ti(g[2],w[2],d),Ti(g[3],w[3],d)])}});const lc=.95047,Yc=1.08883,So=4/29,Ea=6/29,Gc=3*Ea*Ea,nh=Math.PI/180,vf=180/Math.PI;function Eo(u){return u>.008856451679035631?Math.pow(u,1/3):u/Gc+So}function qs(u){return u>Ea?u*u*u:Gc*(u-So)}function cc(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function Ao(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Aa(u){const s=Ao(u.r),d=Ao(u.g),g=Ao(u.b),w=Eo((.4124564*s+.3575761*d+.1804375*g)/lc),E=Eo((.2126729*s+.7151522*d+.072175*g)/1);return{l:116*E-16,a:500*(w-E),b:200*(E-Eo((.0193339*s+.119192*d+.9503041*g)/Yc)),alpha:u.a}}function Un(u){let s=(u.l+16)/116,d=isNaN(u.a)?s:s+u.a/500,g=isNaN(u.b)?s:s-u.b/200;return s=1*qs(s),d=lc*qs(d),g=Yc*qs(g),new Q(cc(3.2404542*d-1.5371385*s-.4985314*g),cc(-.969266*d+1.8760108*s+.041556*g),cc(.0556434*d-.2040259*s+1.0572252*g),u.alpha)}function Kc(u,s,d){const g=s-u;return u+d*(g>180||g<-180?g-360*Math.round(g/360):g)}const al={forward:Aa,reverse:Un,interpolate:function(u,s,d){return{l:Ti(u.l,s.l,d),a:Ti(u.a,s.a,d),b:Ti(u.b,s.b,d),alpha:Ti(u.alpha,s.alpha,d)}}},$a={forward:function(u){const{l:s,a:d,b:g}=Aa(u),w=Math.atan2(g,d)*vf;return{h:w<0?w+360:w,c:Math.sqrt(d*d+g*g),l:s,alpha:u.a}},reverse:function(u){const s=u.h*nh,d=u.c;return Un({l:u.l,a:Math.cos(s)*d,b:Math.sin(s)*d,alpha:u.alpha})},interpolate:function(u,s,d){return{h:Kc(u.h,s.h,d),c:Ti(u.c,s.c,d),l:Ti(u.l,s.l,d),alpha:Ti(u.alpha,s.alpha,d)}}};var uc=Object.freeze({__proto__:null,lab:al,hcl:$a});class is{constructor(s,d,g,w,E){this.type=s,this.operator=d,this.interpolation=g,this.input=w,this.labels=[],this.outputs=[];for(const[C,P]of E)this.labels.push(C),this.outputs.push(P)}static interpolationFactor(s,d,g,w){let E=0;if(s.name==="exponential")E=Or(d,s.base,g,w);else if(s.name==="linear")E=Or(d,1,g,w);else if(s.name==="cubic-bezier"){const C=s.controlPoints;E=new _(C[0],C[1],C[2],C[3]).solve(Or(d,1,g,w))}return E}static parse(s,d){let[g,w,E,...C]=s;if(!Array.isArray(w)||w.length===0)return d.error("Expected an interpolation type expression.",1);if(w[0]==="linear")w={name:"linear"};else if(w[0]==="exponential"){const F=w[1];if(typeof F!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);w={name:"exponential",base:F}}else{if(w[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(w[0])}`,1,0);{const F=w.slice(1);if(F.length!==4||F.some(j=>typeof j!="number"||j<0||j>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);w={name:"cubic-bezier",controlPoints:F}}}if(s.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(E=d.parse(E,2,wt),!E)return null;const P=[];let O=null;g==="interpolate-hcl"||g==="interpolate-lab"?O=Dr:d.expectedType&&d.expectedType.kind!=="value"&&(O=d.expectedType);for(let F=0;F<C.length;F+=2){const j=C[F],W=C[F+1],G=F+3,J=F+4;if(typeof j!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(P.length&&P[P.length-1][0]>=j)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const ee=d.parse(W,J,O);if(!ee)return null;O=O||ee.type,P.push([j,ee])}return O.kind==="number"||O.kind==="color"||O.kind==="padding"||O.kind==="array"&&O.itemType.kind==="number"&&typeof O.N=="number"?new is(O,g,w,E,P):d.error(`Type ${ii(O)} is not interpolatable.`)}evaluate(s){const d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(s);const w=this.input.evaluate(s);if(w<=d[0])return g[0].evaluate(s);const E=d.length;if(w>=d[E-1])return g[E-1].evaluate(s);const C=sl(d,w),P=is.interpolationFactor(this.interpolation,w,d[C],d[C+1]),O=g[C].evaluate(s),F=g[C+1].evaluate(s);return this.operator==="interpolate"?ja[this.type.kind.toLowerCase()](O,F,P):this.operator==="interpolate-hcl"?$a.reverse($a.interpolate($a.forward(O),$a.forward(F),P)):al.reverse(al.interpolate(al.forward(O),al.forward(F),P))}eachChild(s){s(this.input);for(const d of this.outputs)s(d)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Or(u,s,d,g){const w=g-d,E=u-d;return w===0?0:s===1?E/w:(Math.pow(s,E)-1)/(Math.pow(s,w)-1)}class ha{constructor(s,d){this.type=s,this.args=d}static parse(s,d){if(s.length<2)return d.error("Expectected at least one argument.");let g=null;const w=d.expectedType;w&&w.kind!=="value"&&(g=w);const E=[];for(const P of s.slice(1)){const O=d.parse(P,1+E.length,g,void 0,{typeAnnotation:"omit"});if(!O)return null;g=g||O.type,E.push(O)}if(!g)throw new Error("No output type");const C=w&&E.some(P=>la(w,P.type));return new ha(C?fn:g,E)}evaluate(s){let d,g=null,w=0;for(const E of this.args)if(w++,g=E.evaluate(s),g&&g instanceof xe&&!g.available&&(d||(d=g.name),g=null,w===this.args.length&&(g=d)),g!==null)break;return g}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Co{constructor(s,d){this.type=d.type,this.bindings=[].concat(s),this.result=d}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const d of this.bindings)s(d[1]);s(this.result)}static parse(s,d){if(s.length<4)return d.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const g=[];for(let E=1;E<s.length-1;E+=2){const C=s[E];if(typeof C!="string")return d.error(`Expected string, but found ${typeof C} instead.`,E);if(/[^a-zA-Z0-9_]/.test(C))return d.error("Variable names must contain only alphanumeric characters or '_'.",E);const P=d.parse(s[E+1],E+1);if(!P)return null;g.push([C,P])}const w=d.parse(s[s.length-1],s.length-1,d.expectedType,g);return w?new Co(g,w):null}outputDefined(){return this.result.outputDefined()}}class Ro{constructor(s,d,g){this.type=s,this.index=d,this.input=g}static parse(s,d){if(s.length!==3)return d.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const g=d.parse(s[1],1,wt),w=d.parse(s[2],2,ni(d.expectedType||fn));return g&&w?new Ro(w.type.itemType,g,w):null}evaluate(s){const d=this.index.evaluate(s),g=this.input.evaluate(s);if(d<0)throw new Lt(`Array index out of bounds: ${d} < 0.`);if(d>=g.length)throw new Lt(`Array index out of bounds: ${d} > ${g.length-1}.`);if(d!==Math.floor(d))throw new Lt(`Array index must be an integer, but found ${d} instead.`);return g[d]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class ih{constructor(s,d){this.type=tn,this.needle=s,this.haystack=d}static parse(s,d){if(s.length!==3)return d.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const g=d.parse(s[1],1,fn),w=d.parse(s[2],2,fn);return g&&w?Zr(g.type,[tn,rn,wt,li,fn])?new ih(g,w):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(g.type)} instead`):null}evaluate(s){const d=this.needle.evaluate(s),g=this.haystack.evaluate(s);if(!g)return!1;if(!wi(d,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${ii(ct(d))} instead.`);if(!wi(g,["string","array"]))throw new Lt(`Expected second argument to be of type array or string, but found ${ii(ct(g))} instead.`);return g.indexOf(d)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class ol{constructor(s,d,g){this.type=wt,this.needle=s,this.haystack=d,this.fromIndex=g}static parse(s,d){if(s.length<=2||s.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const g=d.parse(s[1],1,fn),w=d.parse(s[2],2,fn);if(!g||!w)return null;if(!Zr(g.type,[tn,rn,wt,li,fn]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(g.type)} instead`);if(s.length===4){const E=d.parse(s[3],3,wt);return E?new ol(g,w,E):null}return new ol(g,w)}evaluate(s){const d=this.needle.evaluate(s),g=this.haystack.evaluate(s);if(!wi(d,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${ii(ct(d))} instead.`);if(!wi(g,["string","array"]))throw new Lt(`Expected second argument to be of type array or string, but found ${ii(ct(g))} instead.`);if(this.fromIndex){const w=this.fromIndex.evaluate(s);return g.indexOf(d,w)}return g.indexOf(d)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class hc{constructor(s,d,g,w,E,C){this.inputType=s,this.type=d,this.input=g,this.cases=w,this.outputs=E,this.otherwise=C}static parse(s,d){if(s.length<5)return d.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return d.error("Expected an even number of arguments.");let g,w;d.expectedType&&d.expectedType.kind!=="value"&&(w=d.expectedType);const E={},C=[];for(let F=2;F<s.length-1;F+=2){let j=s[F];const W=s[F+1];Array.isArray(j)||(j=[j]);const G=d.concat(F);if(j.length===0)return G.error("Expected at least one branch label.");for(const ee of j){if(typeof ee!="number"&&typeof ee!="string")return G.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return G.error("Numeric branch labels must be integer values.");if(g){if(G.checkSubtype(g,ct(ee)))return null}else g=ct(ee);if(E[String(ee)]!==void 0)return G.error("Branch labels must be unique.");E[String(ee)]=C.length}const J=d.parse(W,F,w);if(!J)return null;w=w||J.type,C.push(J)}const P=d.parse(s[1],1,fn);if(!P)return null;const O=d.parse(s[s.length-1],s.length-1,w);return O?P.type.kind!=="value"&&d.concat(1).checkSubtype(g,P.type)?null:new hc(g,w,P,E,C,O):null}evaluate(s){const d=this.input.evaluate(s);return(ct(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class ko{constructor(s,d,g){this.type=s,this.branches=d,this.otherwise=g}static parse(s,d){if(s.length<4)return d.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return d.error("Expected an odd number of arguments.");let g;d.expectedType&&d.expectedType.kind!=="value"&&(g=d.expectedType);const w=[];for(let C=1;C<s.length-1;C+=2){const P=d.parse(s[C],C,tn);if(!P)return null;const O=d.parse(s[C+1],C+1,g);if(!O)return null;w.push([P,O]),g=g||O.type}const E=d.parse(s[s.length-1],s.length-1,g);if(!E)return null;if(!g)throw new Error("Can't infer output type");return new ko(g,w,E)}evaluate(s){for(const[d,g]of this.branches)if(d.evaluate(s))return g.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[d,g]of this.branches)s(d),s(g);s(this.otherwise)}outputDefined(){return this.branches.every(([s,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class Io{constructor(s,d,g,w){this.type=s,this.input=d,this.beginIndex=g,this.endIndex=w}static parse(s,d){if(s.length<=2||s.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const g=d.parse(s[1],1,fn),w=d.parse(s[2],2,wt);if(!g||!w)return null;if(!Zr(g.type,[ni(fn),rn,fn]))return d.error(`Expected first argument to be of type array or string, but found ${ii(g.type)} instead`);if(s.length===4){const E=d.parse(s[3],3,wt);return E?new Io(g.type,g,w,E):null}return new Io(g.type,g,w)}evaluate(s){const d=this.input.evaluate(s),g=this.beginIndex.evaluate(s);if(!wi(d,["string","array"]))throw new Lt(`Expected first argument to be of type array or string, but found ${ii(ct(d))} instead.`);if(this.endIndex){const w=this.endIndex.evaluate(s);return d.slice(g,w)}return d.slice(g)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function rh(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function wf(u,s,d,g){return g.compare(s,d)===0}function ll(u,s,d){const g=u!=="=="&&u!=="!=";return class s2{constructor(E,C,P){this.type=tn,this.lhs=E,this.rhs=C,this.collator=P,this.hasUntypedArgument=E.type.kind==="value"||C.type.kind==="value"}static parse(E,C){if(E.length!==3&&E.length!==4)return C.error("Expected two or three arguments.");const P=E[0];let O=C.parse(E[1],1,fn);if(!O)return null;if(!rh(P,O.type))return C.concat(1).error(`"${P}" comparisons are not supported for type '${ii(O.type)}'.`);let F=C.parse(E[2],2,fn);if(!F)return null;if(!rh(P,F.type))return C.concat(2).error(`"${P}" comparisons are not supported for type '${ii(F.type)}'.`);if(O.type.kind!==F.type.kind&&O.type.kind!=="value"&&F.type.kind!=="value")return C.error(`Cannot compare types '${ii(O.type)}' and '${ii(F.type)}'.`);g&&(O.type.kind==="value"&&F.type.kind!=="value"?O=new Qt(F.type,[O]):O.type.kind!=="value"&&F.type.kind==="value"&&(F=new Qt(O.type,[F])));let j=null;if(E.length===4){if(O.type.kind!=="string"&&F.type.kind!=="string"&&O.type.kind!=="value"&&F.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(j=C.parse(E[3],3,Xr),!j)return null}return new s2(O,F,j)}evaluate(E){const C=this.lhs.evaluate(E),P=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){const O=ct(C),F=ct(P);if(O.kind!==F.kind||O.kind!=="string"&&O.kind!=="number")throw new Lt(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${O.kind}, ${F.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const O=ct(C),F=ct(P);if(O.kind!=="string"||F.kind!=="string")return s(E,C,P)}return this.collator?d(E,C,P,this.collator.evaluate(E)):s(E,C,P)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const Hd=ll("==",function(u,s,d){return s===d},wf),sh=ll("!=",function(u,s,d){return s!==d},function(u,s,d,g){return!wf(0,s,d,g)}),qd=ll("<",function(u,s,d){return s<d},function(u,s,d,g){return g.compare(s,d)<0}),Wd=ll(">",function(u,s,d){return s>d},function(u,s,d,g){return g.compare(s,d)>0}),Xd=ll("<=",function(u,s,d){return s<=d},function(u,s,d,g){return g.compare(s,d)<=0}),Zd=ll(">=",function(u,s,d){return s>=d},function(u,s,d,g){return g.compare(s,d)>=0});class ah{constructor(s,d,g,w,E){this.type=rn,this.number=s,this.locale=d,this.currency=g,this.minFractionDigits=w,this.maxFractionDigits=E}static parse(s,d){if(s.length!==3)return d.error("Expected two arguments.");const g=d.parse(s[1],1,wt);if(!g)return null;const w=s[2];if(typeof w!="object"||Array.isArray(w))return d.error("NumberFormat options argument must be an object.");let E=null;if(w.locale&&(E=d.parse(w.locale,1,rn),!E))return null;let C=null;if(w.currency&&(C=d.parse(w.currency,1,rn),!C))return null;let P=null;if(w["min-fraction-digits"]&&(P=d.parse(w["min-fraction-digits"],1,wt),!P))return null;let O=null;return w["max-fraction-digits"]&&(O=d.parse(w["max-fraction-digits"],1,wt),!O)?null:new ah(g,E,C,P,O)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class fc{constructor(s){this.type=oa,this.sections=s}static parse(s,d){if(s.length<2)return d.error("Expected at least one argument.");const g=s[1];if(!Array.isArray(g)&&typeof g=="object")return d.error("First argument must be an image or text section.");const w=[];let E=!1;for(let C=1;C<=s.length-1;++C){const P=s[C];if(E&&typeof P=="object"&&!Array.isArray(P)){E=!1;let O=null;if(P["font-scale"]&&(O=d.parse(P["font-scale"],1,wt),!O))return null;let F=null;if(P["text-font"]&&(F=d.parse(P["text-font"],1,ni(rn)),!F))return null;let j=null;if(P["text-color"]&&(j=d.parse(P["text-color"],1,Dr),!j))return null;const W=w[w.length-1];W.scale=O,W.font=F,W.textColor=j}else{const O=d.parse(s[C],1,fn);if(!O)return null;const F=O.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,w.push({content:O,scale:null,font:null,textColor:null})}}return new fc(w)}evaluate(s){return new Ae(this.sections.map(d=>{const g=d.content.evaluate(s);return ct(g)===Sa?new be("",g,null,null,null):new be(ot(g),null,d.scale?d.scale.evaluate(s):null,d.font?d.font.evaluate(s).join(","):null,d.textColor?d.textColor.evaluate(s):null)}))}eachChild(s){for(const d of this.sections)s(d.content),d.scale&&s(d.scale),d.font&&s(d.font),d.textColor&&s(d.textColor)}outputDefined(){return!1}}class oh{constructor(s){this.type=Sa,this.input=s}static parse(s,d){if(s.length!==2)return d.error("Expected two arguments.");const g=d.parse(s[1],1,rn);return g?new oh(g):d.error("No image name provided.")}evaluate(s){const d=this.input.evaluate(s),g=xe.fromString(d);return g&&s.availableImages&&(g.available=s.availableImages.indexOf(d)>-1),g}eachChild(s){s(this.input)}outputDefined(){return!1}}class lh{constructor(s){this.type=wt,this.input=s}static parse(s,d){if(s.length!==2)return d.error(`Expected 1 argument, but found ${s.length-1} instead.`);const g=d.parse(s[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${ii(g.type)} instead.`):new lh(g):null}evaluate(s){const d=this.input.evaluate(s);if(typeof d=="string"||Array.isArray(d))return d.length;throw new Lt(`Expected value to be of type string or array, but found ${ii(ct(d))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const cl={"==":Hd,"!=":sh,">":Wd,"<":qd,">=":Zd,"<=":Xd,array:Qt,at:Ro,boolean:Qt,case:ko,coalesce:ha,collator:Di,format:fc,image:oh,in:ih,"index-of":ol,interpolate:is,"interpolate-hcl":is,"interpolate-lab":is,length:lh,let:Co,literal:Ft,match:hc,number:Qt,"number-format":ah,object:Qt,slice:Io,step:oc,string:Qt,"to-boolean":gn,"to-color":gn,"to-number":gn,"to-string":gn,var:Zc,within:ws};function Tf(u,[s,d,g,w]){s=s.evaluate(u),d=d.evaluate(u),g=g.evaluate(u);const E=w?w.evaluate(u):1,C=ke(s,d,g,E);if(C)throw new Lt(C);return new Q(s/255*E,d/255*E,g/255*E,E)}function Qc(u,s){return u in s}function ch(u,s){const d=s[u];return d===void 0?null:d}function Ha(u){return{type:u}}function Sf(u){return{result:"success",value:u}}function Mo(u){return{result:"error",value:u}}function ul(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Bi(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function uh(u){return!!u.expression&&u.expression.interpolated}function Xt(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function hl(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Si(u){return u}function _i(u,s){const d=s.type==="color",g=u.stops&&typeof u.stops[0][0]=="object",w=g||!(g||u.property!==void 0),E=u.type||(uh(s)?"exponential":"interval");if(d||s.type==="padding"){const F=d?Q.parse:Se.parse;(u=Cn({},u)).stops&&(u.stops=u.stops.map(j=>[j[0],F(j[1])])),u.default=F(u.default?u.default:s.default)}if(u.colorSpace&&u.colorSpace!=="rgb"&&!uc[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let C,P,O;if(E==="exponential")C=fl;else if(E==="interval")C=hh;else if(E==="categorical"){C=Ef,P=Object.create(null);for(const F of u.stops)P[F[0]]=F[1];O=typeof u.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);C=Yd}if(g){const F={},j=[];for(let J=0;J<u.stops.length;J++){const ee=u.stops[J],ve=ee[0].zoom;F[ve]===void 0&&(F[ve]={zoom:ve,type:u.type,property:u.property,default:u.default,stops:[]},j.push(ve)),F[ve].stops.push([ee[0].value,ee[1]])}const W=[];for(const J of j)W.push([F[J].zoom,_i(F[J],s)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:is.interpolationFactor.bind(void 0,G),zoomStops:W.map(J=>J[0]),evaluate:({zoom:J},ee)=>fl({stops:W,base:u.base},s,J).evaluate(J,ee)}}if(w){const F=E==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:is.interpolationFactor.bind(void 0,F),zoomStops:u.stops.map(j=>j[0]),evaluate:({zoom:j})=>C(u,s,j,P,O)}}return{kind:"source",evaluate(F,j){const W=j&&j.properties?j.properties[u.property]:void 0;return W===void 0?qa(u.default,s.default):C(u,s,W,P,O)}}}function qa(u,s,d){return u!==void 0?u:s!==void 0?s:d!==void 0?d:void 0}function Ef(u,s,d,g,w){return qa(typeof d===w?g[d]:void 0,u.default,s.default)}function hh(u,s,d){if(Xt(d)!=="number")return qa(u.default,s.default);const g=u.stops.length;if(g===1||d<=u.stops[0][0])return u.stops[0][1];if(d>=u.stops[g-1][0])return u.stops[g-1][1];const w=sl(u.stops.map(E=>E[0]),d);return u.stops[w][1]}function fl(u,s,d){const g=u.base!==void 0?u.base:1;if(Xt(d)!=="number")return qa(u.default,s.default);const w=u.stops.length;if(w===1||d<=u.stops[0][0])return u.stops[0][1];if(d>=u.stops[w-1][0])return u.stops[w-1][1];const E=sl(u.stops.map(j=>j[0]),d),C=function(j,W,G,J){const ee=J-G,ve=j-G;return ee===0?0:W===1?ve/ee:(Math.pow(W,ve)-1)/(Math.pow(W,ee)-1)}(d,g,u.stops[E][0],u.stops[E+1][0]),P=u.stops[E][1],O=u.stops[E+1][1];let F=ja[s.type]||Si;if(u.colorSpace&&u.colorSpace!=="rgb"){const j=uc[u.colorSpace];F=(W,G)=>j.reverse(j.interpolate(j.forward(W),j.forward(G),C))}return typeof P.evaluate=="function"?{evaluate(...j){const W=P.evaluate.apply(void 0,j),G=O.evaluate.apply(void 0,j);if(W!==void 0&&G!==void 0)return F(W,G,C)}}:F(P,O,C)}function Yd(u,s,d){switch(s.type){case"color":d=Q.parse(d);break;case"formatted":d=Ae.fromString(d.toString());break;case"resolvedImage":d=xe.fromString(d.toString());break;case"padding":d=Se.parse(d);break;default:Xt(d)===s.type||s.type==="enum"&&s.values[d]||(d=void 0)}return qa(d,u.default,s.default)}ln.register(cl,{error:[{kind:"error"},[rn],(u,[s])=>{throw new Lt(s.evaluate(u))}],typeof:[rn,[fn],(u,[s])=>ii(ct(s.evaluate(u)))],"to-rgba":[ni(wt,4),[Dr],(u,[s])=>s.evaluate(u).toArray()],rgb:[Dr,[wt,wt,wt],Tf],rgba:[Dr,[wt,wt,wt,wt],Tf],has:{type:tn,overloads:[[[rn],(u,[s])=>Qc(s.evaluate(u),u.properties())],[[rn,ts],(u,[s,d])=>Qc(s.evaluate(u),d.evaluate(u))]]},get:{type:fn,overloads:[[[rn],(u,[s])=>ch(s.evaluate(u),u.properties())],[[rn,ts],(u,[s,d])=>ch(s.evaluate(u),d.evaluate(u))]]},"feature-state":[fn,[rn],(u,[s])=>ch(s.evaluate(u),u.featureState||{})],properties:[ts,[],u=>u.properties()],"geometry-type":[rn,[],u=>u.geometryType()],id:[fn,[],u=>u.id()],zoom:[wt,[],u=>u.globals.zoom],"heatmap-density":[wt,[],u=>u.globals.heatmapDensity||0],"line-progress":[wt,[],u=>u.globals.lineProgress||0],accumulated:[fn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[wt,Ha(wt),(u,s)=>{let d=0;for(const g of s)d+=g.evaluate(u);return d}],"*":[wt,Ha(wt),(u,s)=>{let d=1;for(const g of s)d*=g.evaluate(u);return d}],"-":{type:wt,overloads:[[[wt,wt],(u,[s,d])=>s.evaluate(u)-d.evaluate(u)],[[wt],(u,[s])=>-s.evaluate(u)]]},"/":[wt,[wt,wt],(u,[s,d])=>s.evaluate(u)/d.evaluate(u)],"%":[wt,[wt,wt],(u,[s,d])=>s.evaluate(u)%d.evaluate(u)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(u,[s,d])=>Math.pow(s.evaluate(u),d.evaluate(u))],sqrt:[wt,[wt],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[wt,[wt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[wt,[wt],(u,[s])=>Math.log(s.evaluate(u))],log2:[wt,[wt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[wt,[wt],(u,[s])=>Math.sin(s.evaluate(u))],cos:[wt,[wt],(u,[s])=>Math.cos(s.evaluate(u))],tan:[wt,[wt],(u,[s])=>Math.tan(s.evaluate(u))],asin:[wt,[wt],(u,[s])=>Math.asin(s.evaluate(u))],acos:[wt,[wt],(u,[s])=>Math.acos(s.evaluate(u))],atan:[wt,[wt],(u,[s])=>Math.atan(s.evaluate(u))],min:[wt,Ha(wt),(u,s)=>Math.min(...s.map(d=>d.evaluate(u)))],max:[wt,Ha(wt),(u,s)=>Math.max(...s.map(d=>d.evaluate(u)))],abs:[wt,[wt],(u,[s])=>Math.abs(s.evaluate(u))],round:[wt,[wt],(u,[s])=>{const d=s.evaluate(u);return d<0?-Math.round(-d):Math.round(d)}],floor:[wt,[wt],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[wt,[wt],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[tn,[rn,fn],(u,[s,d])=>u.properties()[s.value]===d.value],"filter-id-==":[tn,[fn],(u,[s])=>u.id()===s.value],"filter-type-==":[tn,[rn],(u,[s])=>u.geometryType()===s.value],"filter-<":[tn,[rn,fn],(u,[s,d])=>{const g=u.properties()[s.value],w=d.value;return typeof g==typeof w&&g<w}],"filter-id-<":[tn,[fn],(u,[s])=>{const d=u.id(),g=s.value;return typeof d==typeof g&&d<g}],"filter->":[tn,[rn,fn],(u,[s,d])=>{const g=u.properties()[s.value],w=d.value;return typeof g==typeof w&&g>w}],"filter-id->":[tn,[fn],(u,[s])=>{const d=u.id(),g=s.value;return typeof d==typeof g&&d>g}],"filter-<=":[tn,[rn,fn],(u,[s,d])=>{const g=u.properties()[s.value],w=d.value;return typeof g==typeof w&&g<=w}],"filter-id-<=":[tn,[fn],(u,[s])=>{const d=u.id(),g=s.value;return typeof d==typeof g&&d<=g}],"filter->=":[tn,[rn,fn],(u,[s,d])=>{const g=u.properties()[s.value],w=d.value;return typeof g==typeof w&&g>=w}],"filter-id->=":[tn,[fn],(u,[s])=>{const d=u.id(),g=s.value;return typeof d==typeof g&&d>=g}],"filter-has":[tn,[fn],(u,[s])=>s.value in u.properties()],"filter-has-id":[tn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[tn,[ni(rn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[tn,[ni(fn)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[tn,[rn,ni(fn)],(u,[s,d])=>d.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[tn,[rn,ni(fn)],(u,[s,d])=>function(g,w,E,C){for(;E<=C;){const P=E+C>>1;if(w[P]===g)return!0;w[P]>g?C=P-1:E=P+1}return!1}(u.properties()[s.value],d.value,0,d.value.length-1)],all:{type:tn,overloads:[[[tn,tn],(u,[s,d])=>s.evaluate(u)&&d.evaluate(u)],[Ha(tn),(u,s)=>{for(const d of s)if(!d.evaluate(u))return!1;return!0}]]},any:{type:tn,overloads:[[[tn,tn],(u,[s,d])=>s.evaluate(u)||d.evaluate(u)],[Ha(tn),(u,s)=>{for(const d of s)if(d.evaluate(u))return!0;return!1}]]},"!":[tn,[tn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[tn,[rn],(u,[s])=>{const d=u.globals&&u.globals.isSupportedScript;return!d||d(s.evaluate(u))}],upcase:[rn,[rn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[rn,[rn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[rn,Ha(fn),(u,s)=>s.map(d=>ot(d.evaluate(u))).join("")],"resolved-locale":[rn,[Xr],(u,[s])=>s.evaluate(u).resolvedLocale()]});class Jc{constructor(s,d){this.expression=s,this._warningHistory={},this._evaluator=new an,this._defaultValue=d?function(g){return g.type==="color"&&hl(g.default)?new Q(0,0,0,0):g.type==="color"?Q.parse(g.default)||null:g.type==="padding"?Se.parse(g.default)||null:g.default===void 0?null:g.default}(d):null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(s,d,g,w,E,C){return this._evaluator.globals=s,this._evaluator.feature=d,this._evaluator.featureState=g,this._evaluator.canonical=w,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(s,d,g,w,E,C){this._evaluator.globals=s,this._evaluator.feature=d||null,this._evaluator.featureState=g||null,this._evaluator.canonical=w,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=C||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Lt(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function dl(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in cl}function pl(u,s){const d=new ac(cl,[],s?function(w){const E={color:Dr,string:rn,number:wt,enum:rn,boolean:tn,formatted:oa,padding:Er,resolvedImage:Sa};return w.type==="array"?ni(E[w.value]||fn,w.length):E[w.type]}(s):void 0),g=d.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Sf(new Jc(g,s)):Mo(d.errors)}class dc{constructor(s,d){this.kind=s,this._styleExpression=d,this.isStateDependent=s!=="constant"&&!To(d.expression)}evaluateWithoutErrorHandling(s,d,g,w,E,C){return this._styleExpression.evaluateWithoutErrorHandling(s,d,g,w,E,C)}evaluate(s,d,g,w,E,C){return this._styleExpression.evaluate(s,d,g,w,E,C)}}class ml{constructor(s,d,g,w){this.kind=s,this.zoomStops=g,this._styleExpression=d,this.isStateDependent=s!=="camera"&&!To(d.expression),this.interpolationType=w}evaluateWithoutErrorHandling(s,d,g,w,E,C){return this._styleExpression.evaluateWithoutErrorHandling(s,d,g,w,E,C)}evaluate(s,d,g,w,E,C){return this._styleExpression.evaluate(s,d,g,w,E,C)}interpolationFactor(s,d,g){return this.interpolationType?is.interpolationFactor(this.interpolationType,s,d,g):0}}function Po(u,s){const d=pl(u,s);if(d.result==="error")return d;const g=d.value.expression,w=sc(g);if(!w&&!ul(s))return Mo([new ri("","data expressions not supported")]);const E=ua(g,["zoom"]);if(!E&&!Bi(s))return Mo([new ri("","zoom expressions not supported")]);const C=tu(g);return C||E?C instanceof ri?Mo([C]):C instanceof is&&!uh(s)?Mo([new ri("",'"interpolate" expressions cannot be used with this property')]):Sf(C?new ml(w?"camera":"composite",d.value,C.labels,C instanceof is?C.interpolation:void 0):new dc(w?"constant":"source",d.value)):Mo([new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class eu{constructor(s,d){this._parameters=s,this._specification=d,Cn(this,_i(this._parameters,this._specification))}static deserialize(s){return new eu(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function tu(u){let s=null;if(u instanceof Co)s=tu(u.result);else if(u instanceof ha){for(const d of u.args)if(s=tu(d),s)break}else(u instanceof oc||u instanceof is)&&u.input instanceof ln&&u.input.name==="zoom"&&(s=u);return s instanceof ri||u.eachChild(d=>{const g=tu(d);g instanceof ri?s=g:!s&&g?s=new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&g&&s!==g&&(s=new ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Ws(u){const s=u.key,d=u.value,g=u.valueSpec||{},w=u.objectElementValidators||{},E=u.style,C=u.styleSpec;let P=[];const O=Xt(d);if(O!=="object")return[new at(s,d,`object expected, ${O} found`)];for(const F in d){const j=F.split(".")[0],W=g[j]||g["*"];let G;if(w[j])G=w[j];else if(g[j])G=fr;else if(w["*"])G=w["*"];else{if(!g["*"]){P.push(new at(s,d[F],`unknown property "${F}"`));continue}G=fr}P=P.concat(G({key:(s&&`${s}.`)+F,value:d[F],valueSpec:W,style:E,styleSpec:C,object:d,objectKey:F},d))}for(const F in g)w[F]||g[F].required&&g[F].default===void 0&&d[F]===void 0&&P.push(new at(s,d,`missing required property "${F}"`));return P}function fh(u){const s=u.value,d=u.valueSpec,g=u.style,w=u.styleSpec,E=u.key,C=u.arrayElementValidator||fr;if(Xt(s)!=="array")return[new at(E,s,`array expected, ${Xt(s)} found`)];if(d.length&&s.length!==d.length)return[new at(E,s,`array length ${d.length} expected, length ${s.length} found`)];if(d["min-length"]&&s.length<d["min-length"])return[new at(E,s,`array length at least ${d["min-length"]} expected, length ${s.length} found`)];let P={type:d.value,values:d.values};w.$version<7&&(P.function=d.function),Xt(d.value)==="object"&&(P=d.value);let O=[];for(let F=0;F<s.length;F++)O=O.concat(C({array:s,arrayIndex:F,value:s[F],valueSpec:P,style:g,styleSpec:w,key:`${E}[${F}]`}));return O}function nu(u){const s=u.key,d=u.value,g=u.valueSpec;let w=Xt(d);return w==="number"&&d!=d&&(w="NaN"),w!=="number"?[new at(s,d,`number expected, ${w} found`)]:"minimum"in g&&d<g.minimum?[new at(s,d,`${d} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&d>g.maximum?[new at(s,d,`${d} is greater than the maximum value ${g.maximum}`)]:[]}function gl(u){const s=u.valueSpec,d=Mn(u.value.type);let g,w,E,C={};const P=d!=="categorical"&&u.value.property===void 0,O=!P,F=Xt(u.value.stops)==="array"&&Xt(u.value.stops[0])==="array"&&Xt(u.value.stops[0][0])==="object",j=Ws({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(J){if(d==="identity")return[new at(J.key,J.value,'identity function may not have a "stops" property')];let ee=[];const ve=J.value;return ee=ee.concat(fh({key:J.key,value:ve,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:W})),Xt(ve)==="array"&&ve.length===0&&ee.push(new at(J.key,ve,"array must have at least one stop")),ee},default:function(J){return fr({key:J.key,value:J.value,valueSpec:s,style:J.style,styleSpec:J.styleSpec})}}});return d==="identity"&&P&&j.push(new at(u.key,u.value,'missing required property "property"')),d==="identity"||u.value.stops||j.push(new at(u.key,u.value,'missing required property "stops"')),d==="exponential"&&u.valueSpec.expression&&!uh(u.valueSpec)&&j.push(new at(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(O&&!ul(u.valueSpec)?j.push(new at(u.key,u.value,"property functions not supported")):P&&!Bi(u.valueSpec)&&j.push(new at(u.key,u.value,"zoom functions not supported"))),d!=="categorical"&&!F||u.value.property!==void 0||j.push(new at(u.key,u.value,'"property" property is required')),j;function W(J){let ee=[];const ve=J.value,ye=J.key;if(Xt(ve)!=="array")return[new at(ye,ve,`array expected, ${Xt(ve)} found`)];if(ve.length!==2)return[new at(ye,ve,`array length 2 expected, length ${ve.length} found`)];if(F){if(Xt(ve[0])!=="object")return[new at(ye,ve,`object expected, ${Xt(ve[0])} found`)];if(ve[0].zoom===void 0)return[new at(ye,ve,"object stop key must have zoom")];if(ve[0].value===void 0)return[new at(ye,ve,"object stop key must have value")];if(E&&E>Mn(ve[0].zoom))return[new at(ye,ve[0].zoom,"stop zoom values must appear in ascending order")];Mn(ve[0].zoom)!==E&&(E=Mn(ve[0].zoom),w=void 0,C={}),ee=ee.concat(Ws({key:`${ye}[0]`,value:ve[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:nu,value:G}}))}else ee=ee.concat(G({key:`${ye}[0]`,value:ve[0],style:J.style,styleSpec:J.styleSpec},ve));return dl(Jn(ve[1]))?ee.concat([new at(`${ye}[1]`,ve[1],"expressions are not allowed in function stops.")]):ee.concat(fr({key:`${ye}[1]`,value:ve[1],valueSpec:s,style:J.style,styleSpec:J.styleSpec}))}function G(J,ee){const ve=Xt(J.value),ye=Mn(J.value),Ne=J.value!==null?J.value:ee;if(g){if(ve!==g)return[new at(J.key,Ne,`${ve} stop domain type must match previous stop domain type ${g}`)]}else g=ve;if(ve!=="number"&&ve!=="string"&&ve!=="boolean")return[new at(J.key,Ne,"stop domain value must be a number, string, or boolean")];if(ve!=="number"&&d!=="categorical"){let Ge=`number expected, ${ve} found`;return ul(s)&&d===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(J.key,Ne,Ge)]}return d!=="categorical"||ve!=="number"||isFinite(ye)&&Math.floor(ye)===ye?d!=="categorical"&&ve==="number"&&w!==void 0&&ye<w?[new at(J.key,Ne,"stop domain values must appear in ascending order")]:(w=ye,d==="categorical"&&ye in C?[new at(J.key,Ne,"stop domain values must be unique")]:(C[ye]=!0,[])):[new at(J.key,Ne,`integer expected, found ${ye}`)]}}function fa(u){const s=(u.expressionContext==="property"?Po:pl)(Jn(u.value),u.valueSpec);if(s.result==="error")return s.value.map(g=>new at(`${u.key}${g.key}`,u.value,g.message));const d=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!d.outputDefined())return[new at(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!To(d))return[new at(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!To(d))return[new at(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!ua(d,["zoom","feature-state"]))return[new at(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!sc(d))return[new at(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pc(u){const s=u.key,d=u.value,g=u.valueSpec,w=[];return Array.isArray(g.values)?g.values.indexOf(Mn(d))===-1&&w.push(new at(s,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(Mn(d))===-1&&w.push(new at(s,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),w}function Do(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Do(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const mc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function iu(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Do(u)||(u=_c(u));const s=pl(u,mc);if(s.result==="error")throw new Error(s.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,g,w)=>s.value.evaluate(d,g,{},w),needGeometry:gc(u)}}function ru(u,s){return u<s?-1:u>s?1:0}function gc(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let s=1;s<u.length;s++)if(gc(u[s]))return!0;return!1}function _c(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?yc(u[1],u[2],"=="):s==="!="?Oo(yc(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?yc(u[1],u[2],s):s==="any"?(d=u.slice(1),["any"].concat(d.map(_c))):s==="all"?["all"].concat(u.slice(1).map(_c)):s==="none"?["all"].concat(u.slice(1).map(_c).map(Oo)):s==="in"?dh(u[1],u.slice(2)):s==="!in"?Oo(dh(u[1],u.slice(2))):s==="has"?su(u[1]):s==="!has"?Oo(su(u[1])):s!=="within"||u;var d}function yc(u,s,d){switch(u){case"$type":return[`filter-type-${d}`,s];case"$id":return[`filter-id-${d}`,s];default:return[`filter-${d}`,u,s]}}function dh(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(d=>typeof d!=typeof s[0])?["filter-in-large",u,["literal",s.sort(ru)]]:["filter-in-small",u,["literal",s]]}}function su(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Oo(u){return["!",u]}function bc(u){return Do(Jn(u.value))?fa(Cn({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):au(u)}function au(u){const s=u.value,d=u.key;if(Xt(s)!=="array")return[new at(d,s,`array expected, ${Xt(s)} found`)];const g=u.styleSpec;let w,E=[];if(s.length<1)return[new at(d,s,"filter array must have at least 1 element")];switch(E=E.concat(pc({key:`${d}[0]`,value:s[0],valueSpec:g.filter_operator,style:u.style,styleSpec:u.styleSpec})),Mn(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Mn(s[1])==="$type"&&E.push(new at(d,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&E.push(new at(d,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(w=Xt(s[1]),w!=="string"&&E.push(new at(`${d}[1]`,s[1],`string expected, ${w} found`)));for(let C=2;C<s.length;C++)w=Xt(s[C]),Mn(s[1])==="$type"?E=E.concat(pc({key:`${d}[${C}]`,value:s[C],valueSpec:g.geometry_type,style:u.style,styleSpec:u.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&E.push(new at(`${d}[${C}]`,s[C],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)E=E.concat(au({key:`${d}[${C}]`,value:s[C],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":w=Xt(s[1]),s.length!==2?E.push(new at(d,s,`filter array for "${s[0]}" operator must have 2 elements`)):w!=="string"&&E.push(new at(`${d}[1]`,s[1],`string expected, ${w} found`));break;case"within":w=Xt(s[1]),s.length!==2?E.push(new at(d,s,`filter array for "${s[0]}" operator must have 2 elements`)):w!=="object"&&E.push(new at(`${d}[1]`,s[1],`object expected, ${w} found`))}return E}function Af(u,s){const d=u.key,g=u.style,w=u.styleSpec,E=u.value,C=u.objectKey,P=w[`${s}_${u.layerType}`];if(!P)return[];const O=C.match(/^(.*)-transition$/);if(s==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return fr({key:d,value:E,valueSpec:w.transition,style:g,styleSpec:w});const F=u.valueSpec||P[C];if(!F)return[new at(d,E,`unknown property "${C}"`)];let j;if(Xt(E)==="string"&&ul(F)&&!F.tokens&&(j=/^{([^}]+)}$/.exec(E)))return[new at(d,E,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const W=[];return u.layerType==="symbol"&&(C==="text-field"&&g&&!g.glyphs&&W.push(new at(d,E,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&hl(Jn(E))&&Mn(E.type)==="identity"&&W.push(new at(d,E,'"text-font" does not support identity functions'))),W.concat(fr({key:u.key,value:E,valueSpec:F,style:g,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:C}))}function Ar(u){return Af(u,"paint")}function _l(u){return Af(u,"layout")}function ph(u){let s=[];const d=u.value,g=u.key,w=u.style,E=u.styleSpec;d.type||d.ref||s.push(new at(g,d,'either "type" or "ref" is required'));let C=Mn(d.type);const P=Mn(d.ref);if(d.id){const O=Mn(d.id);for(let F=0;F<u.arrayIndex;F++){const j=w.layers[F];Mn(j.id)===O&&s.push(new at(g,d.id,`duplicate layer id "${d.id}", previously used at line ${j.id.__line__}`))}}if("ref"in d){let O;["type","source","source-layer","filter","layout"].forEach(F=>{F in d&&s.push(new at(g,d[F],`"${F}" is prohibited for ref layers`))}),w.layers.forEach(F=>{Mn(F.id)===P&&(O=F)}),O?O.ref?s.push(new at(g,d.ref,"ref cannot reference another ref layer")):C=Mn(O.type):s.push(new at(g,d.ref,`ref layer "${P}" not found`))}else if(C!=="background")if(d.source){const O=w.sources&&w.sources[d.source],F=O&&Mn(O.type);O?F==="vector"&&C==="raster"?s.push(new at(g,d.source,`layer "${d.id}" requires a raster source`)):F==="raster"&&C!=="raster"?s.push(new at(g,d.source,`layer "${d.id}" requires a vector source`)):F!=="vector"||d["source-layer"]?F==="raster-dem"&&C!=="hillshade"?s.push(new at(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!d.paint||!d.paint["line-gradient"]||F==="geojson"&&O.lineMetrics||s.push(new at(g,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new at(g,d,`layer "${d.id}" must specify a "source-layer"`)):s.push(new at(g,d.source,`source "${d.source}" not found`))}else s.push(new at(g,d,'missing required property "source"'));return s=s.concat(Ws({key:g,value:d,valueSpec:E.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fr({key:`${g}.type`,value:d.type,valueSpec:E.layer.type,style:u.style,styleSpec:u.styleSpec,object:d,objectKey:"type"}),filter:bc,layout:O=>Ws({layer:d,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":F=>_l(Cn({layerType:C},F))}}),paint:O=>Ws({layer:d,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":F=>Ar(Cn({layerType:C},F))}})}})),s}function Bo(u){const s=u.value,d=u.key,g=Xt(s);return g!=="string"?[new at(d,s,`string expected, ${g} found`)]:[]}const mh={promoteId:function({key:u,value:s}){if(Xt(s)==="string")return Bo({key:u,value:s});{const d=[];for(const g in s)d.push(...Bo({key:`${u}.${g}`,value:s[g]}));return d}}};function gh(u){const s=u.value,d=u.key,g=u.styleSpec,w=u.style;if(!s.type)return[new at(d,s,'"type" is required')];const E=Mn(s.type);let C;switch(E){case"vector":case"raster":case"raster-dem":return C=Ws({key:d,value:s,valueSpec:g[`source_${E.replace("-","_")}`],style:u.style,styleSpec:g,objectElementValidators:mh}),C;case"geojson":if(C=Ws({key:d,value:s,valueSpec:g.source_geojson,style:w,styleSpec:g,objectElementValidators:mh}),s.cluster)for(const P in s.clusterProperties){const[O,F]=s.clusterProperties[P],j=typeof O=="string"?[O,["accumulated"],["get",P]]:O;C.push(...fa({key:`${d}.${P}.map`,value:F,expressionContext:"cluster-map"})),C.push(...fa({key:`${d}.${P}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return C;case"video":return Ws({key:d,value:s,valueSpec:g.source_video,style:w,styleSpec:g});case"image":return Ws({key:d,value:s,valueSpec:g.source_image,style:w,styleSpec:g});case"canvas":return[new at(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pc({key:`${d}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function No(u){const s=u.value,d=u.styleSpec,g=d.light,w=u.style;let E=[];const C=Xt(s);if(s===void 0)return E;if(C!=="object")return E=E.concat([new at("light",s,`object expected, ${C} found`)]),E;for(const P in s){const O=P.match(/^(.*)-transition$/);E=E.concat(O&&g[O[1]]&&g[O[1]].transition?fr({key:P,value:s[P],valueSpec:d.transition,style:w,styleSpec:d}):g[P]?fr({key:P,value:s[P],valueSpec:g[P],style:w,styleSpec:d}):[new at(P,s[P],`unknown property "${P}"`)])}return E}function xc(u){const s=u.value,d=u.styleSpec,g=d.terrain,w=u.style;let E=[];const C=Xt(s);if(s===void 0)return E;if(C!=="object")return E=E.concat([new at("terrain",s,`object expected, ${C} found`)]),E;for(const P in s)E=E.concat(g[P]?fr({key:P,value:s[P],valueSpec:g[P],style:w,styleSpec:d}):[new at(P,s[P],`unknown property "${P}"`)]);return E}const hr={"*":()=>[],array:fh,boolean:function(u){const s=u.value,d=u.key,g=Xt(s);return g!=="boolean"?[new at(d,s,`boolean expected, ${g} found`)]:[]},number:nu,color:function(u){const s=u.key,d=u.value,g=Xt(d);return g!=="string"?[new at(s,d,`color expected, ${g} found`)]:ur(d)===null?[new at(s,d,`color expected, "${d}" found`)]:[]},constants:nn,enum:pc,filter:bc,function:gl,layer:ph,object:Ws,source:gh,light:No,terrain:xc,string:Bo,formatted:function(u){return Bo(u).length===0?[]:fa(u)},resolvedImage:function(u){return Bo(u).length===0?[]:fa(u)},padding:function(u){const s=u.key,d=u.value;if(Xt(d)==="array"){if(d.length<1||d.length>4)return[new at(s,d,`padding requires 1 to 4 values; ${d.length} values found`)];const g={type:"number"};let w=[];for(let E=0;E<d.length;E++)w=w.concat(fr({key:`${s}[${E}]`,value:d[E],valueSpec:g}));return w}return nu({key:s,value:d,valueSpec:{}})}};function fr(u){const s=u.value,d=u.valueSpec,g=u.styleSpec;return d.expression&&hl(Mn(s))?gl(u):d.expression&&dl(Jn(s))?fa(u):d.type&&hr[d.type]?hr[d.type](u):Ws(Cn({},u,{valueSpec:d.type?g[d.type]:d}))}function vc(u){const s=u.value,d=u.key,g=Bo(u);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new at(d,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new at(d,s,'"glyphs" url must include a "{range}" token'))),g}function da(u,s=Ee){let d=[];return d=d.concat(fr({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,objectElementValidators:{glyphs:vc,"*":()=>[]}})),u.constants&&(d=d.concat(nn({key:"constants",value:u.constants}))),_h(d)}function _h(u){return[].concat(u).sort((s,d)=>s.line-d.line)}function fs(u){return function(...s){return _h(u.apply(this,s))}}da.source=fs(gh),da.light=fs(No),da.terrain=fs(xc),da.layer=fs(ph),da.filter=fs(bc),da.paintProperty=fs(Ar),da.layoutProperty=fs(_l);const Ts=da,yh=Ts.light,ou=Ts.paintProperty,zo=Ts.layoutProperty;function bh(u,s){let d=!1;if(s&&s.length)for(const g of s)u.fire(new aa(new Error(g.message))),d=!0;return d}class Wa{constructor(s,d,g){const w=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const C=new Int32Array(this.arrayBuffer);s=C[0],this.d=(d=C[1])+2*(g=C[2]);for(let O=0;O<this.d*this.d;O++){const F=C[3+O],j=C[3+O+1];w.push(F===j?null:C.subarray(F,j))}const P=C[3+w.length+1];this.keys=C.subarray(C[3+w.length],P),this.bboxes=C.subarray(P),this.insert=this._insertReadonly}else{this.d=d+2*g;for(let C=0;C<this.d*this.d;C++)w.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=s,this.padding=g,this.scale=d/s,this.uid=0;const E=g/d*s;this.min=-E,this.max=s+E}insert(s,d,g,w,E){this._forEachCell(d,g,w,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(w),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,d,g,w,E,C){this.cells[E].push(C)}query(s,d,g,w,E){const C=this.min,P=this.max;if(s<=C&&d<=C&&P<=g&&P<=w&&!E)return Array.prototype.slice.call(this.keys);{const O=[];return this._forEachCell(s,d,g,w,this._queryCell,O,{},E),O}}_queryCell(s,d,g,w,E,C,P,O){const F=this.cells[E];if(F!==null){const j=this.keys,W=this.bboxes;for(let G=0;G<F.length;G++){const J=F[G];if(P[J]===void 0){const ee=4*J;(O?O(W[ee+0],W[ee+1],W[ee+2],W[ee+3]):s<=W[ee+2]&&d<=W[ee+3]&&g>=W[ee+0]&&w>=W[ee+1])?(P[J]=!0,C.push(j[J])):P[J]=!1}}}}_forEachCell(s,d,g,w,E,C,P,O){const F=this._convertToCellCoord(s),j=this._convertToCellCoord(d),W=this._convertToCellCoord(g),G=this._convertToCellCoord(w);for(let J=F;J<=W;J++)for(let ee=j;ee<=G;ee++){const ve=this.d*ee+J;if((!O||O(this._convertFromCellCoord(J),this._convertFromCellCoord(ee),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ee+1)))&&E.call(this,s,d,g,w,ve,C,P,O))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,d=3+this.cells.length+1+1;let g=0;for(let C=0;C<this.cells.length;C++)g+=this.cells[C].length;const w=new Int32Array(d+g+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;let E=d;for(let C=0;C<s.length;C++){const P=s[C];w[3+C]=E,w.set(P,E),E+=P.length}return w[3+s.length]=E,w.set(this.keys,E),E+=this.keys.length,w[3+s.length+1]=E,w.set(this.bboxes,E),E+=this.bboxes.length,w.buffer}static serialize(s,d){const g=s.toArrayBuffer();return d&&d.push(g),{buffer:g}}static deserialize(s){return new Wa(s.buffer)}}const Ca={};function jt(u,s,d={}){if(Ca[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),Ca[u]={klass:s,omit:d.omit||[],shallow:d.shallow||[]}}jt("Object",Object),jt("TransferableGridIndex",Wa),jt("Color",Q),jt("Error",Error),jt("AJAXError",Sr),jt("ResolvedImage",xe),jt("StylePropertyFunction",eu),jt("StyleExpression",Jc,{omit:["_evaluator"]}),jt("ZoomDependentExpression",ml),jt("ZoomConstantExpression",dc),jt("CompoundExpression",ln,{omit:["_evaluate"]});for(const u in cl)cl[u]._classRegistryKey||jt(`Expression_${u}`,cl[u]);function xh(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function wc(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob)return u;if(xh(u)||Le(u))return s&&s.push(u),u;if(ArrayBuffer.isView(u)){const d=u;return s&&s.push(d.buffer),d}if(u instanceof ImageData)return s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const d=[];for(const g of u)d.push(wc(g,s));return d}if(typeof u=="object"){const d=u.constructor,g=d._classRegistryKey;if(!g)throw new Error("can't serialize object of unregistered class");if(!Ca[g])throw new Error(`${g} is not registered.`);const w=d.serialize?d.serialize(u,s):{};if(d.serialize){if(s&&w===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in u){if(!u.hasOwnProperty(E)||Ca[g].omit.indexOf(E)>=0)continue;const C=u[E];w[E]=Ca[g].shallow.indexOf(E)>=0?C:wc(C,s)}u instanceof Error&&(w.message=u.message)}if(w.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(w.$name=g),w}throw new Error("can't serialize object of type "+typeof u)}function Xa(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||xh(u)||Le(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Xa);if(typeof u=="object"){const s=u.$name||"Object";if(!Ca[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:d}=Ca[s];if(!d)throw new Error(`can't deserialize unregistered class ${s}`);if(d.deserialize)return d.deserialize(u);const g=Object.create(d.prototype);for(const w of Object.keys(u)){if(w==="$name")continue;const E=u[w];g[w]=Ca[s].shallow.indexOf(w)>=0?E:Xa(E)}return g}throw new Error("can't deserialize object of type "+typeof u)}class yl{constructor(){this.first=!0}update(s,d){const g=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=d),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=g,!0))}}const It={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function ds(u){for(const s of u)if(Br(s.charCodeAt(0)))return!0;return!1}function vh(u){for(const s of u)if(!Ss(s.charCodeAt(0)))return!1;return!0}function Ss(u){return!(It.Arabic(u)||It["Arabic Supplement"](u)||It["Arabic Extended-A"](u)||It["Arabic Presentation Forms-A"](u)||It["Arabic Presentation Forms-B"](u))}function Br(u){return!(u!==746&&u!==747&&(u<4352||!(It["Bopomofo Extended"](u)||It.Bopomofo(u)||It["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||It["CJK Compatibility Ideographs"](u)||It["CJK Compatibility"](u)||It["CJK Radicals Supplement"](u)||It["CJK Strokes"](u)||!(!It["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||It["CJK Unified Ideographs Extension A"](u)||It["CJK Unified Ideographs"](u)||It["Enclosed CJK Letters and Months"](u)||It["Hangul Compatibility Jamo"](u)||It["Hangul Jamo Extended-A"](u)||It["Hangul Jamo Extended-B"](u)||It["Hangul Jamo"](u)||It["Hangul Syllables"](u)||It.Hiragana(u)||It["Ideographic Description Characters"](u)||It.Kanbun(u)||It["Kangxi Radicals"](u)||It["Katakana Phonetic Extensions"](u)||It.Katakana(u)&&u!==12540||!(!It["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!It["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||It["Unified Canadian Aboriginal Syllabics"](u)||It["Unified Canadian Aboriginal Syllabics Extended"](u)||It["Vertical Forms"](u)||It["Yijing Hexagram Symbols"](u)||It["Yi Syllables"](u)||It["Yi Radicals"](u))))}function Lo(u){return!(Br(u)||function(s){return!!(It["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||It["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||It["Letterlike Symbols"](s)||It["Number Forms"](s)||It["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||It["Control Pictures"](s)&&s!==9251||It["Optical Character Recognition"](s)||It["Enclosed Alphanumerics"](s)||It["Geometric Shapes"](s)||It["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||It["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||It["CJK Symbols and Punctuation"](s)||It.Katakana(s)||It["Private Use Area"](s)||It["CJK Compatibility Forms"](s)||It["Small Form Variants"](s)||It["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function lu(u){return u>=1424&&u<=2303||It["Arabic Presentation Forms-A"](u)||It["Arabic Presentation Forms-B"](u)}function cu(u,s){return!(!s&&lu(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||It.Khmer(u))}function uu(u){for(const s of u)if(lu(s.charCodeAt(0)))return!0;return!1}const bl="deferred",Za="loading",hu="loaded";let xl=null,sr="unavailable",Ya=null;const rs=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(sr="error"),xl&&xl(u)};function Tc(){ss.fire(new vs("pluginStateChange",{pluginStatus:sr,pluginURL:Ya}))}const ss=new ft,fu=function(){return sr},Fo=function(){if(sr!==bl||!Ya)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");sr=Za,Tc(),Ya&&xs({url:Ya},u=>{u?rs(u):(sr=hu,Tc())})},dr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>sr===hu||dr.applyArabicShaping!=null,isLoading:()=>sr===Za,setState(u){if(!mt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");sr=u.pluginStatus,Ya=u.pluginURL},isParsed(){if(!mt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return dr.applyArabicShaping!=null&&dr.processBidirectionalText!=null&&dr.processStyledBidirectionalText!=null},getPluginURL(){if(!mt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ya}};class ui{constructor(s,d){this.zoom=s,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yl,this.transition={})}isSupportedScript(s){return function(d,g){for(const w of d)if(!cu(w.charCodeAt(0),g))return!1;return!0}(s,dr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,d=s-Math.floor(s),g=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*d}}}class vl{constructor(s,d){this.property=s,this.value=d,this.expression=function(g,w){if(hl(g))return new eu(g,w);if(dl(g)){const E=Po(g,w);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=g;return w.type==="color"&&typeof g=="string"?E=Q.parse(g):w.type!=="padding"||typeof g!="number"&&!Array.isArray(g)||(E=Se.parse(g)),{kind:"constant",evaluate:()=>E}}}(d===void 0?s.specification.default:d,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,d,g){return this.property.possiblyEvaluate(this,s,d,g)}}class Ra{constructor(s){this.property=s,this.value=new vl(s,void 0)}transitioned(s,d){return new Sc(this.property,this.value,d,L({},s.transition,this.transition),s.now)}untransitioned(){return new Sc(this.property,this.value,null,{},0)}}class Ga{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return re(this._values[s].value.value)}setValue(s,d){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Ra(this._values[s].property)),this._values[s].value=new vl(this._values[s].property,d===null?void 0:re(d))}getTransition(s){return re(this._values[s].transition)}setTransition(s,d){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Ra(this._values[s].property)),this._values[s].transition=re(d)||void 0}serialize(){const s={};for(const d of Object.keys(this._values)){const g=this.getValue(d);g!==void 0&&(s[d]=g);const w=this.getTransition(d);w!==void 0&&(s[`${d}-transition`]=w)}return s}transitioned(s,d){const g=new Ec(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].transitioned(s,d._values[w]);return g}untransitioned(){const s=new Ec(this._properties);for(const d of Object.keys(this._values))s._values[d]=this._values[d].untransitioned();return s}}class Sc{constructor(s,d,g,w,E){this.property=s,this.value=d,this.begin=E+w.delay||0,this.end=this.begin+w.duration||0,s.specification.transition&&(w.delay||w.duration)&&(this.prior=g)}possiblyEvaluate(s,d,g){const w=s.now||0,E=this.value.possiblyEvaluate(s,d,g),C=this.prior;if(C){if(w>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(w<this.begin)return C.possiblyEvaluate(s,d,g);{const P=(w-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(s,d,g),E,function(O){if(O<=0)return 0;if(O>=1)return 1;const F=O*O,j=F*O;return 4*(O<.5?j:3*(O-F)+j-.75)}(P))}}return E}}class Ec{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,d,g){const w=new pa(this._properties);for(const E of Object.keys(this._values))w._values[E]=this._values[E].possiblyEvaluate(s,d,g);return w}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Es{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}getValue(s){return re(this._values[s].value)}setValue(s,d){this._values[s]=new vl(this._values[s].property,d===null?void 0:re(d))}serialize(){const s={};for(const d of Object.keys(this._values)){const g=this.getValue(d);g!==void 0&&(s[d]=g)}return s}possiblyEvaluate(s,d,g){const w=new pa(this._properties);for(const E of Object.keys(this._values))w._values[E]=this._values[E].possiblyEvaluate(s,d,g);return w}}class Hi{constructor(s,d,g){this.property=s,this.value=d,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,d,g,w){return this.property.evaluate(this.value,this.parameters,s,d,g,w)}}class pa{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class $t{constructor(s){this.specification=s}possiblyEvaluate(s,d){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(d)}interpolate(s,d,g){const w=ja[this.specification.type];return w?w(s,d,g):s}}class Gt{constructor(s,d){this.specification=s,this.overrides=d}possiblyEvaluate(s,d,g,w){return new Hi(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(d,null,{},g,w)}:s.expression,d)}interpolate(s,d,g){if(s.value.kind!=="constant"||d.value.kind!=="constant")return s;if(s.value.value===void 0||d.value.value===void 0)return new Hi(this,{kind:"constant",value:void 0},s.parameters);const w=ja[this.specification.type];return w?new Hi(this,{kind:"constant",value:w(s.value.value,d.value.value,g)},s.parameters):s}evaluate(s,d,g,w,E,C){return s.kind==="constant"?s.value:s.evaluate(d,g,w,E,C)}}class Xs extends Gt{possiblyEvaluate(s,d,g,w){if(s.value===void 0)return new Hi(this,{kind:"constant",value:void 0},d);if(s.expression.kind==="constant"){const E=s.expression.evaluate(d,null,{},g,w),C=s.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,P=this._calculate(C,C,C,d);return new Hi(this,{kind:"constant",value:P},d)}if(s.expression.kind==="camera"){const E=this._calculate(s.expression.evaluate({zoom:d.zoom-1}),s.expression.evaluate({zoom:d.zoom}),s.expression.evaluate({zoom:d.zoom+1}),d);return new Hi(this,{kind:"constant",value:E},d)}return new Hi(this,s.expression,d)}evaluate(s,d,g,w,E,C){if(s.kind==="source"){const P=s.evaluate(d,g,w,E,C);return this._calculate(P,P,P,d)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(d.zoom)-1},g,w),s.evaluate({zoom:Math.floor(d.zoom)},g,w),s.evaluate({zoom:Math.floor(d.zoom)+1},g,w),d):s.value}_calculate(s,d,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:s,to:d}:{from:g,to:d}}interpolate(s){return s}}class wl{constructor(s){this.specification=s}possiblyEvaluate(s,d,g,w){if(s.value!==void 0){if(s.expression.kind==="constant"){const E=s.expression.evaluate(d,null,{},g,w);return this._calculate(E,E,E,d)}return this._calculate(s.expression.evaluate(new ui(Math.floor(d.zoom-1),d)),s.expression.evaluate(new ui(Math.floor(d.zoom),d)),s.expression.evaluate(new ui(Math.floor(d.zoom+1),d)),d)}}_calculate(s,d,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:s,to:d}:{from:g,to:d}}interpolate(s){return s}}class Ac{constructor(s){this.specification=s}possiblyEvaluate(s,d,g,w){return!!s.expression.evaluate(d,null,{},g,w)}interpolate(){return!1}}class qi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in s){const g=s[d];g.specification.overridable&&this.overridableProperties.push(d);const w=this.defaultPropertyValues[d]=new vl(g,void 0),E=this.defaultTransitionablePropertyValues[d]=new Ra(g);this.defaultTransitioningPropertyValues[d]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=w.possiblyEvaluate({})}}}jt("DataDrivenProperty",Gt),jt("DataConstantProperty",$t),jt("CrossFadedDataDrivenProperty",Xs),jt("CrossFadedProperty",wl),jt("ColorRampProperty",Ac);const Wi="-transition";class Vn extends ft{constructor(s,d){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),d.layout&&(this._unevaluatedLayout=new Es(d.layout)),d.paint)){this._transitionablePaint=new Ga(d.paint);for(const g in s.paint)this.setPaintProperty(g,s.paint[g],{validate:!1});for(const g in s.layout)this.setLayoutProperty(g,s.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pa(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,d,g={}){d!=null&&this._validate(zo,`layers.${this.id}.layout.${s}`,s,d,g)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,d):this.visibility=d)}getPaintProperty(s){return s.endsWith(Wi)?this._transitionablePaint.getTransition(s.slice(0,-Wi.length)):this._transitionablePaint.getValue(s)}setPaintProperty(s,d,g={}){if(d!=null&&this._validate(ou,`layers.${this.id}.paint.${s}`,s,d,g))return!1;if(s.endsWith(Wi))return this._transitionablePaint.setTransition(s.slice(0,-Wi.length),d||void 0),!1;{const w=this._transitionablePaint._values[s],E=w.property.specification["property-type"]==="cross-faded-data-driven",C=w.value.isDataDriven(),P=w.value;this._transitionablePaint.setValue(s,d),this._handleSpecialPaintPropertyUpdate(s);const O=this._transitionablePaint._values[s].value;return O.isDataDriven()||C||E||this._handleOverridablePaintPropertyUpdate(s,P,O)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,d,g){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,d){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,d)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),he(s,(d,g)=>!(d===void 0||g==="layout"&&!Object.keys(d).length||g==="paint"&&!Object.keys(d).length))}_validate(s,d,g,w,E={}){return(!E||E.validate!==!1)&&bh(this,s.call(Ts,{key:d,layerType:this.type,objectKey:g,value:w,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const d=this.paint.get(s);if(d instanceof Hi&&ul(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const Gn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zs{constructor(s,d){this._structArray=s,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,d){return s._trim(),d&&(s.isTransferred=!0,d.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const d=Object.create(this.prototype);return d.arrayBuffer=s.arrayBuffer,d.length=s.length,d.capacity=s.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ni(u,s=1){let d=0,g=0;return{members:u.map(w=>{const E=Gn[w.type].BYTES_PER_ELEMENT,C=d=Ka(d,Math.max(s,E)),P=w.components||1;return g=Math.max(g,E),d+=E*P,{name:w.name,type:w.type,components:P,offset:C}}),size:Ka(d,Math.max(g,s)),alignment:s}}function Ka(u,s){return Math.ceil(u/s)*s}class Uo extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d){const g=this.length;return this.resize(g+1),this.emplace(g,s,d)}emplace(s,d,g){const w=2*s;return this.int16[w+0]=d,this.int16[w+1]=g,s}}Uo.prototype.bytesPerElement=4,jt("StructArrayLayout2i4",Uo);class Tl extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,d,g,w)}emplace(s,d,g,w,E){const C=4*s;return this.int16[C+0]=d,this.int16[C+1]=g,this.int16[C+2]=w,this.int16[C+3]=E,s}}Tl.prototype.bytesPerElement=8,jt("StructArrayLayout4i8",Tl);class v extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C){const P=this.length;return this.resize(P+1),this.emplace(P,s,d,g,w,E,C)}emplace(s,d,g,w,E,C,P){const O=6*s;return this.int16[O+0]=d,this.int16[O+1]=g,this.int16[O+2]=w,this.int16[O+3]=E,this.int16[O+4]=C,this.int16[O+5]=P,s}}v.prototype.bytesPerElement=12,jt("StructArrayLayout2i4i12",v);class o extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C){const P=this.length;return this.resize(P+1),this.emplace(P,s,d,g,w,E,C)}emplace(s,d,g,w,E,C,P){const O=4*s,F=8*s;return this.int16[O+0]=d,this.int16[O+1]=g,this.uint8[F+4]=w,this.uint8[F+5]=E,this.uint8[F+6]=C,this.uint8[F+7]=P,s}}o.prototype.bytesPerElement=8,jt("StructArrayLayout2i4ub8",o);class p extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,d){const g=this.length;return this.resize(g+1),this.emplace(g,s,d)}emplace(s,d,g){const w=2*s;return this.float32[w+0]=d,this.float32[w+1]=g,s}}p.prototype.bytesPerElement=8,jt("StructArrayLayout2f8",p);class y extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C,P,O,F,j){const W=this.length;return this.resize(W+1),this.emplace(W,s,d,g,w,E,C,P,O,F,j)}emplace(s,d,g,w,E,C,P,O,F,j,W){const G=10*s;return this.uint16[G+0]=d,this.uint16[G+1]=g,this.uint16[G+2]=w,this.uint16[G+3]=E,this.uint16[G+4]=C,this.uint16[G+5]=P,this.uint16[G+6]=O,this.uint16[G+7]=F,this.uint16[G+8]=j,this.uint16[G+9]=W,s}}y.prototype.bytesPerElement=20,jt("StructArrayLayout10ui20",y);class T extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C,P,O,F,j,W,G){const J=this.length;return this.resize(J+1),this.emplace(J,s,d,g,w,E,C,P,O,F,j,W,G)}emplace(s,d,g,w,E,C,P,O,F,j,W,G,J){const ee=12*s;return this.int16[ee+0]=d,this.int16[ee+1]=g,this.int16[ee+2]=w,this.int16[ee+3]=E,this.uint16[ee+4]=C,this.uint16[ee+5]=P,this.uint16[ee+6]=O,this.uint16[ee+7]=F,this.int16[ee+8]=j,this.int16[ee+9]=W,this.int16[ee+10]=G,this.int16[ee+11]=J,s}}T.prototype.bytesPerElement=24,jt("StructArrayLayout4i4ui4i24",T);class A extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,s,d,g)}emplace(s,d,g,w){const E=3*s;return this.float32[E+0]=d,this.float32[E+1]=g,this.float32[E+2]=w,s}}A.prototype.bytesPerElement=12,jt("StructArrayLayout3f12",A);class M extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const d=this.length;return this.resize(d+1),this.emplace(d,s)}emplace(s,d){return this.uint32[1*s+0]=d,s}}M.prototype.bytesPerElement=4,jt("StructArrayLayout1ul4",M);class B extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C,P,O,F){const j=this.length;return this.resize(j+1),this.emplace(j,s,d,g,w,E,C,P,O,F)}emplace(s,d,g,w,E,C,P,O,F,j){const W=10*s,G=5*s;return this.int16[W+0]=d,this.int16[W+1]=g,this.int16[W+2]=w,this.int16[W+3]=E,this.int16[W+4]=C,this.int16[W+5]=P,this.uint32[G+3]=O,this.uint16[W+8]=F,this.uint16[W+9]=j,s}}B.prototype.bytesPerElement=20,jt("StructArrayLayout6i1ul2ui20",B);class z extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C){const P=this.length;return this.resize(P+1),this.emplace(P,s,d,g,w,E,C)}emplace(s,d,g,w,E,C,P){const O=6*s;return this.int16[O+0]=d,this.int16[O+1]=g,this.int16[O+2]=w,this.int16[O+3]=E,this.int16[O+4]=C,this.int16[O+5]=P,s}}z.prototype.bytesPerElement=12,jt("StructArrayLayout2i2i2i12",z);class U extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E){const C=this.length;return this.resize(C+1),this.emplace(C,s,d,g,w,E)}emplace(s,d,g,w,E,C){const P=4*s,O=8*s;return this.float32[P+0]=d,this.float32[P+1]=g,this.float32[P+2]=w,this.int16[O+6]=E,this.int16[O+7]=C,s}}U.prototype.bytesPerElement=16,jt("StructArrayLayout2f1f2i16",U);class $ extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,d,g,w)}emplace(s,d,g,w,E){const C=12*s,P=3*s;return this.uint8[C+0]=d,this.uint8[C+1]=g,this.float32[P+1]=w,this.float32[P+2]=E,s}}$.prototype.bytesPerElement=12,jt("StructArrayLayout2ub2f12",$);class Y extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,s,d,g)}emplace(s,d,g,w){const E=3*s;return this.uint16[E+0]=d,this.uint16[E+1]=g,this.uint16[E+2]=w,s}}Y.prototype.bytesPerElement=6,jt("StructArrayLayout3ui6",Y);class K extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve,ye,Ne){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve,ye,Ne)}emplace(s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve,ye,Ne,Ge){const De=24*s,Xe=12*s,dt=48*s;return this.int16[De+0]=d,this.int16[De+1]=g,this.uint16[De+2]=w,this.uint16[De+3]=E,this.uint32[Xe+2]=C,this.uint32[Xe+3]=P,this.uint32[Xe+4]=O,this.uint16[De+10]=F,this.uint16[De+11]=j,this.uint16[De+12]=W,this.float32[Xe+7]=G,this.float32[Xe+8]=J,this.uint8[dt+36]=ee,this.uint8[dt+37]=ve,this.uint8[dt+38]=ye,this.uint32[Xe+10]=Ne,this.int16[De+22]=Ge,s}}K.prototype.bytesPerElement=48,jt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",K);class fe extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve,ye,Ne,Ge,De,Xe,dt,ut,Vt,Zt,Bt,Ct,Et,Nt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve,ye,Ne,Ge,De,Xe,dt,ut,Vt,Zt,Bt,Ct,Et,Nt)}emplace(s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve,ye,Ne,Ge,De,Xe,dt,ut,Vt,Zt,Bt,Ct,Et,Nt,Pt){const vt=34*s,Jt=17*s;return this.int16[vt+0]=d,this.int16[vt+1]=g,this.int16[vt+2]=w,this.int16[vt+3]=E,this.int16[vt+4]=C,this.int16[vt+5]=P,this.int16[vt+6]=O,this.int16[vt+7]=F,this.uint16[vt+8]=j,this.uint16[vt+9]=W,this.uint16[vt+10]=G,this.uint16[vt+11]=J,this.uint16[vt+12]=ee,this.uint16[vt+13]=ve,this.uint16[vt+14]=ye,this.uint16[vt+15]=Ne,this.uint16[vt+16]=Ge,this.uint16[vt+17]=De,this.uint16[vt+18]=Xe,this.uint16[vt+19]=dt,this.uint16[vt+20]=ut,this.uint16[vt+21]=Vt,this.uint16[vt+22]=Zt,this.uint32[Jt+12]=Bt,this.float32[Jt+13]=Ct,this.float32[Jt+14]=Et,this.float32[Jt+15]=Nt,this.float32[Jt+16]=Pt,s}}fe.prototype.bytesPerElement=68,jt("StructArrayLayout8i15ui1ul4f68",fe);class se extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const d=this.length;return this.resize(d+1),this.emplace(d,s)}emplace(s,d){return this.float32[1*s+0]=d,s}}se.prototype.bytesPerElement=4,jt("StructArrayLayout1f4",se);class ue extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,s,d,g)}emplace(s,d,g,w){const E=3*s;return this.int16[E+0]=d,this.int16[E+1]=g,this.int16[E+2]=w,s}}ue.prototype.bytesPerElement=6,jt("StructArrayLayout3i6",ue);class Re extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,s,d,g)}emplace(s,d,g,w){const E=4*s;return this.uint32[2*s+0]=d,this.uint16[E+2]=g,this.uint16[E+3]=w,s}}Re.prototype.bytesPerElement=8,jt("StructArrayLayout1ul2ui8",Re);class Pe extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,d){const g=this.length;return this.resize(g+1),this.emplace(g,s,d)}emplace(s,d,g){const w=2*s;return this.uint16[w+0]=d,this.uint16[w+1]=g,s}}Pe.prototype.bytesPerElement=4,jt("StructArrayLayout2ui4",Pe);class $e extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const d=this.length;return this.resize(d+1),this.emplace(d,s)}emplace(s,d){return this.uint16[1*s+0]=d,s}}$e.prototype.bytesPerElement=2,jt("StructArrayLayout1ui2",$e);class me extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,d,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,d,g,w)}emplace(s,d,g,w,E){const C=4*s;return this.float32[C+0]=d,this.float32[C+1]=g,this.float32[C+2]=w,this.float32[C+3]=E,s}}me.prototype.bytesPerElement=16,jt("StructArrayLayout4f16",me);class Fe extends Zs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new we(this.anchorPointX,this.anchorPointY)}}Fe.prototype.size=20;class He extends B{get(s){return new Fe(this,s)}}jt("CollisionBoxArray",He);class rt extends Zs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}rt.prototype.size=48;class st extends K{get(s){return new rt(this,s)}}jt("PlacedSymbolArray",st);class bt extends Zs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}bt.prototype.size=68;class Qe extends fe{get(s){return new bt(this,s)}}jt("SymbolInstanceArray",Qe);class Mt extends se{getoffsetX(s){return this.float32[1*s+0]}}jt("GlyphOffsetArray",Mt);class kt extends ue{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}jt("SymbolLineVertexArray",kt);class Ut extends Zs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ut.prototype.size=8;class un extends Re{get(s){return new Ut(this,s)}}jt("FeatureIndexArray",un);class yn extends Uo{}class Kt extends Uo{}class Wn extends Uo{}class $n extends v{}class Pn extends o{}class En extends p{}class zn extends y{}class Nr extends T{}class As extends A{}class Cs extends M{}class as extends z{}class Qa extends ${}class Xi extends Y{}class Rs extends Pe{}const Ja=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ys}=Ja;class Dn{constructor(s=[]){this.segments=s}prepareSegment(s,d,g,w){let E=this.segments[this.segments.length-1];return s>Dn.MAX_VERTEX_ARRAY_LENGTH&&_e(`Max vertices per segment is ${Dn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!E||E.vertexLength+s>Dn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==w)&&(E={vertexOffset:d.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},w!==void 0&&(E.sortKey=w),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const s of this.segments)for(const d in s.vaos)s.vaos[d].destroy()}static simpleSegment(s,d,g,w){return new Dn([{vertexOffset:s,primitiveOffset:d,vertexLength:g,primitiveLength:w,vaos:{},sortKey:0}])}}function si(u,s){return 256*(u=I(Math.floor(u),0,255))+I(Math.floor(s),0,255)}Dn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt("SegmentVector",Dn);const Sn=Ni([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hi={exports:{}},pr={exports:{}};pr.exports=function(u,s){var d,g,w,E,C,P,O,F;for(g=u.length-(d=3&u.length),w=s,C=3432918353,P=461845907,F=0;F<g;)O=255&u.charCodeAt(F)|(255&u.charCodeAt(++F))<<8|(255&u.charCodeAt(++F))<<16|(255&u.charCodeAt(++F))<<24,++F,w=27492+(65535&(E=5*(65535&(w=(w^=O=(65535&(O=(O=(65535&O)*C+(((O>>>16)*C&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(O=0,d){case 3:O^=(255&u.charCodeAt(F+2))<<16;case 2:O^=(255&u.charCodeAt(F+1))<<8;case 1:w^=O=(65535&(O=(O=(65535&(O^=255&u.charCodeAt(F)))*C+(((O>>>16)*C&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295}return w^=u.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0};var fi={exports:{}};fi.exports=function(u,s){for(var d,g=u.length,w=s^g,E=0;g>=4;)d=1540483477*(65535&(d=255&u.charCodeAt(E)|(255&u.charCodeAt(++E))<<8|(255&u.charCodeAt(++E))<<16|(255&u.charCodeAt(++E))<<24))+((1540483477*(d>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:w^=(255&u.charCodeAt(E+2))<<16;case 2:w^=(255&u.charCodeAt(E+1))<<8;case 1:w=1540483477*(65535&(w^=255&u.charCodeAt(E)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0};var os=pr.exports,ma=fi.exports;hi.exports=os,hi.exports.murmur3=os,hi.exports.murmur2=ma;class ga{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,d,g,w){this.ids.push(Cc(s)),this.positions.push(d,g,w)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=Cc(s);let g=0,w=this.ids.length-1;for(;g<w;){const C=g+w>>1;this.ids[C]>=d?w=C:g=C+1}const E=[];for(;this.ids[g]===d;)E.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return E}static serialize(s,d){const g=new Float64Array(s.ids),w=new Uint32Array(s.positions);return du(g,w,0,g.length-1),d&&d.push(g.buffer,w.buffer),{ids:g,positions:w}}static deserialize(s){const d=new ga;return d.ids=s.ids,d.positions=s.positions,d.indexed=!0,d}}function Cc(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:hi.exports(String(u))}function du(u,s,d,g){for(;d<g;){const w=u[d+g>>1];let E=d-1,C=g+1;for(;;){do E++;while(u[E]<w);do C--;while(u[C]>w);if(E>=C)break;ka(u,E,C),ka(s,3*E,3*C),ka(s,3*E+1,3*C+1),ka(s,3*E+2,3*C+2)}C-d<g-C?(du(u,s,d,C),d=C+1):(du(u,s,C+1,g),g=C)}}function ka(u,s,d){const g=u[s];u[s]=u[d],u[d]=g}jt("FeaturePositionMap",ga);class ls{constructor(s,d){this.gl=s.gl,this.location=d}}class Rc extends ls{constructor(s,d){super(s,d),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Vo extends ls{constructor(s,d){super(s,d),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Sl extends ls{constructor(s,d){super(s,d),this.current=Q.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const El=new Float32Array(16);function Rn(u){return[si(255*u.r,255*u.g),si(255*u.b,255*u.a)]}class ei{constructor(s,d,g){this.value=s,this.uniformNames=d.map(w=>`u_${w}`),this.type=g}setUniform(s,d,g){s.set(g.constantOr(this.value))}getBinding(s,d,g){return this.type==="color"?new Sl(s,d):new Rc(s,d)}}class Ii{constructor(s,d){this.uniformNames=d.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=s.tlbr}setUniform(s,d,g,w){const E=w==="u_pattern_to"?this.patternTo:w==="u_pattern_from"?this.patternFrom:w==="u_pixel_ratio_to"?this.pixelRatioTo:w==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&s.set(E)}getBinding(s,d,g){return g.substr(0,9)==="u_pattern"?new Vo(s,d):new Rc(s,d)}}class _a{constructor(s,d,g,w){this.expression=s,this.type=g,this.maxValue=0,this.paintVertexAttributes=d.map(E=>({name:`a_${E}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,d,g,w,E){const C=this.paintVertexArray.length,P=this.expression.evaluate(new ui(0),d,{},w,[],E);this.paintVertexArray.resize(s),this._setPaintValue(C,s,P)}updatePaintArray(s,d,g,w){const E=this.expression.evaluate({zoom:0},g,w);this._setPaintValue(s,d,E)}_setPaintValue(s,d,g){if(this.type==="color"){const w=Rn(g);for(let E=s;E<d;E++)this.paintVertexArray.emplace(E,w[0],w[1])}else{for(let w=s;w<d;w++)this.paintVertexArray.emplace(w,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cs{constructor(s,d,g,w,E,C){this.expression=s,this.uniformNames=d.map(P=>`u_${P}_t`),this.type=g,this.useIntegerZoom=w,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=d.map(P=>({name:`a_${P}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(s,d,g,w,E){const C=this.expression.evaluate(new ui(this.zoom),d,{},w,[],E),P=this.expression.evaluate(new ui(this.zoom+1),d,{},w,[],E),O=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(O,s,C,P)}updatePaintArray(s,d,g,w){const E=this.expression.evaluate({zoom:this.zoom},g,w),C=this.expression.evaluate({zoom:this.zoom+1},g,w);this._setPaintValue(s,d,E,C)}_setPaintValue(s,d,g,w){if(this.type==="color"){const E=Rn(g),C=Rn(w);for(let P=s;P<d;P++)this.paintVertexArray.emplace(P,E[0],E[1],C[0],C[1])}else{for(let E=s;E<d;E++)this.paintVertexArray.emplace(E,g,w);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(w))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,d){const g=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,w=I(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);s.set(w)}getBinding(s,d,g){return new Rc(s,d)}}class ks{constructor(s,d,g,w,E,C){this.expression=s,this.type=d,this.useIntegerZoom=g,this.zoom=w,this.layerId=C,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(s,d,g){const w=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(w,s,d.patterns&&d.patterns[this.layerId],g)}updatePaintArray(s,d,g,w,E){this._setPaintValues(s,d,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(s,d,g,w){if(!w||!g)return;const{min:E,mid:C,max:P}=g,O=w[E],F=w[C],j=w[P];if(O&&F&&j)for(let W=s;W<d;W++)this.zoomInPaintVertexArray.emplace(W,F.tl[0],F.tl[1],F.br[0],F.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],F.pixelRatio,O.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,F.tl[0],F.tl[1],F.br[0],F.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],F.pixelRatio,j.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Sn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Sn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class wh{constructor(s,d,g){this.binders={},this._buffers=[];const w=[];for(const E in s.paint._values){if(!g(E))continue;const C=s.paint.get(E);if(!(C instanceof Hi&&ul(C.property.specification)))continue;const P=pu(E,s.type),O=C.value,F=C.property.specification.type,j=C.property.useIntegerZoom,W=C.property.specification["property-type"],G=W==="cross-faded"||W==="cross-faded-data-driven";if(O.kind==="constant")this.binders[E]=G?new Ii(O.value,P):new ei(O.value,P,F),w.push(`/u_${E}`);else if(O.kind==="source"||G){const J=Zm(E,F,"source");this.binders[E]=G?new ks(O,F,j,d,J,s.id):new _a(O,P,F,J),w.push(`/a_${E}`)}else{const J=Zm(E,F,"composite");this.binders[E]=new cs(O,P,F,j,d,J),w.push(`/z_${E}`)}}this.cacheKey=w.sort().join("")}getMaxValue(s){const d=this.binders[s];return d instanceof _a||d instanceof cs?d.maxValue:0}populatePaintArrays(s,d,g,w,E){for(const C in this.binders){const P=this.binders[C];(P instanceof _a||P instanceof cs||P instanceof ks)&&P.populatePaintArray(s,d,g,w,E)}}setConstantPatternPositions(s,d){for(const g in this.binders){const w=this.binders[g];w instanceof Ii&&w.setConstantPatternPositions(s,d)}}updatePaintArrays(s,d,g,w,E){let C=!1;for(const P in s){const O=d.getPositions(P);for(const F of O){const j=g.feature(F.index);for(const W in this.binders){const G=this.binders[W];if((G instanceof _a||G instanceof cs||G instanceof ks)&&G.expression.isStateDependent===!0){const J=w.paint.get(W);G.expression=J.value,G.updatePaintArray(F.start,F.end,j,s[P],E),C=!0}}}}return C}defines(){const s=[];for(const d in this.binders){const g=this.binders[d];(g instanceof ei||g instanceof Ii)&&s.push(...g.uniformNames.map(w=>`#define HAS_UNIFORM_${w}`))}return s}getBinderAttributes(){const s=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof _a||g instanceof cs)for(let w=0;w<g.paintVertexAttributes.length;w++)s.push(g.paintVertexAttributes[w].name);else if(g instanceof ks)for(let w=0;w<Sn.members.length;w++)s.push(Sn.members[w].name)}return s}getBinderUniforms(){const s=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof ei||g instanceof Ii||g instanceof cs)for(const w of g.uniformNames)s.push(w)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,d){const g=[];for(const w in this.binders){const E=this.binders[w];if(E instanceof ei||E instanceof Ii||E instanceof cs){for(const C of E.uniformNames)if(d[C]){const P=E.getBinding(s,d[C],C);g.push({name:C,property:w,binding:P})}}}return g}setUniforms(s,d,g,w){for(const{name:E,property:C,binding:P}of d)this.binders[C].setUniform(P,w,g.get(C),E)}updatePaintBuffers(s){this._buffers=[];for(const d in this.binders){const g=this.binders[d];if(s&&g instanceof ks){const w=s.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;w&&this._buffers.push(w)}else(g instanceof _a||g instanceof cs)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(s){for(const d in this.binders){const g=this.binders[d];(g instanceof _a||g instanceof cs||g instanceof ks)&&g.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const d=this.binders[s];(d instanceof _a||d instanceof cs||d instanceof ks)&&d.destroy()}}}class Ia{constructor(s,d,g=()=>!0){this.programConfigurations={};for(const w of s)this.programConfigurations[w.id]=new wh(w,d,g);this.needsUpload=!1,this._featureMap=new ga,this._bufferOffset=0}populatePaintArrays(s,d,g,w,E,C){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(s,d,w,E,C);d.id!==void 0&&this._featureMap.add(d.id,g,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,d,g,w){for(const E of g)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(s,this._featureMap,d,E,w)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function pu(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function Zm(u,s,d){const g={color:{source:p,composite:me},number:{source:se,composite:p}},w=function(E){return{"line-pattern":{source:zn,composite:zn},"fill-pattern":{source:zn,composite:zn},"fill-extrusion-pattern":{source:zn,composite:zn}}[E]}(u);return w&&w[d]||g[s][d]}jt("ConstantBinder",ei),jt("CrossFadedConstantBinder",Ii),jt("SourceExpressionBinder",_a),jt("CrossFadedCompositeBinder",ks),jt("CompositeExpressionBinder",cs),jt("ProgramConfiguration",wh,{omit:["_buffers"]}),jt("ProgramConfigurationSet",Ia);var kn=8192;const Th=Math.pow(2,14)-1,Cf=-Th-1;function Al(u){const s=kn/u.extent,d=u.loadGeometry();for(let g=0;g<d.length;g++){const w=d[g];for(let E=0;E<w.length;E++){const C=w[E],P=Math.round(C.x*s),O=Math.round(C.y*s);C.x=I(P,Cf,Th),C.y=I(O,Cf,Th),(P<C.x||P>C.x+1||O<C.y||O>C.y+1)&&_e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function Cl(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?Al(u):[]}}function Rf(u,s,d,g,w){u.emplaceBack(2*s+(g+1)/2,2*d+(w+1)/2)}class Sh{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(d=>d.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Kt,this.indexArray=new Xi,this.segments=new Dn,this.programConfigurations=new Ia(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(s,d,g){const w=this.layers[0],E=[];let C=null,P=!1;w.type==="circle"&&(C=w.layout.get("circle-sort-key"),P=!C.isConstant());for(const{feature:O,id:F,index:j,sourceLayerIndex:W}of s){const G=this.layers[0]._featureFilter.needGeometry,J=Cl(O,G);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),J,g))continue;const ee=P?C.evaluate(J,{},g):void 0,ve={id:F,properties:O.properties,type:O.type,sourceLayerIndex:W,index:j,geometry:G?J.geometry:Al(O),patterns:{},sortKey:ee};E.push(ve)}P&&E.sort((O,F)=>O.sortKey-F.sortKey);for(const O of E){const{geometry:F,index:j,sourceLayerIndex:W}=O,G=s[j].feature;this.addFeature(O,F,j,g),d.featureIndex.insert(G,F,j,W,this.index)}}update(s,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ys),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,d,g,w){for(const E of d)for(const C of E){const P=C.x,O=C.y;if(P<0||P>=kn||O<0||O>=kn)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),j=F.vertexLength;Rf(this.layoutVertexArray,P,O,-1,-1),Rf(this.layoutVertexArray,P,O,1,-1),Rf(this.layoutVertexArray,P,O,1,1),Rf(this.layoutVertexArray,P,O,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,{},w)}}function kf(u,s){for(let d=0;d<u.length;d++)if(jo(s,u[d]))return!0;for(let d=0;d<s.length;d++)if(jo(u,s[d]))return!0;return!!Eh(u,s)}function Gd(u,s,d){return!!jo(u,s)||!!mu(s,u,d)}function ps(u,s){if(u.length===1)return eo(s,u[0]);for(let d=0;d<s.length;d++){const g=s[d];for(let w=0;w<g.length;w++)if(jo(u,g[w]))return!0}for(let d=0;d<u.length;d++)if(eo(s,u[d]))return!0;for(let d=0;d<s.length;d++)if(Eh(u,s[d]))return!0;return!1}function mr(u,s,d){if(u.length>1){if(Eh(u,s))return!0;for(let g=0;g<s.length;g++)if(mu(s[g],u,d))return!0}for(let g=0;g<u.length;g++)if(mu(u[g],s,d))return!0;return!1}function Eh(u,s){if(u.length===0||s.length===0)return!1;for(let d=0;d<u.length-1;d++){const g=u[d],w=u[d+1];for(let E=0;E<s.length-1;E++)if(Ah(g,w,s[E],s[E+1]))return!0}return!1}function Ah(u,s,d,g){return pe(u,d,g)!==pe(s,d,g)&&pe(u,s,d)!==pe(u,s,g)}function mu(u,s,d){const g=d*d;if(s.length===1)return u.distSqr(s[0])<g;for(let w=1;w<s.length;w++)if(If(u,s[w-1],s[w])<g)return!0;return!1}function If(u,s,d){const g=s.distSqr(d);if(g===0)return u.distSqr(s);const w=((u.x-s.x)*(d.x-s.x)+(u.y-s.y)*(d.y-s.y))/g;return u.distSqr(w<0?s:w>1?d:d.sub(s)._mult(w)._add(s))}function eo(u,s){let d,g,w,E=!1;for(let C=0;C<u.length;C++){d=u[C];for(let P=0,O=d.length-1;P<d.length;O=P++)g=d[P],w=d[O],g.y>s.y!=w.y>s.y&&s.x<(w.x-g.x)*(s.y-g.y)/(w.y-g.y)+g.x&&(E=!E)}return E}function jo(u,s){let d=!1;for(let g=0,w=u.length-1;g<u.length;w=g++){const E=u[g],C=u[w];E.y>s.y!=C.y>s.y&&s.x<(C.x-E.x)*(s.y-E.y)/(C.y-E.y)+E.x&&(d=!d)}return d}function Kd(u,s,d){const g=d[0],w=d[2];if(u.x<g.x&&s.x<g.x||u.x>w.x&&s.x>w.x||u.y<g.y&&s.y<g.y||u.y>w.y&&s.y>w.y)return!1;const E=pe(u,s,d[0]);return E!==pe(u,s,d[1])||E!==pe(u,s,d[2])||E!==pe(u,s,d[3])}function kc(u,s,d){const g=s.paint.get(u).value;return g.kind==="constant"?g.value:d.programConfigurations.get(s.id).getMaxValue(u)}function Ch(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Rh(u,s,d,g,w){if(!s[0]&&!s[1])return u;const E=we.convert(s)._mult(w);d==="viewport"&&E._rotate(-g);const C=[];for(let P=0;P<u.length;P++)C.push(u[P].sub(E));return C}jt("CircleBucket",Sh,{omit:["layers"]});const Ym=new qi({"circle-sort-key":new Gt(Ee.layout_circle["circle-sort-key"])});var Gm={paint:new qi({"circle-radius":new Gt(Ee.paint_circle["circle-radius"]),"circle-color":new Gt(Ee.paint_circle["circle-color"]),"circle-blur":new Gt(Ee.paint_circle["circle-blur"]),"circle-opacity":new Gt(Ee.paint_circle["circle-opacity"]),"circle-translate":new $t(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Ee.paint_circle["circle-stroke-opacity"])}),layout:Ym},Yr=1e-6,Gr=typeof Float32Array<"u"?Float32Array:Array;function Mf(){var u=new Gr(9);return Gr!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function Pf(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Km(u,s,d){var g=s[0],w=s[1],E=s[2],C=s[3],P=s[4],O=s[5],F=s[6],j=s[7],W=s[8],G=s[9],J=s[10],ee=s[11],ve=s[12],ye=s[13],Ne=s[14],Ge=s[15],De=d[0],Xe=d[1],dt=d[2],ut=d[3];return u[0]=De*g+Xe*P+dt*W+ut*ve,u[1]=De*w+Xe*O+dt*G+ut*ye,u[2]=De*E+Xe*F+dt*J+ut*Ne,u[3]=De*C+Xe*j+dt*ee+ut*Ge,u[4]=(De=d[4])*g+(Xe=d[5])*P+(dt=d[6])*W+(ut=d[7])*ve,u[5]=De*w+Xe*O+dt*G+ut*ye,u[6]=De*E+Xe*F+dt*J+ut*Ne,u[7]=De*C+Xe*j+dt*ee+ut*Ge,u[8]=(De=d[8])*g+(Xe=d[9])*P+(dt=d[10])*W+(ut=d[11])*ve,u[9]=De*w+Xe*O+dt*G+ut*ye,u[10]=De*E+Xe*F+dt*J+ut*Ne,u[11]=De*C+Xe*j+dt*ee+ut*Ge,u[12]=(De=d[12])*g+(Xe=d[13])*P+(dt=d[14])*W+(ut=d[15])*ve,u[13]=De*w+Xe*O+dt*G+ut*ye,u[14]=De*E+Xe*F+dt*J+ut*Ne,u[15]=De*C+Xe*j+dt*ee+ut*Ge,u}Math.hypot||(Math.hypot=function(){for(var u=0,s=arguments.length;s--;)u+=arguments[s]*arguments[s];return Math.sqrt(u)});var gu,Qm=Km;function Qd(){var u=new Gr(3);return Gr!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function Df(u,s,d){var g=new Gr(3);return g[0]=u,g[1]=s,g[2]=d,g}function kh(u,s,d){var g=s[0],w=s[1],E=s[2],C=s[3];return u[0]=d[0]*g+d[4]*w+d[8]*E+d[12]*C,u[1]=d[1]*g+d[5]*w+d[9]*E+d[13]*C,u[2]=d[2]*g+d[6]*w+d[10]*E+d[14]*C,u[3]=d[3]*g+d[7]*w+d[11]*E+d[15]*C,u}function Jd(){var u=new Gr(4);return Gr!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function ep(u,s){const d=kh([],[u.x,u.y,0,1],s);return new we(d[0]/d[3],d[1]/d[3])}Qd(),gu=new Gr(4),Gr!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0,gu[3]=0),Qd(),Df(1,0,0),Df(0,1,0),Jd(),Jd(),Mf(),function(){var u;u=new Gr(2),Gr!=Float32Array&&(u[0]=0,u[1]=0)}();class tp extends Sh{}jt("HeatmapBucket",tp,{omit:["layers"]});var Jm={paint:new qi({"heatmap-radius":new Gt(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ac(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(Ee.paint_heatmap["heatmap-opacity"])})};function np(u,{width:s,height:d},g,w){if(w){if(w instanceof Uint8ClampedArray)w=new Uint8Array(w.buffer);else if(w.length!==s*d*g)throw new RangeError(`mismatched image size. expected: ${w.length} but got: ${s*d*g}`)}else w=new Uint8Array(s*d*g);return u.width=s,u.height=d,u.data=w,u}function ip(u,{width:s,height:d},g){if(s===u.width&&d===u.height)return;const w=np({},{width:s,height:d},g);Rl(u,w,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,d)},g),u.width=s,u.height=d,u.data=w.data}function Rl(u,s,d,g,w,E){if(w.width===0||w.height===0)return s;if(w.width>u.width||w.height>u.height||d.x>u.width-w.width||d.y>u.height-w.height)throw new RangeError("out of range source coordinates for image copy");if(w.width>s.width||w.height>s.height||g.x>s.width-w.width||g.y>s.height-w.height)throw new RangeError("out of range destination coordinates for image copy");const C=u.data,P=s.data;if(C===P)throw new Error("srcData equals dstData, so image is already copied");for(let O=0;O<w.height;O++){const F=((d.y+O)*u.width+d.x)*E,j=((g.y+O)*s.width+g.x)*E;for(let W=0;W<w.width*E;W++)P[j+W]=C[F+W]}return s}class kl{constructor(s,d){np(this,s,1,d)}resize(s){ip(this,s,1)}clone(){return new kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,d,g,w,E){Rl(s,d,g,w,E,1)}}class Is{constructor(s,d){np(this,s,4,d)}resize(s){ip(this,s,4)}replace(s,d){d?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,d,g,w,E){Rl(s,d,g,w,E,4)}}function Ih(u){const s={},d=u.resolution||256,g=u.clips?u.clips.length:1,w=u.image||new Is({width:d,height:g});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const E=(C,P,O)=>{s[u.evaluationKey]=O;const F=u.expression.evaluate(s);w.data[C+P+0]=Math.floor(255*F.r/F.a),w.data[C+P+1]=Math.floor(255*F.g/F.a),w.data[C+P+2]=Math.floor(255*F.b/F.a),w.data[C+P+3]=Math.floor(255*F.a)};if(u.clips)for(let C=0,P=0;C<g;++C,P+=4*d)for(let O=0,F=0;O<d;O++,F+=4){const j=O/(d-1),{start:W,end:G}=u.clips[C];E(P,F,W*(1-j)+G*j)}else for(let C=0,P=0;C<d;C++,P+=4)E(0,P,C/(d-1));return w}jt("AlphaImage",kl),jt("RGBAImage",Is);var Mh={paint:new qi({"hillshade-illumination-direction":new $t(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(Ee.paint_hillshade["hillshade-accent-color"])})};const eg=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:tg}=eg;var Ph={exports:{}};function Dh(u,s,d){d=d||2;var g,w,E,C,P,O,F,j=s&&s.length,W=j?s[0]*d:u.length,G=rp(u,0,W,d,!0),J=[];if(!G||G.next===G.prev)return J;if(j&&(G=function(ve,ye,Ne,Ge){var De,Xe,dt,ut=[];for(De=0,Xe=ye.length;De<Xe;De++)(dt=rp(ve,ye[De]*Ge,De<Xe-1?ye[De+1]*Ge:ve.length,Ge,!1))===dt.next&&(dt.steiner=!0),ut.push(ag(dt));for(ut.sort(sg),De=0;De<ut.length;De++)Ne=ay(ut[De],Ne);return Ne}(u,s,G,d)),u.length>80*d){g=E=u[0],w=C=u[1];for(var ee=d;ee<W;ee+=d)(P=u[ee])<g&&(g=P),(O=u[ee+1])<w&&(w=O),P>E&&(E=P),O>C&&(C=O);F=(F=Math.max(E-g,C-w))!==0?32767/F:0}return Ic(G,J,d,g,w,F,0),J}function rp(u,s,d,g,w){var E,C;if(w===Nf(u,s,d,g)>0)for(E=s;E<d;E+=g)C=op(E,u[E],u[E+1],C);else for(E=d-g;E>=s;E-=g)C=op(E,u[E],u[E+1],C);return C&&Bf(C,C.next)&&(_u(C),C=C.next),C}function Il(u,s){if(!u)return u;s||(s=u);var d,g=u;do if(d=!1,g.steiner||!Bf(g,g.next)&&zi(g.prev,g,g.next)!==0)g=g.next;else{if(_u(g),(g=s=g.prev)===g.next)break;d=!0}while(d||g!==s);return s}function Ic(u,s,d,g,w,E,C){if(u){!C&&E&&function(j,W,G,J){var ee=j;do ee.z===0&&(ee.z=Of(ee.x,ee.y,W,G,J)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==j);ee.prevZ.nextZ=null,ee.prevZ=null,function(ve){var ye,Ne,Ge,De,Xe,dt,ut,Vt,Zt=1;do{for(Ne=ve,ve=null,Xe=null,dt=0;Ne;){for(dt++,Ge=Ne,ut=0,ye=0;ye<Zt&&(ut++,Ge=Ge.nextZ);ye++);for(Vt=Zt;ut>0||Vt>0&&Ge;)ut!==0&&(Vt===0||!Ge||Ne.z<=Ge.z)?(De=Ne,Ne=Ne.nextZ,ut--):(De=Ge,Ge=Ge.nextZ,Vt--),Xe?Xe.nextZ=De:ve=De,De.prevZ=Xe,Xe=De;Ne=Ge}Xe.nextZ=null,Zt*=2}while(dt>1)}(ee)}(u,g,w,E);for(var P,O,F=u;u.prev!==u.next;)if(P=u.prev,O=u.next,E?ig(u,g,w,E):ng(u))s.push(P.i/d|0),s.push(u.i/d|0),s.push(O.i/d|0),_u(u),u=O.next,F=O.next;else if((u=O)===F){C?C===1?Ic(u=sp(Il(u),s,d),s,d,g,w,E,2):C===2&&rg(u,s,d,g,w,E):Ic(Il(u),s,d,g,w,E,1);break}}}function ng(u){var s=u.prev,d=u,g=u.next;if(zi(s,d,g)>=0)return!1;for(var w=s.x,E=d.x,C=g.x,P=s.y,O=d.y,F=g.y,j=w<E?w<C?w:C:E<C?E:C,W=P<O?P<F?P:F:O<F?O:F,G=w>E?w>C?w:C:E>C?E:C,J=P>O?P>F?P:F:O>F?O:F,ee=g.next;ee!==s;){if(ee.x>=j&&ee.x<=G&&ee.y>=W&&ee.y<=J&&Ml(w,P,E,O,C,F,ee.x,ee.y)&&zi(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function ig(u,s,d,g){var w=u.prev,E=u,C=u.next;if(zi(w,E,C)>=0)return!1;for(var P=w.x,O=E.x,F=C.x,j=w.y,W=E.y,G=C.y,J=P<O?P<F?P:F:O<F?O:F,ee=j<W?j<G?j:G:W<G?W:G,ve=P>O?P>F?P:F:O>F?O:F,ye=j>W?j>G?j:G:W>G?W:G,Ne=Of(J,ee,s,d,g),Ge=Of(ve,ye,s,d,g),De=u.prevZ,Xe=u.nextZ;De&&De.z>=Ne&&Xe&&Xe.z<=Ge;){if(De.x>=J&&De.x<=ve&&De.y>=ee&&De.y<=ye&&De!==w&&De!==C&&Ml(P,j,O,W,F,G,De.x,De.y)&&zi(De.prev,De,De.next)>=0||(De=De.prevZ,Xe.x>=J&&Xe.x<=ve&&Xe.y>=ee&&Xe.y<=ye&&Xe!==w&&Xe!==C&&Ml(P,j,O,W,F,G,Xe.x,Xe.y)&&zi(Xe.prev,Xe,Xe.next)>=0))return!1;Xe=Xe.nextZ}for(;De&&De.z>=Ne;){if(De.x>=J&&De.x<=ve&&De.y>=ee&&De.y<=ye&&De!==w&&De!==C&&Ml(P,j,O,W,F,G,De.x,De.y)&&zi(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;Xe&&Xe.z<=Ge;){if(Xe.x>=J&&Xe.x<=ve&&Xe.y>=ee&&Xe.y<=ye&&Xe!==w&&Xe!==C&&Ml(P,j,O,W,F,G,Xe.x,Xe.y)&&zi(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.nextZ}return!0}function sp(u,s,d){var g=u;do{var w=g.prev,E=g.next.next;!Bf(w,E)&&lg(w,g,g.next,E)&&Mc(w,E)&&Mc(E,w)&&(s.push(w.i/d|0),s.push(g.i/d|0),s.push(E.i/d|0),_u(g),_u(g.next),g=u=E),g=g.next}while(g!==u);return Il(g)}function rg(u,s,d,g,w,E){var C=u;do{for(var P=C.next.next;P!==C.prev;){if(C.i!==P.i&&og(C,P)){var O=Bh(C,P);return C=Il(C,C.next),O=Il(O,O.next),Ic(C,s,d,g,w,E,0),void Ic(O,s,d,g,w,E,0)}P=P.next}C=C.next}while(C!==u)}function sg(u,s){return u.x-s.x}function ay(u,s){var d=function(w,E){var C,P=E,O=w.x,F=w.y,j=-1/0;do{if(F<=P.y&&F>=P.next.y&&P.next.y!==P.y){var W=P.x+(F-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(W<=O&&W>j&&(j=W,C=P.x<P.next.x?P:P.next,W===O))return C}P=P.next}while(P!==E);if(!C)return null;var G,J=C,ee=C.x,ve=C.y,ye=1/0;P=C;do O>=P.x&&P.x>=ee&&O!==P.x&&Ml(F<ve?O:j,F,ee,ve,F<ve?j:O,F,P.x,P.y)&&(G=Math.abs(F-P.y)/(O-P.x),Mc(P,w)&&(G<ye||G===ye&&(P.x>C.x||P.x===C.x&&ap(C,P)))&&(C=P,ye=G)),P=P.next;while(P!==J);return C}(u,s);if(!d)return s;var g=Bh(d,u);return Il(g,g.next),Il(d,d.next)}function ap(u,s){return zi(u.prev,u,s.prev)<0&&zi(s.next,u,u.next)<0}function Of(u,s,d,g,w){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-d)*w|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-g)*w|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function ag(u){var s=u,d=u;do(s.x<d.x||s.x===d.x&&s.y<d.y)&&(d=s),s=s.next;while(s!==u);return d}function Ml(u,s,d,g,w,E,C,P){return(w-C)*(s-P)>=(u-C)*(E-P)&&(u-C)*(g-P)>=(d-C)*(s-P)&&(d-C)*(E-P)>=(w-C)*(g-P)}function og(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(d,g){var w=d;do{if(w.i!==d.i&&w.next.i!==d.i&&w.i!==g.i&&w.next.i!==g.i&&lg(w,w.next,d,g))return!0;w=w.next}while(w!==d);return!1}(u,s)&&(Mc(u,s)&&Mc(s,u)&&function(d,g){var w=d,E=!1,C=(d.x+g.x)/2,P=(d.y+g.y)/2;do w.y>P!=w.next.y>P&&w.next.y!==w.y&&C<(w.next.x-w.x)*(P-w.y)/(w.next.y-w.y)+w.x&&(E=!E),w=w.next;while(w!==d);return E}(u,s)&&(zi(u.prev,u,s.prev)||zi(u,s.prev,s))||Bf(u,s)&&zi(u.prev,u,u.next)>0&&zi(s.prev,s,s.next)>0)}function zi(u,s,d){return(s.y-u.y)*(d.x-s.x)-(s.x-u.x)*(d.y-s.y)}function Bf(u,s){return u.x===s.x&&u.y===s.y}function lg(u,s,d,g){var w=Pl(zi(u,s,d)),E=Pl(zi(u,s,g)),C=Pl(zi(d,g,u)),P=Pl(zi(d,g,s));return w!==E&&C!==P||!(w!==0||!Oh(u,d,s))||!(E!==0||!Oh(u,g,s))||!(C!==0||!Oh(d,u,g))||!(P!==0||!Oh(d,s,g))}function Oh(u,s,d){return s.x<=Math.max(u.x,d.x)&&s.x>=Math.min(u.x,d.x)&&s.y<=Math.max(u.y,d.y)&&s.y>=Math.min(u.y,d.y)}function Pl(u){return u>0?1:u<0?-1:0}function Mc(u,s){return zi(u.prev,u,u.next)<0?zi(u,s,u.next)>=0&&zi(u,u.prev,s)>=0:zi(u,s,u.prev)<0||zi(u,u.next,s)<0}function Bh(u,s){var d=new yu(u.i,u.x,u.y),g=new yu(s.i,s.x,s.y),w=u.next,E=s.prev;return u.next=s,s.prev=u,d.next=w,w.prev=d,g.next=d,d.prev=g,E.next=g,g.prev=E,g}function op(u,s,d,g){var w=new yu(u,s,d);return g?(w.next=g.next,w.prev=g,g.next.prev=w,g.next=w):(w.prev=w,w.next=w),w}function _u(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function yu(u,s,d){this.i=u,this.x=s,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nf(u,s,d,g){for(var w=0,E=s,C=d-g;E<d;E+=g)w+=(u[C]-u[E])*(u[E+1]+u[C+1]),C=E;return w}function cg(u,s,d,g,w){ug(u,s,d,g||u.length-1,w||Nh)}function ug(u,s,d,g,w){for(;g>d;){if(g-d>600){var E=g-d+1,C=s-d+1,P=Math.log(E),O=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*O*(E-O)/E)*(C-E/2<0?-1:1);ug(u,s,Math.max(d,Math.floor(s-C*O/E+F)),Math.min(g,Math.floor(s+(E-C)*O/E+F)),w)}var j=u[s],W=d,G=g;for(to(u,d,s),w(u[g],j)>0&&to(u,d,g);W<G;){for(to(u,W,G),W++,G--;w(u[W],j)<0;)W++;for(;w(u[G],j)>0;)G--}w(u[d],j)===0?to(u,d,G):to(u,++G,g),G<=s&&(d=G+1),s<=G&&(g=G-1)}}function to(u,s,d){var g=u[s];u[s]=u[d],u[d]=g}function Nh(u,s){return u<s?-1:u>s?1:0}function bu(u,s){const d=u.length;if(d<=1)return[u];const g=[];let w,E;for(let C=0;C<d;C++){const P=it(u[C]);P!==0&&(u[C].area=Math.abs(P),E===void 0&&(E=P<0),E===P<0?(w&&g.push(w),w=[u[C]]):w.push(u[C]))}if(w&&g.push(w),s>1)for(let C=0;C<g.length;C++)g[C].length<=s||(cg(g[C],s,1,g[C].length-1,zh),g[C]=g[C].slice(0,s));return g}function zh(u,s){return s.area-u.area}function xu(u,s,d){const g=d.patternDependencies;let w=!1;for(const E of s){const C=E.paint.get(`${u}-pattern`);C.isConstant()||(w=!0);const P=C.constantOr(null);P&&(w=!0,g[P.to]=!0,g[P.from]=!0)}return w}function zf(u,s,d,g,w){const E=w.patternDependencies;for(const C of s){const P=C.paint.get(`${u}-pattern`).value;if(P.kind!=="constant"){let O=P.evaluate({zoom:g-1},d,{},w.availableImages),F=P.evaluate({zoom:g},d,{},w.availableImages),j=P.evaluate({zoom:g+1},d,{},w.availableImages);O=O&&O.name?O.name:O,F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,E[O]=!0,E[F]=!0,E[j]=!0,d.patterns[C.id]={min:O,mid:F,max:j}}}return d}Ph.exports=Dh,Ph.exports.default=Dh,Dh.deviation=function(u,s,d,g){var w=s&&s.length,E=Math.abs(Nf(u,0,w?s[0]*d:u.length,d));if(w)for(var C=0,P=s.length;C<P;C++)E-=Math.abs(Nf(u,s[C]*d,C<P-1?s[C+1]*d:u.length,d));var O=0;for(C=0;C<g.length;C+=3){var F=g[C]*d,j=g[C+1]*d,W=g[C+2]*d;O+=Math.abs((u[F]-u[W])*(u[j+1]-u[F+1])-(u[F]-u[j])*(u[W+1]-u[F+1]))}return E===0&&O===0?0:Math.abs((O-E)/E)},Dh.flatten=function(u){for(var s=u[0][0].length,d={vertices:[],holes:[],dimensions:s},g=0,w=0;w<u.length;w++){for(var E=0;E<u[w].length;E++)for(var C=0;C<s;C++)d.vertices.push(u[w][E][C]);w>0&&d.holes.push(g+=u[w-1].length)}return d};class Lf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(d=>d.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wn,this.indexArray=new Xi,this.indexArray2=new Rs,this.programConfigurations=new Ia(s.layers,s.zoom),this.segments=new Dn,this.segments2=new Dn,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(s,d,g){this.hasPattern=xu("fill",this.layers,d);const w=this.layers[0].layout.get("fill-sort-key"),E=!w.isConstant(),C=[];for(const{feature:P,id:O,index:F,sourceLayerIndex:j}of s){const W=this.layers[0]._featureFilter.needGeometry,G=Cl(P,W);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),G,g))continue;const J=E?w.evaluate(G,{},g,d.availableImages):void 0,ee={id:O,properties:P.properties,type:P.type,sourceLayerIndex:j,index:F,geometry:W?G.geometry:Al(P),patterns:{},sortKey:J};C.push(ee)}E&&C.sort((P,O)=>P.sortKey-O.sortKey);for(const P of C){const{geometry:O,index:F,sourceLayerIndex:j}=P;if(this.hasPattern){const W=zf("fill",this.layers,P,this.zoom,d);this.patternFeatures.push(W)}else this.addFeature(P,O,F,g,{});d.featureIndex.insert(s[F].feature,O,F,j,this.index)}}update(s,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,d,this.stateDependentLayers,g)}addFeatures(s,d,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,tg),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,d,g,w,E){for(const C of bu(d,500)){let P=0;for(const J of C)P+=J.length;const O=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),F=O.vertexLength,j=[],W=[];for(const J of C){if(J.length===0)continue;J!==C[0]&&W.push(j.length/2);const ee=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),ve=ee.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(ve+J.length-1,ve),j.push(J[0].x),j.push(J[0].y);for(let ye=1;ye<J.length;ye++)this.layoutVertexArray.emplaceBack(J[ye].x,J[ye].y),this.indexArray2.emplaceBack(ve+ye-1,ve+ye),j.push(J[ye].x),j.push(J[ye].y);ee.vertexLength+=J.length,ee.primitiveLength+=J.length}const G=Ph.exports(j,W);for(let J=0;J<G.length;J+=3)this.indexArray.emplaceBack(F+G[J],F+G[J+1],F+G[J+2]);O.vertexLength+=P,O.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,E,w)}}jt("FillBucket",Lf,{omit:["layers","patternFeatures"]});const vu=new qi({"fill-sort-key":new Gt(Ee.layout_fill["fill-sort-key"])});var hg={paint:new qi({"fill-antialias":new $t(Ee.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Ee.paint_fill["fill-opacity"]),"fill-color":new Gt(Ee.paint_fill["fill-color"]),"fill-outline-color":new Gt(Ee.paint_fill["fill-outline-color"]),"fill-translate":new $t(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xs(Ee.paint_fill["fill-pattern"])}),layout:vu};const ya=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),no=Ni([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Dl}=ya;var $o={},Ol=we,io=Li;function Li(u,s,d,g,w){this.properties={},this.extent=d,this.type=0,this._pbf=u,this._geometry=-1,this._keys=g,this._values=w,u.readFields(Ff,this,s)}function Ff(u,s,d){u==1?s.id=d.readVarint():u==2?function(g,w){for(var E=g.readVarint()+g.pos;g.pos<E;){var C=w._keys[g.readVarint()],P=w._values[g.readVarint()];w.properties[C]=P}}(d,s):u==3?s.type=d.readVarint():u==4&&(s._geometry=d.pos)}function lp(u){for(var s,d,g=0,w=0,E=u.length,C=E-1;w<E;C=w++)g+=((d=u[C]).x-(s=u[w]).x)*(s.y+d.y);return g}Li.types=["Unknown","Point","LineString","Polygon"],Li.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var s,d=u.readVarint()+u.pos,g=1,w=0,E=0,C=0,P=[];u.pos<d;){if(w<=0){var O=u.readVarint();g=7&O,w=O>>3}if(w--,g===1||g===2)E+=u.readSVarint(),C+=u.readSVarint(),g===1&&(s&&P.push(s),s=[]),s.push(new Ol(E,C));else{if(g!==7)throw new Error("unknown command "+g);s&&s.push(s[0].clone())}}return s&&P.push(s),P},Li.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var s=u.readVarint()+u.pos,d=1,g=0,w=0,E=0,C=1/0,P=-1/0,O=1/0,F=-1/0;u.pos<s;){if(g<=0){var j=u.readVarint();d=7&j,g=j>>3}if(g--,d===1||d===2)(w+=u.readSVarint())<C&&(C=w),w>P&&(P=w),(E+=u.readSVarint())<O&&(O=E),E>F&&(F=E);else if(d!==7)throw new Error("unknown command "+d)}return[C,O,P,F]},Li.prototype.toGeoJSON=function(u,s,d){var g,w,E=this.extent*Math.pow(2,d),C=this.extent*u,P=this.extent*s,O=this.loadGeometry(),F=Li.types[this.type];function j(J){for(var ee=0;ee<J.length;ee++){var ve=J[ee];J[ee]=[360*(ve.x+C)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(ve.y+P)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(g=0;g<O.length;g++)W[g]=O[g][0];j(O=W);break;case 2:for(g=0;g<O.length;g++)j(O[g]);break;case 3:for(O=function(J){var ee=J.length;if(ee<=1)return[J];for(var ve,ye,Ne=[],Ge=0;Ge<ee;Ge++){var De=lp(J[Ge]);De!==0&&(ye===void 0&&(ye=De<0),ye===De<0?(ve&&Ne.push(ve),ve=[J[Ge]]):ve.push(J[Ge]))}return ve&&Ne.push(ve),Ne}(O),g=0;g<O.length;g++)for(w=0;w<O[g].length;w++)j(O[g][w])}O.length===1?O=O[0]:F="Multi"+F;var G={type:"Feature",geometry:{type:F,coordinates:O},properties:this.properties};return"id"in this&&(G.id=this.id),G};var cp=io,up=hp;function hp(u,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(Pc,this,s),this.length=this._features.length}function Pc(u,s,d){u===15?s.version=d.readVarint():u===1?s.name=d.readString():u===5?s.extent=d.readVarint():u===2?s._features.push(d.pos):u===3?s._keys.push(d.readString()):u===4&&s._values.push(function(g){for(var w=null,E=g.readVarint()+g.pos;g.pos<E;){var C=g.readVarint()>>3;w=C===1?g.readString():C===2?g.readFloat():C===3?g.readDouble():C===4?g.readVarint64():C===5?g.readVarint():C===6?g.readSVarint():C===7?g.readBoolean():null}return w}(d))}hp.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var s=this._pbf.readVarint()+this._pbf.pos;return new cp(this._pbf,s,this.extent,this._keys,this._values)};var Uf=up;function fg(u,s,d){if(u===3){var g=new Uf(d,d.readVarint()+d.pos);g.length&&(s[g.name]=g)}}$o.VectorTile=function(u,s){this.layers=u.readFields(fg,{},s)},$o.VectorTileFeature=io,$o.VectorTileLayer=up;const dg=$o.VectorTileFeature.types,Vf=Math.pow(2,13);function Bl(u,s,d,g,w,E,C,P){u.emplaceBack(s,d,2*Math.floor(g*Vf)+C,w*Vf*2,E*Vf*2,Math.round(P))}class jf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(d=>d.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new $n,this.centroidVertexArray=new yn,this.indexArray=new Xi,this.programConfigurations=new Ia(s.layers,s.zoom),this.segments=new Dn,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(s,d,g){this.features=[],this.hasPattern=xu("fill-extrusion",this.layers,d);for(const{feature:w,id:E,index:C,sourceLayerIndex:P}of s){const O=this.layers[0]._featureFilter.needGeometry,F=Cl(w,O);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),F,g))continue;const j={id:E,sourceLayerIndex:P,index:C,geometry:O?F.geometry:Al(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(zf("fill-extrusion",this.layers,j,this.zoom,d)):this.addFeature(j,j.geometry,C,g,{}),d.featureIndex.insert(w,j.geometry,C,P,this.index,!0)}}addFeatures(s,d,g){for(const w of this.features){const{geometry:E}=w;this.addFeature(w,E,w.index,d,g)}}update(s,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Dl),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,no.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,d,g,w,E){const C={x:0,y:0,vertexCount:0};for(const P of bu(d,500)){let O=0;for(const ee of P)O+=ee.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ee of P){if(ee.length===0||pg(ee))continue;let ve=0;for(let ye=0;ye<ee.length;ye++){const Ne=ee[ye];if(ye>=1){const Ge=ee[ye-1];if(!fp(Ne,Ge)){F.vertexLength+4>Dn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=Ne.sub(Ge)._perp()._unit(),Xe=Ge.dist(Ne);ve+Xe>32768&&(ve=0),Bl(this.layoutVertexArray,Ne.x,Ne.y,De.x,De.y,0,0,ve),Bl(this.layoutVertexArray,Ne.x,Ne.y,De.x,De.y,0,1,ve),C.x+=2*Ne.x,C.y+=2*Ne.y,C.vertexCount+=2,ve+=Xe,Bl(this.layoutVertexArray,Ge.x,Ge.y,De.x,De.y,0,0,ve),Bl(this.layoutVertexArray,Ge.x,Ge.y,De.x,De.y,0,1,ve),C.x+=2*Ge.x,C.y+=2*Ge.y,C.vertexCount+=2;const dt=F.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+O>Dn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),dg[s.type]!=="Polygon")continue;const j=[],W=[],G=F.vertexLength;for(const ee of P)if(ee.length!==0){ee!==P[0]&&W.push(j.length/2);for(let ve=0;ve<ee.length;ve++){const ye=ee[ve];Bl(this.layoutVertexArray,ye.x,ye.y,0,0,1,1,0),C.x+=ye.x,C.y+=ye.y,C.vertexCount+=1,j.push(ye.x),j.push(ye.y)}}const J=Ph.exports(j,W);for(let ee=0;ee<J.length;ee+=3)this.indexArray.emplaceBack(G+J[ee],G+J[ee+2],G+J[ee+1]);F.primitiveLength+=J.length/3,F.vertexLength+=O}for(let P=0;P<C.vertexCount;P++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,E,w)}}function fp(u,s){return u.x===s.x&&(u.x<0||u.x>kn)||u.y===s.y&&(u.y<0||u.y>kn)}function pg(u){return u.every(s=>s.x<0)||u.every(s=>s.x>kn)||u.every(s=>s.y<0)||u.every(s=>s.y>kn)}jt("FillExtrusionBucket",jf,{omit:["layers","features"]});var mg={paint:new qi({"fill-extrusion-opacity":new $t(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xs(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Lh(u,s){return u.x*s.x+u.y*s.y}function dp(u,s){if(u.length===1){let d=0;const g=s[d++];let w;for(;!w||g.equals(w);)if(w=s[d++],!w)return 1/0;for(;d<s.length;d++){const E=s[d],C=u[0],P=w.sub(g),O=E.sub(g),F=C.sub(g),j=Lh(P,P),W=Lh(P,O),G=Lh(O,O),J=Lh(F,P),ee=Lh(F,O),ve=j*G-W*W,ye=(G*J-W*ee)/ve,Ne=(j*ee-W*J)/ve,Ge=g.z*(1-ye-Ne)+w.z*ye+E.z*Ne;if(isFinite(Ge))return Ge}return 1/0}{let d=1/0;for(const g of s)d=Math.min(d,g.z);return d}}const zr=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Kr}=zr,gg=Ni([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_g}=gg,yg=$o.VectorTileFeature.types,bg=Math.cos(Math.PI/180*37.5),pp=Math.pow(2,14)/.5;class wu{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(d=>d.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Pn,this.layoutVertexArray2=new En,this.indexArray=new Xi,this.programConfigurations=new Ia(s.layers,s.zoom),this.segments=new Dn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(s,d,g){this.hasPattern=xu("line",this.layers,d);const w=this.layers[0].layout.get("line-sort-key"),E=!w.isConstant(),C=[];for(const{feature:P,id:O,index:F,sourceLayerIndex:j}of s){const W=this.layers[0]._featureFilter.needGeometry,G=Cl(P,W);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),G,g))continue;const J=E?w.evaluate(G,{},g):void 0,ee={id:O,properties:P.properties,type:P.type,sourceLayerIndex:j,index:F,geometry:W?G.geometry:Al(P),patterns:{},sortKey:J};C.push(ee)}E&&C.sort((P,O)=>P.sortKey-O.sortKey);for(const P of C){const{geometry:O,index:F,sourceLayerIndex:j}=P;if(this.hasPattern){const W=zf("line",this.layers,P,this.zoom,d);this.patternFeatures.push(W)}else this.addFeature(P,O,F,g,{});d.featureIndex.insert(s[F].feature,O,F,j,this.index)}}update(s,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,d,this.stateDependentLayers,g)}addFeatures(s,d,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,_g)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Kr),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,d,g,w,E){const C=this.layers[0].layout,P=C.get("line-join").evaluate(s,{}),O=C.get("line-cap"),F=C.get("line-miter-limit"),j=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const W of d)this.addLine(W,s,P,O,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,E,w)}addLine(s,d,g,w,E,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ne=0;Ne<s.length-1;Ne++)this.totalDistance+=s[Ne].dist(s[Ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=yg[d.type]==="Polygon";let O=s.length;for(;O>=2&&s[O-1].equals(s[O-2]);)O--;let F=0;for(;F<O-1&&s[F].equals(s[F+1]);)F++;if(O<(P?3:2))return;g==="bevel"&&(E=1.05);const j=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let G,J,ee,ve,ye;this.e1=this.e2=-1,P&&(G=s[O-2],ye=s[F].sub(G)._unit()._perp());for(let Ne=F;Ne<O;Ne++){if(ee=Ne===O-1?P?s[F+1]:void 0:s[Ne+1],ee&&s[Ne].equals(ee))continue;ye&&(ve=ye),G&&(J=G),G=s[Ne],ye=ee?ee.sub(G)._unit()._perp():ve,ve=ve||ye;let Ge=ve.add(ye);Ge.x===0&&Ge.y===0||Ge._unit();const De=ve.x*ye.x+ve.y*ye.y,Xe=Ge.x*ye.x+Ge.y*ye.y,dt=Xe!==0?1/Xe:1/0,ut=2*Math.sqrt(2-2*Xe),Vt=Xe<bg&&J&&ee,Zt=ve.x*ye.y-ve.y*ye.x>0;if(Vt&&Ne>F){const Et=G.dist(J);if(Et>2*j){const Nt=G.sub(G.sub(J)._mult(j/Et)._round());this.updateDistance(J,Nt),this.addCurrentVertex(Nt,ve,0,0,W),J=Nt}}const Bt=J&&ee;let Ct=Bt?g:P?"butt":w;if(Bt&&Ct==="round"&&(dt<C?Ct="miter":dt<=2&&(Ct="fakeround")),Ct==="miter"&&dt>E&&(Ct="bevel"),Ct==="bevel"&&(dt>2&&(Ct="flipbevel"),dt<E&&(Ct="miter")),J&&this.updateDistance(J,G),Ct==="miter")Ge._mult(dt),this.addCurrentVertex(G,Ge,0,0,W);else if(Ct==="flipbevel"){if(dt>100)Ge=ye.mult(-1);else{const Et=dt*ve.add(ye).mag()/ve.sub(ye).mag();Ge._perp()._mult(Et*(Zt?-1:1))}this.addCurrentVertex(G,Ge,0,0,W),this.addCurrentVertex(G,Ge.mult(-1),0,0,W)}else if(Ct==="bevel"||Ct==="fakeround"){const Et=-Math.sqrt(dt*dt-1),Nt=Zt?Et:0,Pt=Zt?0:Et;if(J&&this.addCurrentVertex(G,ve,Nt,Pt,W),Ct==="fakeround"){const vt=Math.round(180*ut/Math.PI/20);for(let Jt=1;Jt<vt;Jt++){let Yt=Jt/vt;if(Yt!==.5){const ai=Yt-.5;Yt+=Yt*ai*(Yt-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*ai*ai+(.848013+De*(.215638*De-1.06021)))}const xn=ye.sub(ve)._mult(Yt)._add(ve)._unit()._mult(Zt?-1:1);this.addHalfVertex(G,xn.x,xn.y,!1,Zt,0,W)}}ee&&this.addCurrentVertex(G,ye,-Nt,-Pt,W)}else if(Ct==="butt")this.addCurrentVertex(G,Ge,0,0,W);else if(Ct==="square"){const Et=J?1:-1;this.addCurrentVertex(G,Ge,Et,Et,W)}else Ct==="round"&&(J&&(this.addCurrentVertex(G,ve,0,0,W),this.addCurrentVertex(G,ve,1,1,W,!0)),ee&&(this.addCurrentVertex(G,ye,-1,-1,W,!0),this.addCurrentVertex(G,ye,0,0,W)));if(Vt&&Ne<O-1){const Et=G.dist(ee);if(Et>2*j){const Nt=G.add(ee.sub(G)._mult(j/Et)._round());this.updateDistance(G,Nt),this.addCurrentVertex(Nt,ye,0,0,W),G=Nt}}}}addCurrentVertex(s,d,g,w,E,C=!1){const P=d.y*w-d.x,O=-d.y-d.x*w;this.addHalfVertex(s,d.x+d.y*g,d.y-d.x*g,C,!1,g,E),this.addHalfVertex(s,P,O,C,!0,-w,E),this.distance>pp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,d,g,w,E,C))}addHalfVertex({x:s,y:d},g,w,E,C,P,O){const F=.5*(this.lineClips?this.scaledDistance*(pp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(E?1:0),(d<<1)+(C?1:0),Math.round(63*g)+128,Math.round(63*w)+128,1+(P===0?0:P<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=O.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),O.primitiveLength++),C?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,d){this.distance+=s.dist(d),this.updateScaledDistance()}}jt("LineBucket",wu,{omit:["layers","patternFeatures"]});const mp=new qi({"line-cap":new $t(Ee.layout_line["line-cap"]),"line-join":new Gt(Ee.layout_line["line-join"]),"line-miter-limit":new $t(Ee.layout_line["line-miter-limit"]),"line-round-limit":new $t(Ee.layout_line["line-round-limit"]),"line-sort-key":new Gt(Ee.layout_line["line-sort-key"])});var gp={paint:new qi({"line-opacity":new Gt(Ee.paint_line["line-opacity"]),"line-color":new Gt(Ee.paint_line["line-color"]),"line-translate":new $t(Ee.paint_line["line-translate"]),"line-translate-anchor":new $t(Ee.paint_line["line-translate-anchor"]),"line-width":new Gt(Ee.paint_line["line-width"]),"line-gap-width":new Gt(Ee.paint_line["line-gap-width"]),"line-offset":new Gt(Ee.paint_line["line-offset"]),"line-blur":new Gt(Ee.paint_line["line-blur"]),"line-dasharray":new wl(Ee.paint_line["line-dasharray"]),"line-pattern":new Xs(Ee.paint_line["line-pattern"]),"line-gradient":new Ac(Ee.paint_line["line-gradient"])}),layout:mp};const _p=new class extends Gt{possiblyEvaluate(u,s){return s=new ui(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(u,s)}evaluate(u,s,d,g){return s=L({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(u,s,d,g)}}(gp.paint.properties["line-width"].specification);function yp(u,s){return s>0?s+2*u:u}_p.useIntegerZoom=!0;const bp=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xp=Ni([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vp=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ni([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wp=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tp=Ni([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $f(u,s,d){return u.sections.forEach(g=>{g.text=function(w,E,C){const P=E.layout.get("text-transform").evaluate(C,{});return P==="uppercase"?w=w.toLocaleUpperCase():P==="lowercase"&&(w=w.toLocaleLowerCase()),dr.applyArabicShaping&&(w=dr.applyArabicShaping(w)),w}(g.text,s,d)}),u}Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Dc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var gr=24,Fh=Kn,Sp=function(u,s,d,g,w){var E,C,P=8*w-g-1,O=(1<<P)-1,F=O>>1,j=-7,W=w-1,G=-1,J=u[s+W];for(W+=G,E=J&(1<<-j)-1,J>>=-j,j+=P;j>0;E=256*E+u[s+W],W+=G,j-=8);for(C=E&(1<<-j)-1,E>>=-j,j+=g;j>0;C=256*C+u[s+W],W+=G,j-=8);if(E===0)E=1-F;else{if(E===O)return C?NaN:1/0*(J?-1:1);C+=Math.pow(2,g),E-=F}return(J?-1:1)*C*Math.pow(2,E-g)},ro=function(u,s,d,g,w,E){var C,P,O,F=8*E-w-1,j=(1<<F)-1,W=j>>1,G=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=0,ee=1,ve=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(P=isNaN(s)?1:0,C=j):(C=Math.floor(Math.log(s)/Math.LN2),s*(O=Math.pow(2,-C))<1&&(C--,O*=2),(s+=C+W>=1?G/O:G*Math.pow(2,1-W))*O>=2&&(C++,O/=2),C+W>=j?(P=0,C=j):C+W>=1?(P=(s*O-1)*Math.pow(2,w),C+=W):(P=s*Math.pow(2,W-1)*Math.pow(2,w),C=0));w>=8;u[d+J]=255&P,J+=ee,P/=256,w-=8);for(C=C<<w|P,F+=w;F>0;u[d+J]=255&C,J+=ee,C/=256,F-=8);u[d+J-ee]|=128*ve};function Kn(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Kn.Varint=0,Kn.Fixed64=1,Kn.Bytes=2,Kn.Fixed32=5;var Nl,Hf=4294967296,so=1/Hf,Ep=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ba(u){return u.type===Kn.Bytes?u.readVarint()+u.pos:u.pos+1}function ao(u,s,d){return d?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function Fi(u,s,d){var g=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));d.realloc(g);for(var w=d.pos-1;w>=u;w--)d.buf[w+g]=d.buf[w]}function oy(u,s){for(var d=0;d<u.length;d++)s.writeVarint(u[d])}function ly(u,s){for(var d=0;d<u.length;d++)s.writeSVarint(u[d])}function xg(u,s){for(var d=0;d<u.length;d++)s.writeFloat(u[d])}function Uh(u,s){for(var d=0;d<u.length;d++)s.writeDouble(u[d])}function zl(u,s){for(var d=0;d<u.length;d++)s.writeBoolean(u[d])}function vg(u,s){for(var d=0;d<u.length;d++)s.writeFixed32(u[d])}function wg(u,s){for(var d=0;d<u.length;d++)s.writeSFixed32(u[d])}function Vh(u,s){for(var d=0;d<u.length;d++)s.writeFixed64(u[d])}function oo(u,s){for(var d=0;d<u.length;d++)s.writeSFixed64(u[d])}function jh(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+16777216*u[s+3]}function Ll(u,s,d){u[d]=s,u[d+1]=s>>>8,u[d+2]=s>>>16,u[d+3]=s>>>24}function Ap(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+(u[s+3]<<24)}function Cp(u,s,d){u===1&&d.readMessage(Rp,s)}function Rp(u,s,d){if(u===3){const{id:g,bitmap:w,width:E,height:C,left:P,top:O,advance:F}=d.readMessage(qf,{});s.push({id:g,bitmap:new kl({width:E+6,height:C+6},w),metrics:{width:E,height:C,left:P,top:O,advance:F}})}}function qf(u,s,d){u===1?s.id=d.readVarint():u===2?s.bitmap=d.readBytes():u===3?s.width=d.readVarint():u===4?s.height=d.readVarint():u===5?s.left=d.readSVarint():u===6?s.top=d.readSVarint():u===7&&(s.advance=d.readVarint())}function kp(u){let s=0,d=0;for(const C of u)s+=C.w*C.h,d=Math.max(d,C.w);u.sort((C,P)=>P.h-C.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),d),h:1/0}];let w=0,E=0;for(const C of u)for(let P=g.length-1;P>=0;P--){const O=g[P];if(!(C.w>O.w||C.h>O.h)){if(C.x=O.x,C.y=O.y,E=Math.max(E,C.y+C.h),w=Math.max(w,C.x+C.w),C.w===O.w&&C.h===O.h){const F=g.pop();P<g.length&&(g[P]=F)}else C.h===O.h?(O.x+=C.w,O.w-=C.w):C.w===O.w?(O.y+=C.h,O.h-=C.h):(g.push({x:O.x+C.w,y:O.y,w:O.w-C.w,h:C.h}),O.y+=C.h,O.h-=C.h);break}}return{w,h:E,fill:s/(w*E)||0}}Kn.prototype={destroy:function(){this.buf=null},readFields:function(u,s,d){for(d=d||this.length;this.pos<d;){var g=this.readVarint(),w=g>>3,E=this.pos;this.type=7&g,u(w,s,this),this.pos===E&&this.skip(g)}return s},readMessage:function(u,s){return this.readFields(u,s,this.readVarint()+this.pos)},readFixed32:function(){var u=jh(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=Ap(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=jh(this.buf,this.pos)+jh(this.buf,this.pos+4)*Hf;return this.pos+=8,u},readSFixed64:function(){var u=jh(this.buf,this.pos)+Ap(this.buf,this.pos+4)*Hf;return this.pos+=8,u},readFloat:function(){var u=Sp(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=Sp(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var s,d,g=this.buf;return s=127&(d=g[this.pos++]),d<128?s:(s|=(127&(d=g[this.pos++]))<<7,d<128?s:(s|=(127&(d=g[this.pos++]))<<14,d<128?s:(s|=(127&(d=g[this.pos++]))<<21,d<128?s:function(w,E,C){var P,O,F=C.buf;if(P=(112&(O=F[C.pos++]))>>4,O<128||(P|=(127&(O=F[C.pos++]))<<3,O<128)||(P|=(127&(O=F[C.pos++]))<<10,O<128)||(P|=(127&(O=F[C.pos++]))<<17,O<128)||(P|=(127&(O=F[C.pos++]))<<24,O<128)||(P|=(1&(O=F[C.pos++]))<<31,O<128))return ao(w,P,E);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(d=g[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,s=this.pos;return this.pos=u,u-s>=12&&Ep?function(d,g,w){return Ep.decode(d.subarray(g,w))}(this.buf,s,u):function(d,g,w){for(var E="",C=g;C<w;){var P,O,F,j=d[C],W=null,G=j>239?4:j>223?3:j>191?2:1;if(C+G>w)break;G===1?j<128&&(W=j):G===2?(192&(P=d[C+1]))==128&&(W=(31&j)<<6|63&P)<=127&&(W=null):G===3?(O=d[C+2],(192&(P=d[C+1]))==128&&(192&O)==128&&((W=(15&j)<<12|(63&P)<<6|63&O)<=2047||W>=55296&&W<=57343)&&(W=null)):G===4&&(O=d[C+2],F=d[C+3],(192&(P=d[C+1]))==128&&(192&O)==128&&(192&F)==128&&((W=(15&j)<<18|(63&P)<<12|(63&O)<<6|63&F)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,G=1):W>65535&&(W-=65536,E+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),E+=String.fromCharCode(W),C+=G}return E}(this.buf,s,u)},readBytes:function(){var u=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,u);return this.pos=u,s},readPackedVarint:function(u,s){if(this.type!==Kn.Bytes)return u.push(this.readVarint(s));var d=ba(this);for(u=u||[];this.pos<d;)u.push(this.readVarint(s));return u},readPackedSVarint:function(u){if(this.type!==Kn.Bytes)return u.push(this.readSVarint());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Kn.Bytes)return u.push(this.readBoolean());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Kn.Bytes)return u.push(this.readFloat());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Kn.Bytes)return u.push(this.readDouble());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Kn.Bytes)return u.push(this.readFixed32());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Kn.Bytes)return u.push(this.readSFixed32());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Kn.Bytes)return u.push(this.readFixed64());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Kn.Bytes)return u.push(this.readSFixed64());var s=ba(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed64());return u},skip:function(u){var s=7&u;if(s===Kn.Varint)for(;this.buf[this.pos++]>127;);else if(s===Kn.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Kn.Fixed32)this.pos+=4;else{if(s!==Kn.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(u,s){this.writeVarint(u<<3|s)},realloc:function(u){for(var s=this.length||16;s<this.pos+u;)s*=2;if(s!==this.length){var d=new Uint8Array(s);d.set(this.buf),this.buf=d,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),Ll(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),Ll(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),Ll(this.buf,-1&u,this.pos),Ll(this.buf,Math.floor(u*so),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),Ll(this.buf,-1&u,this.pos),Ll(this.buf,Math.floor(u*so),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(s,d){var g,w;if(s>=0?(g=s%4294967296|0,w=s/4294967296|0):(w=~(-s/4294967296),4294967295^(g=~(-s%4294967296))?g=g+1|0:(g=0,w=w+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(E,C,P){P.buf[P.pos++]=127&E|128,E>>>=7,P.buf[P.pos++]=127&E|128,E>>>=7,P.buf[P.pos++]=127&E|128,E>>>=7,P.buf[P.pos++]=127&E|128,P.buf[P.pos]=127&(E>>>=7)}(g,0,d),function(E,C){var P=(7&E)<<4;C.buf[C.pos++]|=P|((E>>>=3)?128:0),E&&(C.buf[C.pos++]=127&E|((E>>>=7)?128:0),E&&(C.buf[C.pos++]=127&E|((E>>>=7)?128:0),E&&(C.buf[C.pos++]=127&E|((E>>>=7)?128:0),E&&(C.buf[C.pos++]=127&E|((E>>>=7)?128:0),E&&(C.buf[C.pos++]=127&E)))))}(w,d)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var s=this.pos;this.pos=function(g,w,E){for(var C,P,O=0;O<w.length;O++){if((C=w.charCodeAt(O))>55295&&C<57344){if(!P){C>56319||O+1===w.length?(g[E++]=239,g[E++]=191,g[E++]=189):P=C;continue}if(C<56320){g[E++]=239,g[E++]=191,g[E++]=189,P=C;continue}C=P-55296<<10|C-56320|65536,P=null}else P&&(g[E++]=239,g[E++]=191,g[E++]=189,P=null);C<128?g[E++]=C:(C<2048?g[E++]=C>>6|192:(C<65536?g[E++]=C>>12|224:(g[E++]=C>>18|240,g[E++]=C>>12&63|128),g[E++]=C>>6&63|128),g[E++]=63&C|128)}return E}(this.buf,u,this.pos);var d=this.pos-s;d>=128&&Fi(s,d,this),this.pos=s-1,this.writeVarint(d),this.pos+=d},writeFloat:function(u){this.realloc(4),ro(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),ro(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var s=u.length;this.writeVarint(s),this.realloc(s);for(var d=0;d<s;d++)this.buf[this.pos++]=u[d]},writeRawMessage:function(u,s){this.pos++;var d=this.pos;u(s,this);var g=this.pos-d;g>=128&&Fi(d,g,this),this.pos=d-1,this.writeVarint(g),this.pos+=g},writeMessage:function(u,s,d){this.writeTag(u,Kn.Bytes),this.writeRawMessage(s,d)},writePackedVarint:function(u,s){s.length&&this.writeMessage(u,oy,s)},writePackedSVarint:function(u,s){s.length&&this.writeMessage(u,ly,s)},writePackedBoolean:function(u,s){s.length&&this.writeMessage(u,zl,s)},writePackedFloat:function(u,s){s.length&&this.writeMessage(u,xg,s)},writePackedDouble:function(u,s){s.length&&this.writeMessage(u,Uh,s)},writePackedFixed32:function(u,s){s.length&&this.writeMessage(u,vg,s)},writePackedSFixed32:function(u,s){s.length&&this.writeMessage(u,wg,s)},writePackedFixed64:function(u,s){s.length&&this.writeMessage(u,Vh,s)},writePackedSFixed64:function(u,s){s.length&&this.writeMessage(u,oo,s)},writeBytesField:function(u,s){this.writeTag(u,Kn.Bytes),this.writeBytes(s)},writeFixed32Field:function(u,s){this.writeTag(u,Kn.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(u,s){this.writeTag(u,Kn.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(u,s){this.writeTag(u,Kn.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(u,s){this.writeTag(u,Kn.Fixed64),this.writeSFixed64(s)},writeVarintField:function(u,s){this.writeTag(u,Kn.Varint),this.writeVarint(s)},writeSVarintField:function(u,s){this.writeTag(u,Kn.Varint),this.writeSVarint(s)},writeStringField:function(u,s){this.writeTag(u,Kn.Bytes),this.writeString(s)},writeFloatField:function(u,s){this.writeTag(u,Kn.Fixed32),this.writeFloat(s)},writeDoubleField:function(u,s){this.writeTag(u,Kn.Fixed64),this.writeDouble(s)},writeBooleanField:function(u,s){this.writeVarintField(u,!!s)}};class Ma{constructor(s,{pixelRatio:d,version:g,stretchX:w,stretchY:E,content:C}){this.paddedRect=s,this.pixelRatio=d,this.stretchX=w,this.stretchY=E,this.content=C,this.version=g}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gi{constructor(s,d){const g={},w={};this.haveRenderCallbacks=[];const E=[];this.addImages(s,g,E),this.addImages(d,w,E);const{w:C,h:P}=kp(E),O=new Is({width:C||1,height:P||1});for(const F in s){const j=s[F],W=g[F].paddedRect;Is.copy(j.data,O,{x:0,y:0},{x:W.x+1,y:W.y+1},j.data)}for(const F in d){const j=d[F],W=w[F].paddedRect,G=W.x+1,J=W.y+1,ee=j.data.width,ve=j.data.height;Is.copy(j.data,O,{x:0,y:0},{x:G,y:J},j.data),Is.copy(j.data,O,{x:0,y:ve-1},{x:G,y:J-1},{width:ee,height:1}),Is.copy(j.data,O,{x:0,y:0},{x:G,y:J+ve},{width:ee,height:1}),Is.copy(j.data,O,{x:ee-1,y:0},{x:G-1,y:J},{width:1,height:ve}),Is.copy(j.data,O,{x:0,y:0},{x:G+ee,y:J},{width:1,height:ve})}this.image=O,this.iconPositions=g,this.patternPositions=w}addImages(s,d,g){for(const w in s){const E=s[w],C={x:0,y:0,w:E.data.width+2,h:E.data.height+2};g.push(C),d[w]=new Ma(C,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(w)}}patchUpdatedImages(s,d){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in s.updatedImages)this.patchUpdatedImage(this.iconPositions[g],s.getImage(g),d),this.patchUpdatedImage(this.patternPositions[g],s.getImage(g),d)}patchUpdatedImage(s,d,g){if(!s||!d||s.version===d.version)return;s.version=d.version;const[w,E]=s.tl;g.update(d.data,void 0,{x:w,y:E})}}jt("ImagePosition",Ma),jt("ImageAtlas",Gi),a.WritingMode=void 0,(Nl=a.WritingMode||(a.WritingMode={}))[Nl.none=0]="none",Nl[Nl.horizontal=1]="horizontal",Nl[Nl.vertical=2]="vertical",Nl[Nl.horizontalOnly=3]="horizontalOnly";const Tu=-17;class Su{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,d){const g=new Su;return g.scale=s||1,g.fontStack=d,g}static forImage(s){const d=new Su;return d.imageName=s,d}}class Zi{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,d){const g=new Zi;for(let w=0;w<s.sections.length;w++){const E=s.sections[w];E.image?g.addImageSection(E):g.addTextSection(E,d)}return g}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let d="";for(let g=0;g<s.length;g++){const w=s.charCodeAt(g+1)||null,E=s.charCodeAt(g-1)||null;d+=w&&Lo(w)&&!Dc[s[g+1]]||E&&Lo(E)&&!Dc[s[g-1]]||!Dc[s[g]]?s[g]:Dc[s[g]]}return d}(this.text)}trim(){let s=0;for(let g=0;g<this.text.length&&$h[this.text.charCodeAt(g)];g++)s++;let d=this.text.length;for(let g=this.text.length-1;g>=0&&g>=s&&$h[this.text.charCodeAt(g)];g--)d--;this.text=this.text.substring(s,d),this.sectionIndex=this.sectionIndex.slice(s,d)}substring(s,d){const g=new Zi;return g.text=this.text.substring(s,d),g.sectionIndex=this.sectionIndex.slice(s,d),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,d)=>Math.max(s,this.sections[d].scale),0)}addTextSection(s,d){this.text+=s.text,this.sections.push(Su.forText(s.scale,s.fontStack||d));const g=this.sections.length-1;for(let w=0;w<s.text.length;++w)this.sectionIndex.push(g)}addImageSection(s){const d=s.image?s.image.name:"";if(d.length===0)return void _e("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(Su.forImage(d)),this.sectionIndex.push(this.sections.length-1)):_e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wf(u,s,d,g,w,E,C,P,O,F,j,W,G,J,ee,ve){const ye=Zi.fromFeature(u,w);let Ne;W===a.WritingMode.vertical&&ye.verticalizePunctuation();const{processBidirectionalText:Ge,processStyledBidirectionalText:De}=dr;if(Ge&&ye.sections.length===1){Ne=[];const ut=Ge(ye.toString(),Pp(ye,F,E,s,g,J,ee));for(const Vt of ut){const Zt=new Zi;Zt.text=Vt,Zt.sections=ye.sections;for(let Bt=0;Bt<Vt.length;Bt++)Zt.sectionIndex.push(0);Ne.push(Zt)}}else if(De){Ne=[];const ut=De(ye.text,ye.sectionIndex,Pp(ye,F,E,s,g,J,ee));for(const Vt of ut){const Zt=new Zi;Zt.text=Vt[0],Zt.sectionIndex=Vt[1],Zt.sections=ye.sections,Ne.push(Zt)}}else Ne=function(ut,Vt){const Zt=[],Bt=ut.text;let Ct=0;for(const Et of Vt)Zt.push(ut.substring(Ct,Et)),Ct=Et;return Ct<Bt.length&&Zt.push(ut.substring(Ct,Bt.length)),Zt}(ye,Pp(ye,F,E,s,g,J,ee));const Xe=[],dt={positionedLines:Xe,text:ye.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(ut,Vt,Zt,Bt,Ct,Et,Nt,Pt,vt,Jt,Yt,xn){let ai=0,pi=Tu,or=0,Ks=0;const Qi=Pt==="right"?1:Pt==="left"?0:.5;let Ji=0;for(const Ui of Ct){Ui.trim();const Rr=Ui.getMaxScale(),kr=(Rr-1)*gr,yr={positionedGlyphs:[],lineOffset:0};ut.positionedLines[Ji]=yr;const Fr=yr.positionedGlyphs;let br=0;if(!Ui.length()){pi+=Et,++Ji;continue}for(let xr=0;xr<Ui.length();xr++){const An=Ui.getSection(xr),ys=Ui.getSectionIndex(xr),Ir=Ui.getCharCode(xr);let vr=0,On=null,Qs=null,vi=null,Go=gr;const Bs=!(vt===a.WritingMode.horizontal||!Yt&&!Br(Ir)||Yt&&($h[Ir]||(lr=Ir,It.Arabic(lr)||It["Arabic Supplement"](lr)||It["Arabic Extended-A"](lr)||It["Arabic Presentation Forms-A"](lr)||It["Arabic Presentation Forms-B"](lr))));if(An.imageName){const bs=Bt[An.imageName];if(!bs)continue;vi=An.imageName,ut.iconsInText=ut.iconsInText||!0,Qs=bs.paddedRect;const Ur=bs.displaySize;An.scale=An.scale*gr/xn,On={width:Ur[0],height:Ur[1],left:1,top:-3,advance:Bs?Ur[1]:Ur[0]},vr=kr+(gr-Ur[1]*An.scale),Go=On.advance;const fo=Bs?Ur[0]*An.scale-gr*Rr:Ur[1]*An.scale-gr*Rr;fo>0&&fo>br&&(br=fo)}else{const bs=Zt[An.fontStack],Ur=bs&&bs[Ir];if(Ur&&Ur.rect)Qs=Ur.rect,On=Ur.metrics;else{const fo=Vt[An.fontStack],Pu=fo&&fo[Ir];if(!Pu)continue;On=Pu.metrics}vr=(Rr-An.scale)*gr}Bs?(ut.verticalizable=!0,Fr.push({glyph:Ir,imageName:vi,x:ai,y:pi+vr,vertical:Bs,scale:An.scale,fontStack:An.fontStack,sectionIndex:ys,metrics:On,rect:Qs}),ai+=Go*An.scale+Jt):(Fr.push({glyph:Ir,imageName:vi,x:ai,y:pi+vr,vertical:Bs,scale:An.scale,fontStack:An.fontStack,sectionIndex:ys,metrics:On,rect:Qs}),ai+=On.advance*An.scale+Jt)}Fr.length!==0&&(or=Math.max(ai-Jt,or),Gs(Fr,0,Fr.length-1,Qi,br)),ai=0;const xi=Et*Rr+br;yr.lineOffset=Math.max(br,kr),pi+=xi,Ks=Math.max(xi,Ks),++Ji}var lr;const on=pi-Tu,{horizontalAlign:Cr,verticalAlign:Lr}=Hh(Nt);(function(Ui,Rr,kr,yr,Fr,br,xi,xr,An){const ys=(Rr-kr)*Fr;let Ir=0;Ir=br!==xi?-xr*yr-Tu:(-yr*An+.5)*xi;for(const vr of Ui)for(const On of vr.positionedGlyphs)On.x+=ys,On.y+=Ir})(ut.positionedLines,Qi,Cr,Lr,or,Ks,Et,on,Ct.length),ut.top+=-Lr*on,ut.bottom=ut.top+on,ut.left+=-Cr*or,ut.right=ut.left+or}(dt,s,d,g,Ne,C,P,O,W,F,G,ve),!function(ut){for(const Vt of ut)if(Vt.positionedGlyphs.length!==0)return!1;return!0}(Xe)&&dt}const $h={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Mi(u,s,d,g,w,E){if(s.imageName){const C=g[s.imageName];return C?C.displaySize[0]*s.scale*gr/E+w:0}{const C=d[s.fontStack],P=C&&C[u];return P?P.metrics.advance*s.scale+w:0}}function ms(u,s,d,g){const w=Math.pow(u-s,2);return g?u<s?w/2:2*w:w+Math.abs(d)*d}function Ho(u,s,d){let g=0;return u===10&&(g-=1e4),d&&(g+=150),u!==40&&u!==65288||(g+=50),s!==41&&s!==65289||(g+=50),g}function Ip(u,s,d,g,w,E){let C=null,P=ms(s,d,w,E);for(const O of g){const F=ms(s-O.x,d,w,E)+O.badness;F<=P&&(C=O,P=F)}return{index:u,x:s,priorBreak:C,badness:P}}function Mp(u){return u?Mp(u.priorBreak).concat(u.index):[]}function Pp(u,s,d,g,w,E,C){if(E!=="point")return[];if(!u)return[];const P=[],O=function(G,J,ee,ve,ye,Ne){let Ge=0;for(let De=0;De<G.length();De++){const Xe=G.getSection(De);Ge+=Mi(G.getCharCode(De),Xe,ve,ye,J,Ne)}return Ge/Math.max(1,Math.ceil(Ge/ee))}(u,s,d,g,w,C),F=u.text.indexOf("")>=0;let j=0;for(let G=0;G<u.length();G++){const J=u.getSection(G),ee=u.getCharCode(G);if($h[ee]||(j+=Mi(ee,J,g,w,s,C)),G<u.length()-1){const ve=!((W=ee)<11904||!(It["Bopomofo Extended"](W)||It.Bopomofo(W)||It["CJK Compatibility Forms"](W)||It["CJK Compatibility Ideographs"](W)||It["CJK Compatibility"](W)||It["CJK Radicals Supplement"](W)||It["CJK Strokes"](W)||It["CJK Symbols and Punctuation"](W)||It["CJK Unified Ideographs Extension A"](W)||It["CJK Unified Ideographs"](W)||It["Enclosed CJK Letters and Months"](W)||It["Halfwidth and Fullwidth Forms"](W)||It.Hiragana(W)||It["Ideographic Description Characters"](W)||It["Kangxi Radicals"](W)||It["Katakana Phonetic Extensions"](W)||It.Katakana(W)||It["Vertical Forms"](W)||It["Yi Radicals"](W)||It["Yi Syllables"](W)));(Tg[ee]||ve||J.imageName)&&P.push(Ip(G+1,j,O,P,Ho(ee,u.getCharCode(G+1),ve&&F),!1))}}var W;return Mp(Ip(u.length(),j,O,P,0,!0))}function Hh(u){let s=.5,d=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:s,verticalAlign:d}}function Gs(u,s,d,g,w){if(!g&&!w)return;const E=u[d],C=(u[d].x+E.metrics.advance*E.scale)*g;for(let P=s;P<=d;P++)u[P].x-=C,u[P].y+=w}function Pa(u,s,d){const{horizontalAlign:g,verticalAlign:w}=Hh(d),E=s[0]-u.displaySize[0]*g,C=s[1]-u.displaySize[1]*w;return{image:u,top:C,bottom:C+u.displaySize[1],left:E,right:E+u.displaySize[0]}}function Dp(u,s,d,g,w,E){const C=u.image;let P;if(C.content){const ye=C.content,Ne=C.pixelRatio||1;P=[ye[0]/Ne,ye[1]/Ne,C.displaySize[0]-ye[2]/Ne,C.displaySize[1]-ye[3]/Ne]}const O=s.left*E,F=s.right*E;let j,W,G,J;d==="width"||d==="both"?(J=w[0]+O-g[3],W=w[0]+F+g[1]):(J=w[0]+(O+F-C.displaySize[0])/2,W=J+C.displaySize[0]);const ee=s.top*E,ve=s.bottom*E;return d==="height"||d==="both"?(j=w[1]+ee-g[0],G=w[1]+ve+g[2]):(j=w[1]+(ee+ve-C.displaySize[1])/2,G=j+C.displaySize[1]),{image:C,top:j,right:W,bottom:G,left:J,collisionPadding:P}}const ar=128;function Op(u,s){const{expression:d}=s;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new ui(u+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:w}=d;let E=0;for(;E<g.length&&g[E]<=u;)E++;E=Math.max(0,E-1);let C=E;for(;C<g.length&&g[C]<u+1;)C++;C=Math.min(g.length-1,C);const P=g[E],O=g[C];return d.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:O,interpolationType:w}:{kind:"camera",minZoom:P,maxZoom:O,minSize:d.evaluate(new ui(P)),maxSize:d.evaluate(new ui(O)),interpolationType:w}}}class gs extends we{constructor(s,d,g,w){super(s,d),this.angle=g,w!==void 0&&(this.segment=w)}clone(){return new gs(this.x,this.y,this.angle,this.segment)}}function Fl(u,s,d,g,w){if(s.segment===void 0)return!0;let E=s,C=s.segment+1,P=0;for(;P>-d/2;){if(C--,C<0)return!1;P-=u[C].dist(E),E=u[C]}P+=u[C].dist(u[C+1]),C++;const O=[];let F=0;for(;P<d/2;){const j=u[C],W=u[C+1];if(!W)return!1;let G=u[C-1].angleTo(j)-j.angleTo(W);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:P,angleDelta:G}),F+=G;P-O[0].distance>g;)F-=O.shift().angleDelta;if(F>w)return!1;C++,P+=j.dist(W)}return!0}function qo(u){let s=0;for(let d=0;d<u.length-1;d++)s+=u[d].dist(u[d+1]);return s}function Xf(u,s,d){return u?.6*s*d:0}function Zf(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function lo(u,s,d,g,w,E){const C=Xf(d,w,E),P=Zf(d,g)*E;let O=0;const F=qo(u)/2;for(let j=0;j<u.length-1;j++){const W=u[j],G=u[j+1],J=W.dist(G);if(O+J>F){const ee=(F-O)/J,ve=Ti(W.x,G.x,ee),ye=Ti(W.y,G.y,ee),Ne=new gs(ve,ye,G.angleTo(W),j);return Ne._round(),!C||Fl(u,Ne,P,C,s)?Ne:void 0}O+=J}}function Sg(u,s,d,g,w,E,C,P,O){const F=Xf(g,E,C),j=Zf(g,w),W=j*C,G=u[0].x===0||u[0].x===O||u[0].y===0||u[0].y===O;return s-W<s/4&&(s=W+s/4),Oc(u,G?s/2*P%s:(j/2+2*E)*C*P%s,s,F,d,W,G,!1,O)}function Oc(u,s,d,g,w,E,C,P,O){const F=E/2,j=qo(u);let W=0,G=s-d,J=[];for(let ee=0;ee<u.length-1;ee++){const ve=u[ee],ye=u[ee+1],Ne=ve.dist(ye),Ge=ye.angleTo(ve);for(;G+d<W+Ne;){G+=d;const De=(G-W)/Ne,Xe=Ti(ve.x,ye.x,De),dt=Ti(ve.y,ye.y,De);if(Xe>=0&&Xe<O&&dt>=0&&dt<O&&G-F>=0&&G+F<=j){const ut=new gs(Xe,dt,Ge,ee);ut._round(),g&&!Fl(u,ut,E,g,w)||J.push(ut)}}W+=Ne}return P||J.length||C||(J=Oc(u,W/2,d,g,w,E,C,!0,O)),J}function Eu(u,s,d,g,w){const E=[];for(let C=0;C<u.length;C++){const P=u[C];let O;for(let F=0;F<P.length-1;F++){let j=P[F],W=P[F+1];j.x<s&&W.x<s||(j.x<s?j=new we(s,j.y+(s-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x<s&&(W=new we(s,j.y+(s-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y<d&&W.y<d||(j.y<d?j=new we(j.x+(d-j.y)/(W.y-j.y)*(W.x-j.x),d)._round():W.y<d&&(W=new we(j.x+(d-j.y)/(W.y-j.y)*(W.x-j.x),d)._round()),j.x>=g&&W.x>=g||(j.x>=g?j=new we(g,j.y+(g-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x>=g&&(W=new we(g,j.y+(g-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y>=w&&W.y>=w||(j.y>=w?j=new we(j.x+(w-j.y)/(W.y-j.y)*(W.x-j.x),w)._round():W.y>=w&&(W=new we(j.x+(w-j.y)/(W.y-j.y)*(W.x-j.x),w)._round()),O&&j.equals(O[O.length-1])||(O=[j],E.push(O)),O.push(W)))))}}return E}function Au(u,s,d,g){const w=[],E=u.image,C=E.pixelRatio,P=E.paddedRect.w-2,O=E.paddedRect.h-2,F=u.right-u.left,j=u.bottom-u.top,W=E.stretchX||[[0,P]],G=E.stretchY||[[0,O]],J=(Et,Nt)=>Et+Nt[1]-Nt[0],ee=W.reduce(J,0),ve=G.reduce(J,0),ye=P-ee,Ne=O-ve;let Ge=0,De=ee,Xe=0,dt=ve,ut=0,Vt=ye,Zt=0,Bt=Ne;if(E.content&&g){const Et=E.content;Ge=Wo(W,0,Et[0]),Xe=Wo(G,0,Et[1]),De=Wo(W,Et[0],Et[2]),dt=Wo(G,Et[1],Et[3]),ut=Et[0]-Ge,Zt=Et[1]-Xe,Vt=Et[2]-Et[0]-De,Bt=Et[3]-Et[1]-dt}const Ct=(Et,Nt,Pt,vt)=>{const Jt=qh(Et.stretch-Ge,De,F,u.left),Yt=Ul(Et.fixed-ut,Vt,Et.stretch,ee),xn=qh(Nt.stretch-Xe,dt,j,u.top),ai=Ul(Nt.fixed-Zt,Bt,Nt.stretch,ve),pi=qh(Pt.stretch-Ge,De,F,u.left),or=Ul(Pt.fixed-ut,Vt,Pt.stretch,ee),Ks=qh(vt.stretch-Xe,dt,j,u.top),Qi=Ul(vt.fixed-Zt,Bt,vt.stretch,ve),Ji=new we(Jt,xn),lr=new we(pi,xn),on=new we(pi,Ks),Cr=new we(Jt,Ks),Lr=new we(Yt/C,ai/C),Ui=new we(or/C,Qi/C),Rr=s*Math.PI/180;if(Rr){const Fr=Math.sin(Rr),br=Math.cos(Rr),xi=[br,-Fr,Fr,br];Ji._matMult(xi),lr._matMult(xi),Cr._matMult(xi),on._matMult(xi)}const kr=Et.stretch+Et.fixed,yr=Nt.stretch+Nt.fixed;return{tl:Ji,tr:lr,bl:Cr,br:on,tex:{x:E.paddedRect.x+1+kr,y:E.paddedRect.y+1+yr,w:Pt.stretch+Pt.fixed-kr,h:vt.stretch+vt.fixed-yr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:Ui,minFontScaleX:Vt/C/F,minFontScaleY:Bt/C/j,isSDF:d}};if(g&&(E.stretchX||E.stretchY)){const Et=Bp(W,ye,ee),Nt=Bp(G,Ne,ve);for(let Pt=0;Pt<Et.length-1;Pt++){const vt=Et[Pt],Jt=Et[Pt+1];for(let Yt=0;Yt<Nt.length-1;Yt++)w.push(Ct(vt,Nt[Yt],Jt,Nt[Yt+1]))}}else w.push(Ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:O+1}));return w}function Wo(u,s,d){let g=0;for(const w of u)g+=Math.max(s,Math.min(d,w[1]))-Math.max(s,Math.min(d,w[0]));return g}function Bp(u,s,d){const g=[{fixed:-1,stretch:0}];for(const[w,E]of u){const C=g[g.length-1];g.push({fixed:w-C.stretch,stretch:C.stretch}),g.push({fixed:w-C.stretch,stretch:C.stretch+(E-w)})}return g.push({fixed:s+1,stretch:d}),g}function qh(u,s,d,g){return u/s*d+g}function Ul(u,s,d,g){return u-s*d/g}jt("Anchor",gs);class Wh{constructor(s,d,g,w,E,C,P,O,F,j){if(this.boxStartIndex=s.length,F){let W=C.top,G=C.bottom;const J=C.collisionPadding;J&&(W-=J[1],G+=J[3]);let ee=G-W;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{let W=C.top*P-O[0],G=C.bottom*P+O[2],J=C.left*P-O[3],ee=C.right*P+O[1];const ve=C.collisionPadding;if(ve&&(J-=ve[0]*P,W-=ve[1]*P,ee+=ve[2]*P,G+=ve[3]*P),j){const ye=new we(J,W),Ne=new we(ee,W),Ge=new we(J,G),De=new we(ee,G),Xe=j*Math.PI/180;ye._rotate(Xe),Ne._rotate(Xe),Ge._rotate(Xe),De._rotate(Xe),J=Math.min(ye.x,Ne.x,Ge.x,De.x),ee=Math.max(ye.x,Ne.x,Ge.x,De.x),W=Math.min(ye.y,Ne.y,Ge.y,De.y),G=Math.max(ye.y,Ne.y,Ge.y,De.y)}s.emplaceBack(d.x,d.y,J,W,ee,G,g,w,E)}this.boxEndIndex=s.length}}class Yf{constructor(s=[],d=Eg){if(this.data=s,this.length=this.data.length,this.compare=d,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:d,compare:g}=this,w=d[s];for(;s>0;){const E=s-1>>1,C=d[E];if(g(w,C)>=0)break;d[s]=C,s=E}d[s]=w}_down(s){const{data:d,compare:g}=this,w=this.length>>1,E=d[s];for(;s<w;){let C=1+(s<<1),P=d[C];const O=C+1;if(O<this.length&&g(d[O],P)<0&&(C=O,P=d[O]),g(P,E)>=0)break;d[s]=P,s=C}d[s]=E}}function Eg(u,s){return u<s?-1:u>s?1:0}function cy(u,s=1,d=!1){let g=1/0,w=1/0,E=-1/0,C=-1/0;const P=u[0];for(let J=0;J<P.length;J++){const ee=P[J];(!J||ee.x<g)&&(g=ee.x),(!J||ee.y<w)&&(w=ee.y),(!J||ee.x>E)&&(E=ee.x),(!J||ee.y>C)&&(C=ee.y)}const O=Math.min(E-g,C-w);let F=O/2;const j=new Yf([],uy);if(O===0)return new we(g,w);for(let J=g;J<E;J+=O)for(let ee=w;ee<C;ee+=O)j.push(new Zn(J+F,ee+F,F,u));let W=function(J){let ee=0,ve=0,ye=0;const Ne=J[0];for(let Ge=0,De=Ne.length,Xe=De-1;Ge<De;Xe=Ge++){const dt=Ne[Ge],ut=Ne[Xe],Vt=dt.x*ut.y-ut.x*dt.y;ve+=(dt.x+ut.x)*Vt,ye+=(dt.y+ut.y)*Vt,ee+=3*Vt}return new Zn(ve/ee,ye/ee,0,J)}(u),G=j.length;for(;j.length;){const J=j.pop();(J.d>W.d||!W.d)&&(W=J,d&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,G)),J.max-W.d<=s||(F=J.h/2,j.push(new Zn(J.p.x-F,J.p.y-F,F,u)),j.push(new Zn(J.p.x+F,J.p.y-F,F,u)),j.push(new Zn(J.p.x-F,J.p.y+F,F,u)),j.push(new Zn(J.p.x+F,J.p.y+F,F,u)),G+=4)}return d&&(console.log(`num probes: ${G}`),console.log(`best distance: ${W.d}`)),W.p}function uy(u,s){return s.max-u.max}function Zn(u,s,d,g){this.p=new we(u,s),this.h=d,this.d=function(w,E){let C=!1,P=1/0;for(let O=0;O<E.length;O++){const F=E[O];for(let j=0,W=F.length,G=W-1;j<W;G=j++){const J=F[j],ee=F[G];J.y>w.y!=ee.y>w.y&&w.x<(ee.x-J.x)*(w.y-J.y)/(ee.y-J.y)+J.x&&(C=!C),P=Math.min(P,If(w,J,ee))}}return(C?1:-1)*Math.sqrt(P)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}const yi=Number.POSITIVE_INFINITY;function Ln(u,s){return s[1]!==yi?function(d,g,w){let E=0,C=0;switch(g=Math.abs(g),w=Math.abs(w),d){case"top-right":case"top-left":case"top":C=w-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-w}switch(d){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,C]}(u,s[0],s[1]):function(d,g){let w=0,E=0;g<0&&(g=0);const C=g/Math.sqrt(2);switch(d){case"top-right":case"top-left":E=C-7;break;case"bottom-right":case"bottom-left":E=7-C;break;case"bottom":E=7-g;break;case"top":E=g-7}switch(d){case"top-right":case"bottom-right":w=-C;break;case"top-left":case"bottom-left":w=C;break;case"left":w=g;break;case"right":w=-g}return[w,E]}(u,s[0])}function Hn(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function di(u,s,d,g,w,E,C,P,O,F,j){let W=E.textMaxSize.evaluate(s,{});W===void 0&&(W=C);const G=u.layers[0].layout,J=G.get("icon-offset").evaluate(s,{},j),ee=Bc(d.horizontal),ve=C/24,ye=u.tilePixelRatio*ve,Ne=u.tilePixelRatio*W/24,Ge=u.tilePixelRatio*P,De=u.tilePixelRatio*G.get("symbol-spacing"),Xe=G.get("text-padding")*u.tilePixelRatio,dt=function(vt,Jt,Yt,xn=1){const ai=vt.get("icon-padding").evaluate(Jt,{},Yt),pi=ai&&ai.values;return[pi[0]*xn,pi[1]*xn,pi[2]*xn,pi[3]*xn]}(G,s,j,u.tilePixelRatio),ut=G.get("text-max-angle")/180*Math.PI,Vt=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",Zt=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",Bt=G.get("symbol-placement"),Ct=De/2,Et=G.get("icon-text-fit");let Nt;g&&Et!=="none"&&(u.allowVerticalPlacement&&d.vertical&&(Nt=Dp(g,d.vertical,Et,G.get("icon-text-fit-padding"),J,ve)),ee&&(g=Dp(g,ee,Et,G.get("icon-text-fit-padding"),J,ve)));const Pt=(vt,Jt)=>{Jt.x<0||Jt.x>=kn||Jt.y<0||Jt.y>=kn||function(Yt,xn,ai,pi,or,Ks,Qi,Ji,lr,on,Cr,Lr,Ui,Rr,kr,yr,Fr,br,xi,xr,An,ys,Ir,vr,On){const Qs=Yt.addToLineVertexArray(xn,ai);let vi,Go,Bs,bs,Ur=0,fo=0,Pu=0,id=0,Kh=-1,$p=-1;const po={};let Rg=hi.exports(""),rd=0,Hp=0;if(Ji._unevaluatedLayout.getValue("text-radial-offset")===void 0?[rd,Hp]=Ji.layout.get("text-offset").evaluate(An,{},vr).map(Mr=>Mr*gr):(rd=Ji.layout.get("text-radial-offset").evaluate(An,{},vr)*gr,Hp=yi),Yt.allowVerticalPlacement&&pi.vertical){const Mr=Ji.layout.get("text-rotate").evaluate(An,{},vr)+90;Bs=new Wh(lr,xn,on,Cr,Lr,pi.vertical,Ui,Rr,kr,Mr),Qi&&(bs=new Wh(lr,xn,on,Cr,Lr,Qi,Fr,br,kr,Mr))}if(or){const Mr=Ji.layout.get("icon-rotate").evaluate(An,{}),cr=Ji.layout.get("icon-text-fit")!=="none",Du=Au(or,Mr,Ir,cr),Xl=Qi?Au(Qi,Mr,Ir,cr):void 0;Go=new Wh(lr,xn,on,Cr,Lr,or,Fr,br,!1,Mr),Ur=4*Du.length;const mo=Yt.iconSizeData;let zc=null;mo.kind==="source"?(zc=[ar*Ji.layout.get("icon-size").evaluate(An,{})],zc[0]>_r&&_e(`${Yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):mo.kind==="composite"&&(zc=[ar*ys.compositeIconSizes[0].evaluate(An,{},vr),ar*ys.compositeIconSizes[1].evaluate(An,{},vr)],(zc[0]>_r||zc[1]>_r)&&_e(`${Yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Yt.addSymbols(Yt.icon,Du,zc,xr,xi,An,a.WritingMode.none,xn,Qs.lineStartIndex,Qs.lineLength,-1,vr),Kh=Yt.icon.placedSymbolArray.length-1,Xl&&(fo=4*Xl.length,Yt.addSymbols(Yt.icon,Xl,zc,xr,xi,An,a.WritingMode.vertical,xn,Qs.lineStartIndex,Qs.lineLength,-1,vr),$p=Yt.icon.placedSymbolArray.length-1)}const kg=Object.keys(pi.horizontal);for(const Mr of kg){const cr=pi.horizontal[Mr];if(!vi){Rg=hi.exports(cr.text);const Xl=Ji.layout.get("text-rotate").evaluate(An,{},vr);vi=new Wh(lr,xn,on,Cr,Lr,cr,Ui,Rr,kr,Xl)}const Du=cr.positionedLines.length===1;if(Pu+=Xo(Yt,xn,cr,Ks,Ji,kr,An,yr,Qs,pi.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,Du?kg:[Mr],po,Kh,ys,vr),Du)break}pi.vertical&&(id+=Xo(Yt,xn,pi.vertical,Ks,Ji,kr,An,yr,Qs,a.WritingMode.vertical,["vertical"],po,$p,ys,vr));const Wl=vi?vi.boxStartIndex:Yt.collisionBoxArray.length,Ig=vi?vi.boxEndIndex:Yt.collisionBoxArray.length,qp=Bs?Bs.boxStartIndex:Yt.collisionBoxArray.length,fy=Bs?Bs.boxEndIndex:Yt.collisionBoxArray.length,dy=Go?Go.boxStartIndex:Yt.collisionBoxArray.length,Wp=Go?Go.boxEndIndex:Yt.collisionBoxArray.length,py=bs?bs.boxStartIndex:Yt.collisionBoxArray.length,Oa=bs?bs.boxEndIndex:Yt.collisionBoxArray.length;let Js=-1;const Qh=(Mr,cr)=>Mr&&Mr.circleDiameter?Math.max(Mr.circleDiameter,cr):cr;Js=Qh(vi,Js),Js=Qh(Bs,Js),Js=Qh(Go,Js),Js=Qh(bs,Js);const Xp=Js>-1?1:0;Xp&&(Js*=On/gr),Yt.glyphOffsetArray.length>=co.MAX_GLYPHS&&_e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),An.sortKey!==void 0&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,An.sortKey),Yt.symbolInstances.emplaceBack(xn.x,xn.y,po.right>=0?po.right:-1,po.center>=0?po.center:-1,po.left>=0?po.left:-1,po.vertical||-1,Kh,$p,Rg,Wl,Ig,qp,fy,dy,Wp,py,Oa,on,Pu,id,Ur,fo,Xp,0,Ui,rd,Hp,Js)}(u,Jt,vt,d,g,w,Nt,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,ye,[Xe,Xe,Xe,Xe],Vt,O,Ge,dt,Zt,J,s,E,F,j,C)};if(Bt==="line")for(const vt of Eu(s.geometry,0,0,kn,kn)){const Jt=Sg(vt,De,ut,d.vertical||ee,g,24,Ne,u.overscaling,kn);for(const Yt of Jt){const xn=ee;xn&&Np(u,xn.text,Ct,Yt)||Pt(vt,Yt)}}else if(Bt==="line-center"){for(const vt of s.geometry)if(vt.length>1){const Jt=lo(vt,ut,d.vertical||ee,g,24,Ne);Jt&&Pt(vt,Jt)}}else if(s.type==="Polygon")for(const vt of bu(s.geometry,0)){const Jt=cy(vt,16);Pt(vt[0],new gs(Jt.x,Jt.y,0))}else if(s.type==="LineString")for(const vt of s.geometry)Pt(vt,new gs(vt[0].x,vt[0].y,0));else if(s.type==="Point")for(const vt of s.geometry)for(const Jt of vt)Pt([Jt],new gs(Jt.x,Jt.y,0))}const _r=32640;function Xo(u,s,d,g,w,E,C,P,O,F,j,W,G,J,ee){const ve=function(Ge,De,Xe,dt,ut,Vt,Zt,Bt){const Ct=dt.layout.get("text-rotate").evaluate(Vt,{})*Math.PI/180,Et=[];for(const Nt of De.positionedLines)for(const Pt of Nt.positionedGlyphs){if(!Pt.rect)continue;const vt=Pt.rect||{};let Jt=4,Yt=!0,xn=1,ai=0;const pi=(ut||Bt)&&Pt.vertical,or=Pt.metrics.advance*Pt.scale/2;if(Bt&&De.verticalizable){const xi=(Pt.scale-1)*gr,xr=(gr-Pt.metrics.width*Pt.scale)/2;ai=Nt.lineOffset/2-(Pt.imageName?-xr:xi)}if(Pt.imageName){const xi=Zt[Pt.imageName];Yt=xi.sdf,xn=xi.pixelRatio,Jt=1/xn}const Ks=ut?[Pt.x+or,Pt.y]:[0,0];let Qi=ut?[0,0]:[Pt.x+or+Xe[0],Pt.y+Xe[1]-ai],Ji=[0,0];pi&&(Ji=Qi,Qi=[0,0]);const lr=(Pt.metrics.left-Jt)*Pt.scale-or+Qi[0],on=(-Pt.metrics.top-Jt)*Pt.scale+Qi[1],Cr=lr+vt.w*Pt.scale/xn,Lr=on+vt.h*Pt.scale/xn,Ui=new we(lr,on),Rr=new we(Cr,on),kr=new we(lr,Lr),yr=new we(Cr,Lr);if(pi){const xi=new we(-or,or-Tu),xr=-Math.PI/2,An=12-or,ys=new we(22-An,-(Pt.imageName?An:0)),Ir=new we(...Ji);Ui._rotateAround(xr,xi)._add(ys)._add(Ir),Rr._rotateAround(xr,xi)._add(ys)._add(Ir),kr._rotateAround(xr,xi)._add(ys)._add(Ir),yr._rotateAround(xr,xi)._add(ys)._add(Ir)}if(Ct){const xi=Math.sin(Ct),xr=Math.cos(Ct),An=[xr,-xi,xi,xr];Ui._matMult(An),Rr._matMult(An),kr._matMult(An),yr._matMult(An)}const Fr=new we(0,0),br=new we(0,0);Et.push({tl:Ui,tr:Rr,bl:kr,br:yr,tex:vt,writingMode:De.writingMode,glyphOffset:Ks,sectionIndex:Pt.sectionIndex,isSDF:Yt,pixelOffsetTL:Fr,pixelOffsetBR:br,minFontScaleX:0,minFontScaleY:0})}return Et}(0,d,P,w,E,C,g,u.allowVerticalPlacement),ye=u.textSizeData;let Ne=null;ye.kind==="source"?(Ne=[ar*w.layout.get("text-size").evaluate(C,{})],Ne[0]>_r&&_e(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ye.kind==="composite"&&(Ne=[ar*J.compositeTextSizes[0].evaluate(C,{},ee),ar*J.compositeTextSizes[1].evaluate(C,{},ee)],(Ne[0]>_r||Ne[1]>_r)&&_e(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,ve,Ne,P,E,C,F,s,O.lineStartIndex,O.lineLength,G,ee);for(const Ge of j)W[Ge]=u.text.placedSymbolArray.length-1;return 4*ve.length}function Bc(u){for(const s in u)return u[s];return null}function Np(u,s,d,g){const w=u.compareText;if(s in w){const E=w[s];for(let C=E.length-1;C>=0;C--)if(g.dist(E[C])<d)return!0}else w[s]=[];return w[s].push(g),!1}const Zo=$o.VectorTileFeature.types,Ki=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Da(u,s,d,g,w,E,C,P,O,F,j,W,G){const J=P?Math.min(_r,Math.round(P[0])):0,ee=P?Math.min(_r,Math.round(P[1])):0;u.emplaceBack(s,d,Math.round(32*g),Math.round(32*w),E,C,(J<<1)+(O?1:0),ee,16*F,16*j,256*W,256*G)}function Yo(u,s,d){u.emplaceBack(s.x,s.y,d),u.emplaceBack(s.x,s.y,d),u.emplaceBack(s.x,s.y,d),u.emplaceBack(s.x,s.y,d)}function zp(u){for(const s of u.sections)if(uu(s.text))return!0;return!1}class Ms{constructor(s){this.layoutVertexArray=new Nr,this.indexArray=new Xi,this.programConfigurations=s,this.segments=new Dn,this.dynamicLayoutVertexArray=new As,this.opacityVertexArray=new Cs,this.placedSymbolArray=new st}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,d,g,w){this.isEmpty()||(g&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,bp.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,xp.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Ki,!0),this.opacityVertexBuffer.itemSize=1),(g||w)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}jt("SymbolBuffers",Ms);class Vl{constructor(s,d,g){this.layoutVertexArray=new s,this.layoutAttributes=d,this.indexArray=new g,this.segments=new Dn,this.collisionVertexArray=new Qa}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,vp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}jt("CollisionBuffers",Vl);class co{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(C=>C.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pf([]),this.placementViewportMatrix=Pf([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Op(this.zoom,d["text-size"]),this.iconSizeData=Op(this.zoom,d["icon-size"]);const g=this.layers[0].layout,w=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=Cu(g,"text-overlap","text-allow-overlap")!=="never"||Cu(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!w.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(C=>a.WritingMode[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=s.sourceID}createArrays(){this.text=new Ms(new Ia(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Ms(new Ia(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new Mt,this.lineVertexArray=new kt,this.symbolInstances=new Qe}calculateGlyphDependencies(s,d,g,w,E){for(let C=0;C<s.length;C++)if(d[s.charCodeAt(C)]=!0,(g||w)&&E){const P=Dc[s.charAt(C)];P&&(d[P.charCodeAt(0)]=!0)}}populate(s,d,g){const w=this.layers[0],E=w.layout,C=E.get("text-font"),P=E.get("text-field"),O=E.get("icon-image"),F=(P.value.kind!=="constant"||P.value.value instanceof Ae&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),j=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,W=E.get("symbol-sort-key");if(this.features=[],!F&&!j)return;const G=d.iconDependencies,J=d.glyphDependencies,ee=d.availableImages,ve=new ui(this.zoom);for(const{feature:ye,id:Ne,index:Ge,sourceLayerIndex:De}of s){const Xe=w._featureFilter.needGeometry,dt=Cl(ye,Xe);if(!w._featureFilter.filter(ve,dt,g))continue;let ut,Vt;if(Xe||(dt.geometry=Al(ye)),F){const Bt=w.getValueAndResolveTokens("text-field",dt,g,ee),Ct=Ae.factory(Bt);zp(Ct)&&(this.hasRTLText=!0),(!this.hasRTLText||fu()==="unavailable"||this.hasRTLText&&dr.isParsed())&&(ut=$f(Ct,w,dt))}if(j){const Bt=w.getValueAndResolveTokens("icon-image",dt,g,ee);Vt=Bt instanceof xe?Bt:xe.fromString(Bt)}if(!ut&&!Vt)continue;const Zt=this.sortFeaturesByKey?W.evaluate(dt,{},g):void 0;if(this.features.push({id:Ne,text:ut,icon:Vt,index:Ge,sourceLayerIndex:De,geometry:dt.geometry,properties:ye.properties,type:Zo[ye.type],sortKey:Zt}),Vt&&(G[Vt.name]=!0),ut){const Bt=C.evaluate(dt,{},g).join(","),Ct=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const Et of ut.sections)if(Et.image)G[Et.image.name]=!0;else{const Nt=ds(ut.toString()),Pt=Et.fontStack||Bt,vt=J[Pt]=J[Pt]||{};this.calculateGlyphDependencies(Et.text,vt,Ct,this.allowVerticalPlacement,Nt)}}}E.get("symbol-placement")==="line"&&(this.features=function(ye){const Ne={},Ge={},De=[];let Xe=0;function dt(Bt){De.push(ye[Bt]),Xe++}function ut(Bt,Ct,Et){const Nt=Ge[Bt];return delete Ge[Bt],Ge[Ct]=Nt,De[Nt].geometry[0].pop(),De[Nt].geometry[0]=De[Nt].geometry[0].concat(Et[0]),Nt}function Vt(Bt,Ct,Et){const Nt=Ne[Ct];return delete Ne[Ct],Ne[Bt]=Nt,De[Nt].geometry[0].shift(),De[Nt].geometry[0]=Et[0].concat(De[Nt].geometry[0]),Nt}function Zt(Bt,Ct,Et){const Nt=Et?Ct[0][Ct[0].length-1]:Ct[0][0];return`${Bt}:${Nt.x}:${Nt.y}`}for(let Bt=0;Bt<ye.length;Bt++){const Ct=ye[Bt],Et=Ct.geometry,Nt=Ct.text?Ct.text.toString():null;if(!Nt){dt(Bt);continue}const Pt=Zt(Nt,Et),vt=Zt(Nt,Et,!0);if(Pt in Ge&&vt in Ne&&Ge[Pt]!==Ne[vt]){const Jt=Vt(Pt,vt,Et),Yt=ut(Pt,vt,De[Jt].geometry);delete Ne[Pt],delete Ge[vt],Ge[Zt(Nt,De[Yt].geometry,!0)]=Yt,De[Jt].geometry=null}else Pt in Ge?ut(Pt,vt,Et):vt in Ne?Vt(Pt,vt,Et):(dt(Bt),Ne[Pt]=Xe-1,Ge[vt]=Xe-1)}return De.filter(Bt=>Bt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ye,Ne)=>ye.sortKey-Ne.sortKey)}update(s,d,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,d,this.layers,g),this.icon.programConfigurations.updatePaintArrays(s,d,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,d){const g=this.lineVertexArray.length;if(s.segment!==void 0){let w=s.dist(d[s.segment+1]),E=s.dist(d[s.segment]);const C={};for(let P=s.segment+1;P<d.length;P++)C[P]={x:d[P].x,y:d[P].y,tileUnitDistanceFromAnchor:w},P<d.length-1&&(w+=d[P+1].dist(d[P]));for(let P=s.segment||0;P>=0;P--)C[P]={x:d[P].x,y:d[P].y,tileUnitDistanceFromAnchor:E},P>0&&(E+=d[P-1].dist(d[P]));for(let P=0;P<d.length;P++){const O=C[P];this.lineVertexArray.emplaceBack(O.x,O.y,O.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(s,d,g,w,E,C,P,O,F,j,W,G){const J=s.indexArray,ee=s.layoutVertexArray,ve=s.segments.prepareSegment(4*d.length,ee,J,this.canOverlap?C.sortKey:void 0),ye=this.glyphOffsetArray.length,Ne=ve.vertexLength,Ge=this.allowVerticalPlacement&&P===a.WritingMode.vertical?Math.PI/2:0,De=C.text&&C.text.sections;for(let Xe=0;Xe<d.length;Xe++){const{tl:dt,tr:ut,bl:Vt,br:Zt,tex:Bt,pixelOffsetTL:Ct,pixelOffsetBR:Et,minFontScaleX:Nt,minFontScaleY:Pt,glyphOffset:vt,isSDF:Jt,sectionIndex:Yt}=d[Xe],xn=ve.vertexLength,ai=vt[1];Da(ee,O.x,O.y,dt.x,ai+dt.y,Bt.x,Bt.y,g,Jt,Ct.x,Ct.y,Nt,Pt),Da(ee,O.x,O.y,ut.x,ai+ut.y,Bt.x+Bt.w,Bt.y,g,Jt,Et.x,Ct.y,Nt,Pt),Da(ee,O.x,O.y,Vt.x,ai+Vt.y,Bt.x,Bt.y+Bt.h,g,Jt,Ct.x,Et.y,Nt,Pt),Da(ee,O.x,O.y,Zt.x,ai+Zt.y,Bt.x+Bt.w,Bt.y+Bt.h,g,Jt,Et.x,Et.y,Nt,Pt),Yo(s.dynamicLayoutVertexArray,O,Ge),J.emplaceBack(xn,xn+1,xn+2),J.emplaceBack(xn+1,xn+2,xn+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(vt[0]),Xe!==d.length-1&&Yt===d[Xe+1].sectionIndex||s.programConfigurations.populatePaintArrays(ee.length,C,C.index,{},G,De&&De[Yt])}s.placedSymbolArray.emplaceBack(O.x,O.y,ye,this.glyphOffsetArray.length-ye,Ne,F,j,O.segment,g?g[0]:0,g?g[1]:0,w[0],w[1],P,0,!1,0,W)}_addCollisionDebugVertex(s,d,g,w,E,C){return d.emplaceBack(0,0),s.emplaceBack(g.x,g.y,w,E,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(s,d,g,w,E,C,P){const O=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=O.vertexLength,j=E.layoutVertexArray,W=E.collisionVertexArray,G=P.anchorX,J=P.anchorY;this._addCollisionDebugVertex(j,W,C,G,J,new we(s,d)),this._addCollisionDebugVertex(j,W,C,G,J,new we(g,d)),this._addCollisionDebugVertex(j,W,C,G,J,new we(g,w)),this._addCollisionDebugVertex(j,W,C,G,J,new we(s,w)),O.vertexLength+=4;const ee=E.indexArray;ee.emplaceBack(F,F+1),ee.emplaceBack(F+1,F+2),ee.emplaceBack(F+2,F+3),ee.emplaceBack(F+3,F),O.primitiveLength+=4}addDebugCollisionBoxes(s,d,g,w){for(let E=s;E<d;E++){const C=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,w?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vl(as,wp.members,Rs),this.iconCollisionBox=new Vl(as,wp.members,Rs);for(let s=0;s<this.symbolInstances.length;s++){const d=this.symbolInstances.get(s);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(s,d,g,w,E,C,P,O,F){const j={};for(let W=d;W<g;W++){const G=s.get(W);j.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},j.textFeatureIndex=G.featureIndex;break}for(let W=w;W<E;W++){const G=s.get(W);j.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},j.verticalTextFeatureIndex=G.featureIndex;break}for(let W=C;W<P;W++){const G=s.get(W);j.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},j.iconFeatureIndex=G.featureIndex;break}for(let W=O;W<F;W++){const G=s.get(W);j.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},j.verticalIconFeatureIndex=G.featureIndex;break}return j}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,d){const g=s.placedSymbolArray.get(d),w=g.vertexStartIndex+4*g.numGlyphs;for(let E=g.vertexStartIndex;E<w;E+=4)s.indexArray.emplaceBack(E,E+1,E+2),s.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(s),g=Math.cos(s),w=[],E=[],C=[];for(let P=0;P<this.symbolInstances.length;++P){C.push(P);const O=this.symbolInstances.get(P);w.push(0|Math.round(d*O.anchorX+g*O.anchorY)),E.push(O.featureIndex)}return C.sort((P,O)=>w[P]-w[O]||E[O]-E[P]),C}addToSortKeyRanges(s,d){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===d?g.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const g=this.symbolInstances.get(d);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((w,E,C)=>{w>=0&&C.indexOf(w)===E&&this.addIndicesForPlacedSymbol(this.text,w)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}jt("SymbolBucket",co,{omit:["layers","collisionBoxArray","features","compareText"]}),co.MAX_GLYPHS=65535,co.addDynamicAttributes=Yo;const Ps=new qi({"symbol-placement":new $t(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(Ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $t(Ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $t(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Ee.layout_symbol["icon-size"]),"icon-text-fit":new $t(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Ee.layout_symbol["icon-image"]),"icon-rotate":new Gt(Ee.layout_symbol["icon-rotate"]),"icon-padding":new Gt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Ee.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Ee.layout_symbol["text-field"]),"text-font":new Gt(Ee.layout_symbol["text-font"]),"text-size":new Gt(Ee.layout_symbol["text-size"]),"text-max-width":new Gt(Ee.layout_symbol["text-max-width"]),"text-line-height":new $t(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Ee.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(Ee.layout_symbol["text-anchor"]),"text-max-angle":new $t(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Ee.layout_symbol["text-rotate"]),"text-padding":new $t(Ee.layout_symbol["text-padding"]),"text-keep-upright":new $t(Ee.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Ee.layout_symbol["text-transform"]),"text-offset":new Gt(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new $t(Ee.layout_symbol["text-allow-overlap"]),"text-overlap":new $t(Ee.layout_symbol["text-overlap"]),"text-ignore-placement":new $t(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new $t(Ee.layout_symbol["text-optional"])});var Xh={paint:new qi({"icon-opacity":new Gt(Ee.paint_symbol["icon-opacity"]),"icon-color":new Gt(Ee.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(Ee.paint_symbol["text-opacity"]),"text-color":new Gt(Ee.paint_symbol["text-color"],{runtimeType:Dr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Gt(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Ee.paint_symbol["text-halo-blur"]),"text-translate":new $t(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new $t(Ee.paint_symbol["text-translate-anchor"])}),layout:Ps};class Gf{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:li,this.defaultValue=s}evaluate(s){if(s.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(s.formattedSection))return d.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt("FormatSectionOverride",Gf,{omit:["defaultValue"]});class Nc extends Vn{constructor(s){super(s,Xh)}recalculate(s,d){if(super.recalculate(s,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const w=[];for(const E of g)w.indexOf(E)<0&&w.push(E);this.layout._values["text-writing-mode"]=w}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,d,g,w){const E=this.layout.get(s).evaluate(d,{},g,w),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||dl(C.value)||!E?E:function(P,O){return O.replace(/{([^{}]+)}/g,(F,j)=>j in P?String(P[j]):"")}(d.properties,E)}createBucket(s){return new co(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Xh.paint.overridableProperties){if(!Nc.hasPaintOverride(this.layout,s))continue;const d=this.paint.get(s),g=new Gf(d),w=new Jc(g,d.property.specification);let E=null;E=d.value.kind==="constant"||d.value.kind==="source"?new dc("source",w):new ml("composite",w,d.value.zoomStops),this.paint._values[s]=new Hi(d.property,E,d.parameters)}}_handleOverridablePaintPropertyUpdate(s,d,g){return!(!this.layout||d.isDataDriven()||g.isDataDriven())&&Nc.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,d){const g=s.get("text-field"),w=Xh.paint.properties[d];let E=!1;const C=P=>{for(const O of P)if(w.overrides&&w.overrides.hasOverride(O))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Ae)C(g.value.value.sections);else if(g.value.kind==="source"){const P=F=>{E||(F instanceof Ft&&ct(F.value)===oa?C(F.value.sections):F instanceof fc?C(F.sections):F.eachChild(P))},O=g.value;O._styleExpression&&P(O._styleExpression.expression)}return E}}function Cu(u,s,d){let g="never";const w=u.get(s);return w?g=w:u.get(d)&&(g="always"),g}var jl={paint:new qi({"background-color":new $t(Ee.paint_background["background-color"]),"background-pattern":new wl(Ee.paint_background["background-pattern"]),"background-opacity":new $t(Ee.paint_background["background-opacity"])})},Qr={paint:new qi({"raster-opacity":new $t(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(Ee.paint_raster["raster-saturation"]),"raster-contrast":new $t(Ee.paint_raster["raster-contrast"]),"raster-resampling":new $t(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(Ee.paint_raster["raster-fade-duration"])})};class $l extends Vn{constructor(s){super(s,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Ru={circle:class extends Vn{constructor(u){super(u,Gm)}createBucket(u){return new Sh(u)}queryRadius(u){const s=u;return kc("circle-radius",this,s)+kc("circle-stroke-width",this,s)+Ch(this.paint.get("circle-translate"))}queryIntersectsFeature(u,s,d,g,w,E,C,P){const O=Rh(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),E.angle,C),F=this.paint.get("circle-radius").evaluate(s,d)+this.paint.get("circle-stroke-width").evaluate(s,d),j=this.paint.get("circle-pitch-alignment")==="map",W=j?O:function(J,ee){return J.map(ve=>ep(ve,ee))}(O,P),G=j?F*C:F;for(const J of g)for(const ee of J){const ve=j?ee:ep(ee,P);let ye=G;const Ne=kh([],[ee.x,ee.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ye*=Ne[3]/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ye*=E.cameraToCenterDistance/Ne[3]),Gd(W,ve,ye))return!0}return!1}},heatmap:class extends Vn{constructor(u){super(u,Jm),this._updateColorRamp()}createBucket(u){return new tp(u)}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ih({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Vn{constructor(u){super(u,Mh)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Vn{constructor(u){super(u,hg)}recalculate(u,s){super.recalculate(u,s);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Lf(u)}queryRadius(){return Ch(this.paint.get("fill-translate"))}queryIntersectsFeature(u,s,d,g,w,E,C){return ps(Rh(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),E.angle,C),g)}isTileClipped(){return!0}},"fill-extrusion":class extends Vn{constructor(u){super(u,mg)}createBucket(u){return new jf(u)}queryRadius(){return Ch(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,s,d,g,w,E,C,P){const O=Rh(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),E.angle,C),F=this.paint.get("fill-extrusion-height").evaluate(s,d),j=this.paint.get("fill-extrusion-base").evaluate(s,d),W=function(J,ee,ve,ye){const Ne=[];for(const Ge of J){const De=[Ge.x,Ge.y,0,1];kh(De,De,ee),Ne.push(new we(De[0]/De[3],De[1]/De[3]))}return Ne}(O,P),G=function(J,ee,ve,ye){const Ne=[],Ge=[],De=ye[8]*ee,Xe=ye[9]*ee,dt=ye[10]*ee,ut=ye[11]*ee,Vt=ye[8]*ve,Zt=ye[9]*ve,Bt=ye[10]*ve,Ct=ye[11]*ve;for(const Et of J){const Nt=[],Pt=[];for(const vt of Et){const Jt=vt.x,Yt=vt.y,xn=ye[0]*Jt+ye[4]*Yt+ye[12],ai=ye[1]*Jt+ye[5]*Yt+ye[13],pi=ye[2]*Jt+ye[6]*Yt+ye[14],or=ye[3]*Jt+ye[7]*Yt+ye[15],Ks=pi+dt,Qi=or+ut,Ji=xn+Vt,lr=ai+Zt,on=pi+Bt,Cr=or+Ct,Lr=new we((xn+De)/Qi,(ai+Xe)/Qi);Lr.z=Ks/Qi,Nt.push(Lr);const Ui=new we(Ji/Cr,lr/Cr);Ui.z=on/Cr,Pt.push(Ui)}Ne.push(Nt),Ge.push(Pt)}return[Ne,Ge]}(g,j,F,P);return function(J,ee,ve){let ye=1/0;ps(ve,ee)&&(ye=dp(ve,ee[0]));for(let Ne=0;Ne<ee.length;Ne++){const Ge=ee[Ne],De=J[Ne];for(let Xe=0;Xe<Ge.length-1;Xe++){const dt=Ge[Xe],ut=[dt,Ge[Xe+1],De[Xe+1],De[Xe],dt];kf(ve,ut)&&(ye=Math.min(ye,dp(ve,ut)))}}return ye!==1/0&&ye}(G[0],G[1],W)}},line:class extends Vn{constructor(u){super(u,gp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof oc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,s){super.recalculate(u,s),this.paint._values["line-floorwidth"]=_p.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new wu(u)}queryRadius(u){const s=u,d=yp(kc("line-width",this,s),kc("line-gap-width",this,s)),g=kc("line-offset",this,s);return d/2+Math.abs(g)+Ch(this.paint.get("line-translate"))}queryIntersectsFeature(u,s,d,g,w,E,C){const P=Rh(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),E.angle,C),O=C/2*yp(this.paint.get("line-width").evaluate(s,d),this.paint.get("line-gap-width").evaluate(s,d)),F=this.paint.get("line-offset").evaluate(s,d);return F&&(g=function(j,W){const G=[];for(let J=0;J<j.length;J++){const ee=j[J],ve=[];for(let ye=0;ye<ee.length;ye++){const Ne=ee[ye-1],Ge=ee[ye],De=ee[ye+1],Xe=ye===0?new we(0,0):Ge.sub(Ne)._unit()._perp(),dt=ye===ee.length-1?new we(0,0):De.sub(Ge)._unit()._perp(),ut=Xe._add(dt)._unit(),Vt=ut.x*dt.x+ut.y*dt.y;Vt!==0&&ut._mult(1/Vt),ve.push(ut._mult(W)._add(Ge))}G.push(ve)}return G}(g,F*C)),function(j,W,G){for(let J=0;J<W.length;J++){const ee=W[J];if(j.length>=3){for(let ve=0;ve<ee.length;ve++)if(jo(j,ee[ve]))return!0}if(mr(j,ee,G))return!0}return!1}(P,g,O)}isTileClipped(){return!0}},symbol:Nc,background:class extends Vn{constructor(u){super(u,jl)}},raster:class extends Vn{constructor(u){super(u,Qr)}}};class ku{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Kf=63710088e-1;class Ei{constructor(s,d){if(isNaN(s)||isNaN(d))throw new Error(`Invalid LngLat object: (${s}, ${d})`);if(this.lng=+s,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ei(N(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const d=Math.PI/180,g=this.lat*d,w=s.lat*d,E=Math.sin(g)*Math.sin(w)+Math.cos(g)*Math.cos(w)*Math.cos((s.lng-this.lng)*d);return Kf*Math.acos(Math.min(E,1))}toBounds(s=0){const d=360*s/40075017,g=d/Math.cos(Math.PI/180*this.lat);return new Hl(new Ei(this.lng-g,this.lat-d),new Ei(this.lng+g,this.lat+d))}static convert(s){if(s instanceof Ei)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Ei(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Ei(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Hl{constructor(s,d){s&&(d?this.setSouthWest(s).setNorthEast(d):s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof Ei?new Ei(s.lng,s.lat):Ei.convert(s),this}setSouthWest(s){return this._sw=s instanceof Ei?new Ei(s.lng,s.lat):Ei.convert(s),this}extend(s){const d=this._sw,g=this._ne;let w,E;if(s instanceof Ei)w=s,E=s;else{if(!(s instanceof Hl))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Hl.convert(s)):this.extend(Ei.convert(s)):this;if(w=s._sw,E=s._ne,!w||!E)return this}return d||g?(d.lng=Math.min(w.lng,d.lng),d.lat=Math.min(w.lat,d.lat),g.lng=Math.max(E.lng,g.lng),g.lat=Math.max(E.lat,g.lat)):(this._sw=new Ei(w.lng,w.lat),this._ne=new Ei(E.lng,E.lat)),this}getCenter(){return new Ei((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ei(this.getWest(),this.getNorth())}getSouthEast(){return new Ei(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:d,lat:g}=Ei.convert(s);let w=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&w}static convert(s){return s instanceof Hl?s:s&&new Hl(s)}}const Iu=2*Math.PI*Kf;function Qf(u){return Iu*Math.cos(u*Math.PI/180)}function Ds(u){return(180+u)/360}function Lp(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Os(u,s){return u/Qf(s)}function Jf(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class Zh{constructor(s,d,g=0){this.x=+s,this.y=+d,this.z=+g}static fromLngLat(s,d=0){const g=Ei.convert(s);return new Zh(Ds(g.lng),Lp(g.lat),Os(d,g.lat))}toLngLat(){return new Ei(360*this.x-180,Jf(this.y))}toAltitude(){return this.z*Qf(Jf(this.y))}meterInMercatorCoordinateUnits(){return 1/Iu*(s=Jf(this.y),1/Math.cos(s*Math.PI/180));var s}}function Ag(u,s,d){var g=2*Math.PI*6378137/256/Math.pow(2,d);return[u*g-2*Math.PI*6378137/2,s*g-2*Math.PI*6378137/2]}class uo{constructor(s,d,g){if(s<0||s>25||g<0||g>=Math.pow(2,s)||d<0||d>=Math.pow(2,s))throw new Error(`x=${d}, y=${g}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=d,this.y=g,this.key=ho(0,s,s,d,g)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,d,g){const w=(C=this.y,P=this.z,O=Ag(256*(E=this.x),256*(C=Math.pow(2,P)-C-1),P),F=Ag(256*(E+1),256*(C+1),P),O[0]+","+O[1]+","+F[0]+","+F[1]);var E,C,P,O,F;const j=function(W,G,J){let ee,ve="";for(let ye=W;ye>0;ye--)ee=1<<ye-1,ve+=(G&ee?1:0)+(J&ee?2:0);return ve}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,w)}isChildOf(s){const d=this.z-s.z;return d>0&&s.x===this.x>>d&&s.y===this.y>>d}getTilePoint(s){const d=Math.pow(2,this.z);return new we((s.x*d-this.x)*kn,(s.y*d-this.y)*kn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yh{constructor(s,d){this.wrap=s,this.canonical=d,this.key=ho(s,d.z,d.z,d.x,d.y)}}class _s{constructor(s,d,g,w,E){if(s<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${g}`);this.overscaledZ=s,this.wrap=d,this.canonical=new uo(g,+w,+E),this.key=ho(d,s,g,w,E)}clone(){return new _s(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-s;return s>this.canonical.z?new _s(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _s(s,this.wrap,s,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(s,d){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-s;return s>this.canonical.z?ho(this.wrap*+d,s,this.canonical.z,this.canonical.x,this.canonical.y):ho(this.wrap*+d,s,s,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const d=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>d&&s.canonical.y===this.canonical.y>>d}children(s){if(this.overscaledZ>=s)return[new _s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,g=2*this.canonical.x,w=2*this.canonical.y;return[new _s(d,this.wrap,d,g,w),new _s(d,this.wrap,d,g+1,w),new _s(d,this.wrap,d,g,w+1),new _s(d,this.wrap,d,g+1,w+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new _s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new _s(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Zh(s.x-this.wrap,s.y))}}function ho(u,s,d,g,w){(u*=2)<0&&(u=-1*u-1);const E=1<<d;return(E*E*u+E*w+g).toString(36)+d.toString(36)+s.toString(36)}jt("CanonicalTileID",uo),jt("OverscaledTileID",_s,{omit:["posMatrix"]});class Fp{constructor(s,d,g){if(this.uid=s,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(g&&g!=="mapbox"&&g!=="terrarium")return void _e(`"${g}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=d.height;const w=this.dim=d.height-2;this.data=new Uint32Array(d.data.buffer),this.encoding=g||"mapbox";for(let E=0;E<w;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(w,E)]=this.data[this._idx(w-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,w)]=this.data[this._idx(E,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<w;E++)for(let C=0;C<w;C++){const P=this.get(E,C);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(s,d){const g=new Uint8Array(this.data.buffer),w=4*this._idx(s,d);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(g[w],g[w+1],g[w+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(s,d){if(s<-1||s>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(s+1)}_unpackMapbox(s,d,g){return(256*s*256+256*d+g)/10-1e4}_unpackTerrarium(s,d,g){return 256*s+d+g/256-32768}getPixels(){return new Is({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,d,g){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let w=d*this.dim,E=d*this.dim+this.dim,C=g*this.dim,P=g*this.dim+this.dim;switch(d){case-1:w=E-1;break;case 1:E=w+1}switch(g){case-1:C=P-1;break;case 1:P=C+1}const O=-d*this.dim,F=-g*this.dim;for(let j=C;j<P;j++)for(let W=w;W<E;W++)this.data[this._idx(W,j)]=s.data[this._idx(W+O,j+F)]}}jt("DEMData",Fp);class Up{constructor(s){this._stringToNumber={},this._numberToString=[];for(let d=0;d<s.length;d++){const g=s[d];this._stringToNumber[g]=d,this._numberToString[d]=g}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class Vp{constructor(s,d,g,w,E){this.type="Feature",this._vectorTileFeature=s,s._z=d,s._x=g,s._y=w,this.properties=s.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(s[d]=this[d]);return s}}class ed{constructor(s,d){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Wa(kn,16,0),this.grid3D=new Wa(kn,16,0),this.featureIndexArray=new un,this.promoteId=d}insert(s,d,g,w,E,C){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,w,E);const O=C?this.grid3D:this.grid;for(let F=0;F<d.length;F++){const j=d[F],W=[1/0,1/0,-1/0,-1/0];for(let G=0;G<j.length;G++){const J=j[G];W[0]=Math.min(W[0],J.x),W[1]=Math.min(W[1],J.y),W[2]=Math.max(W[2],J.x),W[3]=Math.max(W[3],J.y)}W[0]<kn&&W[1]<kn&&W[2]>=0&&W[3]>=0&&O.insert(P,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $o.VectorTile(new Fh(this.rawTileData)).layers,this.sourceLayerCoder=new Up(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,d,g,w){this.loadVTLayers();const E=s.params||{},C=kn/s.tileSize/s.scale,P=iu(E.filter),O=s.queryGeometry,F=s.queryPadding*C,j=Cg(O),W=this.grid.query(j.minX-F,j.minY-F,j.maxX+F,j.maxY+F),G=Cg(s.cameraQueryGeometry),J=this.grid3D.query(G.minX-F,G.minY-F,G.maxX+F,G.maxY+F,(ye,Ne,Ge,De)=>function(Xe,dt,ut,Vt,Zt){for(const Ct of Xe)if(dt<=Ct.x&&ut<=Ct.y&&Vt>=Ct.x&&Zt>=Ct.y)return!0;const Bt=[new we(dt,ut),new we(dt,Zt),new we(Vt,Zt),new we(Vt,ut)];if(Xe.length>2){for(const Ct of Bt)if(jo(Xe,Ct))return!0}for(let Ct=0;Ct<Xe.length-1;Ct++)if(Kd(Xe[Ct],Xe[Ct+1],Bt))return!0;return!1}(s.cameraQueryGeometry,ye-F,Ne-F,Ge+F,De+F));for(const ye of J)W.push(ye);W.sort(hy);const ee={};let ve;for(let ye=0;ye<W.length;ye++){const Ne=W[ye];if(Ne===ve)continue;ve=Ne;const Ge=this.featureIndexArray.get(Ne);let De=null;this.loadMatchingFeature(ee,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,P,E.layers,E.availableImages,d,g,w,(Xe,dt,ut)=>(De||(De=Al(Xe)),dt.queryIntersectsFeature(O,Xe,ut,De,this.z,s.transform,C,s.pixelPosMatrix)))}return ee}loadMatchingFeature(s,d,g,w,E,C,P,O,F,j,W){const G=this.bucketLayerIDs[d];if(C&&!function(ye,Ne){for(let Ge=0;Ge<ye.length;Ge++)if(Ne.indexOf(ye[Ge])>=0)return!0;return!1}(C,G))return;const J=this.sourceLayerCoder.decode(g),ee=this.vtLayers[J].feature(w);if(E.needGeometry){const ye=Cl(ee,!0);if(!E.filter(new ui(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!E.filter(new ui(this.tileID.overscaledZ),ee))return;const ve=this.getId(ee,J);for(let ye=0;ye<G.length;ye++){const Ne=G[ye];if(C&&C.indexOf(Ne)<0)continue;const Ge=O[Ne];if(!Ge)continue;let De={};ve&&j&&(De=j.getState(Ge.sourceLayer||"_geojsonTileLayer",ve));const Xe=L({},F[Ne]);Xe.paint=td(Xe.paint,Ge.paint,ee,De,P),Xe.layout=td(Xe.layout,Ge.layout,ee,De,P);const dt=!W||W(ee,Ge,De);if(!dt)continue;const ut=new Vp(ee,this.z,this.x,this.y,ve);ut.layer=Xe;let Vt=s[Ne];Vt===void 0&&(Vt=s[Ne]=[]),Vt.push({featureIndex:w,feature:ut,intersectionZ:dt})}}lookupSymbolFeatures(s,d,g,w,E,C,P,O){const F={};this.loadVTLayers();const j=iu(E);for(const W of s)this.loadMatchingFeature(F,g,w,W,j,C,P,O,d);return F}hasLayer(s){for(const d of this.bucketLayerIDs)for(const g of d)if(s===g)return!0;return!1}getId(s,d){let g=s.id;return this.promoteId&&(g=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof g=="boolean"&&(g=Number(g))),g}}function td(u,s,d,g,w){return ne(u,(E,C)=>{const P=s instanceof pa?s.get(C):null;return P&&P.evaluate?P.evaluate(d,g,w):P})}function Cg(u){let s=1/0,d=1/0,g=-1/0,w=-1/0;for(const E of u)s=Math.min(s,E.x),d=Math.min(d,E.y),g=Math.max(g,E.x),w=Math.max(w,E.y);return{minX:s,minY:d,maxX:g,maxY:w}}function hy(u,s){return s-u}var jp;jt("FeatureIndex",ed,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(jp=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",jp.load="load",jp.fullLoad="fullLoad";let Gh=null,Mu=[];const ql=1e3/30,nd={mark(u){performance.mark(u)},frame(u){const s=u;Gh!=null&&Mu.push(s-Gh),Gh=s},clearMetrics(){Gh=null,Mu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const u in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[u])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const u=performance.getEntriesByName("loadTime")[0].duration,s=performance.getEntriesByName("fullLoadTime")[0].duration,d=Mu.length,g=1/(Mu.reduce((E,C)=>E+C,0)/d/1e3),w=Mu.filter(E=>E>ql).reduce((E,C)=>E+(C-ql)/ql,0);return{loadTime:u,fullLoadTime:s,fps:g,percentDroppedFrames:w/(d+w)*100}}};a.AJAXError=Sr,a.ARRAY_TYPE=Gr,a.Actor=class{constructor(u,s,d){this.target=u,this.parent=s,this.mapId=d,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ie(["receive","process"],this),this.invoker=new ku(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=mt()?u:window}send(u,s,d,g,w=!1){const E=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(this.callbacks[E]=d);const C=Ve(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:u,hasCallback:!!d,targetMapId:g,mustQueue:w,sourceMapId:this.mapId,data:wc(s,C)},C),{cancel:()=>{d&&delete this.callbacks[E],this.target.postMessage({id:E,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(u){const s=u.data,d=s.id;if(d&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[d];const g=this.cancelCallbacks[d];delete this.cancelCallbacks[d],g&&g()}else mt()||s.mustQueue?(this.tasks[d]=s,this.taskQueue.push(d),this.invoker.trigger()):this.processTask(d,s)}process(){if(!this.taskQueue.length)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){if(s.type==="<response>"){const d=this.callbacks[u];delete this.callbacks[u],d&&(s.error?d(Xa(s.error)):d(null,Xa(s.data)))}else{let d=!1;const g=Ve(this.globalScope)?void 0:[],w=s.hasCallback?(P,O)=>{d=!0,delete this.cancelCallbacks[u],this.target.postMessage({id:u,type:"<response>",sourceMapId:this.mapId,error:P?wc(P):null,data:wc(O,g)},g)}:P=>{d=!0};let E=null;const C=Xa(s.data);if(this.parent[s.type])E=this.parent[s.type](s.sourceMapId,C,w);else if(this.parent.getWorkerSource){const P=s.type.split(".");E=this.parent.getWorkerSource(s.sourceMapId,P[0],C.source)[P[1]](C,w)}else w(new Error(`Could not find function ${s.type}`));!d&&E&&E.cancel&&(this.cancelCallbacks[u]=E.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=kl,a.CanonicalTileID=uo,a.CollisionBoxArray=He,a.CollisionCircleLayoutArray=class extends U{},a.Color=Q,a.DEMData=Fp,a.DataConstantProperty=$t,a.DictionaryCoder=Up,a.EXTENT=kn,a.ErrorEvent=aa,a.EvaluationParameters=ui,a.Event=vs,a.Evented=ft,a.FeatureIndex=ed,a.FillBucket=Lf,a.FillExtrusionBucket=jf,a.GeoJSONFeature=Vp,a.ImageAtlas=Gi,a.ImagePosition=Ma,a.LineBucket=wu,a.LineStripIndexArray=class extends $e{},a.LngLat=Ei,a.LngLatBounds=Hl,a.MercatorCoordinate=Zh,a.ONE_EM=gr,a.OverscaledTileID=_s,a.PerformanceUtils=nd,a.PosArray=yn,a.Properties=qi,a.QuadTriangleArray=class extends Y{},a.RGBAImage=Is,a.RasterBoundsArray=class extends Tl{},a.RequestPerformance=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.ResourceType=Pr,a.SegmentVector=Dn,a.SymbolBucket=co,a.Transitionable=Ga,a.TriangleIndexArray=Xi,a.Uniform1f=Rc,a.Uniform1i=class extends ls{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.Uniform2f=class extends ls{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.Uniform3f=class extends ls{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.Uniform4f=Vo,a.UniformColor=Sl,a.UniformMatrix4f=class extends ls{constructor(u,s){super(u,s),this.current=El}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.UnwrappedTileID=Yh,a.ValidationError=at,a.ZoomHistory=yl,a.add=function(u,s,d){return u[0]=s[0]+d[0],u[1]=s[1]+d[1],u[2]=s[2]+d[2],u},a.addDynamicAttributes=Yo,a.asyncAll=function(u,s,d){if(!u.length)return d(null,[]);let g=u.length;const w=new Array(u.length);let E=null;u.forEach((C,P)=>{s(C,(O,F)=>{O&&(E=O),w[P]=F,--g==0&&d(E,w)})})},a.bezier=S,a.bindAll=ie,a.cacheEntryPossiblyAdded=function(u){zt++,zt>Tt&&(u.getActor().send("enforceCacheSizeLimit",Ke),zt=0)},a.clamp=I,a.clearTileCache=function(u){const s=caches.delete(Dt);u&&s.catch(u).then(()=>u())},a.clipLine=Eu,a.clone=function(u){var s=new Gr(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},a.clone$1=re,a.clone$2=function(u){var s=new Gr(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s},a.collisionCircleLayout=Tp,a.config=gt,a.copy=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},a.create=function(){var u=new Gr(16);return Gr!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a.create$1=Mf,a.createExpression=pl,a.createFilter=iu,a.createLayout=Ni,a.createStyleLayer=function(u){return u.type==="custom"?new $l(u):new Ru[u.type](u)},a.cross=function(u,s,d){var g=s[0],w=s[1],E=s[2],C=d[0],P=d[1],O=d[2];return u[0]=w*O-E*P,u[1]=E*C-g*O,u[2]=g*P-w*C,u},a.dot=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]},a.dot$1=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]*s[3]},a.ease=R,a.emitValidationErrors=bh,a.enforceCacheSizeLimit=function(u){ce(),X&&X.then(s=>{s.keys().then(d=>{for(let g=0;g<d.length-u;g++)s.delete(d[g])})})},a.equals=function(u,s){var d=u[0],g=u[1],w=u[2],E=u[3],C=u[4],P=u[5],O=u[6],F=u[7],j=u[8],W=u[9],G=u[10],J=u[11],ee=u[12],ve=u[13],ye=u[14],Ne=u[15],Ge=s[0],De=s[1],Xe=s[2],dt=s[3],ut=s[4],Vt=s[5],Zt=s[6],Bt=s[7],Ct=s[8],Et=s[9],Nt=s[10],Pt=s[11],vt=s[12],Jt=s[13],Yt=s[14],xn=s[15];return Math.abs(d-Ge)<=Yr*Math.max(1,Math.abs(d),Math.abs(Ge))&&Math.abs(g-De)<=Yr*Math.max(1,Math.abs(g),Math.abs(De))&&Math.abs(w-Xe)<=Yr*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(E-dt)<=Yr*Math.max(1,Math.abs(E),Math.abs(dt))&&Math.abs(C-ut)<=Yr*Math.max(1,Math.abs(C),Math.abs(ut))&&Math.abs(P-Vt)<=Yr*Math.max(1,Math.abs(P),Math.abs(Vt))&&Math.abs(O-Zt)<=Yr*Math.max(1,Math.abs(O),Math.abs(Zt))&&Math.abs(F-Bt)<=Yr*Math.max(1,Math.abs(F),Math.abs(Bt))&&Math.abs(j-Ct)<=Yr*Math.max(1,Math.abs(j),Math.abs(Ct))&&Math.abs(W-Et)<=Yr*Math.max(1,Math.abs(W),Math.abs(Et))&&Math.abs(G-Nt)<=Yr*Math.max(1,Math.abs(G),Math.abs(Nt))&&Math.abs(J-Pt)<=Yr*Math.max(1,Math.abs(J),Math.abs(Pt))&&Math.abs(ee-vt)<=Yr*Math.max(1,Math.abs(ee),Math.abs(vt))&&Math.abs(ve-Jt)<=Yr*Math.max(1,Math.abs(ve),Math.abs(Jt))&&Math.abs(ye-Yt)<=Yr*Math.max(1,Math.abs(ye),Math.abs(Yt))&&Math.abs(Ne-xn)<=Yr*Math.max(1,Math.abs(Ne),Math.abs(xn))},a.evaluateSizeForFeature=function(u,{uSize:s,uSizeT:d},{lowerSize:g,upperSize:w}){return u.kind==="source"?g/ar:u.kind==="composite"?Ti(g/ar,w/ar,d):s},a.evaluateSizeForZoom=function(u,s){let d=0,g=0;if(u.kind==="constant")g=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:w,minZoom:E,maxZoom:C}=u,P=w?I(is.interpolationFactor(w,s,E,C),0,1):0;u.kind==="camera"?g=Ti(u.minSize,u.maxSize,P):d=P}return{uSizeT:d,uSize:g}},a.evaluateVariableOffset=Ln,a.evented=ss,a.exported=lt,a.exported$1=qt,a.extend=L,a.filterObject=he,a.fromRotation=function(u,s){var d=Math.sin(s),g=Math.cos(s);return u[0]=g,u[1]=d,u[2]=0,u[3]=-d,u[4]=g,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},a.fromScaling=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.getAnchorAlignment=Hh,a.getAnchorJustification=Hn,a.getArrayBuffer=xs,a.getImage=ra,a.getJSON=function(u,s){return nr(L(u,{type:"json"}),s)},a.getOverlapMode=Cu,a.getRTLTextPluginStatus=fu,a.getReferrer=tr,a.getVideo=function(u,s){const d=window.document.createElement("video");d.muted=!0,d.onloadstart=function(){s(null,d)};for(let g=0;g<u.length;g++){const w=window.document.createElement("source");ir(u[g])||(d.crossOrigin="Anonymous"),w.src=u[g],d.appendChild(w)}return{cancel:()=>{}}},a.identity=Pf,a.invert=function(u,s){var d=s[0],g=s[1],w=s[2],E=s[3],C=s[4],P=s[5],O=s[6],F=s[7],j=s[8],W=s[9],G=s[10],J=s[11],ee=s[12],ve=s[13],ye=s[14],Ne=s[15],Ge=d*P-g*C,De=d*O-w*C,Xe=d*F-E*C,dt=g*O-w*P,ut=g*F-E*P,Vt=w*F-E*O,Zt=j*ve-W*ee,Bt=j*ye-G*ee,Ct=j*Ne-J*ee,Et=W*ye-G*ve,Nt=W*Ne-J*ve,Pt=G*Ne-J*ye,vt=Ge*Pt-De*Nt+Xe*Et+dt*Ct-ut*Bt+Vt*Zt;return vt?(u[0]=(P*Pt-O*Nt+F*Et)*(vt=1/vt),u[1]=(w*Nt-g*Pt-E*Et)*vt,u[2]=(ve*Vt-ye*ut+Ne*dt)*vt,u[3]=(G*ut-W*Vt-J*dt)*vt,u[4]=(O*Ct-C*Pt-F*Bt)*vt,u[5]=(d*Pt-w*Ct+E*Bt)*vt,u[6]=(ye*Xe-ee*Vt-Ne*De)*vt,u[7]=(j*Vt-G*Xe+J*De)*vt,u[8]=(C*Nt-P*Ct+F*Zt)*vt,u[9]=(g*Ct-d*Nt-E*Zt)*vt,u[10]=(ee*ut-ve*Xe+Ne*Ge)*vt,u[11]=(W*Xe-j*ut-J*Ge)*vt,u[12]=(P*Bt-C*Et-O*Zt)*vt,u[13]=(d*Et-g*Bt+w*Zt)*vt,u[14]=(ve*De-ee*dt-ye*Ge)*vt,u[15]=(j*dt-W*De+G*Ge)*vt,u):null},a.isImageBitmap=Le,a.isSafari=Ve,a.isWorker=mt,a.keysDifference=function(u,s){const d=[];for(const g in u)g in s||d.push(g);return d},a.lazyLoadRTLTextPlugin=function(){dr.isLoading()||dr.isLoaded()||fu()!=="deferred"||Fo()},a.makeRequest=nr,a.mapObject=ne,a.mercatorXfromLng=Ds,a.mercatorYfromLat=Lp,a.mercatorZfromAltitude=Os,a.mul=Qm,a.mul$1=function(u,s,d){return u[0]=s[0]*d[0],u[1]=s[1]*d[1],u[2]=s[2]*d[2],u[3]=s[3]*d[3],u},a.multiply=Km,a.nextPowerOfTwo=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.normalize=function(u,s){var d=s[0],g=s[1],w=s[2],E=d*d+g*g+w*w;return E>0&&(E=1/Math.sqrt(E)),u[0]=s[0]*E,u[1]=s[1]*E,u[2]=s[2]*E,u},a.number=Ti,a.ortho=function(u,s,d,g,w,E,C){var P=1/(s-d),O=1/(g-w),F=1/(E-C);return u[0]=-2*P,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*O,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*F,u[11]=0,u[12]=(s+d)*P,u[13]=(w+g)*O,u[14]=(C+E)*F,u[15]=1,u},a.parseCacheControl=nt,a.parseGlyphPbf=function(u){return new Fh(u).readFields(Cp,[])},a.pbf=Fh,a.performSymbolLayout=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=kn/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0].layout,d=u.bucket.layers[0]._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new ui(u.bucket.zoom+1),u.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new ui(u.bucket.zoom+1),u.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new ui(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=u.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new ui(O),u.canonical),d["text-size"].possiblyEvaluate(new ui(F),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=u.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new ui(O),u.canonical),d["icon-size"].possiblyEvaluate(new ui(F),u.canonical)]}const w=s.get("text-line-height")*gr,E=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",C=s.get("text-keep-upright"),P=s.get("text-size");for(const O of u.bucket.features){const F=s.get("text-font").evaluate(O,{},u.canonical).join(","),j=P.evaluate(O,{},u.canonical),W=g.layoutTextSize.evaluate(O,{},u.canonical),G=g.layoutIconSize.evaluate(O,{},u.canonical),J={horizontal:{},vertical:void 0},ee=O.text;let ve,ye=[0,0];if(ee){const De=ee.toString(),Xe=s.get("text-letter-spacing").evaluate(O,{},u.canonical)*gr,dt=vh(De)?Xe:0,ut=s.get("text-anchor").evaluate(O,{},u.canonical),Vt=s.get("text-variable-anchor");if(!Vt){const Nt=s.get("text-radial-offset").evaluate(O,{},u.canonical);ye=Nt?Ln(ut,[Nt*gr,yi]):s.get("text-offset").evaluate(O,{},u.canonical).map(Pt=>Pt*gr)}let Zt=E?"center":s.get("text-justify").evaluate(O,{},u.canonical);const Bt=s.get("symbol-placement"),Ct=Bt==="point"?s.get("text-max-width").evaluate(O,{},u.canonical)*gr:0,Et=()=>{u.bucket.allowVerticalPlacement&&ds(De)&&(J.vertical=Wf(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Ct,w,ut,"left",dt,ye,a.WritingMode.vertical,!0,Bt,W,j))};if(!E&&Vt){const Nt=Zt==="auto"?Vt.map(vt=>Hn(vt)):[Zt];let Pt=!1;for(let vt=0;vt<Nt.length;vt++){const Jt=Nt[vt];if(!J.horizontal[Jt])if(Pt)J.horizontal[Jt]=J.horizontal[0];else{const Yt=Wf(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Ct,w,"center",Jt,dt,ye,a.WritingMode.horizontal,!1,Bt,W,j);Yt&&(J.horizontal[Jt]=Yt,Pt=Yt.positionedLines.length===1)}}Et()}else{Zt==="auto"&&(Zt=Hn(ut));const Nt=Wf(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Ct,w,ut,Zt,dt,ye,a.WritingMode.horizontal,!1,Bt,W,j);Nt&&(J.horizontal[Zt]=Nt),Et(),ds(De)&&E&&C&&(J.vertical=Wf(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Ct,w,ut,Zt,dt,ye,a.WritingMode.vertical,!1,Bt,W,j))}}let Ne=!1;if(O.icon&&O.icon.name){const De=u.imageMap[O.icon.name];De&&(ve=Pa(u.imagePositions[O.icon.name],s.get("icon-offset").evaluate(O,{},u.canonical),s.get("icon-anchor").evaluate(O,{},u.canonical)),Ne=!!De.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Ne:u.bucket.sdfIcons!==Ne&&_e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==u.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Ge=Bc(J.horizontal)||J.vertical;u.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||ve)&&di(u.bucket,O,J,ve,u.imageMap,g,W,G,ye,Ne,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.perspective=function(u,s,d,g,w){var E,C=1/Math.tan(s/2);return u[0]=C/d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=C,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,w!=null&&w!==1/0?(u[10]=(w+g)*(E=1/(g-w)),u[14]=2*w*g*E):(u[10]=-1,u[14]=-2*g),u},a.pick=function(u,s){const d={};for(let g=0;g<s.length;g++){const w=s[g];w in u&&(d[w]=u[w])}return d},a.plugin=dr,a.pointGeometry=we,a.polygonIntersectsPolygon=kf,a.potpack=kp,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=jt,a.registerForPluginStateChange=function(u){return u({pluginStatus:sr,pluginURL:Ya}),ss.on("pluginStateChange",u),u},a.renderColorRamp=Ih,a.rotateX=function(u,s,d){var g=Math.sin(d),w=Math.cos(d),E=s[4],C=s[5],P=s[6],O=s[7],F=s[8],j=s[9],W=s[10],G=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=E*w+F*g,u[5]=C*w+j*g,u[6]=P*w+W*g,u[7]=O*w+G*g,u[8]=F*w-E*g,u[9]=j*w-C*g,u[10]=W*w-P*g,u[11]=G*w-O*g,u},a.rotateZ=function(u,s,d){var g=Math.sin(d),w=Math.cos(d),E=s[0],C=s[1],P=s[2],O=s[3],F=s[4],j=s[5],W=s[6],G=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=E*w+F*g,u[1]=C*w+j*g,u[2]=P*w+W*g,u[3]=O*w+G*g,u[4]=F*w-E*g,u[5]=j*w-C*g,u[6]=W*w-P*g,u[7]=G*w-O*g,u},a.scale=function(u,s,d){var g=d[0],w=d[1],E=d[2];return u[0]=s[0]*g,u[1]=s[1]*g,u[2]=s[2]*g,u[3]=s[3]*g,u[4]=s[4]*w,u[5]=s[5]*w,u[6]=s[6]*w,u[7]=s[7]*w,u[8]=s[8]*E,u[9]=s[9]*E,u[10]=s[10]*E,u[11]=s[11]*E,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},a.scale$1=function(u,s,d){return u[0]=s[0]*d,u[1]=s[1]*d,u[2]=s[2]*d,u},a.setCacheLimits=function(u,s){Ke=u,Tt=s},a.setRTLTextPlugin=function(u,s,d=!1){if(sr===bl||sr===Za||sr===hu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ya=lt.resolveURL(u),sr=bl,xl=s,Tc(),d||Fo()},a.spec=Ee,a.sphericalToCartesian=function([u,s,d]){return s+=90,s*=Math.PI/180,d*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(d),y:u*Math.sin(s)*Math.sin(d),z:u*Math.cos(d)}},a.sqrLen=function(u){var s=u[0],d=u[1];return s*s+d*d},a.sub=function(u,s,d){return u[0]=s[0]-d[0],u[1]=s[1]-d[1],u[2]=s[2]-d[2],u},a.toEvaluationFeature=Cl,a.transformMat3=function(u,s,d){var g=s[0],w=s[1],E=s[2];return u[0]=g*d[0]+w*d[3]+E*d[6],u[1]=g*d[1]+w*d[4]+E*d[7],u[2]=g*d[2]+w*d[5]+E*d[8],u},a.transformMat4=kh,a.transformMat4$1=function(u,s,d){var g=s[0],w=s[1];return u[0]=d[0]*g+d[4]*w+d[12],u[1]=d[1]*g+d[5]*w+d[13],u},a.translate=function(u,s,d){var g,w,E,C,P,O,F,j,W,G,J,ee,ve=d[0],ye=d[1],Ne=d[2];return s===u?(u[12]=s[0]*ve+s[4]*ye+s[8]*Ne+s[12],u[13]=s[1]*ve+s[5]*ye+s[9]*Ne+s[13],u[14]=s[2]*ve+s[6]*ye+s[10]*Ne+s[14],u[15]=s[3]*ve+s[7]*ye+s[11]*Ne+s[15]):(w=s[1],E=s[2],C=s[3],P=s[4],O=s[5],F=s[6],j=s[7],W=s[8],G=s[9],J=s[10],ee=s[11],u[0]=g=s[0],u[1]=w,u[2]=E,u[3]=C,u[4]=P,u[5]=O,u[6]=F,u[7]=j,u[8]=W,u[9]=G,u[10]=J,u[11]=ee,u[12]=g*ve+P*ye+W*Ne+s[12],u[13]=w*ve+O*ye+G*Ne+s[13],u[14]=E*ve+F*ye+J*Ne+s[14],u[15]=C*ve+j*ye+ee*Ne+s[15]),u},a.triggerPluginCompletionEvent=rs,a.unicodeBlockLookup=It,a.uniqueId=function(){return H++},a.validateCustomStyleLayer=function(u){const s=[],d=u.id;return d===void 0&&s.push({message:`layers.${d}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${d}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),s},a.validateLight=yh,a.validateStyle=Ts,a.vectorTile=$o,a.warnOnce=_e,a.wrap=N}),c(["./shared"],function(a){function _(ae){const V=typeof ae;if(V==="number"||V==="boolean"||V==="string"||ae==null)return JSON.stringify(ae);if(Array.isArray(ae)){let le="[";for(const be of ae)le+=`${_(be)},`;return`${le}]`}const Z=Object.keys(ae).sort();let Q="{";for(let le=0;le<Z.length;le++)Q+=`${JSON.stringify(Z[le])}:${_(ae[Z[le]])},`;return`${Q}}`}function x(ae){let V="";for(const Z of a.refProperties)V+=`/${_(ae[Z])}`;return V}class S{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,Z){for(const le of V){this._layerConfigs[le.id]=le;const be=this._layers[le.id]=a.createStyleLayer(le);be._featureFilter=a.createFilter(be.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of Z)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const Q=function(le,be){const Ae={};for(let xe=0;xe<le.length;xe++){const ke=be&&be[le[xe].id]||x(le[xe]);be&&(be[le[xe].id]=ke);let et=Ae[ke];et||(et=Ae[ke]=[]),et.push(le[xe])}const Se=[];for(const xe in Ae)Se.push(Ae[xe]);return Se}(Object.values(this._layerConfigs),this.keyCache);for(const le of Q){const be=le.map(ct=>this._layers[ct.id]),Ae=be[0];if(Ae.visibility==="none")continue;const Se=Ae.source||"";let xe=this.familiesBySource[Se];xe||(xe=this.familiesBySource[Se]={});const ke=Ae.sourceLayer||"_geojsonTileLayer";let et=xe[ke];et||(et=xe[ke]=[]),et.push(be)}}}class R{constructor(V){const Z={},Q=[];for(const Se in V){const xe=V[Se],ke=Z[Se]={};for(const et in xe){const ct=xe[+et];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;const ot={x:0,y:0,w:ct.bitmap.width+2,h:ct.bitmap.height+2};Q.push(ot),ke[et]={rect:ot,metrics:ct.metrics}}}const{w:le,h:be}=a.potpack(Q),Ae=new a.AlphaImage({width:le||1,height:be||1});for(const Se in V){const xe=V[Se];for(const ke in xe){const et=xe[+ke];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const ct=Z[Se][ke].rect;a.AlphaImage.copy(et.bitmap,Ae,{x:0,y:0},{x:ct.x+1,y:ct.y+1},et.bitmap)}}this.image=Ae,this.positions=Z}}a.register("GlyphAtlas",R);class I{constructor(V){this.tileID=new a.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId}parse(V,Z,Q,le,be){this.status="parsing",this.data=V,this.collisionBoxArray=new a.CollisionBoxArray;const Ae=new a.DictionaryCoder(Object.keys(V.layers).sort()),Se=new a.FeatureIndex(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const xe={},ke={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q},et=Z.familiesBySource[this.source];for(const dn in et){const an=V.layers[dn];if(!an)continue;an.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${dn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ln=Ae.encode(dn),Di=[];for(let ci=0;ci<an.length;ci++){const Oi=an.feature(ci),rr=Se.getId(Oi,dn);Di.push({feature:Oi,id:rr,index:ci,sourceLayerIndex:ln})}for(const ci of et[dn]){const Oi=ci[0];Oi.source!==this.source&&a.warnOnce(`layer.source = ${Oi.source} does not equal this.source = ${this.source}`),Oi.minzoom&&this.zoom<Math.floor(Oi.minzoom)||Oi.maxzoom&&this.zoom>=Oi.maxzoom||Oi.visibility!=="none"&&(N(ci,this.zoom,Q),(xe[Oi.id]=Oi.createBucket({index:Se.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ln,sourceID:this.source})).populate(Di,ke,this.tileID.canonical),Se.bucketLayerIDs.push(ci.map(rr=>rr.id)))}}let ct,ot,Ft,Lt;const Wt=a.mapObject(ke.glyphDependencies,dn=>Object.keys(dn).map(Number));Object.keys(Wt).length?le.send("getGlyphs",{uid:this.uid,stacks:Wt},(dn,an)=>{ct||(ct=dn,ot=an,gn.call(this))}):ot={};const Qt=Object.keys(ke.iconDependencies);Qt.length?le.send("getImages",{icons:Qt,source:this.source,tileID:this.tileID,type:"icons"},(dn,an)=>{ct||(ct=dn,Ft=an,gn.call(this))}):Ft={};const _n=Object.keys(ke.patternDependencies);function gn(){if(ct)return be(ct);if(ot&&Ft&&Lt){const dn=new R(ot),an=new a.ImageAtlas(Ft,Lt);for(const ln in xe){const Di=xe[ln];Di instanceof a.SymbolBucket?(N(Di.layers,this.zoom,Q),a.performSymbolLayout({bucket:Di,glyphMap:ot,glyphPositions:dn.positions,imageMap:Ft,imagePositions:an.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Di.hasPattern&&(Di instanceof a.LineBucket||Di instanceof a.FillBucket||Di instanceof a.FillExtrusionBucket)&&(N(Di.layers,this.zoom,Q),Di.addFeatures(ke,this.tileID.canonical,an.patternPositions))}this.status="done",be(null,{buckets:Object.values(xe).filter(ln=>!ln.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dn.image,imageAtlas:an,glyphMap:this.returnDependencies?ot:null,iconMap:this.returnDependencies?Ft:null,glyphPositions:this.returnDependencies?dn.positions:null})}}_n.length?le.send("getImages",{icons:_n,source:this.source,tileID:this.tileID,type:"patterns"},(dn,an)=>{ct||(ct=dn,Lt=an,gn.call(this))}):Lt={},gn.call(this)}}function N(ae,V,Z){const Q=new a.EvaluationParameters(V);for(const le of ae)le.recalculate(Q,Z)}function L(ae,V){const Z=a.getArrayBuffer(ae.request,(Q,le,be,Ae)=>{Q?V(Q):le&&V(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(le)),rawData:le,cacheControl:be,expires:Ae})});return()=>{Z.cancel(),V()}}class H{constructor(V,Z,Q,le){this.actor=V,this.layerIndex=Z,this.availableImages=Q,this.loadVectorData=le||L,this.loading={},this.loaded={}}loadTile(V,Z){const Q=V.uid;this.loading||(this.loading={});const le=!!(V&&V.request&&V.request.collectResourceTiming)&&new a.RequestPerformance(V.request),be=this.loading[Q]=new I(V);be.abort=this.loadVectorData(V,(Ae,Se)=>{if(delete this.loading[Q],Ae||!Se)return be.status="done",this.loaded[Q]=be,Z(Ae);const xe=Se.rawData,ke={};Se.expires&&(ke.expires=Se.expires),Se.cacheControl&&(ke.cacheControl=Se.cacheControl);const et={};if(le){const ct=le.finish();ct&&(et.resourceTiming=JSON.parse(JSON.stringify(ct)))}be.vectorTile=Se.vectorTile,be.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,(ct,ot)=>{if(ct||!ot)return Z(ct);Z(null,a.extend({rawTileData:xe.slice(0)},ot,ke,et))}),this.loaded=this.loaded||{},this.loaded[Q]=be})}reloadTile(V,Z){const Q=this.loaded,le=V.uid,be=this;if(Q&&Q[le]){const Ae=Q[le];Ae.showCollisionBoxes=V.showCollisionBoxes;const Se=(xe,ke)=>{const et=Ae.reloadCallback;et&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,be.layerIndex,this.availableImages,be.actor,et)),Z(xe,ke)};Ae.status==="parsing"?Ae.reloadCallback=Se:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Se):Se())}}abortTile(V,Z){const Q=this.loading,le=V.uid;Q&&Q[le]&&Q[le].abort&&(Q[le].abort(),delete Q[le]),Z()}removeTile(V,Z){const Q=this.loaded,le=V.uid;Q&&Q[le]&&delete Q[le],Z()}}class ie{constructor(){this.loaded={}}loadTile(V,Z){const{uid:Q,encoding:le,rawImageData:be}=V,Ae=a.isImageBitmap(be)?this.getImageData(be):be,Se=new a.DEMData(Q,Ae,le);this.loaded=this.loaded||{},this.loaded[Q]=Se,Z(null,Se)}getImageData(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const Z=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:Z.width,height:Z.height},Z.data)}removeTile(V){const Z=this.loaded,Q=V.uid;Z&&Z[Q]&&delete Z[Q]}}var ne=function ae(V,Z){var Q,le=V&&V.type;if(le==="FeatureCollection")for(Q=0;Q<V.features.length;Q++)ae(V.features[Q],Z);else if(le==="GeometryCollection")for(Q=0;Q<V.geometries.length;Q++)ae(V.geometries[Q],Z);else if(le==="Feature")ae(V.geometry,Z);else if(le==="Polygon")he(V.coordinates,Z);else if(le==="MultiPolygon")for(Q=0;Q<V.coordinates.length;Q++)he(V.coordinates[Q],Z);return V};function he(ae,V){if(ae.length!==0){re(ae[0],V);for(var Z=1;Z<ae.length;Z++)re(ae[Z],!V)}}function re(ae,V){for(var Z=0,Q=0,le=0,be=ae.length,Ae=be-1;le<be;Ae=le++){var Se=(ae[le][0]-ae[Ae][0])*(ae[Ae][1]+ae[le][1]),xe=Z+Se;Q+=Math.abs(Z)>=Math.abs(Se)?Z-xe+Se:Se-xe+Z,Z=xe}Z+Q>=0!=!!V&&ae.reverse()}const ge=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class _e{constructor(V){this._feature=V,this.extent=a.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const Z of this._feature.geometry)V.push([new a.pointGeometry(Z[0],Z[1])]);return V}{const V=[];for(const Z of this._feature.geometry){const Q=[];for(const le of Z)Q.push(new a.pointGeometry(le[0],le[1]));V.push(Q)}return V}}toGeoJSON(V,Z,Q){return ge.call(this,V,Z,Q)}}class pe{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=V.length,this._features=V}feature(V){return new _e(this._features[V])}}var it={exports:{}},mt=a.pointGeometry,nt=a.vectorTile.VectorTileFeature,Ce=ht;function ht(ae,V){this.options=V||{},this.features=ae,this.length=ae.length}function Me(ae,V){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=V||4096}ht.prototype.feature=function(ae){return new Me(this.features[ae],this.options.extent)},Me.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var V=0;V<ae.length;V++){for(var Z=ae[V],Q=[],le=0;le<Z.length;le++)Q.push(new mt(Z[le][0],Z[le][1]));this.geometry.push(Q)}return this.geometry},Me.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,V=1/0,Z=-1/0,Q=1/0,le=-1/0,be=0;be<ae.length;be++)for(var Ae=ae[be],Se=0;Se<Ae.length;Se++){var xe=Ae[Se];V=Math.min(V,xe.x),Z=Math.max(Z,xe.x),Q=Math.min(Q,xe.y),le=Math.max(le,xe.y)}return[V,Q,Z,le]},Me.prototype.toGeoJSON=nt.prototype.toGeoJSON;var Ve=a.pbf,Le=Ce;function lt(ae){var V=new Ve;return function(Z,Q){for(var le in Z.layers)Q.writeMessage(3,we,Z.layers[le])}(ae,V),V.finish()}function we(ae,V){var Z;V.writeVarintField(15,ae.version||1),V.writeStringField(1,ae.name||""),V.writeVarintField(5,ae.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ae.length;Z++)Q.feature=ae.feature(Z),V.writeMessage(2,Ye,Q);var le=Q.keys;for(Z=0;Z<le.length;Z++)V.writeStringField(3,le[Z]);var be=Q.values;for(Z=0;Z<be.length;Z++)V.writeMessage(4,Tt,be[Z])}function Ye(ae,V){var Z=ae.feature;Z.id!==void 0&&V.writeVarintField(1,Z.id),V.writeMessage(2,gt,ae),V.writeVarintField(3,Z.type),V.writeMessage(4,Ke,Z)}function gt(ae,V){var Z=ae.feature,Q=ae.keys,le=ae.values,be=ae.keycache,Ae=ae.valuecache;for(var Se in Z.properties){var xe=Z.properties[Se],ke=be[Se];if(xe!==null){ke===void 0&&(Q.push(Se),be[Se]=ke=Q.length-1),V.writeVarint(ke);var et=typeof xe;et!=="string"&&et!=="boolean"&&et!=="number"&&(xe=JSON.stringify(xe));var ct=et+":"+xe,ot=Ae[ct];ot===void 0&&(le.push(xe),Ae[ct]=ot=le.length-1),V.writeVarint(ot)}}}function Dt(ae,V){return(V<<3)+(7&ae)}function X(ae){return ae<<1^ae>>31}function Ke(ae,V){for(var Z=ae.loadGeometry(),Q=ae.type,le=0,be=0,Ae=Z.length,Se=0;Se<Ae;Se++){var xe=Z[Se],ke=1;Q===1&&(ke=xe.length),V.writeVarint(Dt(1,ke));for(var et=Q===3?xe.length-1:xe.length,ct=0;ct<et;ct++){ct===1&&Q!==1&&V.writeVarint(Dt(2,et-1));var ot=xe[ct].x-le,Ft=xe[ct].y-be;V.writeVarint(X(ot)),V.writeVarint(X(Ft)),le+=ot,be+=Ft}Q===3&&V.writeVarint(Dt(7,1))}}function Tt(ae,V){var Z=typeof ae;Z==="string"?V.writeStringField(1,ae):Z==="boolean"?V.writeBooleanField(7,ae):Z==="number"&&(ae%1!=0?V.writeDoubleField(3,ae):ae<0?V.writeSVarintField(6,ae):V.writeVarintField(5,ae))}function ce(ae,V,Z,Q,le,be){if(le-Q<=Z)return;const Ae=Q+le>>1;zt(ae,V,Ae,Q,le,be%2),ce(ae,V,Z,Q,Ae-1,be+1),ce(ae,V,Z,Ae+1,le,be+1)}function zt(ae,V,Z,Q,le,be){for(;le>Q;){if(le-Q>600){const ke=le-Q+1,et=Z-Q+1,ct=Math.log(ke),ot=.5*Math.exp(2*ct/3),Ft=.5*Math.sqrt(ct*ot*(ke-ot)/ke)*(et-ke/2<0?-1:1);zt(ae,V,Z,Math.max(Q,Math.floor(Z-et*ot/ke+Ft)),Math.min(le,Math.floor(Z+(ke-et)*ot/ke+Ft)),be)}const Ae=V[2*Z+be];let Se=Q,xe=le;for(qt(ae,V,Q,Z),V[2*le+be]>Ae&&qt(ae,V,Q,le);Se<xe;){for(qt(ae,V,Se,xe),Se++,xe--;V[2*Se+be]<Ae;)Se++;for(;V[2*xe+be]>Ae;)xe--}V[2*Q+be]===Ae?qt(ae,V,Q,xe):(xe++,qt(ae,V,xe,le)),xe<=Z&&(Q=xe+1),Z<=xe&&(le=xe-1)}}function qt(ae,V,Z,Q){Ot(ae,Z,Q),Ot(V,2*Z,2*Q),Ot(V,2*Z+1,2*Q+1)}function Ot(ae,V,Z){const Q=ae[V];ae[V]=ae[Z],ae[Z]=Q}function Fn(ae,V,Z,Q){const le=ae-Z,be=V-Q;return le*le+be*be}it.exports=lt,it.exports.fromVectorTileJs=lt,it.exports.fromGeojsonVt=function(ae,V){V=V||{};var Z={};for(var Q in ae)Z[Q]=new Le(ae[Q].features,V),Z[Q].name=Q,Z[Q].version=V.version,Z[Q].extent=V.extent;return lt({layers:Z})},it.exports.GeoJSONWrapper=Le;const vn=ae=>ae[0],Qn=ae=>ae[1];class Yi{constructor(V,Z=vn,Q=Qn,le=64,be=Float64Array){this.nodeSize=le,this.points=V;const Ae=V.length<65536?Uint16Array:Uint32Array,Se=this.ids=new Ae(V.length),xe=this.coords=new be(2*V.length);for(let ke=0;ke<V.length;ke++)Se[ke]=ke,xe[2*ke]=Z(V[ke]),xe[2*ke+1]=Q(V[ke]);ce(Se,xe,le,0,Se.length-1,0)}range(V,Z,Q,le){return function(be,Ae,Se,xe,ke,et,ct){const ot=[0,be.length-1,0],Ft=[];let Lt,Wt;for(;ot.length;){const Qt=ot.pop(),_n=ot.pop(),gn=ot.pop();if(_n-gn<=ct){for(let ln=gn;ln<=_n;ln++)Lt=Ae[2*ln],Wt=Ae[2*ln+1],Lt>=Se&&Lt<=ke&&Wt>=xe&&Wt<=et&&Ft.push(be[ln]);continue}const dn=Math.floor((gn+_n)/2);Lt=Ae[2*dn],Wt=Ae[2*dn+1],Lt>=Se&&Lt<=ke&&Wt>=xe&&Wt<=et&&Ft.push(be[dn]);const an=(Qt+1)%2;(Qt===0?Se<=Lt:xe<=Wt)&&(ot.push(gn),ot.push(dn-1),ot.push(an)),(Qt===0?ke>=Lt:et>=Wt)&&(ot.push(dn+1),ot.push(_n),ot.push(an))}return Ft}(this.ids,this.coords,V,Z,Q,le,this.nodeSize)}within(V,Z,Q){return function(le,be,Ae,Se,xe,ke){const et=[0,le.length-1,0],ct=[],ot=xe*xe;for(;et.length;){const Ft=et.pop(),Lt=et.pop(),Wt=et.pop();if(Lt-Wt<=ke){for(let an=Wt;an<=Lt;an++)Fn(be[2*an],be[2*an+1],Ae,Se)<=ot&&ct.push(le[an]);continue}const Qt=Math.floor((Wt+Lt)/2),_n=be[2*Qt],gn=be[2*Qt+1];Fn(_n,gn,Ae,Se)<=ot&&ct.push(le[Qt]);const dn=(Ft+1)%2;(Ft===0?Ae-xe<=_n:Se-xe<=gn)&&(et.push(Wt),et.push(Qt-1),et.push(dn)),(Ft===0?Ae+xe>=_n:Se+xe>=gn)&&(et.push(Qt+1),et.push(Lt),et.push(dn))}return ct}(this.ids,this.coords,V,Z,Q,this.nodeSize)}}const Pr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},Sr=Math.fround||(tr=new Float32Array(1),ae=>(tr[0]=+ae,tr[0]));var tr;class ia{constructor(V){this.options=sa(Object.create(Pr),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:Z,minZoom:Q,maxZoom:le,nodeSize:be}=this.options;Z&&console.time("total time");const Ae=`prepare ${V.length} points`;Z&&console.time(Ae),this.points=V;let Se=[];for(let xe=0;xe<V.length;xe++)V[xe].geometry&&Se.push(xs(V[xe],xe));this.trees[le+1]=new Yi(Se,Ta,vs,be,Float32Array),Z&&console.timeEnd(Ae);for(let xe=le;xe>=Q;xe--){const ke=+Date.now();Se=this._cluster(Se,xe),this.trees[xe]=new Yi(Se,Ta,vs,be,Float32Array),Z&&console.log("z%d: %d clusters in %dms",xe,Se.length,+Date.now()-ke)}return Z&&console.timeEnd("total time"),this}getClusters(V,Z){let Q=((V[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,V[1]));let be=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)Q=-180,be=180;else if(Q>be){const et=this.getClusters([Q,le,180,Ae],Z),ct=this.getClusters([-180,le,be,Ae],Z);return et.concat(ct)}const Se=this.trees[this._limitZoom(Z)],xe=Se.range(wn(Q),qr(Ae),wn(be),qr(le)),ke=[];for(const et of xe){const ct=Se.points[et];ke.push(ct.numPoints?ir(ct):this.points[ct.index])}return ke}getChildren(V){const Z=this._getOriginId(V),Q=this._getOriginZoom(V),le="No cluster with the specified id.",be=this.trees[Q];if(!be)throw new Error(le);const Ae=be.points[Z];if(!Ae)throw new Error(le);const Se=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),xe=be.within(Ae.x,Ae.y,Se),ke=[];for(const et of xe){const ct=be.points[et];ct.parentId===V&&ke.push(ct.numPoints?ir(ct):this.points[ct.index])}if(ke.length===0)throw new Error(le);return ke}getLeaves(V,Z,Q){const le=[];return this._appendLeaves(le,V,Z=Z||10,Q=Q||0,0),le}getTile(V,Z,Q){const le=this.trees[this._limitZoom(V)],be=Math.pow(2,V),{extent:Ae,radius:Se}=this.options,xe=Se/Ae,ke=(Q-xe)/be,et=(Q+1+xe)/be,ct={features:[]};return this._addTileFeatures(le.range((Z-xe)/be,ke,(Z+1+xe)/be,et),le.points,Z,Q,be,ct),Z===0&&this._addTileFeatures(le.range(1-xe/be,ke,1,et),le.points,be,Q,be,ct),Z===be-1&&this._addTileFeatures(le.range(0,ke,xe/be,et),le.points,-1,Q,be,ct),ct.features.length?ct:null}getClusterExpansionZoom(V){let Z=this._getOriginZoom(V)-1;for(;Z<=this.options.maxZoom;){const Q=this.getChildren(V);if(Z++,Q.length!==1)break;V=Q[0].properties.cluster_id}return Z}_appendLeaves(V,Z,Q,le,be){const Ae=this.getChildren(Z);for(const Se of Ae){const xe=Se.properties;if(xe&&xe.cluster?be+xe.point_count<=le?be+=xe.point_count:be=this._appendLeaves(V,xe.cluster_id,Q,le,be):be<le?be++:V.push(Se),V.length===Q)break}return be}_addTileFeatures(V,Z,Q,le,be,Ae){for(const Se of V){const xe=Z[Se],ke=xe.numPoints;let et,ct,ot;if(ke)et=$s(xe),ct=xe.x,ot=xe.y;else{const Wt=this.points[xe.index];et=Wt.properties,ct=wn(Wt.geometry.coordinates[0]),ot=qr(Wt.geometry.coordinates[1])}const Ft={type:1,geometry:[[Math.round(this.options.extent*(ct*be-Q)),Math.round(this.options.extent*(ot*be-le))]],tags:et};let Lt;ke?Lt=xe.id:this.options.generateId?Lt=xe.index:this.points[xe.index].id&&(Lt=this.points[xe.index].id),Lt!==void 0&&(Ft.id=Lt),Ae.features.push(Ft)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,Z){const Q=[],{radius:le,extent:be,reduce:Ae,minPoints:Se}=this.options,xe=le/(be*Math.pow(2,Z));for(let ke=0;ke<V.length;ke++){const et=V[ke];if(et.zoom<=Z)continue;et.zoom=Z;const ct=this.trees[Z+1],ot=ct.within(et.x,et.y,xe),Ft=et.numPoints||1;let Lt=Ft;for(const Wt of ot){const Qt=ct.points[Wt];Qt.zoom>Z&&(Lt+=Qt.numPoints||1)}if(Lt>Ft&&Lt>=Se){let Wt=et.x*Ft,Qt=et.y*Ft,_n=Ae&&Ft>1?this._map(et,!0):null;const gn=(ke<<5)+(Z+1)+this.points.length;for(const dn of ot){const an=ct.points[dn];if(an.zoom<=Z)continue;an.zoom=Z;const ln=an.numPoints||1;Wt+=an.x*ln,Qt+=an.y*ln,an.parentId=gn,Ae&&(_n||(_n=this._map(et,!0)),Ae(_n,this._map(an)))}et.parentId=gn,Q.push(nr(Wt/Lt,Qt/Lt,gn,Lt,_n))}else if(Q.push(et),Lt>1)for(const Wt of ot){const Qt=ct.points[Wt];Qt.zoom<=Z||(Qt.zoom=Z,Q.push(Qt))}}return Q}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,Z){if(V.numPoints)return Z?sa({},V.properties):V.properties;const Q=this.points[V.index].properties,le=this.options.map(Q);return Z&&le===Q?sa({},le):le}}function nr(ae,V,Z,Q,le){return{x:Sr(ae),y:Sr(V),zoom:1/0,id:Z,parentId:-1,numPoints:Q,properties:le}}function xs(ae,V){const[Z,Q]=ae.geometry.coordinates;return{x:Sr(wn(Z)),y:Sr(qr(Q)),zoom:1/0,index:V,parentId:-1}}function ir(ae){return{type:"Feature",id:ae.id,properties:$s(ae),geometry:{type:"Point",coordinates:[(V=ae.x,360*(V-.5)),ra(ae.y)]}};var V}function $s(ae){const V=ae.numPoints,Z=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return sa(sa({},ae.properties),{cluster:!0,cluster_id:ae.id,point_count:V,point_count_abbreviated:Z})}function wn(ae){return ae/360+.5}function qr(ae){const V=Math.sin(ae*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function ra(ae){const V=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function sa(ae,V){for(const Z in V)ae[Z]=V[Z];return ae}function Ta(ae){return ae.x}function vs(ae){return ae.y}function aa(ae,V,Z,Q){for(var le,be=Q,Ae=Z-V>>1,Se=Z-V,xe=ae[V],ke=ae[V+1],et=ae[Z],ct=ae[Z+1],ot=V+3;ot<Z;ot+=3){var Ft=ft(ae[ot],ae[ot+1],xe,ke,et,ct);if(Ft>be)le=ot,be=Ft;else if(Ft===be){var Lt=Math.abs(ot-Ae);Lt<Se&&(le=ot,Se=Lt)}}be>Q&&(le-V>3&&aa(ae,V,le,Q),ae[le+2]=be,Z-le>3&&aa(ae,le,Z,Q))}function ft(ae,V,Z,Q,le,be){var Ae=le-Z,Se=be-Q;if(Ae!==0||Se!==0){var xe=((ae-Z)*Ae+(V-Q)*Se)/(Ae*Ae+Se*Se);xe>1?(Z=le,Q=be):xe>0&&(Z+=Ae*xe,Q+=Se*xe)}return(Ae=ae-Z)*Ae+(Se=V-Q)*Se}function Ee(ae,V,Z,Q){var le={id:ae===void 0?null:ae,type:V,geometry:Z,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(be){var Ae=be.geometry,Se=be.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")at(be,Ae);else if(Se==="Polygon"||Se==="MultiLineString")for(var xe=0;xe<Ae.length;xe++)at(be,Ae[xe]);else if(Se==="MultiPolygon")for(xe=0;xe<Ae.length;xe++)for(var ke=0;ke<Ae[xe].length;ke++)at(be,Ae[xe][ke])}(le),le}function at(ae,V){for(var Z=0;Z<V.length;Z+=3)ae.minX=Math.min(ae.minX,V[Z]),ae.minY=Math.min(ae.minY,V[Z+1]),ae.maxX=Math.max(ae.maxX,V[Z]),ae.maxY=Math.max(ae.maxY,V[Z+1])}function nn(ae,V,Z,Q){if(V.geometry){var le=V.geometry.coordinates,be=V.geometry.type,Ae=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Se=[],xe=V.id;if(Z.promoteId?xe=V.properties[Z.promoteId]:Z.generateId&&(xe=Q||0),be==="Point")Cn(le,Se);else if(be==="MultiPoint")for(var ke=0;ke<le.length;ke++)Cn(le[ke],Se);else if(be==="LineString")Mn(le,Se,Ae,!1);else if(be==="MultiLineString"){if(Z.lineMetrics){for(ke=0;ke<le.length;ke++)Mn(le[ke],Se=[],Ae,!1),ae.push(Ee(xe,"LineString",Se,V.properties));return}Jn(le,Se,Ae,!1)}else if(be==="Polygon")Jn(le,Se,Ae,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(ke=0;ke<V.geometry.geometries.length;ke++)nn(ae,{id:xe,geometry:V.geometry.geometries[ke],properties:V.properties},Z,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<le.length;ke++){var et=[];Jn(le[ke],et,Ae,!0),Se.push(et)}}ae.push(Ee(xe,be,Se,V.properties))}}function Cn(ae,V){V.push(ri(ae[0])),V.push(Wr(ae[1])),V.push(0)}function Mn(ae,V,Z,Q){for(var le,be,Ae=0,Se=0;Se<ae.length;Se++){var xe=ri(ae[Se][0]),ke=Wr(ae[Se][1]);V.push(xe),V.push(ke),V.push(0),Se>0&&(Ae+=Q?(le*ke-xe*be)/2:Math.sqrt(Math.pow(xe-le,2)+Math.pow(ke-be,2))),le=xe,be=ke}var et=V.length-3;V[2]=1,aa(V,0,et,Z),V[et+2]=1,V.size=Math.abs(Ae),V.start=0,V.end=V.size}function Jn(ae,V,Z,Q){for(var le=0;le<ae.length;le++){var be=[];Mn(ae[le],be,Z,Q),V.push(be)}}function ri(ae){return ae/360+.5}function Wr(ae){var V=Math.sin(ae*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function li(ae,V,Z,Q,le,be,Ae,Se){if(Q/=V,be>=(Z/=V)&&Ae<Q)return ae;if(Ae<Z||be>=Q)return null;for(var xe=[],ke=0;ke<ae.length;ke++){var et=ae[ke],ct=et.geometry,ot=et.type,Ft=le===0?et.minX:et.minY,Lt=le===0?et.maxX:et.maxY;if(Ft>=Z&&Lt<Q)xe.push(et);else if(!(Lt<Z||Ft>=Q)){var Wt=[];if(ot==="Point"||ot==="MultiPoint")wt(ct,Wt,Z,Q,le);else if(ot==="LineString")rn(ct,Wt,Z,Q,le,!1,Se.lineMetrics);else if(ot==="MultiLineString")Dr(ct,Wt,Z,Q,le,!1);else if(ot==="Polygon")Dr(ct,Wt,Z,Q,le,!0);else if(ot==="MultiPolygon")for(var Qt=0;Qt<ct.length;Qt++){var _n=[];Dr(ct[Qt],_n,Z,Q,le,!0),_n.length&&Wt.push(_n)}if(Wt.length){if(Se.lineMetrics&&ot==="LineString"){for(Qt=0;Qt<Wt.length;Qt++)xe.push(Ee(et.id,ot,Wt[Qt],et.tags));continue}ot!=="LineString"&&ot!=="MultiLineString"||(Wt.length===1?(ot="LineString",Wt=Wt[0]):ot="MultiLineString"),ot!=="Point"&&ot!=="MultiPoint"||(ot=Wt.length===3?"Point":"MultiPoint"),xe.push(Ee(et.id,ot,Wt,et.tags))}}}return xe.length?xe:null}function wt(ae,V,Z,Q,le){for(var be=0;be<ae.length;be+=3){var Ae=ae[be+le];Ae>=Z&&Ae<=Q&&(V.push(ae[be]),V.push(ae[be+1]),V.push(ae[be+2]))}}function rn(ae,V,Z,Q,le,be,Ae){for(var Se,xe,ke=tn(ae),et=le===0?fn:Xr,ct=ae.start,ot=0;ot<ae.length-3;ot+=3){var Ft=ae[ot],Lt=ae[ot+1],Wt=ae[ot+2],Qt=ae[ot+3],_n=ae[ot+4],gn=le===0?Ft:Lt,dn=le===0?Qt:_n,an=!1;Ae&&(Se=Math.sqrt(Math.pow(Ft-Qt,2)+Math.pow(Lt-_n,2))),gn<Z?dn>Z&&(xe=et(ke,Ft,Lt,Qt,_n,Z),Ae&&(ke.start=ct+Se*xe)):gn>Q?dn<Q&&(xe=et(ke,Ft,Lt,Qt,_n,Q),Ae&&(ke.start=ct+Se*xe)):ts(ke,Ft,Lt,Wt),dn<Z&&gn>=Z&&(xe=et(ke,Ft,Lt,Qt,_n,Z),an=!0),dn>Q&&gn<=Q&&(xe=et(ke,Ft,Lt,Qt,_n,Q),an=!0),!be&&an&&(Ae&&(ke.end=ct+Se*xe),V.push(ke),ke=tn(ae)),Ae&&(ct+=Se)}var ln=ae.length-3;Ft=ae[ln],Lt=ae[ln+1],Wt=ae[ln+2],(gn=le===0?Ft:Lt)>=Z&&gn<=Q&&ts(ke,Ft,Lt,Wt),ln=ke.length-3,be&&ln>=3&&(ke[ln]!==ke[0]||ke[ln+1]!==ke[1])&&ts(ke,ke[0],ke[1],ke[2]),ke.length&&V.push(ke)}function tn(ae){var V=[];return V.size=ae.size,V.start=ae.start,V.end=ae.end,V}function Dr(ae,V,Z,Q,le,be){for(var Ae=0;Ae<ae.length;Ae++)rn(ae[Ae],V,Z,Q,le,be,!1)}function ts(ae,V,Z,Q){ae.push(V),ae.push(Z),ae.push(Q)}function fn(ae,V,Z,Q,le,be){var Ae=(be-V)/(Q-V);return ae.push(be),ae.push(Z+(le-Z)*Ae),ae.push(1),Ae}function Xr(ae,V,Z,Q,le,be){var Ae=(be-Z)/(le-Z);return ae.push(V+(Q-V)*Ae),ae.push(be),ae.push(1),Ae}function oa(ae,V){for(var Z=[],Q=0;Q<ae.length;Q++){var le,be=ae[Q],Ae=be.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")le=Er(be.geometry,V);else if(Ae==="MultiLineString"||Ae==="Polygon"){le=[];for(var Se=0;Se<be.geometry.length;Se++)le.push(Er(be.geometry[Se],V))}else if(Ae==="MultiPolygon")for(le=[],Se=0;Se<be.geometry.length;Se++){for(var xe=[],ke=0;ke<be.geometry[Se].length;ke++)xe.push(Er(be.geometry[Se][ke],V));le.push(xe)}Z.push(Ee(be.id,Ae,le,be.tags))}return Z}function Er(ae,V){var Z=[];Z.size=ae.size,ae.start!==void 0&&(Z.start=ae.start,Z.end=ae.end);for(var Q=0;Q<ae.length;Q+=3)Z.push(ae[Q]+V,ae[Q+1],ae[Q+2]);return Z}function Sa(ae,V){if(ae.transformed)return ae;var Z,Q,le,be=1<<ae.z,Ae=ae.x,Se=ae.y;for(Z=0;Z<ae.features.length;Z++){var xe=ae.features[Z],ke=xe.geometry,et=xe.type;if(xe.geometry=[],et===1)for(Q=0;Q<ke.length;Q+=2)xe.geometry.push(ni(ke[Q],ke[Q+1],V,be,Ae,Se));else for(Q=0;Q<ke.length;Q++){var ct=[];for(le=0;le<ke[Q].length;le+=2)ct.push(ni(ke[Q][le],ke[Q][le+1],V,be,Ae,Se));xe.geometry.push(ct)}}return ae.transformed=!0,ae}function ni(ae,V,Z,Q,le,be){return[Math.round(Z*(ae*Q-le)),Math.round(Z*(V*Q-be))]}function ii(ae,V,Z,Q,le){for(var be=V===le.maxZoom?0:le.tolerance/((1<<V)*le.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:Q,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<ae.length;Se++){Ae.numFeatures++,Va(Ae,ae[Se],be,le);var xe=ae[Se].minX,ke=ae[Se].minY,et=ae[Se].maxX,ct=ae[Se].maxY;xe<Ae.minX&&(Ae.minX=xe),ke<Ae.minY&&(Ae.minY=ke),et>Ae.maxX&&(Ae.maxX=et),ct>Ae.maxY&&(Ae.maxY=ct)}return Ae}function Va(ae,V,Z,Q){var le=V.geometry,be=V.type,Ae=[];if(be==="Point"||be==="MultiPoint")for(var Se=0;Se<le.length;Se+=3)Ae.push(le[Se]),Ae.push(le[Se+1]),ae.numPoints++,ae.numSimplified++;else if(be==="LineString")la(Ae,le,ae,Z,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(Se=0;Se<le.length;Se++)la(Ae,le[Se],ae,Z,be==="Polygon",Se===0);else if(be==="MultiPolygon")for(var xe=0;xe<le.length;xe++){var ke=le[xe];for(Se=0;Se<ke.length;Se++)la(Ae,ke[Se],ae,Z,!0,Se===0)}if(Ae.length){var et=V.tags||null;if(be==="LineString"&&Q.lineMetrics){for(var ct in et={},V.tags)et[ct]=V.tags[ct];et.mapbox_clip_start=le.start/le.size,et.mapbox_clip_end=le.end/le.size}var ot={geometry:Ae,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:et};V.id!==null&&(ot.id=V.id),ae.features.push(ot)}}function la(ae,V,Z,Q,le,be){var Ae=Q*Q;if(Q>0&&V.size<(le?Ae:Q))Z.numPoints+=V.length/3;else{for(var Se=[],xe=0;xe<V.length;xe+=3)(Q===0||V[xe+2]>Ae)&&(Z.numSimplified++,Se.push(V[xe]),Se.push(V[xe+1])),Z.numPoints++;le&&function(ke,et){for(var ct=0,ot=0,Ft=ke.length,Lt=Ft-2;ot<Ft;Lt=ot,ot+=2)ct+=(ke[ot]-ke[Lt])*(ke[ot+1]+ke[Lt+1]);if(ct>0===et)for(ot=0,Ft=ke.length;ot<Ft/2;ot+=2){var Wt=ke[ot],Qt=ke[ot+1];ke[ot]=ke[Ft-2-ot],ke[ot+1]=ke[Ft-1-ot],ke[Ft-2-ot]=Wt,ke[Ft-1-ot]=Qt}}(Se,be),ae.push(Se)}}function Zr(ae,V){var Z=(V=this.options=function(le,be){for(var Ae in be)le[Ae]=be[Ae];return le}(Object.create(this.options),V)).debug;if(Z&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q=function(le,be){var Ae=[];if(le.type==="FeatureCollection")for(var Se=0;Se<le.features.length;Se++)nn(Ae,le.features[Se],be,Se);else nn(Ae,le.type==="Feature"?le:{geometry:le},be);return Ae}(ae,V);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Q=function(le,be){var Ae=be.buffer/be.extent,Se=le,xe=li(le,1,-1-Ae,Ae,0,-1,2,be),ke=li(le,1,1-Ae,2+Ae,0,-1,2,be);return(xe||ke)&&(Se=li(le,1,-Ae,1+Ae,0,-1,2,be)||[],xe&&(Se=oa(xe,1).concat(Se)),ke&&(Se=Se.concat(oa(ke,-1)))),Se}(Q,V),Q.length&&this.splitTile(Q,0,0,0),Z&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wi(ae,V,Z){return 32*((1<<ae)*Z+V)+ae}function ur(ae,V){const Z=ae.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const Q=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!Q)return V(null,null);const le=new pe(Q.features);let be=it.exports(le);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),V(null,{vectorTile:le,rawData:be.buffer})}Zr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zr.prototype.splitTile=function(ae,V,Z,Q,le,be,Ae){for(var Se=[ae,V,Z,Q],xe=this.options,ke=xe.debug;Se.length;){Q=Se.pop(),Z=Se.pop(),V=Se.pop(),ae=Se.pop();var et=1<<V,ct=wi(V,Z,Q),ot=this.tiles[ct];if(!ot&&(ke>1&&console.time("creation"),ot=this.tiles[ct]=ii(ae,V,Z,Q,xe),this.tileCoords.push({z:V,x:Z,y:Q}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,Z,Q,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));var Ft="z"+V;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(ot.source=ae,le){if(V===xe.maxZoom||V===le)continue;var Lt=1<<le-V;if(Z!==Math.floor(be/Lt)||Q!==Math.floor(Ae/Lt))continue}else if(V===xe.indexMaxZoom||ot.numPoints<=xe.indexMaxPoints)continue;if(ot.source=null,ae.length!==0){ke>1&&console.time("clipping");var Wt,Qt,_n,gn,dn,an,ln=.5*xe.buffer/xe.extent,Di=.5-ln,ci=.5+ln,Oi=1+ln;Wt=Qt=_n=gn=null,dn=li(ae,et,Z-ln,Z+ci,0,ot.minX,ot.maxX,xe),an=li(ae,et,Z+Di,Z+Oi,0,ot.minX,ot.maxX,xe),ae=null,dn&&(Wt=li(dn,et,Q-ln,Q+ci,1,ot.minY,ot.maxY,xe),Qt=li(dn,et,Q+Di,Q+Oi,1,ot.minY,ot.maxY,xe),dn=null),an&&(_n=li(an,et,Q-ln,Q+ci,1,ot.minY,ot.maxY,xe),gn=li(an,et,Q+Di,Q+Oi,1,ot.minY,ot.maxY,xe),an=null),ke>1&&console.timeEnd("clipping"),Se.push(Wt||[],V+1,2*Z,2*Q),Se.push(Qt||[],V+1,2*Z,2*Q+1),Se.push(_n||[],V+1,2*Z+1,2*Q),Se.push(gn||[],V+1,2*Z+1,2*Q+1)}}},Zr.prototype.getTile=function(ae,V,Z){var Q=this.options,le=Q.extent,be=Q.debug;if(ae<0||ae>24)return null;var Ae=1<<ae,Se=wi(ae,V=(V%Ae+Ae)%Ae,Z);if(this.tiles[Se])return Sa(this.tiles[Se],le);be>1&&console.log("drilling down to z%d-%d-%d",ae,V,Z);for(var xe,ke=ae,et=V,ct=Z;!xe&&ke>0;)ke--,et=Math.floor(et/2),ct=Math.floor(ct/2),xe=this.tiles[wi(ke,et,ct)];return xe&&xe.source?(be>1&&console.log("found parent tile z%d-%d-%d",ke,et,ct),be>1&&console.time("drilling down"),this.splitTile(xe.source,ke,et,ct,ae,V,Z),be>1&&console.timeEnd("drilling down"),this.tiles[Se]?Sa(this.tiles[Se],le):null):null};class ca extends H{constructor(V,Z,Q,le){super(V,Z,Q,ur),le&&(this.loadGeoJSON=le)}loadData(V,Z){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const le=!!(V&&V.request&&V.request.collectResourceTiming)&&new a.RequestPerformance(V.request);this._pendingCallback=Z,this._pendingRequest=this.loadGeoJSON(V,(be,Ae)=>{if(delete this._pendingCallback,delete this._pendingRequest,be||!Ae)return Z(be);if(typeof Ae!="object")return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{ne(Ae,!0);try{if(V.filter){const xe=a.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(et=>`${et.key}: ${et.message}`).join(", "));Ae={type:"FeatureCollection",features:Ae.features.filter(et=>xe.value.evaluate({zoom:0},et))}}this._geoJSONIndex=V.cluster?new ia(function({superclusterOptions:xe,clusterProperties:ke}){if(!ke||!xe)return xe;const et={},ct={},ot={accumulated:null,zoom:0},Ft={properties:null},Lt=Object.keys(ke);for(const Wt of Lt){const[Qt,_n]=ke[Wt],gn=a.createExpression(_n),dn=a.createExpression(typeof Qt=="string"?[Qt,["accumulated"],["get",Wt]]:Qt);et[Wt]=gn.value,ct[Wt]=dn.value}return xe.map=Wt=>{Ft.properties=Wt;const Qt={};for(const _n of Lt)Qt[_n]=et[_n].evaluate(ot,Ft);return Qt},xe.reduce=(Wt,Qt)=>{Ft.properties=Qt;for(const _n of Lt)ot.accumulated=Wt[_n],Wt[_n]=ct[_n].evaluate(ot,Ft)},xe}(V)).load(Ae.features):function(xe,ke){return new Zr(xe,ke)}(Ae,V.geojsonVtOptions)}catch(xe){return Z(xe)}this.loaded={};const Se={};if(le){const xe=le.finish();xe&&(Se.resourceTiming={},Se.resourceTiming[V.source]=JSON.parse(JSON.stringify(xe)))}Z(null,Se)}})}reloadTile(V,Z){const Q=this.loaded;return Q&&Q[V.uid]?super.reloadTile(V,Z):this.loadTile(V,Z)}loadGeoJSON(V,Z){if(V.request)return a.getJSON(V.request,Z);if(typeof V.data=="string")try{Z(null,JSON.parse(V.data))}catch{Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}else Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(V,Z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Z()}getClusterExpansionZoom(V,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(Q){Z(Q)}}getClusterChildren(V,Z){try{Z(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(Q){Z(Q)}}getClusterLeaves(V,Z){try{Z(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(Q){Z(Q)}}}class Hs{constructor(V){this.self=V,this.actor=new a.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:H,geojson:ca},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,Q)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=Q},this.self.registerRTLTextPlugin=Z=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=Z.applyArabicShaping,a.plugin.processBidirectionalText=Z.processBidirectionalText,a.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}setReferrer(V,Z){this.referrer=Z}setImages(V,Z,Q){this.availableImages[V]=Z;for(const le in this.workerSources[V]){const be=this.workerSources[V][le];for(const Ae in be)be[Ae].availableImages=Z}Q()}setLayers(V,Z,Q){this.getLayerIndex(V).replace(Z),Q()}updateLayers(V,Z,Q){this.getLayerIndex(V).update(Z.layers,Z.removedIds),Q()}loadTile(V,Z,Q){this.getWorkerSource(V,Z.type,Z.source).loadTile(Z,Q)}loadDEMTile(V,Z,Q){this.getDEMWorkerSource(V,Z.source).loadTile(Z,Q)}reloadTile(V,Z,Q){this.getWorkerSource(V,Z.type,Z.source).reloadTile(Z,Q)}abortTile(V,Z,Q){this.getWorkerSource(V,Z.type,Z.source).abortTile(Z,Q)}removeTile(V,Z,Q){this.getWorkerSource(V,Z.type,Z.source).removeTile(Z,Q)}removeDEMTile(V,Z){this.getDEMWorkerSource(V,Z.source).removeTile(Z)}removeSource(V,Z,Q){if(!this.workerSources[V]||!this.workerSources[V][Z.type]||!this.workerSources[V][Z.type][Z.source])return;const le=this.workerSources[V][Z.type][Z.source];delete this.workerSources[V][Z.type][Z.source],le.removeSource!==void 0?le.removeSource(Z,Q):Q()}loadWorkerSource(V,Z,Q){try{this.self.importScripts(Z.url),Q()}catch(le){Q(le.toString())}}syncRTLPluginState(V,Z,Q){try{a.plugin.setState(Z);const le=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&le!=null){this.self.importScripts(le);const be=a.plugin.isParsed();Q(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${le}`),be)}}catch(le){Q(le.toString())}}getAvailableImages(V){let Z=this.availableImages[V];return Z||(Z=[]),Z}getLayerIndex(V){let Z=this.layerIndexes[V];return Z||(Z=this.layerIndexes[V]=new S),Z}getWorkerSource(V,Z,Q){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][Z]||(this.workerSources[V][Z]={}),!this.workerSources[V][Z][Q]){const le={send:(be,Ae,Se)=>{this.actor.send(be,Ae,Se,V)}};this.workerSources[V][Z][Q]=new this.workerSourceTypes[Z](le,this.getLayerIndex(V),this.getAvailableImages(V))}return this.workerSources[V][Z][Q]}getDEMWorkerSource(V,Z){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][Z]||(this.demWorkerSources[V][Z]=new ie),this.demWorkerSources[V][Z]}enforceCacheSizeLimit(V,Z){a.enforceCacheSizeLimit(Z)}}return a.isWorker()&&(self.worker=new Hs(self)),Hs}),c(["./shared"],function(a){var _=x;function x(v){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,T,A=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(A);try{T=new Worker(M),y=!0}catch{y=!1}return T&&T.terminate(),URL.revokeObjectURL(M),y}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var y=document.createElement("canvas");y.width=y.height=1;var T=y.getContext("2d");if(!T)return!1;var A=T.getImageData(0,0,1,1);return A&&A.width===y.width}()?(S[p=o&&o.failIfMajorPerformanceCaveat]===void 0&&(S[p]=function(y){var T,A=function(M){var B=document.createElement("canvas"),z=Object.create(x.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=M,B.getContext("webgl",z)||B.getContext("experimental-webgl",z)}(y);if(!A)return!1;try{T=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!T||A.isContextLost())&&(A.shaderSource(T,"void main() {}"),A.compileShader(T),A.getShaderParameter(T,A.COMPILE_STATUS)===!0)}(p)),S[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var p}(v)}var S={};function R(v,o){if(Array.isArray(v)){if(!Array.isArray(o)||v.length!==o.length)return!1;for(let p=0;p<v.length;p++)if(!R(v[p],o[p]))return!1;return!0}if(typeof v=="object"&&v!==null&&o!==null){if(typeof o!="object"||Object.keys(v).length!==Object.keys(o).length)return!1;for(const p in v)if(!R(v[p],o[p]))return!1;return!0}return v===o}x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class I{static testProp(o){if(!I.docStyle)return o[0];for(let p=0;p<o.length;p++)if(o[p]in I.docStyle)return o[p];return o[0]}static create(o,p,y){const T=window.document.createElement(o);return p!==void 0&&(T.className=p),y&&y.appendChild(T),T}static createNS(o,p){return window.document.createElementNS(o,p)}static disableDrag(){I.docStyle&&I.selectProp&&(I.userSelect=I.docStyle[I.selectProp],I.docStyle[I.selectProp]="none")}static enableDrag(){I.docStyle&&I.selectProp&&(I.docStyle[I.selectProp]=I.userSelect)}static setTransform(o,p){o.style[I.transformProp]=p}static addEventListener(o,p,y,T={}){o.addEventListener(p,y,"passive"in T?T:T.capture)}static removeEventListener(o,p,y,T={}){o.removeEventListener(p,y,"passive"in T?T:T.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",I.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",I.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",I.suppressClickInternal,!0)},0)}static mousePos(o,p){const y=o.getBoundingClientRect();return new a.pointGeometry(p.clientX-y.left-o.clientLeft,p.clientY-y.top-o.clientTop)}static touchPos(o,p){const y=o.getBoundingClientRect(),T=[];for(let A=0;A<p.length;A++)T.push(new a.pointGeometry(p[A].clientX-y.left-o.clientLeft,p[A].clientY-y.top-o.clientTop));return T}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}I.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,I.selectProp=I.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),I.transformProp=I.testProp(["transform","WebkitTransform"]);class N{constructor(o){this._transformRequestFn=o}transformRequest(o,p){return this._transformRequestFn&&this._transformRequestFn(o,p)||{url:o}}normalizeSpriteURL(o,p,y){const T=function(A){const M=A.match(L);if(!M)throw new Error(`Unable to parse URL "${A}"`);return{protocol:M[1],authority:M[2],path:M[3]||"/",params:M[4]?M[4].split("&"):[]}}(o);return T.path+=`${p}${y}`,function(A){const M=A.params.length?`?${A.params.join("&")}`:"";return`${A.protocol}://${A.authority}${A.path}${M}`}(T)}setTransformRequest(o){this._transformRequestFn=o}}const L=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class H{constructor(o,p,y,T){this.context=o,this.format=y,this.texture=o.gl.createTexture(),this.update(p,T)}update(o,p,y){const{width:T,height:A}=o,M=!(this.size&&this.size[0]===T&&this.size[1]===A||y),{context:B}=this,{gl:z}=B;if(this.useMipmap=!!(p&&p.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!p||p.premultiply!==!1)),M)this.size=[T,A],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.isImageBitmap(o)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,o):z.texImage2D(z.TEXTURE_2D,0,this.format,T,A,0,this.format,z.UNSIGNED_BYTE,o.data);else{const{x:U,y:$}=y||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.isImageBitmap(o)?z.texSubImage2D(z.TEXTURE_2D,0,U,$,z.RGBA,z.UNSIGNED_BYTE,o):z.texSubImage2D(z.TEXTURE_2D,0,U,$,T,A,z.RGBA,z.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(o,p,y){const{context:T}=this,{gl:A}=T;A.bindTexture(A.TEXTURE_2D,this.texture),y!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=A.LINEAR),o!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,o),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,y||o),this.filter=o),p!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,p),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ie(v){const{userImage:o}=v;return!!(o&&o.render&&o.render())&&(v.data.replace(new Uint8Array(o.data.buffer)),!0)}class ne extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,y);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,p){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,p)&&(this.images[o]=p)}_validate(o,p){let y=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),y=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),y=!1),this._validateContent(p.content,p)||(this.fire(new a.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),y=!1),y}_validateStretch(o,p){if(!o)return!0;let y=0;for(const T of o){if(T[0]<y||T[1]<T[0]||p<T[1])return!1;y=T[1]}return!0}_validateContent(o,p){return!(o&&(o.length!==4||o[0]<0||p.data.width<o[0]||o[1]<0||p.data.height<o[1]||o[2]<0||p.data.width<o[2]||o[3]<0||p.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,p){const y=this.images[o];if(y.data.width!==p.data.width||y.data.height!==p.data.height)throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${p.data.width}x${p.data.height}).`);p.version=y.version+1,this.images[o]=p,this.updatedImages[o]=!0}removeImage(o){const p=this.images[o];delete this.images[o],delete this.patterns[o],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,p){let y=!0;if(!this.isLoaded())for(const T of o)this.images[T]||(y=!1);this.isLoaded()||y?this._notify(o,p):this.requestors.push({ids:o,callback:p})}_notify(o,p){const y={};for(const T of o){this.images[T]||this.fire(new a.Event("styleimagemissing",{id:T}));const A=this.images[T];A?y[T]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:a.warnOnce(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,y)}getPixelSize(){const{width:o,height:p}=this.atlasImage;return{width:o,height:p}}getPattern(o){const p=this.patterns[o],y=this.getImage(o);if(!y)return null;if(p&&p.position.version===y.version)return p.position;if(p)p.position.version=y.version;else{const T={w:y.data.width+2,h:y.data.height+2,x:0,y:0},A=new a.ImagePosition(T,y);this.patterns[o]={bin:T,position:A}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const p=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new H(o,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const A in this.patterns)o.push(this.patterns[A].bin);const{w:p,h:y}=a.potpack(o),T=this.atlasImage;T.resize({width:p||1,height:y||1});for(const A in this.patterns){const{bin:M}=this.patterns[A],B=M.x+1,z=M.y+1,U=this.images[A].data,$=U.width,Y=U.height;a.RGBAImage.copy(U,T,{x:0,y:0},{x:B,y:z},{width:$,height:Y}),a.RGBAImage.copy(U,T,{x:0,y:Y-1},{x:B,y:z-1},{width:$,height:1}),a.RGBAImage.copy(U,T,{x:0,y:0},{x:B,y:z+Y},{width:$,height:1}),a.RGBAImage.copy(U,T,{x:$-1,y:0},{x:B-1,y:z},{width:1,height:Y}),a.RGBAImage.copy(U,T,{x:0,y:0},{x:B+$,y:z},{width:1,height:Y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const p of o){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const y=this.images[p];y||a.warnOnce(`Image with ID: "${p}" was not found`),ie(y)&&this.updateImage(p,y)}}}const he=1e20;function re(v,o,p,y,T,A,M,B,z){for(let U=o;U<o+y;U++)ge(v,p*A+U,A,T,M,B,z);for(let U=p;U<p+T;U++)ge(v,U*A+o,1,y,M,B,z)}function ge(v,o,p,y,T,A,M){A[0]=0,M[0]=-he,M[1]=he,T[0]=v[o];for(let B=1,z=0,U=0;B<y;B++){T[B]=v[o+B*p];const $=B*B;do{const Y=A[z];U=(T[B]-T[Y]+$-Y*Y)/(B-Y)/2}while(U<=M[z]&&--z>-1);z++,A[z]=B,M[z]=U,M[z+1]=he}for(let B=0,z=0;B<y;B++){for(;M[z+1]<B;)z++;const U=A[z],$=B-U;v[o+B*p]=T[U]+$*$}}class _e{constructor(o,p){this.requestManager=o,this.localIdeographFontFamily=p,this.entries={}}setURL(o){this.url=o}getGlyphs(o,p){const y=[];for(const T in o)for(const A of o[T])y.push({stack:T,id:A});a.asyncAll(y,({stack:T,id:A},M)=>{let B=this.entries[T];B||(B=this.entries[T]={glyphs:{},requests:{},ranges:{}});let z=B.glyphs[A];if(z!==void 0)return void M(null,{stack:T,id:A,glyph:z});if(z=this._tinySDF(B,T,A),z)return B.glyphs[A]=z,void M(null,{stack:T,id:A,glyph:z});const U=Math.floor(A/256);if(256*U>65535)return void M(new Error("glyphs > 65535 not supported"));if(B.ranges[U])return void M(null,{stack:T,id:A,glyph:z});let $=B.requests[U];$||($=B.requests[U]=[],_e.loadGlyphRange(T,U,this.url,this.requestManager,(Y,K)=>{if(K){for(const fe in K)this._doesCharSupportLocalGlyph(+fe)||(B.glyphs[+fe]=K[+fe]);B.ranges[U]=!0}for(const fe of $)fe(Y,K);delete B.requests[U]})),$.push((Y,K)=>{Y?M(Y):K&&M(null,{stack:T,id:A,glyph:K[A]||null})})},(T,A)=>{if(T)p(T);else if(A){const M={};for(const{stack:B,id:z,glyph:U}of A)(M[B]||(M[B]={}))[z]=U&&{id:U.id,bitmap:U.bitmap.clone(),metrics:U.metrics};p(null,M)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](o)||a.unicodeBlockLookup["Hangul Syllables"](o)||a.unicodeBlockLookup.Hiragana(o)||a.unicodeBlockLookup.Katakana(o))}_tinySDF(o,p,y){const T=this.localIdeographFontFamily;if(!T||!this._doesCharSupportLocalGlyph(y))return;let A=o.tinySDF;if(!A){let B="400";/bold/i.test(p)?B="900":/medium/i.test(p)?B="500":/light/i.test(p)&&(B="200"),A=o.tinySDF=new _e.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:T,fontWeight:B})}const M=A.draw(String.fromCharCode(y));return{id:y,bitmap:new a.AlphaImage({width:M.width||30,height:M.height||30},M.data),metrics:{width:M.glyphWidth||24,height:M.glyphHeight||24,left:M.glyphLeft||0,top:M.glyphTop-27||-8,advance:M.glyphAdvance||24}}}}_e.loadGlyphRange=function(v,o,p,y,T){const A=256*o,M=A+255,B=y.transformRequest(p.replace("{fontstack}",v).replace("{range}",`${A}-${M}`),a.ResourceType.Glyphs);a.getArrayBuffer(B,(z,U)=>{if(z)T(z);else if(U){const $={};for(const Y of a.parseGlyphPbf(U))$[Y.id]=Y;T(null,$)}})},_e.TinySDF=class{constructor({fontSize:v=24,buffer:o=3,radius:p=8,cutoff:y=.25,fontFamily:T="sans-serif",fontWeight:A="normal",fontStyle:M="normal"}={}){this.buffer=o,this.cutoff=y,this.radius=p;const B=this.size=v+4*o,z=this._createCanvas(B),U=this.ctx=z.getContext("2d",{willReadFrequently:!0});U.font=`${M} ${A} ${v}px ${T}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(v){const o=document.createElement("canvas");return o.width=o.height=v,o}draw(v){const{width:o,actualBoundingBoxAscent:p,actualBoundingBoxDescent:y,actualBoundingBoxLeft:T,actualBoundingBoxRight:A}=this.ctx.measureText(v),M=Math.ceil(p),B=Math.min(this.size-this.buffer,Math.ceil(A-T)),z=Math.min(this.size-this.buffer,M+Math.ceil(y)),U=B+2*this.buffer,$=z+2*this.buffer,Y=Math.max(U*$,0),K=new Uint8ClampedArray(Y),fe={data:K,width:U,height:$,glyphWidth:B,glyphHeight:z,glyphTop:M,glyphLeft:0,glyphAdvance:o};if(B===0||z===0)return fe;const{ctx:se,buffer:ue,gridInner:Re,gridOuter:Pe}=this;se.clearRect(ue,ue,B,z),se.fillText(v,ue,ue+M);const $e=se.getImageData(ue,ue,B,z);Pe.fill(he,0,Y),Re.fill(0,0,Y);for(let me=0;me<z;me++)for(let Fe=0;Fe<B;Fe++){const He=$e.data[4*(me*B+Fe)+3]/255;if(He===0)continue;const rt=(me+ue)*U+Fe+ue;if(He===1)Pe[rt]=0,Re[rt]=he;else{const st=.5-He;Pe[rt]=st>0?st*st:0,Re[rt]=st<0?st*st:0}}re(Pe,0,0,U,$,U,this.f,this.v,this.z),re(Re,ue,ue,B,z,U,this.f,this.v,this.z);for(let me=0;me<Y;me++){const Fe=Math.sqrt(Pe[me])-Math.sqrt(Re[me]);K[me]=Math.round(255-255*(Fe/this.radius+this.cutoff))}return fe}};const pe=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(v,o){return a.sphericalToCartesian(v.expression.evaluate(o))}interpolate(v,o,p){return{x:a.number(v.x,o.x,p),y:a.number(v.y,o.y,p),z:a.number(v.z,o.z,p)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),it="-transition";class mt extends a.Evented{constructor(o){super(),this._transitionable=new a.Transitionable(pe),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,p={}){if(!this._validate(a.validateLight,o,p))for(const y in o){const T=o[y];y.endsWith(it)?this._transitionable.setTransition(y.slice(0,-it.length),T):this._transitionable.setValue(y,T)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,p,y){return(!y||y.validate!==!1)&&a.emitValidationErrors(this,o.call(a.validateStyle,a.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class nt{constructor(o,p){this.width=o,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,p){const y=o.join(",")+String(p);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(o,p)),this.dashEntry[y]}getDashRanges(o,p,y){const T=[];let A=o.length%2==1?-o[o.length-1]*y:0,M=o[0]*y,B=!0;T.push({left:A,right:M,isDash:B,zeroLength:o[0]===0});let z=o[0];for(let U=1;U<o.length;U++){B=!B;const $=o[U];A=z*y,z+=$,M=z*y,T.push({left:A,right:M,isDash:B,zeroLength:$===0})}return T}addRoundDash(o,p,y){const T=p/2;for(let A=-y;A<=y;A++){const M=this.width*(this.nextRow+y+A);let B=0,z=o[B];for(let U=0;U<this.width;U++){U/z.right>1&&(z=o[++B]);const $=Math.abs(U-z.left),Y=Math.abs(U-z.right),K=Math.min($,Y);let fe;const se=A/y*(T+1);if(z.isDash){const ue=T-Math.abs(se);fe=Math.sqrt(K*K+ue*ue)}else fe=T-Math.sqrt(K*K+se*se);this.data[M+U]=Math.max(0,Math.min(255,fe+128))}}}addRegularDash(o){for(let B=o.length-1;B>=0;--B){const z=o[B],U=o[B+1];z.zeroLength?o.splice(B,1):U&&U.isDash===z.isDash&&(U.left=z.left,o.splice(B,1))}const p=o[0],y=o[o.length-1];p.isDash===y.isDash&&(p.left=y.left-this.width,y.right=p.right+this.width);const T=this.width*this.nextRow;let A=0,M=o[A];for(let B=0;B<this.width;B++){B/M.right>1&&(M=o[++A]);const z=Math.abs(B-M.left),U=Math.abs(B-M.right),$=Math.min(z,U);this.data[T+B]=Math.max(0,Math.min(255,(M.isDash?$:-$)+128))}}addDash(o,p){const y=p?7:0,T=2*y+1;if(this.nextRow+T>this.height)return a.warnOnce("LineAtlas out of space"),null;let A=0;for(let B=0;B<o.length;B++)A+=o[B];if(A!==0){const B=this.width/A,z=this.getDashRanges(o,this.width,B);p?this.addRoundDash(z,B,y):this.addRegularDash(z)}const M={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:A};return this.nextRow+=T,this.dirty=!0,M}bind(o){const p=o.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))}}class Ce{constructor(o,p){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const y=this.workerPool.acquire(this.id);for(let T=0;T<y.length;T++){const A=new Ce.Actor(y[T],p,this.id);A.name=`Worker ${T}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,p,y){a.asyncAll(this.actors,(T,A)=>{T.send(o,p,A)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ht(v,o,p){const y=function(T,A){if(T)return p(T);if(A){const M=a.pick(a.extend(A,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(M.vectorLayers=A.vector_layers,M.vectorLayerIds=M.vectorLayers.map(B=>B.id)),p(null,M)}};return v.url?a.getJSON(o.transformRequest(v.url,a.ResourceType.Source),y):a.exported.frame(()=>y(null,v))}Ce.Actor=a.Actor;class Me{constructor(o,p,y){this.bounds=a.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=p||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const p=Math.pow(2,o.z),y=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*p),T=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*p),A=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*p),M=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*p);return o.x>=y&&o.x<A&&o.y>=T&&o.y<M}}class Ve extends a.Evented{constructor(o,p,y,T){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(p,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ht(this._options,this.map._requestManager,(o,p)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new a.ErrorEvent(o)):p&&(a.extend(this,p),p.bounds&&(this.tileBounds=new Me(p.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(o,p){const y=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),T={request:this.map._requestManager.transformRequest(y,a.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function A(M,B){return delete o.request,o.aborted?p(null):M&&M.status!==404?p(M):(B&&B.resourceTiming&&(o.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&o.setExpiryData(B),o.loadVectorData(B,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}T.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=p:o.request=o.actor.send("reloadTile",T,A.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",T,A.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Le extends a.Evented{constructor(o,p,y,T){super(),this.id=o,this.dispatcher=y,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},p),a.extend(this,a.pick(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ht(this._options,this.map._requestManager,(o,p)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new a.ErrorEvent(o)):p&&(a.extend(this,p),p.bounds&&(this.tileBounds=new Me(p.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,p){const y=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=a.getImage(this.map._requestManager.transformRequest(y,a.ResourceType.Tile),(T,A,M)=>{if(delete o.request,o.aborted)o.state="unloaded",p(null);else if(T)o.state="errored",p(T);else if(A){this.map._refreshExpiredTiles&&o.setExpiryData(M);const B=this.map.painter.context,z=B.gl;o.texture=this.map.painter.getTileTexture(A.width),o.texture?o.texture.update(A,{useMipmap:!0}):(o.texture=new H(B,A,z.RGBA,{useMipmap:!0}),o.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&z.texParameterf(z.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),o.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),p(null)}})}abortTile(o,p){o.request&&(o.request.cancel(),delete o.request),p()}unloadTile(o,p){o.texture&&this.map.painter.saveTileTexture(o.texture),p()}hasTransition(){return!1}}let lt;class we extends Le{constructor(o,p,y,T){super(o,p,y,T),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,p){const y=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function T(A,M){A&&(o.state="errored",p(A)),M&&(o.dem=M,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",p(null))}o.request=a.getImage(this.map._requestManager.transformRequest(y,a.ResourceType.Tile),(function(A,M){if(delete o.request,o.aborted)o.state="unloaded",p(null);else if(A)o.state="errored",p(A);else if(M){this.map._refreshExpiredTiles&&o.setExpiryData(M),delete M.cacheControl,delete M.expires;const B=a.isImageBitmap(M)&&(lt==null&&(lt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),lt)?M:a.exported.getImageData(M,1),z={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:B,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",z,T.bind(this)))}}).bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const p=o.canonical,y=Math.pow(2,p.z),T=(p.x-1+y)%y,A=p.x===0?o.wrap-1:o.wrap,M=(p.x+1+y)%y,B=p.x+1===y?o.wrap+1:o.wrap,z={};return z[new a.OverscaledTileID(o.overscaledZ,A,p.z,T,p.y).key]={backfilled:!1},z[new a.OverscaledTileID(o.overscaledZ,B,p.z,M,p.y).key]={backfilled:!1},p.y>0&&(z[new a.OverscaledTileID(o.overscaledZ,A,p.z,T,p.y-1).key]={backfilled:!1},z[new a.OverscaledTileID(o.overscaledZ,o.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},z[new a.OverscaledTileID(o.overscaledZ,B,p.z,M,p.y-1).key]={backfilled:!1}),p.y+1<y&&(z[new a.OverscaledTileID(o.overscaledZ,A,p.z,T,p.y+1).key]={backfilled:!1},z[new a.OverscaledTileID(o.overscaledZ,o.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},z[new a.OverscaledTileID(o.overscaledZ,B,p.z,M,p.y+1).key]={backfilled:!1}),z}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class Ye extends a.Evented{constructor(o,p,y,T){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(T),this._data=p.data,this._options=a.extend({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;const A=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*A,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*A,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:a.EXTENT,radius:(p.clusterRadius||50)*A,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},p),this}getClusterChildren(o,p){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},p),this}getClusterLeaves(o,p,y,T){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:p,offset:y},T),this}_updateWorkerData(o){const p=a.extend({},this.workerOptions),y=this._data;typeof y=="string"?(p.request=this.map._requestManager.transformRequest(a.exported.resolveURL(y),a.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(y),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,p,(T,A)=>{if(this._pendingLoads--,this._removed||A&&A.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source",sourceDataType:o}));let M=null;if(A&&A.resourceTiming&&A.resourceTiming[this.id]&&(M=A.resourceTiming[this.id].slice(0)),T)return void this.fire(new a.ErrorEvent(T));const B={dataType:"source",sourceDataType:o};this._collectResourceTiming&&M&&M.length>0&&a.extend(B,{resourceTiming:M}),this.fire(new a.Event("data",B))})}loaded(){return this._pendingLoads===0}loadTile(o,p){const y=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const T={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(y,T,(A,M)=>(delete o.request,o.unloadVectorData(),o.aborted?p(null):A?p(A):(o.loadVectorData(M,this.map.painter,y==="reloadTile"),p(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var gt=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Dt extends a.Evented{constructor(o,p,y,T){super(),this.id=o,this.dispatcher=y,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=p}load(o,p){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(y,T)=>{this._loaded=!0,y?this.fire(new a.ErrorEvent(y)):T&&(this.image=T,o&&(this.coordinates=o),p&&p(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const p=o.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(T){let A=1/0,M=1/0,B=-1/0,z=-1/0;for(const K of T)A=Math.min(A,K.x),M=Math.min(M,K.y),B=Math.max(B,K.x),z=Math.max(z,K.y);const U=Math.max(B-A,z-M),$=Math.max(0,Math.floor(-Math.log(U)/Math.LN2)),Y=Math.pow(2,$);return new a.CanonicalTileID($,Math.floor((A+B)/2*Y),Math.floor((M+z)/2*Y))}(p),this.minzoom=this.maxzoom=this.tileID.z;const y=p.map(T=>this.tileID.getTilePoint(T)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(y[2].x,y[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,p=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new H(o,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));for(const y in this.tiles){const T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}loadTile(o,p){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},p(null)):(o.state="errored",p(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class X extends Dt{constructor(o,p,y,T){super(o,p,y,T),this.roundZoom=!0,this.type="video",this.options=p}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const p of o.urls)this.urls.push(this.map._requestManager.transformRequest(p,a.ResourceType.Source).url);a.getVideo(this.urls,(p,y)=>{this._loaded=!0,p?this.fire(new a.ErrorEvent(p)):y&&(this.video=y,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const p=this.video.seekable;o<p.start(0)||o>p.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,p=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new H(o,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));for(const y in this.tiles){const T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ke extends Dt{constructor(o,p,y,T){super(o,p,y,T),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(M=>typeof M!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const p=this.map.painter.context,y=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new H(p,this.canvas,y.RGBA,{premultiply:!0});for(const T in this.tiles){const A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Tt={vector:Ve,raster:Le,"raster-dem":we,geojson:Ye,video:X,image:Dt,canvas:Ke};function ce(v,o){const p=a.create();return a.translate(p,p,[1,1,0]),a.scale(p,p,[.5*v.width,.5*v.height,1]),a.multiply(p,p,v.calculatePosMatrix(o.toUnwrapped()))}function zt(v,o,p,y,T,A){const M=function(Y,K,fe){if(Y)for(const se of Y){const ue=K[se];if(ue&&ue.source===fe&&ue.type==="fill-extrusion")return!0}else for(const se in K){const ue=K[se];if(ue.source===fe&&ue.type==="fill-extrusion")return!0}return!1}(T&&T.layers,o,v.id),B=A.maxPitchScaleFactor(),z=v.tilesIn(y,B,M);z.sort(qt);const U=[];for(const Y of z)U.push({wrappedTileID:Y.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(o,p,v._state,Y.queryGeometry,Y.cameraQueryGeometry,Y.scale,T,A,B,ce(v.transform,Y.tileID))});const $=function(Y){const K={},fe={};for(const se of Y){const ue=se.queryResults,Re=se.wrappedTileID,Pe=fe[Re]=fe[Re]||{};for(const $e in ue){const me=ue[$e],Fe=Pe[$e]=Pe[$e]||{},He=K[$e]=K[$e]||[];for(const rt of me)Fe[rt.featureIndex]||(Fe[rt.featureIndex]=!0,He.push(rt))}}return K}(U);for(const Y in $)$[Y].forEach(K=>{const fe=K.feature,se=v.getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=se});return $}function qt(v,o){const p=v.tileID,y=o.tileID;return p.overscaledZ-y.overscaledZ||p.canonical.y-y.canonical.y||p.wrap-y.wrap||p.canonical.x-y.canonical.x}class Ot{constructor(o,p){this.tileID=o,this.uid=a.uniqueId(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const p=o+this.timeAdded;p<a.exported.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(p=>o.saveTileTexture(p)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,p,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(T,A){const M={};if(!A)return M;for(const B of T){const z=B.layerIds.map(U=>A.getLayer(U)).filter(Boolean);if(z.length!==0){B.layers=z,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map(U=>z.filter($=>$.id===U)[0]));for(const U of z)M[U.id]=B}}return M}(o.buckets,p.style),this.hasSymbolBuckets=!1;for(const T in this.buckets){const A=this.buckets[T];if(A instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!y)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const T in this.buckets){const A=this.buckets[T];if(A instanceof a.SymbolBucket&&A.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const T in this.buckets){const A=this.buckets[T];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(T).queryRadius(A))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const y in this.buckets){const T=this.buckets[y];T.uploadPending()&&T.upload(o)}const p=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new H(o,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new H(o,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,p,y,T,A,M,B,z,U,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:T,cameraQueryGeometry:A,scale:M,tileSize:this.tileSize,pixelPosMatrix:$,transform:z,params:B,queryPadding:this.queryPadding*U},o,p,y):{}}querySourceFeatures(o,p){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const T=y.loadVTLayers(),A=p?p.sourceLayer:"",M=T._geojsonTileLayer||T[A];if(!M)return;const B=a.createFilter(p&&p.filter),{z,x:U,y:$}=this.tileID.canonical,Y={z,x:U,y:$};for(let K=0;K<M.length;K++){const fe=M.feature(K);if(B.needGeometry){const Re=a.toEvaluationFeature(fe,!0);if(!B.filter(new a.EvaluationParameters(this.tileID.overscaledZ),Re,this.tileID.canonical))continue}else if(!B.filter(new a.EvaluationParameters(this.tileID.overscaledZ),fe))continue;const se=y.getId(fe,A),ue=new a.GeoJSONFeature(fe,z,U,$,se);ue.tile=Y,o.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const p=this.expirationTime;if(o.cacheControl){const y=a.parseCacheControl(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let T=!1;if(this.expirationTime>y)T=!1;else if(p)if(this.expirationTime<p)T=!0;else{const A=this.expirationTime-p;A?this.expirationTime=y+Math.max(A,3e4):T=!0}else T=!0;T?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const T in this.buckets){if(!p.style.hasLayer(T))continue;const A=this.buckets[T],M=A.layers[0].sourceLayer||"_geojsonTileLayer",B=y[M],z=o[M];if(!B||!z||Object.keys(z).length===0)continue;A.update(z,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const U=p&&p.style&&p.style.getLayer(T);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=a.exported.now()+o}setDependencies(o,p){const y={};for(const T of p)y[T]=!0;this.dependencies[o]=y}hasDependency(o,p){for(const y of o){const T=this.dependencies[y];if(T){for(const A of p)if(T[A])return!0}}return!1}}class Fn{constructor(o,p){this.max=o,this.onRemove=p,this.reset()}reset(){for(const o in this.data)for(const p of this.data[o])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(o,p,y){const T=o.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);const A={value:p,timeout:void 0};if(y!==void 0&&(A.timeout=setTimeout(()=>{this.remove(o,A)},y)),this.data[T].push(A),this.order.push(T),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const p=this.data[o].shift();return p.timeout&&clearTimeout(p.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),p.value}getByKey(o){const p=this.data[o];return p?p[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,p){if(!this.has(o))return this;const y=o.wrapped().key,T=p===void 0?0:this.data[y].indexOf(p),A=this.data[y][T];return this.data[y].splice(T,1),A.timeout&&clearTimeout(A.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(A.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(o){const p=[];for(const y in this.data)for(const T of this.data[y])o(T.value)||p.push(T);for(const y of p)this.remove(y.value.tileID,y)}}class vn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,p,y){const T=String(p);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][T]=this.stateChanges[o][T]||{},a.extend(this.stateChanges[o][T],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const A in this.state[o])A!==T&&(this.deletedStates[o][A]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][T]===null){this.deletedStates[o][T]={};for(const A in this.state[o][T])y[A]||(this.deletedStates[o][T][A]=null)}else for(const A in y)this.deletedStates[o]&&this.deletedStates[o][T]&&this.deletedStates[o][T][A]===null&&delete this.deletedStates[o][T][A]}removeFeatureState(o,p,y){if(this.deletedStates[o]===null)return;const T=String(p);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&p!==void 0)this.deletedStates[o][T]!==null&&(this.deletedStates[o][T]=this.deletedStates[o][T]||{},this.deletedStates[o][T][y]=null);else if(p!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][T])for(y in this.deletedStates[o][T]={},this.stateChanges[o][T])this.deletedStates[o][T][y]=null;else this.deletedStates[o][T]=null;else this.deletedStates[o]=null}getState(o,p){const y=String(p),T=a.extend({},(this.state[o]||{})[y],(this.stateChanges[o]||{})[y]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const A=this.deletedStates[o][p];if(A===null)return{};for(const M in A)delete T[M]}return T}initializeTileState(o,p){o.setFeatureState(this.state,p)}coalesceChanges(o,p){const y={};for(const T in this.stateChanges){this.state[T]=this.state[T]||{};const A={};for(const M in this.stateChanges[T])this.state[T][M]||(this.state[T][M]={}),a.extend(this.state[T][M],this.stateChanges[T][M]),A[M]=this.state[T][M];y[T]=A}for(const T in this.deletedStates){this.state[T]=this.state[T]||{};const A={};if(this.deletedStates[T]===null)for(const M in this.state[T])A[M]={},this.state[T][M]={};else for(const M in this.deletedStates[T]){if(this.deletedStates[T][M]===null)this.state[T][M]={};else for(const B of Object.keys(this.deletedStates[T][M]))delete this.state[T][M][B];A[M]=this.state[T][M]}y[T]=y[T]||{},a.extend(y[T],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const T in o)o[T].setFeatureState(y,p)}}class Qn extends a.Evented{constructor(o,p,y){super(),this.id=o,this.dispatcher=y,this.on("data",T=>{T.dataType==="source"&&T.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(T,A,M,B){const z=new Tt[A.type](T,A,M,B);if(z.id!==T)throw new Error(`Expected Source id to be ${T} instead of ${z.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],z),z}(o,p,y,this),this._tiles={},this._cache=new Fn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new vn}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const p=this._tiles[o];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,p){return this._source.loadTile(o,p)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new a.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const y=this._tiles[p];y.upload(o),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Yi).map(o=>o.key)}getRenderableIds(o){const p=[];for(const y in this._tiles)this._isIdRenderable(y,o)&&p.push(this._tiles[y]);return o?p.sort((y,T)=>{const A=y.tileID,M=T.tileID,B=new a.pointGeometry(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),z=new a.pointGeometry(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-M.overscaledZ||z.y-B.y||z.x-B.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(Yi).map(y=>y.key)}hasRenderableParent(o){const p=this.findLoadedParent(o,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(o,p){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(p||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,p){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=p),this._loadTile(y,this._tileLoaded.bind(this,y,o,p)))}_tileLoaded(o,p,y,T){if(T)return o.state="errored",void(T.status!==404?this._source.fire(new a.ErrorEvent(T,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=a.exported.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(p,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const p=this.getRenderableIds();for(let T=0;T<p.length;T++){const A=p[T];if(o.neighboringTiles&&o.neighboringTiles[A]){const M=this.getTileByID(A);y(o,M),y(M,o)}}function y(T,A){T.needsHillshadePrepare=!0,T.needsTerrainPrepare=!0;let M=A.tileID.canonical.x-T.tileID.canonical.x;const B=A.tileID.canonical.y-T.tileID.canonical.y,z=Math.pow(2,T.tileID.canonical.z),U=A.tileID.key;M===0&&B===0||Math.abs(B)>1||(Math.abs(M)>1&&(Math.abs(M+z)===1?M+=z:Math.abs(M-z)===1&&(M-=z)),A.dem&&T.dem&&(T.dem.backfillBorder(A.dem,M,B),T.neighboringTiles&&T.neighboringTiles[U]&&(T.neighboringTiles[U].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,p,y,T){for(const A in this._tiles){let M=this._tiles[A];if(T[A]||!M.hasData()||M.tileID.overscaledZ<=p||M.tileID.overscaledZ>y)continue;let B=M.tileID;for(;M&&M.tileID.overscaledZ>p+1;){const U=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[U.key],M&&M.hasData()&&(B=U)}let z=B;for(;z.overscaledZ>p;)if(z=z.scaledTo(z.overscaledZ-1),o[z.key]){T[B.key]=B;break}}}findLoadedParent(o,p){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=p?y:null}for(let y=o.overscaledZ-1;y>=p;y--){const T=o.scaledTo(y),A=this._getLoadedTile(T);if(A)return A}}_getLoadedTile(o){const p=this._tiles[o.key];return p&&p.hasData()?p:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const p=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,T=Math.floor(p*y*5),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(A)}handleWrapJump(o){const p=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,p){const y={};for(const T in this._tiles){const A=this._tiles[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+p),y[A.tileID.key]=A}this._tiles=y;for(const T in this._timers)clearTimeout(this._timers[T]),delete this._timers[T];for(const T in this._tiles)this._setTileReloadTimer(T,this._tiles[T])}}update(o,p){if(this.transform=o,this.terrain=p,!this._sourceLoaded||this._paused)return;let y;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new a.OverscaledTileID(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y)):(y=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:p}),this._source.hasTile&&(y=y.filter(U=>this._source.hasTile(U)))):y=[];const T=o.coveringZoomLevel(this._source),A=Math.max(T-Qn.maxOverzooming,this._source.minzoom),M=Math.max(T+Qn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const U={};for(const $ of y)if($.canonical.z>this._source.minzoom){const Y=$.scaledTo($.canonical.z-1);U[Y.key]=Y;const K=$.scaledTo(Math.max(this._source.minzoom,Math.min($.canonical.z,5)));U[K.key]=K}y=y.concat(Object.values(U))}const B=this._updateRetainedTiles(y,T);if(Pr(this._source.type)){const U={},$={},Y=Object.keys(B);for(const K of Y){const fe=B[K],se=this._tiles[K];if(!se||se.fadeEndTime&&se.fadeEndTime<=a.exported.now())continue;const ue=this.findLoadedParent(fe,A);ue&&(this._addTile(ue.tileID),U[ue.tileID.key]=ue.tileID),$[K]=fe}this._retainLoadedChildren($,T,M,B);for(const K in U)B[K]||(this._coveredTiles[K]=!0,B[K]=U[K]);if(p){const K={},fe={};for(const se of y)this._tiles[se.key].hasData()?K[se.key]=se:fe[se.key]=se;for(const se in fe){const ue=fe[se].children(this._source.maxzoom);this._tiles[ue[0].key]&&this._tiles[ue[1].key]&&this._tiles[ue[2].key]&&this._tiles[ue[3].key]&&(K[ue[0].key]=B[ue[0].key]=ue[0],K[ue[1].key]=B[ue[1].key]=ue[1],K[ue[2].key]=B[ue[2].key]=ue[2],K[ue[3].key]=B[ue[3].key]=ue[3],delete fe[se])}for(const se in fe){const ue=this.findLoadedParent(fe[se],this._source.minzoom);if(ue){K[ue.tileID.key]=B[ue.tileID.key]=ue.tileID;for(const Re in K)K[Re].isChildOf(ue.tileID)&&delete K[Re]}}for(const se in this._tiles)K[se]||(this._coveredTiles[se]=!0)}}for(const U in B)this._tiles[U].clearFadeHold();const z=a.keysDifference(this._tiles,B);for(const U of z){const $=this._tiles[U];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(U)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,p){const y={},T={},A=Math.max(p-Qn.maxOverzooming,this._source.minzoom),M=Math.max(p+Qn.maxUnderzooming,this._source.minzoom),B={};for(const z of o){const U=this._addTile(z);y[z.key]=z,U.hasData()||p<this._source.maxzoom&&(B[z.key]=z)}this._retainLoadedChildren(B,p,M,y);for(const z of o){let U=this._tiles[z.key];if(U.hasData())continue;if(p+1>this._source.maxzoom){const Y=z.children(this._source.maxzoom)[0],K=this.getTile(Y);if(K&&K.hasData()){y[Y.key]=Y;continue}}else{const Y=z.children(this._source.maxzoom);if(y[Y[0].key]&&y[Y[1].key]&&y[Y[2].key]&&y[Y[3].key])continue}let $=U.wasRequested();for(let Y=z.overscaledZ-1;Y>=A;--Y){const K=z.scaledTo(Y);if(T[K.key]||(T[K.key]=!0,U=this.getTile(K),!U&&$&&(U=this._addTile(K)),U&&(y[K.key]=K,$=U.wasRequested(),U.hasData())))break}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const p=[];let y,T=this._tiles[o].tileID;for(;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){y=this._loadedParentTiles[T.key];break}p.push(T.key);const A=T.scaledTo(T.overscaledZ-1);if(y=this._getLoadedTile(A),y)break;T=A}for(const A of p)this._loadedParentTiles[A]=y}}_addTile(o){let p=this._tiles[o.key];if(p)return p;p=this._cache.getAndRemove(o),p&&(this._setTileReloadTimer(o.key,p),p.tileID=o,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,p)));const y=p;return p||(p=new Ot(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,o.key,p.state))),p.uses++,this._tiles[o.key]=p,y||this._source.fire(new a.Event("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(o,p){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=p.getExpiryTimeout();y&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},y))}_removeTile(o){const p=this._tiles[o];p&&(p.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,p,y){const T=[],A=this.transform;if(!A)return T;const M=y?A.getCameraQueryGeometry(o):o,B=o.map(se=>A.pointCoordinate(se,this.terrain)),z=M.map(se=>A.pointCoordinate(se,this.terrain)),U=this.getIds();let $=1/0,Y=1/0,K=-1/0,fe=-1/0;for(const se of z)$=Math.min($,se.x),Y=Math.min(Y,se.y),K=Math.max(K,se.x),fe=Math.max(fe,se.y);for(let se=0;se<U.length;se++){const ue=this._tiles[U[se]];if(ue.holdingForFade())continue;const Re=ue.tileID,Pe=Math.pow(2,A.zoom-ue.tileID.overscaledZ),$e=p*ue.queryPadding*a.EXTENT/ue.tileSize/Pe,me=[Re.getTilePoint(new a.MercatorCoordinate($,Y)),Re.getTilePoint(new a.MercatorCoordinate(K,fe))];if(me[0].x-$e<a.EXTENT&&me[0].y-$e<a.EXTENT&&me[1].x+$e>=0&&me[1].y+$e>=0){const Fe=B.map(rt=>Re.getTilePoint(rt)),He=z.map(rt=>Re.getTilePoint(rt));T.push({tile:ue,tileID:Re,queryGeometry:Fe,cameraQueryGeometry:He,scale:Pe})}}return T}getVisibleCoordinates(o){const p=this.getRenderableIds(o).map(y=>this._tiles[y].tileID);for(const y of p)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(Pr(this._source.type))for(const o in this._tiles){const p=this._tiles[o];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(o,p,y){this._state.updateState(o=o||"_geojsonTileLayer",p,y)}removeFeatureState(o,p,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",p,y)}getFeatureState(o,p){return this._state.getState(o=o||"_geojsonTileLayer",p)}setDependencies(o,p,y){const T=this._tiles[o];T&&T.setDependencies(p,y)}reloadTilesForDependencies(o,p){for(const y in this._tiles)this._tiles[y].hasDependency(o,p)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(o,p))}}function Yi(v,o){const p=Math.abs(2*v.wrap)-+(v.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return v.overscaledZ-o.overscaledZ||y-p||o.canonical.y-v.canonical.y||o.canonical.x-v.canonical.x}function Pr(v){return v==="raster"||v==="image"||v==="video"}Qn.maxOverzooming=10,Qn.maxUnderzooming=3;const Sr="mapboxgl_preloaded_worker_pool";class tr{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<tr.workerCount;)this.workers.push(new Worker(Tl.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sr]}numActive(){return Object.keys(this.active).length}}const ia=Math.floor(a.exported.hardwareConcurrency/2);let nr;function xs(){return nr||(nr=new tr),nr}function ir(v,o){const p={};for(const y in v)y!=="ref"&&(p[y]=v[y]);return a.refProperties.forEach(y=>{y in o&&(p[y]=o[y])}),p}function $s(v){v=v.slice();const o=Object.create(null);for(let p=0;p<v.length;p++)o[v[p].id]=v[p];for(let p=0;p<v.length;p++)"ref"in v[p]&&(v[p]=ir(v[p],o[v[p].ref]));return v}tr.workerCount=Math.max(Math.min(ia,6),1);const wn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function qr(v,o,p){p.push({command:wn.addSource,args:[v,o[v]]})}function ra(v,o,p){o.push({command:wn.removeSource,args:[v]}),p[v]=!0}function sa(v,o,p,y){ra(v,p,y),qr(v,o,p)}function Ta(v,o,p){let y;for(y in v[p])if(Object.prototype.hasOwnProperty.call(v[p],y)&&y!=="data"&&!R(v[p][y],o[p][y]))return!1;for(y in o[p])if(Object.prototype.hasOwnProperty.call(o[p],y)&&y!=="data"&&!R(v[p][y],o[p][y]))return!1;return!0}function vs(v,o,p,y,T,A){let M;for(M in o=o||{},v=v||{})Object.prototype.hasOwnProperty.call(v,M)&&(R(v[M],o[M])||p.push({command:A,args:[y,M,o[M],T]}));for(M in o)Object.prototype.hasOwnProperty.call(o,M)&&!Object.prototype.hasOwnProperty.call(v,M)&&(R(v[M],o[M])||p.push({command:A,args:[y,M,o[M],T]}))}function aa(v){return v.id}function ft(v,o){return v[o.id]=o,v}class Ee{constructor(o,p){this.reset(o,p)}reset(o,p){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.clamp(o,0,1);let p=1,y=this._distances[p];const T=o*this.paddedLength+this.padding;for(;y<T&&p<this._distances.length;)y=this._distances[++p];const A=p-1,M=this._distances[A],B=y-M,z=B>0?(T-M)/B:0;return this.points[A].mult(1-z).add(this.points[p].mult(z))}}function at(v,o){let p=!0;return v==="always"||v!=="never"&&o!=="never"||(p=!1),p}class nn{constructor(o,p,y){const T=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(p/y);for(let M=0;M<this.xCellCount*this.yCellCount;M++)T.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=p,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,p,y,T,A){this._forEachCell(p,y,T,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(T),this.bboxes.push(A)}insertCircle(o,p,y,T){this._forEachCell(p-T,y-T,p+T,y+T,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(p),this.circles.push(y),this.circles.push(T)}_insertBoxCell(o,p,y,T,A,M){this.boxCells[A].push(M)}_insertCircleCell(o,p,y,T,A,M){this.circleCells[A].push(M)}_query(o,p,y,T,A,M,B){if(y<0||o>this.width||T<0||p>this.height)return[];const z=[];if(o<=0&&p<=0&&this.width<=y&&this.height<=T){if(A)return[{key:null,x1:o,y1:p,x2:y,y2:T}];for(let U=0;U<this.boxKeys.length;U++)z.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const $=this.circles[3*U],Y=this.circles[3*U+1],K=this.circles[3*U+2];z.push({key:this.circleKeys[U],x1:$-K,y1:Y-K,x2:$+K,y2:Y+K})}}else this._forEachCell(o,p,y,T,this._queryCell,z,{hitTest:A,overlapMode:M,seenUids:{box:{},circle:{}}},B);return z}query(o,p,y,T){return this._query(o,p,y,T,!1,null)}hitTest(o,p,y,T,A,M){return this._query(o,p,y,T,!0,A,M).length>0}hitTestCircle(o,p,y,T,A){const M=o-y,B=o+y,z=p-y,U=p+y;if(B<0||M>this.width||U<0||z>this.height)return!1;const $=[];return this._forEachCell(M,z,B,U,this._queryCellCircle,$,{hitTest:!0,overlapMode:T,circle:{x:o,y:p,radius:y},seenUids:{box:{},circle:{}}},A),$.length>0}_queryCell(o,p,y,T,A,M,B,z){const{seenUids:U,hitTest:$,overlapMode:Y}=B,K=this.boxCells[A];if(K!==null){const se=this.bboxes;for(const ue of K)if(!U.box[ue]){U.box[ue]=!0;const Re=4*ue,Pe=this.boxKeys[ue];if(o<=se[Re+2]&&p<=se[Re+3]&&y>=se[Re+0]&&T>=se[Re+1]&&(!z||z(Pe))&&(!$||!at(Y,Pe.overlapMode))&&(M.push({key:Pe,x1:se[Re],y1:se[Re+1],x2:se[Re+2],y2:se[Re+3]}),$))return!0}}const fe=this.circleCells[A];if(fe!==null){const se=this.circles;for(const ue of fe)if(!U.circle[ue]){U.circle[ue]=!0;const Re=3*ue,Pe=this.circleKeys[ue];if(this._circleAndRectCollide(se[Re],se[Re+1],se[Re+2],o,p,y,T)&&(!z||z(Pe))&&(!$||!at(Y,Pe.overlapMode))){const $e=se[Re],me=se[Re+1],Fe=se[Re+2];if(M.push({key:Pe,x1:$e-Fe,y1:me-Fe,x2:$e+Fe,y2:me+Fe}),$)return!0}}}return!1}_queryCellCircle(o,p,y,T,A,M,B,z){const{circle:U,seenUids:$,overlapMode:Y}=B,K=this.boxCells[A];if(K!==null){const se=this.bboxes;for(const ue of K)if(!$.box[ue]){$.box[ue]=!0;const Re=4*ue,Pe=this.boxKeys[ue];if(this._circleAndRectCollide(U.x,U.y,U.radius,se[Re+0],se[Re+1],se[Re+2],se[Re+3])&&(!z||z(Pe))&&!at(Y,Pe.overlapMode))return M.push(!0),!0}}const fe=this.circleCells[A];if(fe!==null){const se=this.circles;for(const ue of fe)if(!$.circle[ue]){$.circle[ue]=!0;const Re=3*ue,Pe=this.circleKeys[ue];if(this._circlesCollide(se[Re],se[Re+1],se[Re+2],U.x,U.y,U.radius)&&(!z||z(Pe))&&!at(Y,Pe.overlapMode))return M.push(!0),!0}}}_forEachCell(o,p,y,T,A,M,B,z){const U=this._convertToXCellCoord(o),$=this._convertToYCellCoord(p),Y=this._convertToXCellCoord(y),K=this._convertToYCellCoord(T);for(let fe=U;fe<=Y;fe++)for(let se=$;se<=K;se++)if(A.call(this,o,p,y,T,this.xCellCount*se+fe,M,B,z))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,p,y,T,A,M){const B=T-o,z=A-p,U=y+M;return U*U>B*B+z*z}_circleAndRectCollide(o,p,y,T,A,M,B){const z=(M-T)/2,U=Math.abs(o-(T+z));if(U>z+y)return!1;const $=(B-A)/2,Y=Math.abs(p-(A+$));if(Y>$+y)return!1;if(U<=z||Y<=$)return!0;const K=U-z,fe=Y-$;return K*K+fe*fe<=y*y}}function Cn(v,o,p,y,T){const A=a.create();return o?(a.scale(A,A,[1/T,1/T,1]),p||a.rotateZ(A,A,y.angle)):a.multiply(A,y.labelPlaneMatrix,v),A}function Mn(v,o,p,y,T){if(o){const A=a.clone(v);return a.scale(A,A,[T,T,1]),p||a.rotateZ(A,A,-y.angle),A}return y.glCoordMatrix}function Jn(v,o,p){let y;p?(y=[v.x,v.y,p(v.x,v.y),1],a.transformMat4(y,y,o)):(y=[v.x,v.y,0,1],oa(y,y,o));const T=y[3];return{point:new a.pointGeometry(y[0]/T,y[1]/T),signedDistanceFromCamera:T}}function ri(v,o){return .5+v/o*.5}function Wr(v,o){const p=v[0]/v[3],y=v[1]/v[3];return p>=-o[0]&&p<=o[0]&&y>=-o[1]&&y<=o[1]}function li(v,o,p,y,T,A,M,B,z,U){const $=y?v.textSizeData:v.iconSizeData,Y=a.evaluateSizeForZoom($,p.transform.zoom),K=[256/p.width*2+1,256/p.height*2+1],fe=y?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;fe.clear();const se=v.lineVertexArray,ue=y?v.text.placedSymbolArray:v.icon.placedSymbolArray,Re=p.transform.width/p.transform.height;let Pe=!1;for(let $e=0;$e<ue.length;$e++){const me=ue.get($e);if(me.hidden||me.writingMode===a.WritingMode.vertical&&!Pe){Xr(me.numGlyphs,fe);continue}let Fe;if(Pe=!1,U?(Fe=[me.anchorX,me.anchorY,U(me.anchorX,me.anchorY),1],a.transformMat4(Fe,Fe,o)):(Fe=[me.anchorX,me.anchorY,0,1],oa(Fe,Fe,o)),!Wr(Fe,K)){Xr(me.numGlyphs,fe);continue}const He=ri(p.transform.cameraToCenterDistance,Fe[3]),rt=a.evaluateSizeForFeature($,Y,me),st=M?rt/He:rt*He,bt=new a.pointGeometry(me.anchorX,me.anchorY),Qe=Jn(bt,T,U).point,Mt={},kt=tn(me,st,!1,B,o,T,A,v.glyphOffsetArray,se,fe,Qe,bt,Mt,Re,z,U);Pe=kt.useVertical,(kt.notEnoughRoom||Pe||kt.needsFlipping&&tn(me,st,!0,B,o,T,A,v.glyphOffsetArray,se,fe,Qe,bt,Mt,Re,z,U).notEnoughRoom)&&Xr(me.numGlyphs,fe)}y?v.text.dynamicLayoutVertexBuffer.updateData(fe):v.icon.dynamicLayoutVertexBuffer.updateData(fe)}function wt(v,o,p,y,T,A,M,B,z,U,$,Y,K){const fe=B.glyphStartIndex+B.numGlyphs,se=B.lineStartIndex,ue=B.lineStartIndex+B.lineLength,Re=o.getoffsetX(B.glyphStartIndex),Pe=o.getoffsetX(fe-1),$e=ts(v*Re,p,y,T,A,M,B.segment,se,ue,z,U,$,Y,K);if(!$e)return null;const me=ts(v*Pe,p,y,T,A,M,B.segment,se,ue,z,U,$,Y,K);return me?{first:$e,last:me}:null}function rn(v,o,p,y){return v===a.WritingMode.horizontal&&Math.abs(p.y-o.y)>Math.abs(p.x-o.x)*y?{useVertical:!0}:(v===a.WritingMode.vertical?o.y<p.y:o.x>p.x)?{needsFlipping:!0}:null}function tn(v,o,p,y,T,A,M,B,z,U,$,Y,K,fe,se,ue){const Re=o/24,Pe=v.lineOffsetX*Re,$e=v.lineOffsetY*Re;let me;if(v.numGlyphs>1){const Fe=v.glyphStartIndex+v.numGlyphs,He=v.lineStartIndex,rt=v.lineStartIndex+v.lineLength,st=wt(Re,B,Pe,$e,p,$,Y,v,z,A,K,se,ue);if(!st)return{notEnoughRoom:!0};const bt=Jn(st.first.point,M,ue).point,Qe=Jn(st.last.point,M,ue).point;if(y&&!p){const Mt=rn(v.writingMode,bt,Qe,fe);if(Mt)return Mt}me=[st.first];for(let Mt=v.glyphStartIndex+1;Mt<Fe-1;Mt++)me.push(ts(Re*B.getoffsetX(Mt),Pe,$e,p,$,Y,v.segment,He,rt,z,A,K,se,ue));me.push(st.last)}else{if(y&&!p){const He=Jn(Y,T,ue).point,rt=v.lineStartIndex+v.segment+1,st=new a.pointGeometry(z.getx(rt),z.gety(rt)),bt=Jn(st,T,ue),Qe=bt.signedDistanceFromCamera>0?bt.point:Dr(Y,st,He,1,T,ue),Mt=rn(v.writingMode,He,Qe,fe);if(Mt)return Mt}const Fe=ts(Re*B.getoffsetX(v.glyphStartIndex),Pe,$e,p,$,Y,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,z,A,K,se,ue);if(!Fe)return{notEnoughRoom:!0};me=[Fe]}for(const Fe of me)a.addDynamicAttributes(U,Fe.point,Fe.angle);return{}}function Dr(v,o,p,y,T,A){const M=Jn(v.add(v.sub(o)._unit()),T,A).point,B=p.sub(M);return p.add(B._mult(y/B.mag()))}function ts(v,o,p,y,T,A,M,B,z,U,$,Y,K,fe){const se=y?v-o:v+o;let ue=se>0?1:-1,Re=0;y&&(ue*=-1,Re=Math.PI),ue<0&&(Re+=Math.PI);let Pe=ue>0?B+M:B+M+1,$e=T,me=T,Fe=0,He=0;const rt=Math.abs(se),st=[];for(;Fe+He<=rt;){if(Pe+=ue,Pe<B||Pe>=z)return null;if(me=$e,st.push($e),$e=Y[Pe],$e===void 0){const Ut=new a.pointGeometry(U.getx(Pe),U.gety(Pe)),un=Jn(Ut,$,fe);if(un.signedDistanceFromCamera>0)$e=Y[Pe]=un.point;else{const yn=Pe-ue;$e=Dr(Fe===0?A:new a.pointGeometry(U.getx(yn),U.gety(yn)),Ut,me,rt-Fe+1,$,fe)}}Fe+=He,He=me.dist($e)}const bt=(rt-Fe)/He,Qe=$e.sub(me),Mt=Qe.mult(bt)._add(me);Mt._add(Qe._unit()._perp()._mult(p*ue));const kt=Re+Math.atan2($e.y-me.y,$e.x-me.x);return st.push(Mt),{point:Mt,angle:K?kt:0,path:st}}const fn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xr(v,o){for(let p=0;p<v;p++){const y=o.length;o.resize(y+4),o.float32.set(fn,3*y)}}function oa(v,o,p){const y=o[0],T=o[1];return v[0]=p[0]*y+p[4]*T+p[12],v[1]=p[1]*y+p[5]*T+p[13],v[3]=p[3]*y+p[7]*T+p[15],v}const Er=100;class Sa{constructor(o,p=new nn(o.width+200,o.height+200,25),y=new nn(o.width+200,o.height+200,25)){this.transform=o,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Er,this.screenBottomBoundary=o.height+Er,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,p,y,T,A,M){const B=this.projectAndGetPerspectiveRatio(T,o.anchorPointX,o.anchorPointY,M),z=y*B.perspectiveRatio,U=o.x1*z+B.point.x,$=o.y1*z+B.point.y,Y=o.x2*z+B.point.x,K=o.y2*z+B.point.y;return!this.isInsideGrid(U,$,Y,K)||p!=="always"&&this.grid.hitTest(U,$,Y,K,p,A)||B.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[U,$,Y,K],offscreen:this.isOffscreen(U,$,Y,K)}}placeCollisionCircles(o,p,y,T,A,M,B,z,U,$,Y,K,fe,se){const ue=[],Re=new a.pointGeometry(p.anchorX,p.anchorY),Pe=Jn(Re,M,se),$e=ri(this.transform.cameraToCenterDistance,Pe.signedDistanceFromCamera),me=($?A/$e:A*$e)/a.ONE_EM,Fe=Jn(Re,B,se).point,He=wt(me,T,p.lineOffsetX*me,p.lineOffsetY*me,!1,Fe,Re,p,y,B,{},!1,se);let rt=!1,st=!1,bt=!0;if(He){const Qe=.5*K*$e+fe,Mt=new a.pointGeometry(-100,-100),kt=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ut=new Ee,un=He.first,yn=He.last;let Kt=[];for(let Pn=un.path.length-1;Pn>=1;Pn--)Kt.push(un.path[Pn]);for(let Pn=1;Pn<yn.path.length;Pn++)Kt.push(yn.path[Pn]);const Wn=2.5*Qe;if(z){const Pn=Kt.map(En=>Jn(En,z,se));Kt=Pn.some(En=>En.signedDistanceFromCamera<=0)?[]:Pn.map(En=>En.point)}let $n=[];if(Kt.length>0){const Pn=Kt[0].clone(),En=Kt[0].clone();for(let zn=1;zn<Kt.length;zn++)Pn.x=Math.min(Pn.x,Kt[zn].x),Pn.y=Math.min(Pn.y,Kt[zn].y),En.x=Math.max(En.x,Kt[zn].x),En.y=Math.max(En.y,Kt[zn].y);$n=Pn.x>=Mt.x&&En.x<=kt.x&&Pn.y>=Mt.y&&En.y<=kt.y?[Kt]:En.x<Mt.x||Pn.x>kt.x||En.y<Mt.y||Pn.y>kt.y?[]:a.clipLine([Kt],Mt.x,Mt.y,kt.x,kt.y)}for(const Pn of $n){Ut.reset(Pn,.25*Qe);let En=0;En=Ut.length<=.5*Qe?1:Math.ceil(Ut.paddedLength/Wn)+1;for(let zn=0;zn<En;zn++){const Nr=zn/Math.max(En-1,1),As=Ut.lerp(Nr),Cs=As.x+Er,as=As.y+Er;ue.push(Cs,as,Qe,0);const Qa=Cs-Qe,Xi=as-Qe,Rs=Cs+Qe,Ja=as+Qe;if(bt=bt&&this.isOffscreen(Qa,Xi,Rs,Ja),st=st||this.isInsideGrid(Qa,Xi,Rs,Ja),o!=="always"&&this.grid.hitTestCircle(Cs,as,Qe,o,Y)&&(rt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!U&&rt||!st||$e<this.perspectiveRatioCutoff?[]:ue,offscreen:bt,collisionDetected:rt}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let y=1/0,T=1/0,A=-1/0,M=-1/0;for(const $ of o){const Y=new a.pointGeometry($.x+Er,$.y+Er);y=Math.min(y,Y.x),T=Math.min(T,Y.y),A=Math.max(A,Y.x),M=Math.max(M,Y.y),p.push(Y)}const B=this.grid.query(y,T,A,M).concat(this.ignoredGrid.query(y,T,A,M)),z={},U={};for(const $ of B){const Y=$.key;if(z[Y.bucketInstanceId]===void 0&&(z[Y.bucketInstanceId]={}),z[Y.bucketInstanceId][Y.featureIndex])continue;const K=[new a.pointGeometry($.x1,$.y1),new a.pointGeometry($.x2,$.y1),new a.pointGeometry($.x2,$.y2),new a.pointGeometry($.x1,$.y2)];a.polygonIntersectsPolygon(p,K)&&(z[Y.bucketInstanceId][Y.featureIndex]=!0,U[Y.bucketInstanceId]===void 0&&(U[Y.bucketInstanceId]=[]),U[Y.bucketInstanceId].push(Y.featureIndex))}return U}insertCollisionBox(o,p,y,T,A,M){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:T,featureIndex:A,collisionGroupID:M,overlapMode:p},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,p,y,T,A,M){const B=y?this.ignoredGrid:this.grid,z={bucketInstanceId:T,featureIndex:A,collisionGroupID:M,overlapMode:p};for(let U=0;U<o.length;U+=4)B.insertCircle(z,o[U],o[U+1],o[U+2])}projectAndGetPerspectiveRatio(o,p,y,T){let A;return T?(A=[p,y,T(p,y),1],a.transformMat4(A,A,o)):(A=[p,y,0,1],oa(A,A,o)),{point:new a.pointGeometry((A[0]/A[3]+1)/2*this.transform.width+Er,(-A[1]/A[3]+1)/2*this.transform.height+Er),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A[3]*.5}}isOffscreen(o,p,y,T){return y<Er||o>=this.screenRightBoundary||T<Er||p>this.screenBottomBoundary}isInsideGrid(o,p,y,T){return y>=0&&o<this.gridRightBoundary&&T>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const o=a.identity([]);return a.translate(o,o,[-100,-100,0]),o}}function ni(v,o,p){return o*(a.EXTENT/(v.tileSize*Math.pow(2,p-v.tileID.overscaledZ)))}class ii{constructor(o,p,y,T){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?p:-p))):T&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Va{constructor(o,p,y,T,A){this.text=new ii(o?o.text:null,p,y,A),this.icon=new ii(o?o.icon:null,p,T,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class la{constructor(o,p,y){this.text=o,this.icon=p,this.skipFade=y}}class Zr{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class wi{constructor(o,p,y,T,A){this.bucketInstanceId=o,this.featureIndex=p,this.sourceLayerIndex=y,this.bucketIndex=T,this.tileID=A}}class ur{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const p=++this.maxGroupID;this.collisionGroups[o]={ID:p,predicate:y=>y.collisionGroupID===p}}return this.collisionGroups[o]}}function ca(v,o,p,y,T){const{horizontalAlign:A,verticalAlign:M}=a.getAnchorAlignment(v),B=-(A-.5)*o,z=-(M-.5)*p,U=a.evaluateVariableOffset(v,y);return new a.pointGeometry(B+U[0]*T,z+U[1]*T)}function Hs(v,o,p,y,T,A){const{x1:M,x2:B,y1:z,y2:U,anchorPointX:$,anchorPointY:Y}=v,K=new a.pointGeometry(o,p);return y&&K._rotate(T?A:-A),{x1:M+K.x,y1:z+K.y,x2:B+K.x,y2:U+K.y,anchorPointX:$,anchorPointY:Y}}class ae{constructor(o,p,y,T,A){this.transform=o.clone(),this.terrain=p,this.collisionIndex=new Sa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new ur(T),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,p,y,T){const A=y.getBucket(p),M=y.latestFeatureIndex;if(!A||!M||p.id!==A.layerIds[0])return;const B=y.collisionBoxArray,z=A.layers[0].layout,U=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),$=y.tileSize/a.EXTENT,Y=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),K=z.get("text-pitch-alignment")==="map",fe=z.get("text-rotation-alignment")==="map",se=ni(y,1,this.transform.zoom),ue=Cn(Y,K,fe,this.transform,se);let Re=null;if(K){const $e=Mn(Y,K,fe,this.transform,se);Re=a.multiply([],this.transform.labelPlaneMatrix,$e)}this.retainedQueryData[A.bucketInstanceId]=new wi(A.bucketInstanceId,M,A.sourceLayerIndex,A.index,y.tileID);const Pe={bucket:A,layout:z,posMatrix:Y,textLabelPlaneMatrix:ue,labelToScreenMatrix:Re,scale:U,textPixelRatio:$,holdingForFade:y.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(T)for(const $e of A.sortKeyRanges){const{sortKey:me,symbolInstanceStart:Fe,symbolInstanceEnd:He}=$e;o.push({sortKey:me,symbolInstanceStart:Fe,symbolInstanceEnd:He,parameters:Pe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(o,p,y,T,A,M,B,z,U,$,Y,K,fe,se,ue,Re){const Pe=[K.textOffset0,K.textOffset1],$e=ca(o,y,T,Pe,A),me=this.collisionIndex.placeCollisionBox(Hs(p,$e.x,$e.y,M,B,this.transform.angle),Y,z,U,$.predicate,Re);if((!ue||this.collisionIndex.placeCollisionBox(Hs(ue,$e.x,$e.y,M,B,this.transform.angle),Y,z,U,$.predicate,Re).box.length!==0)&&me.box.length>0){let Fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[K.crossTileID].anchor),K.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[K.crossTileID]={textOffset:Pe,width:y,height:T,anchor:o,textBoxScale:A,prevAnchor:Fe},this.markUsedJustification(fe,o,K,se),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,se,K),this.placedOrientations[K.crossTileID]=se),{shift:$e,placedGlyphBoxes:me}}}placeLayerBucketPart(o,p,y){const{bucket:T,layout:A,posMatrix:M,textLabelPlaneMatrix:B,labelToScreenMatrix:z,textPixelRatio:U,holdingForFade:$,collisionBoxArray:Y,partiallyEvaluatedTextSize:K,collisionGroup:fe}=o.parameters,se=A.get("text-optional"),ue=A.get("icon-optional"),Re=a.getOverlapMode(A,"text-overlap","text-allow-overlap"),Pe=Re==="always",$e=a.getOverlapMode(A,"icon-overlap","icon-allow-overlap"),me=$e==="always",Fe=A.get("text-rotation-alignment")==="map",He=A.get("text-pitch-alignment")==="map",rt=A.get("icon-text-fit")!=="none",st=A.get("symbol-z-order")==="viewport-y",bt=Pe&&(me||!T.hasIconData()||ue),Qe=me&&(Pe||!T.hasTextData()||se);!T.collisionArrays&&Y&&T.deserializeCollisionBoxes(Y);const Mt=(kt,Ut)=>{if(p[kt.crossTileID])return;if($)return void(this.placements[kt.crossTileID]=new la(!1,!1,!1));let un=!1,yn=!1,Kt=!0,Wn=null,$n={box:null,offscreen:null},Pn={box:null},En=null,zn=null,Nr=null,As=0,Cs=0,as=0;Ut.textFeatureIndex?As=Ut.textFeatureIndex:kt.useRuntimeCollisionCircles&&(As=kt.featureIndex),Ut.verticalTextFeatureIndex&&(Cs=Ut.verticalTextFeatureIndex);const Qa=this.retainedQueryData[T.bucketInstanceId].tileID,Xi=this.terrain?(Dn,si)=>this.terrain.getElevation(Qa,Dn,si):null;for(const Dn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const si=Ut[Dn];si&&(si.elevation=Xi?Xi(si.anchorPointX,si.anchorPointY):0)}const Rs=Ut.textBox;if(Rs){const Dn=Sn=>{let hi=a.WritingMode.horizontal;if(T.allowVerticalPlacement&&!Sn&&this.prevPlacement){const pr=this.prevPlacement.placedOrientations[kt.crossTileID];pr&&(this.placedOrientations[kt.crossTileID]=pr,hi=pr,this.markUsedOrientation(T,hi,kt))}return hi},si=(Sn,hi)=>{if(T.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Ut.verticalTextBox){for(const pr of T.writingModes)if(pr===a.WritingMode.vertical?($n=hi(),Pn=$n):$n=Sn(),$n&&$n.box&&$n.box.length)break}else $n=Sn()};if(A.get("text-variable-anchor")){let Sn=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt.crossTileID]){const fi=this.prevPlacement.variableOffsets[kt.crossTileID];Sn.indexOf(fi.anchor)>0&&(Sn=Sn.filter(os=>os!==fi.anchor),Sn.unshift(fi.anchor))}const hi=(fi,os,ma)=>{const ga=fi.x2-fi.x1,Cc=fi.y2-fi.y1,du=kt.textBoxScale,ka=rt&&$e==="never"?os:null;let ls={box:[],offscreen:!1};const Rc=Re!=="never"?2*Sn.length:Sn.length;for(let Vo=0;Vo<Rc;++Vo){const Sl=this.attemptAnchorPlacement(Sn[Vo%Sn.length],fi,ga,Cc,du,Fe,He,U,M,fe,Vo>=Sn.length?Re:"never",kt,T,ma,ka,Xi);if(Sl&&(ls=Sl.placedGlyphBoxes,ls&&ls.box&&ls.box.length)){un=!0,Wn=Sl.shift;break}}return ls};si(()=>hi(Rs,Ut.iconBox,a.WritingMode.horizontal),()=>{const fi=Ut.verticalTextBox;return T.allowVerticalPlacement&&!($n&&$n.box&&$n.box.length)&&kt.numVerticalGlyphVertices>0&&fi?hi(fi,Ut.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),$n&&(un=$n.box,Kt=$n.offscreen);const pr=Dn($n&&$n.box);if(!un&&this.prevPlacement){const fi=this.prevPlacement.variableOffsets[kt.crossTileID];fi&&(this.variableOffsets[kt.crossTileID]=fi,this.markUsedJustification(T,fi.anchor,kt,pr))}}else{const Sn=(hi,pr)=>{const fi=this.collisionIndex.placeCollisionBox(hi,Re,U,M,fe.predicate,Xi);return fi&&fi.box&&fi.box.length&&(this.markUsedOrientation(T,pr,kt),this.placedOrientations[kt.crossTileID]=pr),fi};si(()=>Sn(Rs,a.WritingMode.horizontal),()=>{const hi=Ut.verticalTextBox;return T.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&hi?Sn(hi,a.WritingMode.vertical):{box:null,offscreen:null}}),Dn($n&&$n.box&&$n.box.length)}}if(En=$n,un=En&&En.box&&En.box.length>0,Kt=En&&En.offscreen,kt.useRuntimeCollisionCircles){const Dn=T.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),si=a.evaluateSizeForFeature(T.textSizeData,K,Dn),Sn=A.get("text-padding");zn=this.collisionIndex.placeCollisionCircles(Re,Dn,T.lineVertexArray,T.glyphOffsetArray,si,M,B,z,y,He,fe.predicate,kt.collisionCircleDiameter,Sn,Xi),zn.circles.length&&zn.collisionDetected&&!y&&a.warnOnce("Collisions detected, but collision boxes are not shown"),un=Pe||zn.circles.length>0&&!zn.collisionDetected,Kt=Kt&&zn.offscreen}if(Ut.iconFeatureIndex&&(as=Ut.iconFeatureIndex),Ut.iconBox){const Dn=si=>{const Sn=rt&&Wn?Hs(si,Wn.x,Wn.y,Fe,He,this.transform.angle):si;return this.collisionIndex.placeCollisionBox(Sn,$e,U,M,fe.predicate,Xi)};Pn&&Pn.box&&Pn.box.length&&Ut.verticalIconBox?(Nr=Dn(Ut.verticalIconBox),yn=Nr.box.length>0):(Nr=Dn(Ut.iconBox),yn=Nr.box.length>0),Kt=Kt&&Nr.offscreen}const Ja=se||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,Ys=ue||kt.numIconVertices===0;if(Ja||Ys?Ys?Ja||(yn=yn&&un):un=yn&&un:yn=un=yn&&un,un&&En&&En.box&&this.collisionIndex.insertCollisionBox(En.box,Re,A.get("text-ignore-placement"),T.bucketInstanceId,Pn&&Pn.box&&Cs?Cs:As,fe.ID),yn&&Nr&&this.collisionIndex.insertCollisionBox(Nr.box,$e,A.get("icon-ignore-placement"),T.bucketInstanceId,as,fe.ID),zn&&(un&&this.collisionIndex.insertCollisionCircles(zn.circles,Re,A.get("text-ignore-placement"),T.bucketInstanceId,As,fe.ID),y)){const Dn=T.bucketInstanceId;let si=this.collisionCircleArrays[Dn];si===void 0&&(si=this.collisionCircleArrays[Dn]=new Zr);for(let Sn=0;Sn<zn.circles.length;Sn+=4)si.circles.push(zn.circles[Sn+0]),si.circles.push(zn.circles[Sn+1]),si.circles.push(zn.circles[Sn+2]),si.circles.push(zn.collisionDetected?1:0)}if(kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(T.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new la(un||bt,yn||Qe,Kt||T.justReloaded),p[kt.crossTileID]=!0};if(st){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=T.getSortedSymbolIndexes(this.transform.angle);for(let Ut=kt.length-1;Ut>=0;--Ut){const un=kt[Ut];Mt(T.symbolInstances.get(un),T.collisionArrays[un])}}else for(let kt=o.symbolInstanceStart;kt<o.symbolInstanceEnd;kt++)Mt(T.symbolInstances.get(kt),T.collisionArrays[kt]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[T.bucketInstanceId];a.invert(kt.invProjMatrix,M),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(o,p,y,T){let A;A=T===a.WritingMode.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(p)];const M=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const B of M)B>=0&&(o.text.placedSymbolArray.get(B).crossTileID=A>=0&&B!==A?0:y.crossTileID)}markUsedOrientation(o,p,y){const T=p===a.WritingMode.horizontal||p===a.WritingMode.horizontalOnly?p:0,A=p===a.WritingMode.vertical?p:0,M=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const B of M)o.text.placedSymbolArray.get(B).placedOrientation=T;y.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let y=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const T=p?p.symbolFadeChange(o):1,A=p?p.opacities:{},M=p?p.variableOffsets:{},B=p?p.placedOrientations:{};for(const z in this.placements){const U=this.placements[z],$=A[z];$?(this.opacities[z]=new Va($,T,U.text,U.icon),y=y||U.text!==$.text.placed||U.icon!==$.icon.placed):(this.opacities[z]=new Va(null,T,U.text,U.icon,U.skipFade),y=y||U.text||U.icon)}for(const z in A){const U=A[z];if(!this.opacities[z]){const $=new Va(U,T,!1,!1);$.isHidden()||(this.opacities[z]=$,y=y||U.text.placed||U.icon.placed)}}for(const z in M)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=M[z]);for(const z in B)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=B[z]);if(p&&p.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:o)}updateLayerOpacities(o,p){const y={};for(const T of p){const A=T.getBucket(o);A&&T.latestFeatureIndex&&o.id===A.layerIds[0]&&this.updateBucketOpacities(A,y,T.collisionBoxArray)}}updateBucketOpacities(o,p,y){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const T=o.layers[0].layout,A=new Va(null,0,!1,!1,!0),M=T.get("text-allow-overlap"),B=T.get("icon-allow-overlap"),z=T.get("text-variable-anchor"),U=T.get("text-rotation-alignment")==="map",$=T.get("text-pitch-alignment")==="map",Y=T.get("icon-text-fit")!=="none",K=new Va(null,0,M&&(B||!o.hasIconData()||T.get("icon-optional")),B&&(M||!o.hasTextData()||T.get("text-optional")),!0);!o.collisionArrays&&y&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(y);const fe=(se,ue,Re)=>{for(let Pe=0;Pe<ue/4;Pe++)se.opacityVertexArray.emplaceBack(Re)};for(let se=0;se<o.symbolInstances.length;se++){const ue=o.symbolInstances.get(se),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Pe,crossTileID:$e}=ue;let me=this.opacities[$e];p[$e]?me=A:me||(me=K,this.opacities[$e]=me),p[$e]=!0;const Fe=ue.numIconVertices>0,He=this.placedOrientations[ue.crossTileID],rt=He===a.WritingMode.vertical,st=He===a.WritingMode.horizontal||He===a.WritingMode.horizontalOnly;if(Re>0||Pe>0){const bt=ke(me.text);fe(o.text,Re,rt?et:bt),fe(o.text,Pe,st?et:bt);const Qe=me.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(o.text.placedSymbolArray.get(Ut).hidden=Qe||rt?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=Qe||st?1:0);const Mt=this.variableOffsets[ue.crossTileID];Mt&&this.markUsedJustification(o,Mt.anchor,ue,He);const kt=this.placedOrientations[ue.crossTileID];kt&&(this.markUsedJustification(o,"left",ue,kt),this.markUsedOrientation(o,kt,ue))}if(Fe){const bt=ke(me.icon),Qe=!(Y&&ue.verticalPlacedIconSymbolIndex&&rt);ue.placedIconSymbolIndex>=0&&(fe(o.icon,ue.numIconVertices,Qe?bt:et),o.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=me.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(fe(o.icon,ue.numVerticalIconVertices,Qe?et:bt),o.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const bt=o.collisionArrays[se];if(bt){let Qe=new a.pointGeometry(0,0);if(bt.textBox||bt.verticalTextBox){let kt=!0;if(z){const Ut=this.variableOffsets[$e];Ut?(Qe=ca(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),U&&Qe._rotate($?this.transform.angle:-this.transform.angle)):kt=!1}bt.textBox&&V(o.textCollisionBox.collisionVertexArray,me.text.placed,!kt||rt,Qe.x,Qe.y),bt.verticalTextBox&&V(o.textCollisionBox.collisionVertexArray,me.text.placed,!kt||st,Qe.x,Qe.y)}const Mt=!!(!st&&bt.verticalIconBox);bt.iconBox&&V(o.iconCollisionBox.collisionVertexArray,me.icon.placed,Mt,Y?Qe.x:0,Y?Qe.y:0),bt.verticalIconBox&&V(o.iconCollisionBox.collisionVertexArray,me.icon.placed,!Mt,Y?Qe.x:0,Y?Qe.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=se.invProjMatrix,o.placementViewportMatrix=se.viewportMatrix,o.collisionCircleArray=se.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,p){const y=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function V(v,o,p,y,T){v.emplaceBack(o?1:0,p?1:0,y||0,T||0),v.emplaceBack(o?1:0,p?1:0,y||0,T||0),v.emplaceBack(o?1:0,p?1:0,y||0,T||0),v.emplaceBack(o?1:0,p?1:0,y||0,T||0)}const Z=Math.pow(2,25),Q=Math.pow(2,24),le=Math.pow(2,17),be=Math.pow(2,16),Ae=Math.pow(2,9),Se=Math.pow(2,8),xe=Math.pow(2,1);function ke(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const o=v.placed?1:0,p=Math.floor(127*v.opacity);return p*Z+o*Q+p*le+o*be+p*Ae+o*Se+p*xe+o}const et=0;class ct{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,p,y,T,A){const M=this._bucketParts;for(;this._currentTileIndex<o.length;)if(p.getBucketParts(M,T,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((B,z)=>B.sortKey-z.sortKey));this._currentPartIndex<M.length;)if(p.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,A())return!0;return!1}}class ot{constructor(o,p,y,T,A,M,B,z){this.placement=new ae(o,p,M,B,z),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=T,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(o,p,y){const T=a.exported.now(),A=()=>{const M=a.exported.now()-T;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=p[o[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=B)&&(!M.maxzoom||M.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new ct(M)),this._inProgressLayer.continuePlacement(y[M.source],this.placement,this._showCollisionBoxes,M,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Ft=512/a.EXTENT/2;class Lt{constructor(o,p,y){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=y;for(let T=0;T<p.length;T++){const A=p.get(T),M=A.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:A.crossTileID,coord:this.getScaledCoordinates(A,o)})}}getScaledCoordinates(o,p){const y=Ft/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*a.EXTENT+o.anchorX)*y),y:Math.floor((p.canonical.y*a.EXTENT+o.anchorY)*y)}}findMatches(o,p,y){const T=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let A=0;A<o.length;A++){const M=o.get(A);if(M.crossTileID)continue;const B=this.indexedSymbolInstances[M.key];if(!B)continue;const z=this.getScaledCoordinates(M,p);for(const U of B)if(Math.abs(U.coord.x-z.x)<=T&&Math.abs(U.coord.y-z.y)<=T&&!y[U.crossTileID]){y[U.crossTileID]=!0,M.crossTileID=U.crossTileID;break}}}}class Wt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const p=Math.round((o-this.lng)/360);if(p!==0)for(const y in this.indexes){const T=this.indexes[y],A={};for(const M in T){const B=T[M];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+p),A[B.tileID.key]=B}this.indexes[y]=A}this.lng=o}addBucket(o,p,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let A=0;A<p.symbolInstances.length;A++)p.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const T=this.usedCrossTileIDs[o.overscaledZ];for(const A in this.indexes){const M=this.indexes[A];if(Number(A)>o.overscaledZ)for(const B in M){const z=M[B];z.tileID.isChildOf(o)&&z.findMatches(p.symbolInstances,o,T)}else{const B=M[o.scaledTo(Number(A)).key];B&&B.findMatches(p.symbolInstances,o,T)}}for(let A=0;A<p.symbolInstances.length;A++){const M=p.symbolInstances.get(A);M.crossTileID||(M.crossTileID=y.generate(),T[M.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Lt(o,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(o,p){for(const y in p.indexedSymbolInstances)for(const T of p.indexedSymbolInstances[y])delete this.usedCrossTileIDs[o][T.crossTileID]}removeStaleBuckets(o){let p=!1;for(const y in this.indexes){const T=this.indexes[y];for(const A in T)o[T[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,T[A]),delete T[A],p=!0)}return p}}class _n{constructor(){this.layerIndexes={},this.crossTileIDs=new Wt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,p,y){let T=this.layerIndexes[o.id];T===void 0&&(T=this.layerIndexes[o.id]=new Qt);let A=!1;const M={};T.handleWrapJump(y);for(const B of p){const z=B.getBucket(o);z&&o.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(B.tileID,z,this.crossTileIDs)&&(A=!0),M[z.bucketInstanceId]=!0)}return T.removeStaleBuckets(M)&&(A=!0),A}pruneUnusedLayers(o){const p={};o.forEach(y=>{p[y]=!0});for(const y in this.layerIndexes)p[y]||delete this.layerIndexes[y]}}var gn=a.createLayout([{name:"a_pos",type:"Int16",components:2}]);class dn extends a.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const p=this._tiles[o];p.textures.forEach(y=>y.destroy()),p.textures=[]}}update(o,p){this.sourceCache.update(o,p),this._renderableTilesKeys=[];for(const y of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:p}))this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),a.ortho(y.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[y.key]=new Ot(y,this.tileSize))}removeOutdated(o){const p={};this.renderHistory=this.renderHistory.filter((y,T)=>this.renderHistory.indexOf(y)===T).slice(0,this.renderHistorySize);for(const y of this._renderableTilesKeys)p[y]=!0;for(const y of this.renderHistory)p[y]=!0;for(const y in this._tiles)p[y]||(this._tiles[y].clearTextures(o),delete this._tiles[y])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const p={};for(const y of this._renderableTilesKeys){const T=this._tiles[y].tileID;if(T.canonical.equals(o.canonical)){const A=o.clone();A.posMatrix=new Float64Array(16),a.ortho(A.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),p[y]=A}else if(T.canonical.isChildOf(o.canonical)){const A=o.clone();A.posMatrix=new Float64Array(16);const M=T.canonical.z-o.canonical.z,B=T.canonical.x-(T.canonical.x>>M<<M),z=T.canonical.y-(T.canonical.y>>M<<M),U=a.EXTENT>>M;a.ortho(A.posMatrix,0,U,0,U,0,1),a.translate(A.posMatrix,A.posMatrix,[-B*U,-z*U,0]),p[y]=A}else if(o.canonical.isChildOf(T.canonical)){const A=o.clone();A.posMatrix=new Float64Array(16);const M=o.canonical.z-T.canonical.z,B=o.canonical.x-(o.canonical.x>>M<<M),z=o.canonical.y-(o.canonical.y>>M<<M),U=a.EXTENT>>M;a.ortho(A.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(A.posMatrix,A.posMatrix,[B*U,z*U,0]),a.scale(A.posMatrix,A.posMatrix,[1/2**M,1/2**M,0]),p[y]=A}}return p}getSourceTile(o,p){const y=this.sourceCache._source;let T=o.overscaledZ-this.deltaZoom;if(T>y.maxzoom&&(T=y.maxzoom),T<y.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(T).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!A||!A.dem)&&p)for(;T>=y.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(o.scaledTo(T--).key);return A}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(p=>p.timeLoaded>=o)}}class an{constructor(o,p,y){this.style=o,this.sourceCache=new dn(p),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.elevationOffset=typeof y.elevationOffset=="number"?y.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,p,y,T=a.EXTENT){if(!(p>=0&&p<T&&y>=0&&y<T))return this.elevationOffset;let A=0;const M=this.getTerrainData(o);if(M.tile&&M.tile.dem){const B=a.transformMat4$1([],[p/T*a.EXTENT,y/T*a.EXTENT],M.u_terrain_matrix),z=[B[0]*M.tile.dem.dim,B[1]*M.tile.dem.dim],U=[Math.floor(z[0]),Math.floor(z[1])],$=M.tile.dem.get(U[0],U[1]),Y=M.tile.dem.get(U[0],U[1]+1),K=M.tile.dem.get(U[0]+1,U[1]),fe=M.tile.dem.get(U[0]+1,U[1]+1);A=a.number(a.number($,Y,z[0]-U[0]),a.number(K,fe,z[0]-U[0]),z[1]-U[1])}return A}rememberForRerender(o,p){for(const y in this.sourceCache._tiles){const T=this.sourceCache._tiles[y];(T.tileID.equals(p)||T.tileID.isChildOf(p))&&(o===this.sourceCache.sourceCache.id&&(T.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][T.tileID.key]=!0)}}needsRerender(o,p){return this._rerender[o]&&this._rerender[o][p.key]}clearRerenderCache(){this._rerender={}}getElevation(o,p,y,T=a.EXTENT){return(this.getDEMElevation(o,p,y,T)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const T=this.style.map.painter.context,A=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new H(T,A,T.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new H(T,new a.RGBAImage({width:1,height:1}),T.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(T.gl.NEAREST,T.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const p=this.sourceCache.getSourceTile(o,!0);if(p&&p.dem&&(!p.demTexture||p.needsTerrainPrepare)){const T=this.style.map.painter.context;p.demTexture=this.style.map.painter.getTileTexture(p.dem.stride),p.demTexture?p.demTexture.update(p.dem.getPixels(),{premultiply:!1}):p.demTexture=new H(T,p.dem.getPixels(),T.gl.RGBA,{premultiply:!1}),p.demTexture.bind(T.gl.NEAREST,T.gl.CLAMP_TO_EDGE),p.needsTerrainPrepare=!1}const y=p&&p+p.tileID.key+o.key;if(y&&!this._demMatrixCache[y]){const T=this.sourceCache.sourceCache._source.maxzoom;let A=o.canonical.z-p.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=T?A=o.canonical.z-T:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=o.canonical.x-(o.canonical.x>>A<<A),B=o.canonical.y-(o.canonical.y>>A<<A),z=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<A),1/(a.EXTENT<<A),0]);a.translate(z,z,[M*a.EXTENT,B*a.EXTENT,0]),this._demMatrixCache[o.key]={matrix:z,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:p&&p.dem&&p.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:p&&p.dem&&p.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(p&&p.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:p}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const p=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(p,p,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,p,p))}return this._rttFramebuffer}getFramebuffer(o){const p=this.style.map.painter,y=p.width/devicePixelRatio,T=p.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===T||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new H(p.context,{width:y,height:T,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new H(p.context,{width:y,height:T,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=p.context.createFramebuffer(y,T,!0),this._fbo.depthAttachment.set(p.context.createRenderbuffer(p.context.gl.DEPTH_COMPONENT16,y,T))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const p=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,M=0;A<this._coordsTextureSize;A++)for(let B=0;B<this._coordsTextureSize;B++,M+=4)p[M+0]=255&B,p[M+1]=255&A,p[M+2]=B>>8<<4|A>>8,p[M+3]=0;const y=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(p.buffer)),T=new H(o,y,o.gl.RGBA,{premultiply:!1});return T.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=T,T}pointCoordinate(o){const p=new Uint8Array(4),y=this.style.map.painter,T=y.context,A=T.gl;T.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),A.readPixels(o.x,y.height/devicePixelRatio-o.y-1,1,1,A.RGBA,A.UNSIGNED_BYTE,p),T.bindFramebuffer.set(null);const M=p[0]+(p[2]>>4<<8),B=p[1]+((15&p[2])<<8),z=this.coordsIndex[255-p[3]],U=z&&this.sourceCache.getTileByID(z);if(!U)return null;const $=this._coordsTextureSize,Y=(1<<U.tileID.canonical.z)*$;return new a.MercatorCoordinate((U.tileID.canonical.x*$+M)/Y,(U.tileID.canonical.y*$+B)/Y,this.getElevation(U.tileID,M,B,$))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,p=new a.PosArray,y=new a.TriangleIndexArray,T=this.meshSize,A=a.EXTENT/T,M=T*T;for(let B=0;B<=T;B++)for(let z=0;z<=T;z++)p.emplaceBack(z*A,B*A);for(let B=0;B<M;B+=T+1)for(let z=0;z<T;z++)y.emplaceBack(z+B,T+z+B+1,T+z+B+2),y.emplaceBack(z+B,T+z+B+2,z+B+1);return this._mesh={indexBuffer:o.createIndexBuffer(y),vertexBuffer:o.createVertexBuffer(p,gn.members),segments:a.SegmentVector.simpleSegment(0,0,p.length,y.length)},this._mesh}getMinMaxElevation(o){const p=this.getTerrainData(o).tile,y={minElevation:null,maxElevation:null};return p&&p.dem&&(y.minElevation=(p.dem.min+this.elevationOffset)*this.exaggeration,y.maxElevation=(p.dem.max+this.elevationOffset)*this.exaggeration),y}}const ln=(v,o)=>a.emitValidationErrors(v,o&&o.filter(p=>p.identifier!=="source.canvas")),Di=a.pick(wn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ci=a.pick(wn,["setCenter","setZoom","setBearing","setPitch"]),Oi=function(){const v={},o=a.spec.$version;for(const p in a.spec.$root){const y=a.spec.$root[p];if(y.required){let T=null;T=p==="version"?o:y.type==="array"?[]:{},T!=null&&(v[p]=T)}}return v}();class rr extends a.Evented{constructor(o,p={}){super(),this.map=o,this.dispatcher=new Ce(xs(),this),this.imageManager=new ne,this.imageManager.setEventedParent(this),this.glyphManager=new _e(o._requestManager,p.localIdeographFontFamily),this.lineAtlas=new nt(256,512),this.crossTileSymbolIndex=new _n,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const y=this;this._rtlTextPluginCallback=rr.registerForPluginStateChange(T=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},(A,M)=>{if(a.triggerPluginCompletionEvent(A),M&&M.every(B=>B))for(const B in y.sourceCaches)y.sourceCaches[B].reload()})}),this.on("data",T=>{if(T.dataType!=="source"||T.sourceDataType!=="metadata")return;const A=this.sourceCaches[T.sourceId];if(!A)return;const M=A.getSource();if(M&&M.vectorLayerIds)for(const B in this._layers){const z=this._layers[B];z.source===M.id&&this._validateLayer(z)}})}loadURL(o,p={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const y=typeof p.validate!="boolean"||p.validate,T=this.map._requestManager.transformRequest(o,a.ResourceType.Style);this._request=a.getJSON(T,(A,M)=>{this._request=null,A?this.fire(new a.ErrorEvent(A)):M&&this._load(M,y)})}loadJSON(o,p={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(o,p.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Oi,!1)}_load(o,p){if(p&&ln(this,a.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const T in o.sources)this.addSource(T,o.sources[T],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const y=$s(this.stylesheet.layers);this._order=y.map(T=>T.id),this._layers={},this._serializedLayers={};for(let T of y)T=a.createStyleLayer(T),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new mt(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(p,y,T,A){let M,B,z;const U=T>1?"@2x":"";let $=a.getJSON(y.transformRequest(y.normalizeSpriteURL(p,U,".json"),a.ResourceType.SpriteJSON),(fe,se)=>{$=null,z||(z=fe,M=se,K())}),Y=a.getImage(y.transformRequest(y.normalizeSpriteURL(p,U,".png"),a.ResourceType.SpriteImage),(fe,se)=>{Y=null,z||(z=fe,B=se,K())});function K(){if(z)A(z);else if(M&&B){const fe=a.exported.getImageData(B),se={};for(const ue in M){const{width:Re,height:Pe,x:$e,y:me,sdf:Fe,pixelRatio:He,stretchX:rt,stretchY:st,content:bt}=M[ue],Qe=new a.RGBAImage({width:Re,height:Pe});a.RGBAImage.copy(fe,Qe,{x:$e,y:me},{x:0,y:0},{width:Re,height:Pe}),se[ue]={data:Qe,pixelRatio:He,sdf:Fe,stretchX:rt,stretchY:st,content:bt}}A(null,se)}}return{cancel(){$&&($.cancel(),$=null),Y&&(Y.cancel(),Y=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(p,y)=>{if(this._spriteRequest=null,p)this.fire(new a.ErrorEvent(p));else if(y)for(const T in y)this.imageManager.addImage(T,y[T]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(o){const p=this.sourceCaches[o.source];if(!p)return;const y=o.sourceLayer;if(!y)return;const T=p.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${T.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const p=[];for(const y of o){const T=this._layers[y];T.type!=="custom"&&p.push(T.serialize())}return p}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const p=this._changed;if(this._changed){const T=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(T.length||A.length)&&this._updateWorkerLayers(T,A);for(const M in this._updatedSources){const B=this._updatedSources[M];if(B==="reload")this._reloadSource(M);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(M)}}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const y={};for(const T in this.sourceCaches){const A=this.sourceCaches[T];y[T]=A.used,A.used=!1}for(const T of this._order){const A=this._layers[T];A.recalculate(o,this._availableImages),!A.isHidden(o.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const T in y){const A=this.sourceCaches[T];y[T]!==A.used&&A.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T}))}this.light.recalculate(o),this.z=o.zoom,p&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const p=this.sourceCaches[o.source];if(!p)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new an(this,p,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=y=>{y.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=y=>{y.tile&&(y.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(y.sourceId,y.tile.tileID)):y.source.type==="geojson"&&this.terrain.rememberForRerender(y.sourceId,y.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new a.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),ln(this,a.validateStyle(o)))return!1;(o=a.clone$1(o)).layers=$s(o.layers);const p=function(T,A){if(!T)return[{command:wn.setStyle,args:[A]}];let M=[];try{if(!R(T.version,A.version))return[{command:wn.setStyle,args:[A]}];R(T.center,A.center)||M.push({command:wn.setCenter,args:[A.center]}),R(T.zoom,A.zoom)||M.push({command:wn.setZoom,args:[A.zoom]}),R(T.bearing,A.bearing)||M.push({command:wn.setBearing,args:[A.bearing]}),R(T.pitch,A.pitch)||M.push({command:wn.setPitch,args:[A.pitch]}),R(T.sprite,A.sprite)||M.push({command:wn.setSprite,args:[A.sprite]}),R(T.glyphs,A.glyphs)||M.push({command:wn.setGlyphs,args:[A.glyphs]}),R(T.transition,A.transition)||M.push({command:wn.setTransition,args:[A.transition]}),R(T.light,A.light)||M.push({command:wn.setLight,args:[A.light]});const B={},z=[];(function($,Y,K,fe){let se;for(se in Y=Y||{},$=$||{})Object.prototype.hasOwnProperty.call($,se)&&(Object.prototype.hasOwnProperty.call(Y,se)||ra(se,K,fe));for(se in Y)Object.prototype.hasOwnProperty.call(Y,se)&&(Object.prototype.hasOwnProperty.call($,se)?R($[se],Y[se])||($[se].type==="geojson"&&Y[se].type==="geojson"&&Ta($,Y,se)?K.push({command:wn.setGeoJSONSourceData,args:[se,Y[se].data]}):sa(se,Y,K,fe)):qr(se,Y,K))})(T.sources,A.sources,z,B);const U=[];T.layers&&T.layers.forEach($=>{B[$.source]?M.push({command:wn.removeLayer,args:[$.id]}):U.push($)}),M=M.concat(z),function($,Y,K){Y=Y||[];const fe=($=$||[]).map(aa),se=Y.map(aa),ue=$.reduce(ft,{}),Re=Y.reduce(ft,{}),Pe=fe.slice(),$e=Object.create(null);let me,Fe,He,rt,st,bt,Qe;for(me=0,Fe=0;me<fe.length;me++)He=fe[me],Object.prototype.hasOwnProperty.call(Re,He)?Fe++:(K.push({command:wn.removeLayer,args:[He]}),Pe.splice(Pe.indexOf(He,Fe),1));for(me=0,Fe=0;me<se.length;me++)He=se[se.length-1-me],Pe[Pe.length-1-me]!==He&&(Object.prototype.hasOwnProperty.call(ue,He)?(K.push({command:wn.removeLayer,args:[He]}),Pe.splice(Pe.lastIndexOf(He,Pe.length-Fe),1)):Fe++,bt=Pe[Pe.length-me],K.push({command:wn.addLayer,args:[Re[He],bt]}),Pe.splice(Pe.length-me,0,He),$e[He]=!0);for(me=0;me<se.length;me++)if(He=se[me],rt=ue[He],st=Re[He],!$e[He]&&!R(rt,st))if(R(rt.source,st.source)&&R(rt["source-layer"],st["source-layer"])&&R(rt.type,st.type)){for(Qe in vs(rt.layout,st.layout,K,He,null,wn.setLayoutProperty),vs(rt.paint,st.paint,K,He,null,wn.setPaintProperty),R(rt.filter,st.filter)||K.push({command:wn.setFilter,args:[He,st.filter]}),R(rt.minzoom,st.minzoom)&&R(rt.maxzoom,st.maxzoom)||K.push({command:wn.setLayerZoomRange,args:[He,st.minzoom,st.maxzoom]}),rt)Object.prototype.hasOwnProperty.call(rt,Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?vs(rt[Qe],st[Qe],K,He,Qe.slice(6),wn.setPaintProperty):R(rt[Qe],st[Qe])||K.push({command:wn.setLayerProperty,args:[He,Qe,st[Qe]]}));for(Qe in st)Object.prototype.hasOwnProperty.call(st,Qe)&&!Object.prototype.hasOwnProperty.call(rt,Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?vs(rt[Qe],st[Qe],K,He,Qe.slice(6),wn.setPaintProperty):R(rt[Qe],st[Qe])||K.push({command:wn.setLayerProperty,args:[He,Qe,st[Qe]]}))}else K.push({command:wn.removeLayer,args:[He]}),bt=Pe[Pe.lastIndexOf(He)+1],K.push({command:wn.addLayer,args:[st,bt]})}(U,A.layers,M)}catch(B){console.warn("Unable to compute style diff:",B),M=[{command:wn.setStyle,args:[A]}]}return M}(this.serialize(),o).filter(T=>!(T.command in ci));if(p.length===0)return!1;const y=p.filter(T=>!(T.command in Di));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);return p.forEach(T=>{T.command!=="setTransition"&&this[T.command].apply(this,T.args)}),this.stylesheet=o,!0}addImage(o,p){if(this.getImage(o))return this.fire(new a.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,p),this._afterImageUpdated(o)}updateImage(o,p){this.imageManager.updateImage(o,p)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,p,y={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(a.validateStyle.source,`sources.${o}`,p,null,y))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const T=this.sourceCaches[o]=new Qn(o,p,this.dispatcher);T.style=this,T.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:T.serialize(),sourceId:o})),T.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new a.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));const p=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],p.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),p.setEventedParent(null),p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,p){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const y=this.sourceCaches[o].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(p),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,p,y={}){this._checkLoaded();const T=o.id;if(this.getLayer(T))return void this.fire(new a.ErrorEvent(new Error(`Layer "${T}" already exists on this map.`)));let A;if(o.type==="custom"){if(ln(this,a.validateCustomStyleLayer(o)))return;A=a.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(T,o.source),o=a.clone$1(o),o=a.extend(o,{source:T})),this._validate(a.validateStyle.layer,`layers.${T}`,o,{arrayIndex:-1},y))return;A=a.createStyleLayer(o),this._validateLayer(A),A.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[A.id]=A.serialize()}const M=p?this._order.indexOf(p):this._order.length;if(p&&M===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${T}" before non-existing layer "${p}".`)));else{if(this._order.splice(M,0,T),this._layerOrderChanged=!0,this._layers[T]=A,this._removedLayers[T]&&A.source&&A.type!=="custom"){const B=this._removedLayers[T];delete this._removedLayers[T],B.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(o,p){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===p)return;const y=this._order.indexOf(o);this._order.splice(y,1);const T=p?this._order.indexOf(p):this._order.length;p&&T===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${p}".`))):(this._order.splice(T,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const p=this._layers[o];if(!p)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));p.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=p,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],p.onRemove&&p.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,p,y){this._checkLoaded();const T=this.getLayer(o);T?T.minzoom===p&&T.maxzoom===y||(p!=null&&(T.minzoom=p),y!=null&&(T.maxzoom=y),this._updateLayer(T)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,p,y={}){this._checkLoaded();const T=this.getLayer(o);if(T){if(!R(T.filter,p))return p==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(a.validateStyle.filter,`layers.${T.id}.filter`,p,null,y)||(T.filter=a.clone$1(p),this._updateLayer(T)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,p,y,T={}){this._checkLoaded();const A=this.getLayer(o);A?R(A.getLayoutProperty(p),y)||(A.setLayoutProperty(p,y,T),this._updateLayer(A)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,p){const y=this.getLayer(o);if(y)return y.getLayoutProperty(p);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,p,y,T={}){this._checkLoaded();const A=this.getLayer(o);A?R(A.getPaintProperty(p),y)||(A.setPaintProperty(p,y,T)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,p){return this.getLayer(o).getPaintProperty(p)}setFeatureState(o,p){this._checkLoaded();const y=o.source,T=o.sourceLayer,A=this.sourceCaches[y];if(A===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const M=A.getSource().type;M==="geojson"&&T?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||T?(o.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),A.setFeatureState(T,o.id,p)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,p){this._checkLoaded();const y=o.source,T=this.sourceCaches[y];if(T===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const A=T.getSource().type,M=A==="vector"?o.sourceLayer:void 0;A!=="vector"||M?p&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(M,o.id,p):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const p=o.source,y=o.sourceLayer,T=this.sourceCaches[p];if(T!==void 0)return T.getSource().type!=="vector"||y?(o.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),T.getFeatureState(y,o.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const p=M=>this._layers[M].type==="fill-extrusion",y={},T=[];for(let M=this._order.length-1;M>=0;M--){const B=this._order[M];if(p(B)){y[B]=M;for(const z of o){const U=z[B];if(U)for(const $ of U)T.push($)}}}T.sort((M,B)=>B.intersectionZ-M.intersectionZ);const A=[];for(let M=this._order.length-1;M>=0;M--){const B=this._order[M];if(p(B))for(let z=T.length-1;z>=0;z--){const U=T[z].feature;if(y[U.layer.id]<M)break;A.push(U),T.pop()}else for(const z of o){const U=z[B];if(U)for(const $ of U)A.push($.feature)}}return A}queryRenderedFeatures(o,p,y){p&&p.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);const T={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of p.layers){const B=this._layers[M];if(!B)return this.fire(new a.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];T[B.source]=!0}}const A=[];p.availableImages=this._availableImages;for(const M in this.sourceCaches)p.layers&&!T[M]||A.push(zt(this.sourceCaches[M],this._layers,this._serializedLayers,o,p,y));return this.placement&&A.push(function(M,B,z,U,$,Y,K){const fe={},se=Y.queryRenderedSymbols(U),ue=[];for(const Re of Object.keys(se).map(Number))ue.push(K[Re]);ue.sort(qt);for(const Re of ue){const Pe=Re.featureIndex.lookupSymbolFeatures(se[Re.bucketInstanceId],B,Re.bucketIndex,Re.sourceLayerIndex,$.filter,$.layers,$.availableImages,M);for(const $e in Pe){const me=fe[$e]=fe[$e]||[],Fe=Pe[$e];Fe.sort((He,rt)=>{const st=Re.featureSortOrder;if(st){const bt=st.indexOf(He.featureIndex);return st.indexOf(rt.featureIndex)-bt}return rt.featureIndex-He.featureIndex});for(const He of Fe)me.push(He)}}for(const Re in fe)fe[Re].forEach(Pe=>{const $e=Pe.feature,me=z[M[Re].source].getFeatureState($e.layer["source-layer"],$e.id);$e.source=$e.layer.source,$e.layer["source-layer"]&&($e.sourceLayer=$e.layer["source-layer"]),$e.state=me});return fe}(this._layers,this._serializedLayers,this.sourceCaches,o,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(o,p){p&&p.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);const y=this.sourceCaches[o];return y?function(T,A){const M=T.getRenderableIds().map(U=>T.getTileByID(U)),B=[],z={};for(let U=0;U<M.length;U++){const $=M[U],Y=$.tileID.canonical.key;z[Y]||(z[Y]=!0,$.querySourceFeatures(B,A))}return B}(y,p):[]}addSourceType(o,p,y){return rr.getSourceType(o)?y(new Error(`A source type called "${o}" already exists.`)):(rr.setSourceType(o,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:p.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(o,p={}){this._checkLoaded();const y=this.light.getLight();let T=!1;for(const M in o)if(!R(o[M],y[M])){T=!0;break}if(!T)return;const A={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,p),this.light.updateTransitions(A)}_validate(o,p,y,T,A={}){return(!A||A.validate!==!1)&&ln(this,o.call(a.validateStyle,a.extend({key:p,style:this.serialize(),value:y,styleSpec:a.spec},T)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const p=this.sourceCaches[o];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const p in this.sourceCaches)this.sourceCaches[p].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,p,y,T,A=!1){let M=!1,B=!1;const z={};for(const U of this._order){const $=this._layers[U];if($.type!=="symbol")continue;if(!z[$.source]){const K=this.sourceCaches[$.source];z[$.source]=K.getRenderableIds(!0).map(fe=>K.getTileByID(fe)).sort((fe,se)=>se.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(se.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer($,z[$.source],o.center.lng);M=M||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),o.zoom))&&(this.pauseablePlacement=new ot(o,this.terrain,this._order,A,p,y,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),B=!0),M&&this.pauseablePlacement.placement.setStale()),B||M)for(const U of this._order){const $=this._layers[U];$.type==="symbol"&&this.placement.updateLayerOpacities($,z[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,p,y){this.imageManager.getImages(p.icons,y),this._updateTilesForChangedImages();const T=this.sourceCaches[p.source];T&&T.setDependencies(p.tileID.key,p.type,p.icons)}getGlyphs(o,p,y){this.glyphManager.getGlyphs(p.stacks,y)}getResource(o,p,y){return a.makeRequest(p,y)}}rr.getSourceType=function(v){return Tt[v]},rr.setSourceType=function(v,o){Tt[v]=o},rr.registerForPluginStateChange=a.registerForPluginStateChange;var Ju="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const il={prelude:Tn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Tn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Tn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Tn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Tn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Tn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Tn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Tn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Tn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Tn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Tn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Tn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Tn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Tn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Tn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Tn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Tn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Tn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Tn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Tn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ju),terrainDepth:Tn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ju),terrainCoords:Tn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ju)};function Tn(v,o){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=o.match(/attribute ([\w]+) ([\w]+)/g),T=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=A?A.concat(T):T,B={};return{fragmentSource:v=v.replace(p,(z,U,$,Y,K)=>(B[K]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${$} ${Y} ${K};
#else
uniform ${$} ${Y} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${$} ${Y} ${K} = u_${K};
#endif
`)),vertexSource:o=o.replace(p,(z,U,$,Y,K)=>{const fe=Y==="float"?"vec2":"vec4",se=K.match(/color/)?"color":fe;return B[K]?U==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${$} ${fe} a_${K};
varying ${$} ${Y} ${K};
#else
uniform ${$} ${Y} u_${K};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${$} ${Y} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${se}(a_${K}, u_${K}_t);
#else
    ${$} ${Y} ${K} = u_${K};
#endif
`:U==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${$} ${fe} a_${K};
#else
uniform ${$} ${Y} u_${K};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${$} ${Y} ${K} = a_${K};
#else
    ${$} ${Y} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${$} ${Y} ${K} = unpack_mix_${se}(a_${K}, u_${K}_t);
#else
    ${$} ${Y} ${K} = u_${K};
#endif
`}),staticAttributes:y,staticUniforms:M}}class xf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,p,y,T,A,M,B,z,U){this.context=o;let $=this.boundPaintVertexBuffers.length!==T.length;for(let Y=0;!$&&Y<T.length;Y++)this.boundPaintVertexBuffers[Y]!==T[Y]&&($=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===p&&this.boundLayoutVertexBuffer===y&&!$&&this.boundIndexBuffer===A&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===B&&this.boundDynamicVertexBuffer2===z&&this.boundDynamicVertexBuffer3===U?(o.bindVertexArrayOES.set(this.vao),B&&B.bind(),A&&A.dynamicDraw&&A.bind(),z&&z.bind(),U&&U.bind()):this.freshBind(p,y,T,A,M,B,z,U)}freshBind(o,p,y,T,A,M,B,z){let U;const $=o.numAttributes,Y=this.context,K=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),U=0,this.boundProgram=o,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=T,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=z;else{U=Y.currentNumAttributes||0;for(let fe=$;fe<U;fe++)K.disableVertexAttribArray(fe)}p.enableAttributes(K,o);for(const fe of y)fe.enableAttributes(K,o);M&&M.enableAttributes(K,o),B&&B.enableAttributes(K,o),z&&z.enableAttributes(K,o),p.bind(),p.setVertexAttribPointers(K,o,A);for(const fe of y)fe.bind(),fe.setVertexAttribPointers(K,o,A);M&&(M.bind(),M.setVertexAttribPointers(K,o,A)),T&&T.bind(),B&&(B.bind(),B.setVertexAttribPointers(K,o,A)),z&&(z.bind(),z.setVertexAttribPointers(K,o,A)),Y.currentNumAttributes=$}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hc(v){const o=[];for(let p=0;p<v.length;p++){if(v[p]===null)continue;const y=v[p].split(" ");o.push(y.pop())}return o}class qc{constructor(o,p,y,T,A,M,B){const z=o.gl;this.program=z.createProgram();const U=Hc(y.staticAttributes),$=T?T.getBinderAttributes():[],Y=U.concat($),K=il.prelude.staticUniforms?Hc(il.prelude.staticUniforms):[],fe=y.staticUniforms?Hc(y.staticUniforms):[],se=T?T.getBinderUniforms():[],ue=K.concat(fe).concat(se),Re=[];for(const st of ue)Re.indexOf(st)<0&&Re.push(st);const Pe=T?T.defines():[];M&&Pe.push("#define OVERDRAW_INSPECTOR;"),B&&Pe.push("#define TERRAIN3D;");const $e=Pe.concat(il.prelude.fragmentSource,y.fragmentSource).join(`
`),me=Pe.concat(il.prelude.vertexSource,y.vertexSource).join(`
`),Fe=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Fe,$e),z.compileShader(Fe),z.attachShader(this.program,Fe);const He=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(He,me),z.compileShader(He),z.attachShader(this.program,He),this.attributes={};const rt={};this.numAttributes=Y.length;for(let st=0;st<this.numAttributes;st++)Y[st]&&(z.bindAttribLocation(this.program,st,Y[st]),this.attributes[Y[st]]=st);z.linkProgram(this.program),z.deleteShader(He),z.deleteShader(Fe);for(let st=0;st<Re.length;st++){const bt=Re[st];if(bt&&!rt[bt]){const Qe=z.getUniformLocation(this.program,bt);Qe&&(rt[bt]=Qe)}}this.fixedUniforms=A(o,rt),this.terrainUniforms=((st,bt)=>({u_depth:new a.Uniform1i(st,bt.u_depth),u_terrain:new a.Uniform1i(st,bt.u_terrain),u_terrain_dim:new a.Uniform1f(st,bt.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(st,bt.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(st,bt.u_terrain_unpack),u_terrain_offset:new a.Uniform1f(st,bt.u_terrain_offset),u_terrain_exaggeration:new a.Uniform1f(st,bt.u_terrain_exaggeration)}))(o,rt),this.binderUniforms=T?T.getUniforms(o,rt):[]}draw(o,p,y,T,A,M,B,z,U,$,Y,K,fe,se,ue,Re,Pe,$e){const me=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(y),o.setStencilMode(T),o.setColorMode(A),o.setCullFace(M),z){o.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,z.depthTexture),o.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,z.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(z[He])}for(const He in this.fixedUniforms)this.fixedUniforms[He].set(B[He]);ue&&ue.setUniforms(o,this.binderUniforms,fe,{zoom:se});let Fe=0;switch(p){case me.LINES:Fe=2;break;case me.TRIANGLES:Fe=3;break;case me.LINE_STRIP:Fe=1}for(const He of K.get()){const rt=He.vaos||(He.vaos={});(rt[U]||(rt[U]=new xf)).bind(o,this,$,ue?ue.getPaintVertexBuffers():[],Y,He.vertexOffset,Re,Pe,$e),me.drawElements(p,He.primitiveLength*Fe,me.UNSIGNED_SHORT,He.primitiveOffset*Fe*2)}}}function Wc(v,o,p){const y=1/ni(p,1,o.transform.tileZoom),T=Math.pow(2,p.tileID.overscaledZ),A=p.tileSize*Math.pow(2,o.transform.tileZoom)/T,M=A*(p.tileID.canonical.x+p.tileID.wrap*T),B=A*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[y,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[M>>16,B>>16],u_pixel_coord_lower:[65535&M,65535&B]}}const ic=(v,o,p,y)=>{const T=o.style.light,A=T.properties.get("position"),M=[A.x,A.y,A.z],B=a.create$1();T.properties.get("anchor")==="viewport"&&a.fromRotation(B,-o.transform.angle),a.transformMat3(M,M,B);const z=T.properties.get("color");return{u_matrix:v,u_lightpos:M,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+p,u_opacity:y}},eh=(v,o,p,y,T,A,M)=>a.extend(ic(v,o,p,y),Wc(A,o,M),{u_height_factor:-Math.pow(2,T.overscaledZ)/M.tileSize/8}),ns=v=>({u_matrix:v}),rc=(v,o,p,y)=>a.extend(ns(v),Wc(p,o,y)),th=(v,o)=>({u_matrix:v,u_world:o}),Xc=(v,o,p,y,T)=>a.extend(rc(v,o,p,y),{u_world:T}),ws=(v,o,p,y)=>{const T=v.transform;let A,M;if(y.paint.get("circle-pitch-alignment")==="map"){const B=ni(p,1,T.zoom);A=!0,M=[B,B]}else A=!1,M=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(o.posMatrix,p,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:M}},sc=(v,o,p)=>{const y=ni(p,1,o.zoom),T=Math.pow(2,o.zoom-p.tileID.overscaledZ),A=p.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[o.pixelsToGLUnits[0]/(y*T),o.pixelsToGLUnits[1]/(y*T)],u_overscale_factor:A}},To=(v,o,p=1)=>({u_matrix:v,u_color:o,u_overlay:0,u_overlay_scale:p}),ua=v=>({u_matrix:v}),Zc=(v,o,p,y)=>({u_matrix:v,u_extrude_scale:ni(o,1,p),u_intensity:y});function ac(v,o){const p=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new a.MercatorCoordinate(0,y/p).toLngLat().lat,new a.MercatorCoordinate(0,(y+1)/p).toLngLat().lat]}const rl=(v,o,p,y)=>{const T=v.transform;return{u_matrix:lc(v,o,p,y),u_ratio:1/ni(o,1,T.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},sl=(v,o,p,y,T)=>a.extend(rl(v,o,p,T),{u_image:0,u_image_height:y}),oc=(v,o,p,y,T)=>{const A=v.transform,M=ja(o,A);return{u_matrix:lc(v,o,p,T),u_texsize:o.imageAtlasTexture.size,u_ratio:1/ni(o,1,A.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[M,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Ti=(v,o,p,y,T,A)=>{const M=v.lineAtlas,B=ja(o,v.transform),z=p.layout.get("line-cap")==="round",U=M.getDash(y.from,z),$=M.getDash(y.to,z),Y=U.width*T.fromScale,K=$.width*T.toScale;return a.extend(rl(v,o,p,A),{u_patternscale_a:[B/Y,-U.height/2],u_patternscale_b:[B/K,-$.height/2],u_sdfgamma:M.width/(256*Math.min(Y,K)*v.pixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:$.y,u_mix:T.t})};function ja(v,o){return 1/ni(v,1,o.tileZoom)}function lc(v,o,p,y){return v.translatePosMatrix(y?y.posMatrix:o.tileID.posMatrix,o,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}const Yc=(v,o,p,y,T)=>{return{u_matrix:v,u_tl_parent:o,u_scale_parent:p,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(M=T.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(A=T.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:So(T.paint.get("raster-hue-rotate"))};var A,M};function So(v){v*=Math.PI/180;const o=Math.sin(v),p=Math.cos(v);return[(2*p+1)/3,(-Math.sqrt(3)*o-p+1)/3,(Math.sqrt(3)*o-p+1)/3]}const Ea=(v,o,p,y,T,A,M,B,z,U)=>{const $=T.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:$.width/$.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:M,u_coord_matrix:B,u_is_text:+z,u_pitch_with_map:+y,u_texsize:U,u_texture:0}},Gc=(v,o,p,y,T,A,M,B,z,U,$)=>{const Y=T.transform;return a.extend(Ea(v,o,p,y,T,A,M,B,z,U),{u_gamma_scale:y?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},nh=(v,o,p,y,T,A,M,B,z,U)=>a.extend(Gc(v,o,p,y,T,A,M,B,!0,z),{u_texsize_icon:U,u_texture_icon:1}),vf=(v,o,p)=>({u_matrix:v,u_opacity:o,u_color:p}),Eo=(v,o,p,y,T,A)=>a.extend(function(M,B,z,U){const $=z.imageManager.getPattern(M.from.toString()),Y=z.imageManager.getPattern(M.to.toString()),{width:K,height:fe}=z.imageManager.getPixelSize(),se=Math.pow(2,U.tileID.overscaledZ),ue=U.tileSize*Math.pow(2,z.transform.tileZoom)/se,Re=ue*(U.tileID.canonical.x+U.tileID.wrap*se),Pe=ue*U.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[K,fe],u_mix:B.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/ni(U,1,z.transform.tileZoom),u_pixel_coord_upper:[Re>>16,Pe>>16],u_pixel_coord_lower:[65535&Re,65535&Pe]}}(y,A,p,T),{u_matrix:v,u_opacity:o}),qs={fillExtrusion:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_lightpos:new a.Uniform3f(v,o.u_lightpos),u_lightintensity:new a.Uniform1f(v,o.u_lightintensity),u_lightcolor:new a.Uniform3f(v,o.u_lightcolor),u_vertical_gradient:new a.Uniform1f(v,o.u_vertical_gradient),u_opacity:new a.Uniform1f(v,o.u_opacity)}),fillExtrusionPattern:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_lightpos:new a.Uniform3f(v,o.u_lightpos),u_lightintensity:new a.Uniform1f(v,o.u_lightintensity),u_lightcolor:new a.Uniform3f(v,o.u_lightcolor),u_vertical_gradient:new a.Uniform1f(v,o.u_vertical_gradient),u_height_factor:new a.Uniform1f(v,o.u_height_factor),u_image:new a.Uniform1i(v,o.u_image),u_texsize:new a.Uniform2f(v,o.u_texsize),u_pixel_coord_upper:new a.Uniform2f(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(v,o.u_pixel_coord_lower),u_scale:new a.Uniform3f(v,o.u_scale),u_fade:new a.Uniform1f(v,o.u_fade),u_opacity:new a.Uniform1f(v,o.u_opacity)}),fill:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix)}),fillPattern:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_image:new a.Uniform1i(v,o.u_image),u_texsize:new a.Uniform2f(v,o.u_texsize),u_pixel_coord_upper:new a.Uniform2f(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(v,o.u_pixel_coord_lower),u_scale:new a.Uniform3f(v,o.u_scale),u_fade:new a.Uniform1f(v,o.u_fade)}),fillOutline:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_world:new a.Uniform2f(v,o.u_world)}),fillOutlinePattern:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_world:new a.Uniform2f(v,o.u_world),u_image:new a.Uniform1i(v,o.u_image),u_texsize:new a.Uniform2f(v,o.u_texsize),u_pixel_coord_upper:new a.Uniform2f(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(v,o.u_pixel_coord_lower),u_scale:new a.Uniform3f(v,o.u_scale),u_fade:new a.Uniform1f(v,o.u_fade)}),circle:(v,o)=>({u_camera_to_center_distance:new a.Uniform1f(v,o.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(v,o.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(v,o.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(v,o.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(v,o.u_matrix)}),collisionBox:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_camera_to_center_distance:new a.Uniform1f(v,o.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(v,o.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(v,o.u_extrude_scale),u_overscale_factor:new a.Uniform1f(v,o.u_overscale_factor)}),collisionCircle:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_inv_matrix:new a.UniformMatrix4f(v,o.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(v,o.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(v,o.u_viewport_size)}),debug:(v,o)=>({u_color:new a.UniformColor(v,o.u_color),u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_overlay:new a.Uniform1i(v,o.u_overlay),u_overlay_scale:new a.Uniform1f(v,o.u_overlay_scale)}),clippingMask:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix)}),heatmap:(v,o)=>({u_extrude_scale:new a.Uniform1f(v,o.u_extrude_scale),u_intensity:new a.Uniform1f(v,o.u_intensity),u_matrix:new a.UniformMatrix4f(v,o.u_matrix)}),heatmapTexture:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_world:new a.Uniform2f(v,o.u_world),u_image:new a.Uniform1i(v,o.u_image),u_color_ramp:new a.Uniform1i(v,o.u_color_ramp),u_opacity:new a.Uniform1f(v,o.u_opacity)}),hillshade:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_image:new a.Uniform1i(v,o.u_image),u_latrange:new a.Uniform2f(v,o.u_latrange),u_light:new a.Uniform2f(v,o.u_light),u_shadow:new a.UniformColor(v,o.u_shadow),u_highlight:new a.UniformColor(v,o.u_highlight),u_accent:new a.UniformColor(v,o.u_accent)}),hillshadePrepare:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_image:new a.Uniform1i(v,o.u_image),u_dimension:new a.Uniform2f(v,o.u_dimension),u_zoom:new a.Uniform1f(v,o.u_zoom),u_unpack:new a.Uniform4f(v,o.u_unpack)}),line:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_ratio:new a.Uniform1f(v,o.u_ratio),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(v,o.u_units_to_pixels)}),lineGradient:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_ratio:new a.Uniform1f(v,o.u_ratio),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(v,o.u_units_to_pixels),u_image:new a.Uniform1i(v,o.u_image),u_image_height:new a.Uniform1f(v,o.u_image_height)}),linePattern:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_texsize:new a.Uniform2f(v,o.u_texsize),u_ratio:new a.Uniform1f(v,o.u_ratio),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_image:new a.Uniform1i(v,o.u_image),u_units_to_pixels:new a.Uniform2f(v,o.u_units_to_pixels),u_scale:new a.Uniform3f(v,o.u_scale),u_fade:new a.Uniform1f(v,o.u_fade)}),lineSDF:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_ratio:new a.Uniform1f(v,o.u_ratio),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(v,o.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(v,o.u_patternscale_a),u_patternscale_b:new a.Uniform2f(v,o.u_patternscale_b),u_sdfgamma:new a.Uniform1f(v,o.u_sdfgamma),u_image:new a.Uniform1i(v,o.u_image),u_tex_y_a:new a.Uniform1f(v,o.u_tex_y_a),u_tex_y_b:new a.Uniform1f(v,o.u_tex_y_b),u_mix:new a.Uniform1f(v,o.u_mix)}),raster:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_tl_parent:new a.Uniform2f(v,o.u_tl_parent),u_scale_parent:new a.Uniform1f(v,o.u_scale_parent),u_buffer_scale:new a.Uniform1f(v,o.u_buffer_scale),u_fade_t:new a.Uniform1f(v,o.u_fade_t),u_opacity:new a.Uniform1f(v,o.u_opacity),u_image0:new a.Uniform1i(v,o.u_image0),u_image1:new a.Uniform1i(v,o.u_image1),u_brightness_low:new a.Uniform1f(v,o.u_brightness_low),u_brightness_high:new a.Uniform1f(v,o.u_brightness_high),u_saturation_factor:new a.Uniform1f(v,o.u_saturation_factor),u_contrast_factor:new a.Uniform1f(v,o.u_contrast_factor),u_spin_weights:new a.Uniform3f(v,o.u_spin_weights)}),symbolIcon:(v,o)=>({u_is_size_zoom_constant:new a.Uniform1i(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(v,o.u_is_size_feature_constant),u_size_t:new a.Uniform1f(v,o.u_size_t),u_size:new a.Uniform1f(v,o.u_size),u_camera_to_center_distance:new a.Uniform1f(v,o.u_camera_to_center_distance),u_pitch:new a.Uniform1f(v,o.u_pitch),u_rotate_symbol:new a.Uniform1i(v,o.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(v,o.u_aspect_ratio),u_fade_change:new a.Uniform1f(v,o.u_fade_change),u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(v,o.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(v,o.u_coord_matrix),u_is_text:new a.Uniform1i(v,o.u_is_text),u_pitch_with_map:new a.Uniform1i(v,o.u_pitch_with_map),u_texsize:new a.Uniform2f(v,o.u_texsize),u_texture:new a.Uniform1i(v,o.u_texture)}),symbolSDF:(v,o)=>({u_is_size_zoom_constant:new a.Uniform1i(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(v,o.u_is_size_feature_constant),u_size_t:new a.Uniform1f(v,o.u_size_t),u_size:new a.Uniform1f(v,o.u_size),u_camera_to_center_distance:new a.Uniform1f(v,o.u_camera_to_center_distance),u_pitch:new a.Uniform1f(v,o.u_pitch),u_rotate_symbol:new a.Uniform1i(v,o.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(v,o.u_aspect_ratio),u_fade_change:new a.Uniform1f(v,o.u_fade_change),u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(v,o.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(v,o.u_coord_matrix),u_is_text:new a.Uniform1i(v,o.u_is_text),u_pitch_with_map:new a.Uniform1i(v,o.u_pitch_with_map),u_texsize:new a.Uniform2f(v,o.u_texsize),u_texture:new a.Uniform1i(v,o.u_texture),u_gamma_scale:new a.Uniform1f(v,o.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(v,o.u_is_halo)}),symbolTextAndIcon:(v,o)=>({u_is_size_zoom_constant:new a.Uniform1i(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(v,o.u_is_size_feature_constant),u_size_t:new a.Uniform1f(v,o.u_size_t),u_size:new a.Uniform1f(v,o.u_size),u_camera_to_center_distance:new a.Uniform1f(v,o.u_camera_to_center_distance),u_pitch:new a.Uniform1f(v,o.u_pitch),u_rotate_symbol:new a.Uniform1i(v,o.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(v,o.u_aspect_ratio),u_fade_change:new a.Uniform1f(v,o.u_fade_change),u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(v,o.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(v,o.u_coord_matrix),u_is_text:new a.Uniform1i(v,o.u_is_text),u_pitch_with_map:new a.Uniform1i(v,o.u_pitch_with_map),u_texsize:new a.Uniform2f(v,o.u_texsize),u_texsize_icon:new a.Uniform2f(v,o.u_texsize_icon),u_texture:new a.Uniform1i(v,o.u_texture),u_texture_icon:new a.Uniform1i(v,o.u_texture_icon),u_gamma_scale:new a.Uniform1f(v,o.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(v,o.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(v,o.u_is_halo)}),background:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_opacity:new a.Uniform1f(v,o.u_opacity),u_color:new a.UniformColor(v,o.u_color)}),backgroundPattern:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_opacity:new a.Uniform1f(v,o.u_opacity),u_image:new a.Uniform1i(v,o.u_image),u_pattern_tl_a:new a.Uniform2f(v,o.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(v,o.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(v,o.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(v,o.u_pattern_br_b),u_texsize:new a.Uniform2f(v,o.u_texsize),u_mix:new a.Uniform1f(v,o.u_mix),u_pattern_size_a:new a.Uniform2f(v,o.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(v,o.u_pattern_size_b),u_scale_a:new a.Uniform1f(v,o.u_scale_a),u_scale_b:new a.Uniform1f(v,o.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(v,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(v,o.u_tile_units_to_pixels)}),terrain:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_texture:new a.Uniform1i(v,o.u_texture)}),terrainDepth:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix)}),terrainCoords:(v,o)=>({u_matrix:new a.UniformMatrix4f(v,o.u_matrix),u_texture:new a.Uniform1i(v,o.u_texture),u_terrain_coords_id:new a.Uniform1f(v,o.u_terrain_coords_id)})};class cc{constructor(o,p,y){this.context=o;const T=o.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const p=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ao={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Aa{constructor(o,p,y,T){this.length=p.length,this.attributes=y,this.itemSize=p.bytesPerElement,this.dynamicDraw=T,this.context=o;const A=o.gl;this.buffer=A.createBuffer(),o.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,p){for(let y=0;y<this.attributes.length;y++){const T=p.attributes[this.attributes[y].name];T!==void 0&&o.enableVertexAttribArray(T)}}setVertexAttribPointers(o,p,y){for(let T=0;T<this.attributes.length;T++){const A=this.attributes[T],M=p.attributes[A.name];M!==void 0&&o.vertexAttribPointer(M,A.components,o[Ao[A.type]],!1,this.itemSize,A.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Un{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kc extends Un{getDefault(){return a.Color.transparent}set(o){const p=this.current;(o.r!==p.r||o.g!==p.g||o.b!==p.b||o.a!==p.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class al extends Un{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class $a extends Un{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class uc extends Un{getDefault(){return[!0,!0,!0,!0]}set(o){const p=this.current;(o[0]!==p[0]||o[1]!==p[1]||o[2]!==p[2]||o[3]!==p[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class is extends Un{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Or extends Un{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ha extends Un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const p=this.current;(o.func!==p.func||o.ref!==p.ref||o.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Co extends Un{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const p=this.current;(o[0]!==p[0]||o[1]!==p[1]||o[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ro extends Un{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;o?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=o,this.dirty=!1}}class ih extends Un{getDefault(){return[0,1]}set(o){const p=this.current;(o[0]!==p[0]||o[1]!==p[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ol extends Un{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;o?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=o,this.dirty=!1}}class hc extends Un{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ko extends Un{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;o?p.enable(p.BLEND):p.disable(p.BLEND),this.current=o,this.dirty=!1}}class Io extends Un{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const p=this.current;(o[0]!==p[0]||o[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class rh extends Un{getDefault(){return a.Color.transparent}set(o){const p=this.current;(o.r!==p.r||o.g!==p.g||o.b!==p.b||o.a!==p.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class wf extends Un{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class ll extends Un{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;o?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=o,this.dirty=!1}}class Hd extends Un{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class sh extends Un{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class qd extends Un{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Wd extends Un{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Xd extends Un{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const p=this.current;(o[0]!==p[0]||o[1]!==p[1]||o[2]!==p[2]||o[3]!==p[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Zd extends Un{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ah extends Un{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class fc extends Un{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class oh extends Un{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class lh extends Un{getDefault(){return null}set(o){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class cl extends Un{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Tf extends Un{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Qc extends Un{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ch extends Un{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ha extends Un{constructor(o,p){super(o),this.context=o,this.parent=p}getDefault(){return null}}class Sf extends Ha{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Mo extends Ha{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ul{constructor(o,p,y,T){this.context=o,this.width=p,this.height=y;const A=o.gl,M=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new Sf(o,M),T&&(this.depthAttachment=new Mo(o,M)),A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,p=this.colorAttachment.get();if(p&&o.deleteTexture(p),this.depthAttachment){const y=this.depthAttachment.get();y&&o.deleteRenderbuffer(y)}o.deleteFramebuffer(this.framebuffer)}}class Bi{constructor(o,p,y){this.blendFunction=o,this.blendColor=p,this.mask=y}}Bi.Replace=[1,0],Bi.disabled=new Bi(Bi.Replace,a.Color.transparent,[!1,!1,!1,!1]),Bi.unblended=new Bi(Bi.Replace,a.Color.transparent,[!0,!0,!0,!0]),Bi.alphaBlended=new Bi([1,771],a.Color.transparent,[!0,!0,!0,!0]);class uh{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Kc(this),this.clearDepth=new al(this),this.clearStencil=new $a(this),this.colorMask=new uc(this),this.depthMask=new is(this),this.stencilMask=new Or(this),this.stencilFunc=new ha(this),this.stencilOp=new Co(this),this.stencilTest=new Ro(this),this.depthRange=new ih(this),this.depthTest=new ol(this),this.depthFunc=new hc(this),this.blend=new ko(this),this.blendFunc=new Io(this),this.blendColor=new rh(this),this.blendEquation=new wf(this),this.cullFace=new ll(this),this.cullFaceSide=new Hd(this),this.frontFace=new sh(this),this.program=new qd(this),this.activeTexture=new Wd(this),this.viewport=new Xd(this),this.bindFramebuffer=new Zd(this),this.bindRenderbuffer=new ah(this),this.bindTexture=new fc(this),this.bindVertexBuffer=new oh(this),this.bindElementBuffer=new lh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new cl(this),this.pixelStoreUnpack=new Tf(this),this.pixelStoreUnpackPremultiplyAlpha=new Qc(this),this.pixelStoreUnpackFlipY=new ch(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,p){return new cc(this,o,p)}createVertexBuffer(o,p,y){return new Aa(this,o,p,y)}createRenderbuffer(o,p,y){const T=this.gl,A=T.createRenderbuffer();return this.bindRenderbuffer.set(A),T.renderbufferStorage(T.RENDERBUFFER,o,p,y),this.bindRenderbuffer.set(null),A}createFramebuffer(o,p,y){return new ul(this,o,p,y)}clear({color:o,depth:p}){const y=this.gl;let T=0;o&&(T|=y.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(T|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),y.clear(T)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){R(o.blendFunction,Bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Xt{constructor(o,p,y){this.func=o,this.mask=p,this.range=y}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const hl=7680;class Si{constructor(o,p,y,T,A,M){this.test=o,this.ref=p,this.mask=y,this.fail=T,this.depthFail=A,this.pass=M}}Si.disabled=new Si({func:519,mask:0},0,0,hl,hl,hl);class _i{constructor(o,p,y){this.enable=o,this.mode=p,this.frontFace=y}}let qa;function Ef(v,o,p,y,T,A,M){const B=v.context,z=B.gl,U=v.useProgram("collisionBox"),$=[];let Y=0,K=0;for(let me=0;me<y.length;me++){const Fe=y[me],He=o.getTile(Fe),rt=He.getBucket(p);if(!rt)continue;let st=Fe.posMatrix;T[0]===0&&T[1]===0||(st=v.translatePosMatrix(Fe.posMatrix,He,T,A));const bt=M?rt.textCollisionBox:rt.iconCollisionBox,Qe=rt.collisionCircleArray;if(Qe.length>0){const Mt=a.create(),kt=st;a.mul(Mt,rt.placementInvProjMatrix,v.transform.glCoordMatrix),a.mul(Mt,Mt,rt.placementViewportMatrix),$.push({circleArray:Qe,circleOffset:K,transform:kt,invTransform:Mt,coord:Fe}),Y+=Qe.length/4,K=Y}bt&&U.draw(B,z.LINES,Xt.disabled,Si.disabled,v.colorModeForRenderPass(),_i.disabled,sc(st,v.transform,He),v.style.terrain&&v.style.terrain.getTerrainData(Fe),p.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,v.transform.zoom,null,null,bt.collisionVertexBuffer)}if(!M||!$.length)return;const fe=v.useProgram("collisionCircle"),se=new a.CollisionCircleLayoutArray;se.resize(4*Y),se._trim();let ue=0;for(const me of $)for(let Fe=0;Fe<me.circleArray.length/4;Fe++){const He=4*Fe,rt=me.circleArray[He+0],st=me.circleArray[He+1],bt=me.circleArray[He+2],Qe=me.circleArray[He+3];se.emplace(ue++,rt,st,bt,Qe,0),se.emplace(ue++,rt,st,bt,Qe,1),se.emplace(ue++,rt,st,bt,Qe,2),se.emplace(ue++,rt,st,bt,Qe,3)}(!qa||qa.length<2*Y)&&(qa=function(me){const Fe=2*me,He=new a.QuadTriangleArray;He.resize(Fe),He._trim();for(let rt=0;rt<Fe;rt++){const st=6*rt;He.uint16[st+0]=4*rt+0,He.uint16[st+1]=4*rt+1,He.uint16[st+2]=4*rt+2,He.uint16[st+3]=4*rt+2,He.uint16[st+4]=4*rt+3,He.uint16[st+5]=4*rt+0}return He}(Y));const Re=B.createIndexBuffer(qa,!0),Pe=B.createVertexBuffer(se,a.collisionCircleLayout.members,!0);for(const me of $){const Fe={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:($e=v.transform).cameraToCenterDistance,u_viewport_size:[$e.width,$e.height]};fe.draw(B,z.TRIANGLES,Xt.disabled,Si.disabled,v.colorModeForRenderPass(),_i.disabled,Fe,v.style.terrain&&v.style.terrain.getTerrainData(me.coord),p.id,Pe,Re,a.SegmentVector.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,v.transform.zoom,null,null,null)}var $e;Pe.destroy(),Re.destroy()}_i.disabled=new _i(!1,1029,2305),_i.backCCW=new _i(!0,1029,2305);const hh=a.identity(new Float32Array(16));function fl(v,o,p,y,T,A){const{horizontalAlign:M,verticalAlign:B}=a.getAnchorAlignment(v),z=-(M-.5)*o,U=-(B-.5)*p,$=a.evaluateVariableOffset(v,y);return new a.pointGeometry((z/T+$[0])*A,(U/T+$[1])*A)}function Yd(v,o,p,y,T,A,M,B,z,U,$){const Y=v.text.placedSymbolArray,K=v.text.dynamicLayoutVertexArray,fe=v.icon.dynamicLayoutVertexArray,se={};K.clear();for(let ue=0;ue<Y.length;ue++){const Re=Y.get(ue),Pe=v.allowVerticalPlacement&&!Re.placedOrientation,$e=Re.hidden||!Re.crossTileID||Pe?null:y[Re.crossTileID];if($e){const me=new a.pointGeometry(Re.anchorX,Re.anchorY),Fe=Jn(me,p?M:A,$),He=ri(T.cameraToCenterDistance,Fe.signedDistanceFromCamera);let rt=a.evaluateSizeForFeature(v.textSizeData,z,Re)*He/a.ONE_EM;p&&(rt*=v.tilePixelRatio/B);const{width:st,height:bt,anchor:Qe,textOffset:Mt,textBoxScale:kt}=$e,Ut=fl(Qe,st,bt,Mt,kt,rt),un=p?Jn(me.add(Ut),A,$).point:Fe.point.add(o?Ut.rotate(-T.angle):Ut),yn=v.allowVerticalPlacement&&Re.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Kt=0;Kt<Re.numGlyphs;Kt++)a.addDynamicAttributes(K,un,yn);U&&Re.associatedIconIndex>=0&&(se[Re.associatedIconIndex]={shiftedAnchor:un,angle:yn})}else Xr(Re.numGlyphs,K)}if(U){fe.clear();const ue=v.icon.placedSymbolArray;for(let Re=0;Re<ue.length;Re++){const Pe=ue.get(Re);if(Pe.hidden)Xr(Pe.numGlyphs,fe);else{const $e=se[Re];if($e)for(let me=0;me<Pe.numGlyphs;me++)a.addDynamicAttributes(fe,$e.shiftedAnchor,$e.angle);else Xr(Pe.numGlyphs,fe)}}v.icon.dynamicLayoutVertexBuffer.updateData(fe)}v.text.dynamicLayoutVertexBuffer.updateData(K)}function Jc(v,o,p){return p.iconsInText&&o?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function dl(v,o,p,y,T,A,M,B,z,U,$,Y){const K=v.context,fe=K.gl,se=v.transform,ue=B==="map",Re=z==="map",Pe=B!=="viewport"&&p.layout.get("symbol-placement")!=="point",$e=ue&&!Re&&!Pe,me=!p.layout.get("symbol-sort-key").isConstant();let Fe=!1;const He=v.depthModeForSublayer(0,Xt.ReadOnly),rt=p.layout.get("text-variable-anchor"),st=[];for(const bt of y){const Qe=o.getTile(bt),Mt=Qe.getBucket(p);if(!Mt)continue;const kt=T?Mt.text:Mt.icon;if(!kt||!kt.segments.get().length)continue;const Ut=kt.programConfigurations.get(p.id),un=T||Mt.sdfIcons,yn=T?Mt.textSizeData:Mt.iconSizeData,Kt=Re||se.pitch!==0,Wn=v.useProgram(Jc(un,T,Mt),Ut),$n=a.evaluateSizeForZoom(yn,se.zoom),Pn=v.style.terrain&&v.style.terrain.getTerrainData(bt);let En,zn,Nr,As,Cs=[0,0],as=null;if(T){if(zn=Qe.glyphAtlasTexture,Nr=fe.LINEAR,En=Qe.glyphAtlasTexture.size,Mt.iconsInText){Cs=Qe.imageAtlasTexture.size,as=Qe.imageAtlasTexture;const os=yn.kind==="composite"||yn.kind==="camera";As=Kt||v.options.rotating||v.options.zooming||os?fe.LINEAR:fe.NEAREST}}else{const os=p.layout.get("icon-size").constantOr(0)!==1||Mt.iconsNeedLinear;zn=Qe.imageAtlasTexture,Nr=un||v.options.rotating||v.options.zooming||os||Kt?fe.LINEAR:fe.NEAREST,En=Qe.imageAtlasTexture.size}const Qa=ni(Qe,1,v.transform.zoom),Xi=Cn(bt.posMatrix,Re,ue,v.transform,Qa),Rs=Mn(bt.posMatrix,Re,ue,v.transform,Qa),Ja=rt&&Mt.hasTextData(),Ys=p.layout.get("icon-text-fit")!=="none"&&Ja&&Mt.hasIconData();if(Pe){const os=v.style.terrain?(ga,Cc)=>v.style.terrain.getElevation(bt,ga,Cc):null,ma=p.layout.get("text-rotation-alignment")==="map";li(Mt,bt.posMatrix,v,T,Xi,Rs,Re,U,ma,os)}const Dn=v.translatePosMatrix(bt.posMatrix,Qe,A,M),si=Pe||T&&rt||Ys?hh:Xi,Sn=v.translatePosMatrix(Rs,Qe,A,M,!0),hi=un&&p.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let pr;pr=un?Mt.iconsInText?nh(yn.kind,$n,$e,Re,v,Dn,si,Sn,En,Cs):Gc(yn.kind,$n,$e,Re,v,Dn,si,Sn,T,En):Ea(yn.kind,$n,$e,Re,v,Dn,si,Sn,T,En);const fi={program:Wn,buffers:kt,uniformValues:pr,atlasTexture:zn,atlasTextureIcon:as,atlasInterpolation:Nr,atlasInterpolationIcon:As,isSDF:un,hasHalo:hi};if(me&&Mt.canOverlap){Fe=!0;const os=kt.segments.get();for(const ma of os)st.push({segments:new a.SegmentVector([ma]),sortKey:ma.sortKey,state:fi,terrainData:Pn})}else st.push({segments:kt.segments,sortKey:0,state:fi,terrainData:Pn})}Fe&&st.sort((bt,Qe)=>bt.sortKey-Qe.sortKey);for(const bt of st){const Qe=bt.state;if(K.activeTexture.set(fe.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,fe.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(K.activeTexture.set(fe.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),Qe.isSDF){const Mt=Qe.uniformValues;Qe.hasHalo&&(Mt.u_is_halo=1,pl(Qe.buffers,bt.segments,p,v,Qe.program,He,$,Y,Mt,bt.terrainData)),Mt.u_is_halo=0}pl(Qe.buffers,bt.segments,p,v,Qe.program,He,$,Y,Qe.uniformValues,bt.terrainData)}}function pl(v,o,p,y,T,A,M,B,z,U){const $=y.context;T.draw($,$.gl.TRIANGLES,A,M,B,_i.disabled,z,U,p.id,v.layoutVertexBuffer,v.indexBuffer,o,p.paint,y.transform.zoom,v.programConfigurations.get(p.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function dc(v,o,p,y,T,A,M){const B=v.context.gl,z=p.paint.get("fill-pattern"),U=z&&z.constantOr(1),$=p.getCrossfadeParameters();let Y,K,fe,se,ue;M?(K=U&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=B.LINES):(K=U?"fillPattern":"fill",Y=B.TRIANGLES);for(const Re of y){const Pe=o.getTile(Re);if(U&&!Pe.patternsLoaded())continue;const $e=Pe.getBucket(p);if(!$e)continue;const me=$e.programConfigurations.get(p.id),Fe=v.useProgram(K,me),He=v.style.terrain&&v.style.terrain.getTerrainData(Re);U&&(v.context.activeTexture.set(B.TEXTURE0),Pe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),me.updatePaintBuffers($));const rt=z.constantOr(null);if(rt&&Pe.imageAtlas){const Qe=Pe.imageAtlas,Mt=Qe.patternPositions[rt.to.toString()],kt=Qe.patternPositions[rt.from.toString()];Mt&&kt&&me.setConstantPatternPositions(Mt,kt)}const st=He?Re:null,bt=v.translatePosMatrix(st?st.posMatrix:Re.posMatrix,Pe,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(M){se=$e.indexBuffer2,ue=$e.segments2;const Qe=[B.drawingBufferWidth,B.drawingBufferHeight];fe=K==="fillOutlinePattern"&&U?Xc(bt,v,$,Pe,Qe):th(bt,Qe)}else se=$e.indexBuffer,ue=$e.segments,fe=U?rc(bt,v,$,Pe):ns(bt);Fe.draw(v.context,Y,T,v.stencilModeForClipping(Re),A,_i.disabled,fe,He,p.id,$e.layoutVertexBuffer,se,ue,p.paint,v.transform.zoom,me)}}function ml(v,o,p,y,T,A,M){const B=v.context,z=B.gl,U=p.paint.get("fill-extrusion-pattern"),$=U.constantOr(1),Y=p.getCrossfadeParameters(),K=p.paint.get("fill-extrusion-opacity");for(const fe of y){const se=o.getTile(fe),ue=se.getBucket(p);if(!ue)continue;const Re=v.style.terrain&&v.style.terrain.getTerrainData(fe),Pe=ue.programConfigurations.get(p.id),$e=v.useProgram($?"fillExtrusionPattern":"fillExtrusion",Pe);$&&(v.context.activeTexture.set(z.TEXTURE0),se.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Pe.updatePaintBuffers(Y));const me=U.constantOr(null);if(me&&se.imageAtlas){const st=se.imageAtlas,bt=st.patternPositions[me.to.toString()],Qe=st.patternPositions[me.from.toString()];bt&&Qe&&Pe.setConstantPatternPositions(bt,Qe)}const Fe=v.translatePosMatrix(fe.posMatrix,se,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),He=p.paint.get("fill-extrusion-vertical-gradient"),rt=$?eh(Fe,v,He,K,fe,Y,se):ic(Fe,v,He,K);$e.draw(B,B.gl.TRIANGLES,T,A,M,_i.backCCW,rt,Re,p.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,p.paint,v.transform.zoom,Pe,v.style.terrain&&ue.centroidVertexBuffer)}}function Po(v,o,p,y,T,A,M){const B=v.context,z=B.gl,U=p.fbo;if(!U)return;const $=v.useProgram("hillshade"),Y=v.style.terrain&&v.style.terrain.getTerrainData(o);B.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,U.colorAttachment.get()),$.draw(B,z.TRIANGLES,T,A,M,_i.disabled,((K,fe,se,ue)=>{const Re=se.paint.get("hillshade-shadow-color"),Pe=se.paint.get("hillshade-highlight-color"),$e=se.paint.get("hillshade-accent-color");let me=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=K.transform.angle);const Fe=!K.options.moving;return{u_matrix:ue?ue.posMatrix:K.transform.calculatePosMatrix(fe.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:ac(0,fe.tileID),u_light:[se.paint.get("hillshade-exaggeration"),me],u_shadow:Re,u_highlight:Pe,u_accent:$e}})(v,p,y,Y?o:null),Y,y.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function eu(v,o,p,y,T,A){const M=v.context,B=M.gl,z=o.dem;if(z&&z.data){const U=z.dim,$=z.stride,Y=z.getPixels();if(M.activeTexture.set(B.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||v.getTileTexture($),o.demTexture){const fe=o.demTexture;fe.update(Y,{premultiply:!1}),fe.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else o.demTexture=new H(M,Y,B.RGBA,{premultiply:!1}),o.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);M.activeTexture.set(B.TEXTURE0);let K=o.fbo;if(!K){const fe=new H(M,{width:U,height:U,data:null},B.RGBA);fe.bind(B.LINEAR,B.CLAMP_TO_EDGE),K=o.fbo=M.createFramebuffer(U,U,!0),K.colorAttachment.set(fe.texture)}M.bindFramebuffer.set(K.framebuffer),M.viewport.set([0,0,U,U]),v.useProgram("hillshadePrepare").draw(M,B.TRIANGLES,y,T,A,_i.disabled,((fe,se)=>{const ue=se.stride,Re=a.create();return a.ortho(Re,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(Re,Re,[0,-a.EXTENT,0]),{u_matrix:Re,u_image:1,u_dimension:[ue,ue],u_zoom:fe.overscaledZ,u_unpack:se.getUnpackVector()}})(o.tileID,z),null,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function tu(v,o,p,y,T,A){const M=y.paint.get("raster-fade-duration");if(!A&&M>0){const B=a.exported.now(),z=(B-v.timeAdded)/M,U=o?(B-o.timeAdded)/M:-1,$=p.getSource(),Y=T.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),K=!o||Math.abs(o.tileID.overscaledZ-Y)>Math.abs(v.tileID.overscaledZ-Y),fe=K&&v.refreshedUponExpiration?1:a.clamp(K?z:1-U,0,1);return v.refreshedUponExpiration&&z>=1&&(v.refreshedUponExpiration=!1),o?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}const Ws=new a.Color(1,0,0,1),fh=new a.Color(0,1,0,1),nu=new a.Color(0,0,1,1),gl=new a.Color(1,0,1,1),fa=new a.Color(0,1,1,1);function pc(v,o,p,y){mc(v,0,o+p/2,v.transform.width,p,y)}function Do(v,o,p,y){mc(v,o-p/2,0,p,v.transform.height,y)}function mc(v,o,p,y,T,A){const M=v.context,B=M.gl;B.enable(B.SCISSOR_TEST),B.scissor(o*v.pixelRatio,p*v.pixelRatio,y*v.pixelRatio,T*v.pixelRatio),M.clear({color:A}),B.disable(B.SCISSOR_TEST)}function iu(v,o,p){const y=v.context,T=y.gl,A=p.posMatrix,M=v.useProgram("debug"),B=Xt.disabled,z=Si.disabled,U=v.colorModeForRenderPass(),$="$debug",Y=v.style.terrain&&v.style.terrain.getTerrainData(p);y.activeTexture.set(T.TEXTURE0),v.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE);const K=o.getTileByID(p.key).latestRawTileData,fe=Math.floor((K&&K.byteLength||0)/1024),se=o.getTile(p).tileSize,ue=512/Math.min(se,512)*(p.overscaledZ/v.transform.zoom)*.5;let Re=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Re+=` => ${p.overscaledZ}`),function(Pe,$e){Pe.initDebugOverlayCanvas();const me=Pe.debugOverlayCanvas,Fe=Pe.context.gl,He=Pe.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,me.width,me.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText($e,5,5),He.strokeText($e,5,5),Pe.debugOverlayTexture.update(me),Pe.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(v,`${Re} ${fe}kB`),M.draw(y,T.TRIANGLES,B,z,Bi.alphaBlended,_i.disabled,To(A,a.Color.transparent,ue),null,$,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),M.draw(y,T.LINE_STRIP,B,z,U,_i.disabled,To(A,a.Color.red),Y,$,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function ru(v,o,p){const y=v.context,T=y.gl,A=v.colorModeForRenderPass(),M=new Xt(T.LEQUAL,Xt.ReadWrite,v.depthRangeFor3D),B=v.useProgram("terrain"),z=o.getTerrainMesh(),U=o.getTerrainData(p.tileID);y.bindFramebuffer.set(null),y.viewport.set([0,0,v.width,v.height]),y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const $=v.transform.calculatePosMatrix(p.tileID.toUnwrapped());B.draw(y,T.TRIANGLES,M,Si.disabled,A,_i.backCCW,{u_matrix:$,u_texture:0},U,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}function gc(v,o,p,y){const T=v.context,A=p.tileSize*o.qualityFactor;p.textures[y]||(p.textures[y]=v.getTileTexture(A)||new H(T,{width:A,height:A,data:null},T.gl.RGBA),p.textures[y].bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),y===0&&o.sourceCache.renderHistory.unshift(p.tileID.key));const M=o.getRTTFramebuffer();M.colorAttachment.set(p.textures[y].texture),T.bindFramebuffer.set(M.framebuffer),T.viewport.set([0,0,A,A])}class _c{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,p=o.terrain;for(const y in o.sourceCaches){this._coordsDescendingInv[y]={};const T=o.sourceCaches[y].getVisibleCoordinates();for(const A of T){const M=p.sourceCache.getTerrainCoords(A);for(const B in M)this._coordsDescendingInv[y][B]||(this._coordsDescendingInv[y][B]=[]),this._coordsDescendingInv[y][B].push(M[B])}}for(const y of o._order){const T=o._layers[y],A=T.source;if(this._renderToTexture[T.type]&&!this._coordsDescendingInvStr[A]){this._coordsDescendingInvStr[A]={};for(const M in this._coordsDescendingInv[A])this._coordsDescendingInvStr[A][M]=this._coordsDescendingInv[A][M].map(B=>B.key).sort().join()}}return this._renderableTiles.forEach(y=>{for(const T in this._coordsDescendingInvStr){const A=this._coordsDescendingInvStr[T][y.tileID.key];A&&A!==y.textureCoords[T]&&y.clearTextures(this.painter),p.needsRerender(T,y.tileID)&&y.clearTextures(this.painter)}this._rerender[y.tileID.key]=!y.textures.length}),p.clearRerenderCache(),p.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const p=o.type,y=this.painter,T=y.style._order,A=y.currentLayer,M=A+1===T.length;if(this._renderToTexture[p]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(T[A]),!M))return!0;if(this._renderToTexture[this._prevType]||p==="hillshade"||this._renderToTexture[p]&&M){this._prevType=p;const B=this._stacks.length-1,z=this._stacks[B]||[];for(const U of this._renderableTiles){if(gc(y,y.style.terrain,U,B),this._rerender[U.tileID.key]){y.context.clear({color:a.Color.transparent});for(let $=0;$<z.length;$++){const Y=y.style._layers[z[$]],K=Y.source?this._coordsDescendingInv[Y.source][U.tileID.key]:[U.tileID];y._renderTileClippingMasks(Y,K),y.renderLayer(y,y.style.sourceCaches[Y.source],Y,K),Y.source&&(U.textureCoords[Y.source]=this._coordsDescendingInvStr[Y.source][U.tileID.key])}}ru(y,y.style.terrain,U)}if(p==="hillshade"){this._stacks.push([T[A]]);for(const U of this._renderableTiles){const $=this._coordsDescendingInv[o.source][U.tileID.key];gc(y,y.style.terrain,U,this._stacks.length-1),y.context.clear({color:a.Color.transparent}),y._renderTileClippingMasks(o,$),y.renderLayer(y,y.style.sourceCaches[o.source],o,$),ru(y,y.style.terrain,U)}return!0}return this._renderToTexture[p]}return!1}}const yc={symbol:function(v,o,p,y,T){if(v.renderPass!=="translucent")return;const A=Si.disabled,M=v.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(B,z,U,$,Y,K,fe){const se=z.transform,ue=Y==="map",Re=K==="map";for(const Pe of B){const $e=$.getTile(Pe),me=$e.getBucket(U);if(!me||!me.text||!me.text.segments.get().length)continue;const Fe=a.evaluateSizeForZoom(me.textSizeData,se.zoom),He=ni($e,1,z.transform.zoom),rt=Cn(Pe.posMatrix,Re,ue,z.transform,He),st=U.layout.get("icon-text-fit")!=="none"&&me.hasIconData();if(Fe){const bt=Math.pow(2,se.zoom-$e.tileID.overscaledZ);Yd(me,ue,Re,fe,se,rt,Pe.posMatrix,bt,Fe,st,z.style.terrain?(Qe,Mt)=>z.style.terrain.getElevation(Pe,Qe,Mt):null)}}}(y,v,p,o,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),T),p.paint.get("icon-opacity").constantOr(1)!==0&&dl(v,o,p,y,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),A,M),p.paint.get("text-opacity").constantOr(1)!==0&&dl(v,o,p,y,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),A,M),o.map.showCollisionBoxes&&(Ef(v,o,p,y,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Ef(v,o,p,y,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(v,o,p,y){if(v.renderPass!=="translucent")return;const T=p.paint.get("circle-opacity"),A=p.paint.get("circle-stroke-width"),M=p.paint.get("circle-stroke-opacity"),B=!p.layout.get("circle-sort-key").isConstant();if(T.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const z=v.context,U=z.gl,$=v.depthModeForSublayer(0,Xt.ReadOnly),Y=Si.disabled,K=v.colorModeForRenderPass(),fe=[];for(let se=0;se<y.length;se++){const ue=y[se],Re=o.getTile(ue),Pe=Re.getBucket(p);if(!Pe)continue;const $e=Pe.programConfigurations.get(p.id),me=v.useProgram("circle",$e),Fe=Pe.layoutVertexBuffer,He=Pe.indexBuffer,rt=v.style.terrain&&v.style.terrain.getTerrainData(ue),st={programConfiguration:$e,program:me,layoutVertexBuffer:Fe,indexBuffer:He,uniformValues:ws(v,ue,Re,p),terrainData:rt};if(B){const bt=Pe.segments.get();for(const Qe of bt)fe.push({segments:new a.SegmentVector([Qe]),sortKey:Qe.sortKey,state:st})}else fe.push({segments:Pe.segments,sortKey:0,state:st})}B&&fe.sort((se,ue)=>se.sortKey-ue.sortKey);for(const se of fe){const{programConfiguration:ue,program:Re,layoutVertexBuffer:Pe,indexBuffer:$e,uniformValues:me,terrainData:Fe}=se.state;Re.draw(z,U.TRIANGLES,$,Y,K,_i.disabled,me,Fe,p.id,Pe,$e,se.segments,p.paint,v.transform.zoom,ue)}},heatmap:function(v,o,p,y){if(p.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const T=v.context,A=T.gl,M=Si.disabled,B=new Bi([A.ONE,A.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(z,U,$){const Y=z.gl;z.activeTexture.set(Y.TEXTURE1),z.viewport.set([0,0,U.width/4,U.height/4]);let K=$.heatmapFbo;if(K)Y.bindTexture(Y.TEXTURE_2D,K.colorAttachment.get()),z.bindFramebuffer.set(K.framebuffer);else{const fe=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,fe),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),K=$.heatmapFbo=z.createFramebuffer(U.width/4,U.height/4,!1),function(se,ue,Re,Pe){const $e=se.gl;$e.texImage2D($e.TEXTURE_2D,0,$e.RGBA,ue.width/4,ue.height/4,0,$e.RGBA,se.extRenderToTextureHalfFloat?se.extTextureHalfFloat.HALF_FLOAT_OES:$e.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Re)}(z,U,fe,K)}})(T,v,p),T.clear({color:a.Color.transparent});for(let z=0;z<y.length;z++){const U=y[z];if(o.hasRenderableParent(U))continue;const $=o.getTile(U),Y=$.getBucket(p);if(!Y)continue;const K=Y.programConfigurations.get(p.id),fe=v.useProgram("heatmap",K),{zoom:se}=v.transform;fe.draw(T,A.TRIANGLES,Xt.disabled,M,B,_i.disabled,Zc(U.posMatrix,$,se,p.paint.get("heatmap-intensity")),null,p.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,p.paint,v.transform.zoom,K)}T.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(T,A){const M=T.context,B=M.gl,z=A.heatmapFbo;if(!z)return;M.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,z.colorAttachment.get()),M.activeTexture.set(B.TEXTURE1);let U=A.colorRampTexture;U||(U=A.colorRampTexture=new H(M,A.colorRamp,B.RGBA)),U.bind(B.LINEAR,B.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(M,B.TRIANGLES,Xt.disabled,Si.disabled,T.colorModeForRenderPass(),_i.disabled,(($,Y,K,fe)=>{const se=a.create();a.ortho(se,0,$.width,$.height,0,0,1);const ue=$.context.gl;return{u_matrix:se,u_world:[ue.drawingBufferWidth,ue.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}})(T,A),null,A.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,A.paint,T.transform.zoom)}(v,p))},line:function(v,o,p,y){if(v.renderPass!=="translucent")return;const T=p.paint.get("line-opacity"),A=p.paint.get("line-width");if(T.constantOr(1)===0||A.constantOr(1)===0)return;const M=v.depthModeForSublayer(0,Xt.ReadOnly),B=v.colorModeForRenderPass(),z=p.paint.get("line-dasharray"),U=p.paint.get("line-pattern"),$=U.constantOr(1),Y=p.paint.get("line-gradient"),K=p.getCrossfadeParameters(),fe=$?"linePattern":z?"lineSDF":Y?"lineGradient":"line",se=v.context,ue=se.gl;let Re=!0;for(const Pe of y){const $e=o.getTile(Pe);if($&&!$e.patternsLoaded())continue;const me=$e.getBucket(p);if(!me)continue;const Fe=me.programConfigurations.get(p.id),He=v.context.program.get(),rt=v.useProgram(fe,Fe),st=Re||rt.program!==He,bt=v.style.terrain&&v.style.terrain.getTerrainData(Pe),Qe=U.constantOr(null);if(Qe&&$e.imageAtlas){const Ut=$e.imageAtlas,un=Ut.patternPositions[Qe.to.toString()],yn=Ut.patternPositions[Qe.from.toString()];un&&yn&&Fe.setConstantPatternPositions(un,yn)}const Mt=bt?Pe:null,kt=$?oc(v,$e,p,K,Mt):z?Ti(v,$e,p,z,K,Mt):Y?sl(v,$e,p,me.lineClipsArray.length,Mt):rl(v,$e,p,Mt);if($)se.activeTexture.set(ue.TEXTURE0),$e.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Fe.updatePaintBuffers(K);else if(z&&(st||v.lineAtlas.dirty))se.activeTexture.set(ue.TEXTURE0),v.lineAtlas.bind(se);else if(Y){const Ut=me.gradients[p.id];let un=Ut.texture;if(p.gradientVersion!==Ut.version){let yn=256;if(p.stepInterpolant){const Kt=o.getSource().maxzoom,Wn=Pe.canonical.z===Kt?Math.ceil(1<<v.transform.maxZoom-Pe.canonical.z):1;yn=a.clamp(a.nextPowerOfTwo(me.maxLineLength/a.EXTENT*1024*Wn),256,se.maxTextureSize)}Ut.gradient=a.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:yn,image:Ut.gradient||void 0,clips:me.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new H(se,Ut.gradient,ue.RGBA),Ut.version=p.gradientVersion,un=Ut.texture}se.activeTexture.set(ue.TEXTURE0),un.bind(p.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}rt.draw(se,ue.TRIANGLES,M,v.stencilModeForClipping(Pe),B,_i.disabled,kt,bt,p.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,p.paint,v.transform.zoom,Fe,me.layoutVertexBuffer2),Re=!1}},fill:function(v,o,p,y){const T=p.paint.get("fill-color"),A=p.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=v.colorModeForRenderPass(),B=p.paint.get("fill-pattern"),z=v.opaquePassEnabledForLayer()&&!B.constantOr(1)&&T.constantOr(a.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===z){const U=v.depthModeForSublayer(1,v.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly);dc(v,o,p,y,U,M,!1)}if(v.renderPass==="translucent"&&p.paint.get("fill-antialias")){const U=v.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly);dc(v,o,p,y,U,M,!0)}},"fill-extrusion":function(v,o,p,y){const T=p.paint.get("fill-extrusion-opacity");if(T!==0&&v.renderPass==="translucent"){const A=new Xt(v.context.gl.LEQUAL,Xt.ReadWrite,v.depthRangeFor3D);if(T!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))ml(v,o,p,y,A,Si.disabled,Bi.disabled),ml(v,o,p,y,A,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const M=v.colorModeForRenderPass();ml(v,o,p,y,A,Si.disabled,M)}}},hillshade:function(v,o,p,y){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const T=v.context,A=v.depthModeForSublayer(0,Xt.ReadOnly),M=v.colorModeForRenderPass(),[B,z]=v.renderPass==="translucent"?v.stencilConfigForOverlap(y):[{},y];for(const U of z){const $=o.getTile(U);$.needsHillshadePrepare!==void 0&&$.needsHillshadePrepare&&v.renderPass==="offscreen"?eu(v,$,p,A,Si.disabled,M):v.renderPass==="translucent"&&Po(v,U,$,p,A,B[U.overscaledZ],M)}T.viewport.set([0,0,v.width,v.height])},raster:function(v,o,p,y){if(v.renderPass!=="translucent"||p.paint.get("raster-opacity")===0||!y.length)return;const T=v.context,A=T.gl,M=o.getSource(),B=v.useProgram("raster"),z=v.colorModeForRenderPass(),[U,$]=M instanceof Dt?[{},y]:v.stencilConfigForOverlap(y),Y=$[$.length-1].overscaledZ,K=!v.options.moving;for(const fe of $){const se=v.depthModeForSublayer(fe.overscaledZ-Y,p.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,A.LESS),ue=o.getTile(fe);ue.registerFadeDuration(p.paint.get("raster-fade-duration"));const Re=o.findLoadedParent(fe,0),Pe=tu(ue,Re,o,p,v.transform,v.style.terrain);let $e,me;const Fe=p.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;T.activeTexture.set(A.TEXTURE0),ue.texture.bind(Fe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(A.TEXTURE1),Re?(Re.texture.bind(Fe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),$e=Math.pow(2,Re.tileID.overscaledZ-ue.tileID.overscaledZ),me=[ue.tileID.canonical.x*$e%1,ue.tileID.canonical.y*$e%1]):ue.texture.bind(Fe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const He=v.style.terrain&&v.style.terrain.getTerrainData(fe),rt=He?fe:null,st=rt?rt.posMatrix:v.transform.calculatePosMatrix(fe.toUnwrapped(),K),bt=Yc(st,me||[0,0],$e||1,Pe,p);M instanceof Dt?B.draw(T,A.TRIANGLES,se,Si.disabled,z,_i.disabled,bt,He,p.id,M.boundsBuffer,v.quadTriangleIndexBuffer,M.boundsSegments):B.draw(T,A.TRIANGLES,se,U[fe.overscaledZ],z,_i.disabled,bt,He,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}},background:function(v,o,p,y){const T=p.paint.get("background-color"),A=p.paint.get("background-opacity");if(A===0)return;const M=v.context,B=M.gl,z=v.transform,U=z.tileSize,$=p.paint.get("background-pattern");if(v.isPatternMissing($))return;const Y=!$&&T.a===1&&A===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==Y)return;const K=Si.disabled,fe=v.depthModeForSublayer(0,Y==="opaque"?Xt.ReadWrite:Xt.ReadOnly),se=v.colorModeForRenderPass(),ue=v.useProgram($?"backgroundPattern":"background"),Re=y||z.coveringTiles({tileSize:U,terrain:v.style.terrain});$&&(M.activeTexture.set(B.TEXTURE0),v.imageManager.bind(v.context));const Pe=p.getCrossfadeParameters();for(const $e of Re){const me=y?$e.posMatrix:v.transform.calculatePosMatrix($e.toUnwrapped()),Fe=$?Eo(me,A,v,$,{tileID:$e,tileSize:U},Pe):vf(me,A,T),He=v.style.terrain&&v.style.terrain.getTerrainData($e);ue.draw(M,B.TRIANGLES,fe,K,se,_i.disabled,Fe,He,p.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}},debug:function(v,o,p){for(let y=0;y<p.length;y++)iu(v,o,p[y])},custom:function(v,o,p){const y=v.context,T=p.implementation;if(v.renderPass==="offscreen"){const A=T.prerender;A&&(v.setCustomLayerDefaults(),y.setColorMode(v.colorModeForRenderPass()),A.call(T,y.gl,v.transform.customLayerMatrix()),y.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),y.setColorMode(v.colorModeForRenderPass()),y.setStencilMode(Si.disabled);const A=T.renderingMode==="3d"?new Xt(v.context.gl.LEQUAL,Xt.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Xt.ReadOnly);y.setDepthMode(A),T.render(y.gl,v.transform.customLayerMatrix()),y.setDirty(),v.setBaseState(),y.bindFramebuffer.set(null)}}};class dh{constructor(o,p){this.context=new uh(o),this.transform=p,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=Qn.maxUnderzooming+Qn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _n,this.gpuTimers={}}resize(o,p,y){if(this.width=o*y,this.height=p*y,this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const T of this.style._order)this.style._layers[T].resize()}setup(){const o=this.context,p=new a.PosArray;p.emplaceBack(0,0),p.emplaceBack(a.EXTENT,0),p.emplaceBack(0,a.EXTENT),p.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(p,gn.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.PosArray;y.emplaceBack(0,0),y.emplaceBack(a.EXTENT,0),y.emplaceBack(0,a.EXTENT),y.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=o.createVertexBuffer(y,gn.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const T=new a.RasterBoundsArray;T.emplaceBack(0,0,0,0),T.emplaceBack(a.EXTENT,0,a.EXTENT,0),T.emplaceBack(0,a.EXTENT,0,a.EXTENT),T.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(T,gt.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const A=new a.PosArray;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(A,gn.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const M=new a.LineStripIndexArray;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(M);const B=new a.TriangleIndexArray;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(B),this.emptyTexture=new H(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const z=this.context.gl;this.stencilClearMode=new Si({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const o=this.context,p=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=a.create();a.ortho(y,0,this.width,this.height,0,0,1),a.scale(y,y,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,p.TRIANGLES,Xt.disabled,this.stencilClearMode,Bi.disabled,_i.disabled,ua(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,p){if(this.currentStencilSource===o.source||!o.isTileClipped()||!p||!p.length)return;this.currentStencilSource=o.source;const y=this.context,T=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(Bi.disabled),y.setDepthMode(Xt.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const B=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,z=this.style.terrain&&this.style.terrain.getTerrainData(M);A.draw(y,T.TRIANGLES,Xt.disabled,new Si({func:T.ALWAYS,mask:0},B,255,T.KEEP,T.KEEP,T.REPLACE),Bi.disabled,_i.disabled,ua(M.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,p=this.context.gl;return new Si({func:p.NOTEQUAL,mask:255},o,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(o){const p=this.context.gl;return new Si({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(o){const p=this.context.gl,y=o.sort((M,B)=>B.overscaledZ-M.overscaledZ),T=y[y.length-1].overscaledZ,A=y[0].overscaledZ-T+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const M={};for(let B=0;B<A;B++)M[B+T]=new Si({func:p.GEQUAL,mask:255},B+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=A,[M,y]}return[{[T]:Si.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Bi([o.CONSTANT_COLOR,o.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Bi.unblended:Bi.alphaBlended}depthModeForSublayer(o,p,y){if(!this.opaquePassEnabledForLayer())return Xt.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Xt(y||this.context.gl.LEQUAL,p,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,p){this.style=o,this.options=p,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const y=this.style._order,T=this.style.sourceCaches,A=this.style.terrain&&new _c(this);for(const U in T){const $=T[U];$.used&&$.prepare(this.context)}const M={},B={},z={};for(const U in T){const $=T[U];M[U]=$.getVisibleCoordinates(),B[U]=M[U].slice().reverse(),z[U]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<y.length;U++)if(this.style._layers[y[U]].is3D()){this.opaquePassCutoff=U;break}if(A){this.opaquePassCutoff=0;const U=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||U.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function($,Y){const K=$.context,fe=K.gl,se=Bi.unblended,ue=new Xt(fe.LEQUAL,Xt.ReadWrite,[0,1]),Re=Y.getTerrainMesh(),Pe=Y.sourceCache.getRenderableTiles(),$e=$.useProgram("terrainDepth");K.bindFramebuffer.set(Y.getFramebuffer("depth").framebuffer),K.viewport.set([0,0,$.width/devicePixelRatio,$.height/devicePixelRatio]),K.clear({color:a.Color.transparent,depth:1});for(const me of Pe){const Fe=Y.getTerrainData(me.tileID),He=$.transform.calculatePosMatrix(me.tileID.toUnwrapped());$e.draw(K,fe.TRIANGLES,ue,Si.disabled,se,_i.backCCW,{u_matrix:He},Fe,"terrain",Re.vertexBuffer,Re.indexBuffer,Re.segments)}K.bindFramebuffer.set(null),K.viewport.set([0,0,$.width,$.height])}(this,this.style.terrain),function($,Y){const K=$.context,fe=K.gl,se=Bi.unblended,ue=new Xt(fe.LEQUAL,Xt.ReadWrite,[0,1]),Re=Y.getTerrainMesh(),Pe=Y.getCoordsTexture(),$e=Y.sourceCache.getRenderableTiles(),me=$.useProgram("terrainCoords");K.bindFramebuffer.set(Y.getFramebuffer("coords").framebuffer),K.viewport.set([0,0,$.width/devicePixelRatio,$.height/devicePixelRatio]),K.clear({color:a.Color.transparent,depth:1}),Y.coordsIndex=[];for(const Fe of $e){const He=Y.getTerrainData(Fe.tileID);K.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_2D,Pe.texture);const rt=$.transform.calculatePosMatrix(Fe.tileID.toUnwrapped());me.draw(K,fe.TRIANGLES,ue,Si.disabled,se,_i.backCCW,{u_matrix:rt,u_terrain_coords_id:(255-Y.coordsIndex.length)/255,u_texture:0},He,"terrain",Re.vertexBuffer,Re.indexBuffer,Re.segments),Y.coordsIndex.push(Fe.tileID.key)}K.bindFramebuffer.set(null),K.viewport.set([0,0,$.width,$.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const U of y){const $=this.style._layers[U];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const Y=B[$.source];($.type==="custom"||Y.length)&&this.renderLayer(this,T[$.source],$,Y)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!A)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const U=this.style._layers[y[this.currentLayer]],$=T[U.source],Y=M[U.source];this._renderTileClippingMasks(U,Y),this.renderLayer(this,$,U,Y)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const U=this.style._layers[y[this.currentLayer]],$=T[U.source];if(A&&A.renderLayer(U))continue;const Y=(U.type==="symbol"?z:B)[U.source];this._renderTileClippingMasks(U,M[U.source]),this.renderLayer(this,$,U,Y)}if(this.options.showTileBoundaries){let U,$;Object.values(this.style._layers).forEach(Y=>{Y.source&&!Y.isHidden(this.transform.zoom)&&(Y.source!==($&&$.id)&&($=this.style.sourceCaches[Y.source]),(!U||U.getSource().maxzoom<$.getSource().maxzoom)&&(U=$))}),U&&yc.debug(this,U,U.getVisibleCoordinates())}this.options.showPadding&&function(U){const $=U.transform.padding;pc(U,U.transform.height-($.top||0),3,Ws),pc(U,$.bottom||0,3,fh),Do(U,$.left||0,3,nu),Do(U,U.transform.width-($.right||0),3,gl);const Y=U.transform.centerPoint;(function(K,fe,se,ue){mc(K,fe-1,se-10,2,20,ue),mc(K,fe-10,se-1,20,2,ue)})(U,Y.x,U.transform.height-Y.y,fa)}(this),this.context.setDefault()}renderLayer(o,p,y,T){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="custom"||(T||[]).length)&&(this.id=y.id,this.gpuTimingStart(y),yc[y.type](o,p,y,T,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;let y=this.gpuTimers[o.id];y||(y=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),y.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,y.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const p={};for(const y in o){const T=o[y],A=this.context.extTimerQuery,M=A.getQueryObjectEXT(T.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(T.query),p[y]=M}return p}translatePosMatrix(o,p,y,T,A){if(!y[0]&&!y[1])return o;const M=A?T==="map"?this.transform.angle:0:T==="viewport"?-this.transform.angle:0;if(M){const U=Math.sin(M),$=Math.cos(M);y=[y[0]*$-y[1]*U,y[0]*U+y[1]*$]}const B=[A?y[0]:ni(p,y[0],this.transform.zoom),A?y[1]:ni(p,y[1],this.transform.zoom),0],z=new Float32Array(16);return a.translate(z,o,B),z}saveTileTexture(o){const p=this._tileTextures[o.size[0]];p?p.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const p=this._tileTextures[o];return p&&p.length>0?p.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const p=this.imageManager.getPattern(o.from.toString()),y=this.imageManager.getPattern(o.to.toString());return!p||!y}useProgram(o,p){this.cache=this.cache||{};const y=o+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new qc(this.context,o,il[o],p,qs[o],this._showOverdrawInspector,this.style.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new H(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class su{constructor(o,p){this.points=o,this.planes=p}static fromInvProjectionMatrix(o,p,y){const T=Math.pow(2,y),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const z=1/(B=a.transformMat4([],B,o))[3]/p*T;return a.mul$1(B,B,[z,z,1/B[3],z])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const z=a.sub([],A[B[0]],A[B[1]]),U=a.sub([],A[B[2]],A[B[1]]),$=a.normalize([],a.cross([],z,U)),Y=-a.dot($,A[B[1]]);return $.concat(Y)});return new su(A,M)}}class Oo{constructor(o,p){this.min=o,this.max=p,this.center=a.scale$1([],a.add([],this.min,this.max),.5)}quadrant(o){const p=[o%2==0,o<2],y=a.clone$2(this.min),T=a.clone$2(this.max);for(let A=0;A<p.length;A++)y[A]=p[A]?this.min[A]:this.center[A],T[A]=p[A]?this.center[A]:this.max[A];return T[2]=this.max[2],new Oo(y,T)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const p=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let T=0;T<o.planes.length;T++){const A=o.planes[T];let M=0;for(let B=0;B<p.length;B++)a.dot$1(A,p[B])>=0&&M++;if(M===0)return 0;M!==p.length&&(y=!1)}if(y)return 2;for(let T=0;T<3;T++){let A=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let B=0;B<o.points.length;B++){const z=o.points[B][T]-this.min[T];A=Math.min(A,z),M=Math.max(M,z)}if(M<0||A>this.max[T]-this.min[T])return 0}return 1}}class bc{constructor(o=0,p=0,y=0,T=0){if(isNaN(o)||o<0||isNaN(p)||p<0||isNaN(y)||y<0||isNaN(T)||T<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=p,this.left=y,this.right=T}interpolate(o,p,y){return p.top!=null&&o.top!=null&&(this.top=a.number(o.top,p.top,y)),p.bottom!=null&&o.bottom!=null&&(this.bottom=a.number(o.bottom,p.bottom,y)),p.left!=null&&o.left!=null&&(this.left=a.number(o.left,p.left,y)),p.right!=null&&o.right!=null&&(this.right=a.number(o.right,p.right,y)),this}getCenter(o,p){const y=a.clamp((this.left+o-this.right)/2,0,o),T=a.clamp((this.top+p-this.bottom)/2,0,p);return new a.pointGeometry(y,T)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new bc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class au{constructor(o,p,y,T,A){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=A===void 0||!!A,this._minZoom=o||0,this._maxZoom=p||22,this._minPitch=y??0,this._maxPitch=T??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new bc,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new au(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const p=-a.wrap(o,-180,180)*Math.PI/180;var y;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=(y=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),function(T,A,M){var B=A[0],z=A[1],U=A[2],$=A[3],Y=Math.sin(M),K=Math.cos(M);T[0]=B*K+U*Y,T[1]=z*K+$*Y,T[2]=B*-Y+U*K,T[3]=z*-Y+$*K}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const p=a.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const p=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.scale=this.zoomScale(p),this.tileZoom=Math.floor(p),this.zoomFraction=p-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,p,y){this._unmodified=!1,this._edgeInsets.interpolate(o,p,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const p=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(o){const p=[new a.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const y=this.pointCoordinate(new a.pointGeometry(0,0)),T=this.pointCoordinate(new a.pointGeometry(this.width,0)),A=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new a.pointGeometry(0,this.height)),B=Math.floor(Math.min(y.x,T.x,A.x,M.x)),z=Math.floor(Math.max(y.x,T.x,A.x,M.x)),U=1;for(let $=B-U;$<=z+U;$++)$!==0&&p.push(new a.UnwrappedTileID($,o))}return p}coveringTiles(o){var p,y;let T=this.coveringZoomLevel(o);const A=T;if(o.minzoom!==void 0&&T<o.minzoom)return[];o.maxzoom!==void 0&&T>o.maxzoom&&(T=o.maxzoom);const M=this.pointCoordinate(this.getCameraPoint()),B=a.MercatorCoordinate.fromLngLat(this.center),z=Math.pow(2,T),U=[z*M.x,z*M.y,0],$=[z*B.x,z*B.y,0],Y=su.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,T);let K=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(K=T);const fe=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,se=me=>({aabb:new Oo([me*z,0,0],[(me+1)*z,z,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ue=[],Re=[],Pe=T,$e=o.reparseOverscaled?A:T;if(this._renderWorldCopies)for(let me=1;me<=3;me++)ue.push(se(-me)),ue.push(se(me));for(ue.push(se(0));ue.length>0;){const me=ue.pop(),Fe=me.x,He=me.y;let rt=me.fullyVisible;if(!rt){const Ut=me.aabb.intersects(Y);if(Ut===0)continue;rt=Ut===2}const st=o.terrain?U:$,bt=me.aabb.distanceX(st),Qe=me.aabb.distanceY(st),Mt=Math.max(Math.abs(bt),Math.abs(Qe)),kt=fe+(1<<Pe-me.zoom)-2;if(me.zoom===Pe||Mt>kt&&me.zoom>=K){const Ut=Pe-me.zoom,un=U[0]-.5-(Fe<<Ut),yn=U[1]-.5-(He<<Ut);Re.push({tileID:new a.OverscaledTileID(me.zoom===Pe?$e:me.zoom,me.wrap,me.zoom,Fe,He),distanceSq:a.sqrLen([$[0]-.5-Fe,$[1]-.5-He]),tileDistanceToCamera:Math.sqrt(un*un+yn*yn)})}else for(let Ut=0;Ut<4;Ut++){const un=(Fe<<1)+Ut%2,yn=(He<<1)+(Ut>>1),Kt=me.zoom+1;let Wn=me.aabb.quadrant(Ut);if(o.terrain){const $n=new a.OverscaledTileID(Kt,me.wrap,Kt,un,yn),Pn=o.terrain.getMinMaxElevation($n),En=(p=Pn.minElevation)!==null&&p!==void 0?p:this.elevation,zn=(y=Pn.maxElevation)!==null&&y!==void 0?y:this.elevation;Wn=new Oo([Wn.min[0],Wn.min[1],En],[Wn.max[0],Wn.max[1],zn])}ue.push({aabb:Wn,zoom:Kt,x:un,y:yn,wrap:me.wrap,fullyVisible:rt})}}return Re.sort((me,Fe)=>me.distanceSq-Fe.distanceSq).map(me=>me.tileID)}resize(o,p){this.width=o,this.height=p,this.pixelsToGLUnits=[2/o,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const p=a.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(o.lng)*this.worldSize,a.mercatorYfromLat(p)*this.worldSize)}unproject(o){return new a.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,p){const y=a.MercatorCoordinate.fromLngLat(o),T=(1<<this.tileZoom)*a.EXTENT,A=y.x*T,M=y.y*T,B=Math.floor(A/a.EXTENT),z=Math.floor(M/a.EXTENT),U=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,B,z);return p.getElevation(U,A%a.EXTENT,M%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const p=this.pointLocation(this.centerPoint,o),y=this.getElevation(p,o);if(!(this.elevation-y))return;const T=this.getCameraPosition(),A=a.MercatorCoordinate.fromLngLat(T.lngLat,T.altitude),M=a.MercatorCoordinate.fromLngLat(p,y),B=A.x-M.x,z=A.y-M.y,U=A.z-M.z,$=Math.sqrt(B*B+z*z+U*U),Y=this.scaleZoom(this.cameraToCenterDistance/$/this.tileSize);this._elevation=y,this._center=p,this.zoom=Y}setLocationAtPoint(o,p){const y=this.pointCoordinate(p),T=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(o),M=new a.MercatorCoordinate(A.x-(y.x-T.x),A.y-(y.y-T.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,p){return p?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,p),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,p){return this.coordinateLocation(this.pointCoordinate(o,p))}locationCoordinate(o){return a.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,p){if(p){const K=p.pointCoordinate(o);if(K!=null)return K}const y=[o.x,o.y,0,1],T=[o.x,o.y,1,1];a.transformMat4(y,y,this.pixelMatrixInverse),a.transformMat4(T,T,this.pixelMatrixInverse);const A=y[3],M=T[3],B=y[1]/A,z=T[1]/M,U=y[2]/A,$=T[2]/M,Y=U===$?0:(0-U)/($-U);return new a.MercatorCoordinate(a.number(y[0]/A,T[0]/M,Y)/this.worldSize,a.number(B,z,Y)/this.worldSize)}coordinatePoint(o,p=0,y=this.pixelMatrix){const T=[o.x*this.worldSize,o.y*this.worldSize,p,1];return a.transformMat4(T,T,y),new a.pointGeometry(T[0]/T[3],T[1]/T[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,o))).extend(this.pointLocation(new a.pointGeometry(this.width,o))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,p=!1){const y=o.key,T=p?this._alignedPosMatrixCache:this._posMatrixCache;if(T[y])return T[y];const A=o.canonical,M=this.worldSize/this.zoomScale(A.z),B=A.x+Math.pow(2,A.z)*o.wrap,z=a.identity(new Float64Array(16));return a.translate(z,z,[B*M,A.y*M,0]),a.scale(z,z,[M/a.EXTENT,M/a.EXTENT,1]),a.multiply(z,p?this.alignedProjMatrix:this.projMatrix,z),T[y]=new Float32Array(z),T[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,p,y,T,A=-90,M=90,B=-180,z=180;const U=this.size,$=this._unmodified;if(this.latRange){const fe=this.latRange;A=a.mercatorYfromLat(fe[1])*this.worldSize,M=a.mercatorYfromLat(fe[0])*this.worldSize,o=M-A<U.y?U.y/(M-A):0}if(this.lngRange){const fe=this.lngRange;B=a.wrap(a.mercatorXfromLng(fe[0])*this.worldSize,0,this.worldSize),z=a.wrap(a.mercatorXfromLng(fe[1])*this.worldSize,0,this.worldSize),z<B&&(z+=this.worldSize),p=z-B<U.x?U.x/(z-B):0}const Y=this.point,K=Math.max(p||0,o||0);if(K)return this.center=this.unproject(new a.pointGeometry(p?(z+B)/2:Y.x,o?(M+A)/2:Y.y)),this.zoom+=this.scaleZoom(K),this._unmodified=$,void(this._constraining=!1);if(this.latRange){const fe=Y.y,se=U.y/2;fe-se<A&&(T=A+se),fe+se>M&&(T=M-se)}if(this.lngRange){const fe=(B+z)/2,se=a.wrap(Y.x,fe-this.worldSize/2,fe+this.worldSize/2),ue=U.x/2;se-ue<B&&(y=B+ue),se+ue>z&&(y=z-ue)}y===void 0&&T===void 0||(this.center=this.unproject(new a.pointGeometry(y!==void 0?y:Y.x,T!==void 0?T:Y.y)).wrap()),this._unmodified=$,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,p=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let T=a.identity(new Float64Array(16));a.scale(T,T,[this.width/2,-this.height/2,1]),a.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=a.identity(new Float64Array(16)),a.scale(T,T,[1,-1,1]),a.translate(T,T,[-1,-1,0]),a.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const A=Math.PI/2+this._pitch,M=this._fov*(.5+o.y/this.height),B=Math.sin(M)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-A-M,.01,Math.PI-.01)),z=this.getHorizon(),U=2*Math.atan(z/this.cameraToCenterDistance)*(.5+o.y/(2*z)),$=Math.sin(U)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-A-U,.01,Math.PI-.01)),Y=Math.cos(Math.PI/2-this._pitch)*B+this.cameraToSeaLevelDistance,K=Math.cos(Math.PI/2-this._pitch)*$+this.cameraToSeaLevelDistance,fe=1.01*Math.min(Y,K),se=this.height/50;T=new Float64Array(16),a.perspective(T,this._fov,this.width/this.height,se,fe),T[8]=2*-o.x/this.width,T[9]=2*o.y/this.height,a.scale(T,T,[1,-1,1]),a.translate(T,T,[0,0,-this.cameraToCenterDistance]),a.rotateX(T,T,this._pitch),a.rotateZ(T,T,this.angle),a.translate(T,T,[-p,-y,0]),this.mercatorMatrix=a.scale([],T,[this.worldSize,this.worldSize,this.worldSize]),a.scale(T,T,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,T),a.translate(T,T,[0,0,-this.elevation]),this.projMatrix=T,this.invProjMatrix=a.invert([],T),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,T);const ue=this.width%2/2,Re=this.height%2/2,Pe=Math.cos(this.angle),$e=Math.sin(this.angle),me=p-Math.round(p)+Pe*ue+$e*Re,Fe=y-Math.round(y)+Pe*Re+$e*ue,He=new Float64Array(T);if(a.translate(He,He,[me>.5?me-1:me,Fe>.5?Fe-1:Fe,0]),this.alignedProjMatrix=He,T=a.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.pointGeometry(0,0)),p=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.transformMat4(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,o))}getCameraQueryGeometry(o){const p=this.getCameraPoint();if(o.length===1)return[o[0],p];{let y=p.x,T=p.y,A=p.x,M=p.y;for(const B of o)y=Math.min(y,B.x),T=Math.min(T,B.y),A=Math.max(A,B.x),M=Math.max(M,B.y);return[new a.pointGeometry(y,T),new a.pointGeometry(A,T),new a.pointGeometry(A,M),new a.pointGeometry(y,M),new a.pointGeometry(y,T)]}}}class Af{constructor(o){this._hashName=o&&encodeURIComponent(o),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(p,y){let T=!1,A=null;const M=()=>{A=null,T&&(p(),A=setTimeout(M,300),T=!1)};return()=>(T=!0,A||M(),A)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const p=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,T=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,T),M=Math.round(p.lng*A)/A,B=Math.round(p.lat*A)/A,z=this._map.getBearing(),U=this._map.getPitch();let $="";if($+=o?`/${M}/${B}/${y}`:`${y}/${B}/${M}`,(z||U)&&($+="/"+Math.round(10*z)/10),U&&($+=`/${Math.round(U)}`),this._hashName){const Y=this._hashName;let K=!1;const fe=window.location.hash.slice(1).split("&").map(se=>{const ue=se.split("=")[0];return ue===Y?(K=!0,`${ue}=${$}`):se}).filter(se=>se);return K||fe.push(`${Y}=${$}`),`#${fe.join("&")}`}return`#${$}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let p;return o.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(p=y)}),(p&&p[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:p,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const Ar={linearity:.3,easing:a.bezier(0,0,.3,1)},_l=a.extend({deceleration:2500,maxSpeed:1400},Ar),ph=a.extend({deceleration:20,maxSpeed:1400},Ar),Bo=a.extend({deceleration:1e3,maxSpeed:360},Ar),mh=a.extend({deceleration:1e3,maxSpeed:90},Ar);class gh{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,p=a.exported.now();for(;o.length>0&&p-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)p.zoom+=A.zoomDelta||0,p.bearing+=A.bearingDelta||0,p.pitch+=A.pitchDelta||0,A.panDelta&&p.pan._add(A.panDelta),A.around&&(p.around=A.around),A.pinchAround&&(p.pinchAround=A.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(p.pan.mag()){const A=xc(p.pan.mag(),y,a.extend({},_l,o||{}));T.offset=p.pan.mult(A.amount/p.pan.mag()),T.center=this._map.transform.center,No(T,A)}if(p.zoom){const A=xc(p.zoom,y,ph);T.zoom=this._map.transform.zoom+A.amount,No(T,A)}if(p.bearing){const A=xc(p.bearing,y,Bo);T.bearing=this._map.transform.bearing+a.clamp(A.amount,-179,179),No(T,A)}if(p.pitch){const A=xc(p.pitch,y,mh);T.pitch=this._map.transform.pitch+A.amount,No(T,A)}if(T.zoom||T.bearing){const A=p.pinchAround===void 0?p.around:p.pinchAround;T.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),a.extend(T,{noMoveStart:!0})}}function No(v,o){(!v.duration||v.duration<o.duration)&&(v.duration=o.duration,v.easing=o.easing)}function xc(v,o,p){const{maxSpeed:y,linearity:T,deceleration:A}=p,M=a.clamp(v*T/(o/1e3),-y,y),B=Math.abs(M)/(A*T);return{easing:p.easing,duration:1e3*B,amount:M*(B/2)}}class hr extends a.Event{constructor(o,p,y,T={}){const A=I.mousePos(p.getCanvasContainer(),y),M=p.unproject(A);super(o,a.extend({point:A,lngLat:M,originalEvent:y},T)),this._defaultPrevented=!1,this.target=p}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class fr extends a.Event{constructor(o,p,y){const T=o==="touchend"?y.changedTouches:y.touches,A=I.touchPos(p.getCanvasContainer(),T),M=A.map(z=>p.unproject(z)),B=A.reduce((z,U,$,Y)=>z.add(U.div(Y.length)),new a.pointGeometry(0,0));super(o,{points:A,point:B,lngLats:M,lngLat:p.unproject(B),originalEvent:y}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class vc extends a.Event{constructor(o,p,y){super(o,{originalEvent:y}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class da{constructor(o,p){this._map=o,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new vc(o.type,this._map,o))}mousedown(o,p){return this._mousedownPos=p,this._firePreventable(new hr(o.type,this._map,o))}mouseup(o){this._map.fire(new hr(o.type,this._map,o))}click(o,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new hr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new hr(o.type,this._map,o))}mouseover(o){this._map.fire(new hr(o.type,this._map,o))}mouseout(o){this._map.fire(new hr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new fr(o.type,this._map,o))}touchmove(o){this._map.fire(new fr(o.type,this._map,o))}touchend(o){this._map.fire(new fr(o.type,this._map,o))}touchcancel(o){this._map.fire(new fr(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _h{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new hr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new hr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fs{constructor(o,p){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,p){this.isEnabled()&&o.shiftKey&&o.button===0&&(I.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(o,p){if(!this._active)return;const y=p;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const T=this._startPos;this._lastPos=y,this._box||(this._box=I.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const A=Math.min(T.x,y.x),M=Math.max(T.x,y.x),B=Math.min(T.y,y.y),z=Math.max(T.y,y.y);I.setTransform(this._box,`translate(${A}px,${B}px)`),this._box.style.width=M-A+"px",this._box.style.height=z-B+"px"}mouseupWindow(o,p){if(!this._active||o.button!==0)return;const y=this._startPos,T=p;if(this.reset(),I.suppressClick(),y.x!==T.x||y.y!==T.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:A=>A.fitScreenCoordinates(y,T,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(I.remove(this._box),this._box=null),I.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,p){return this._map.fire(new a.Event(o,{originalEvent:p}))}}function Ts(v,o){if(v.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${o.length}`);const p={};for(let y=0;y<v.length;y++)p[v[y].identifier]=o[y];return p}class yh{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,p,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(T){const A=new a.pointGeometry(0,0);for(const M of T)A._add(M);return A.div(T.length)}(p),this.touches=Ts(y,p)))}touchmove(o,p,y){if(this.aborted||!this.centroid)return;const T=Ts(y,p);for(const A in this.touches){const M=this.touches[A],B=T[A];(!B||B.dist(M)>30)&&(this.aborted=!0)}}touchend(o,p,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const T=!this.aborted&&this.centroid;if(this.reset(),T)return T}}}class ou{constructor(o){this.singleTap=new yh(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,p,y){this.singleTap.touchstart(o,p,y)}touchmove(o,p,y){this.singleTap.touchmove(o,p,y)}touchend(o,p,y){const T=this.singleTap.touchend(o,p,y);if(T){const A=o.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(T)<30;if(A&&M||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=T,this.count===this.numTaps)return this.reset(),T}}}class zo{constructor(){this._zoomIn=new ou({numTouches:1,numTaps:2}),this._zoomOut=new ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,p,y){this._zoomIn.touchstart(o,p,y),this._zoomOut.touchstart(o,p,y)}touchmove(o,p,y){this._zoomIn.touchmove(o,p,y),this._zoomOut.touchmove(o,p,y)}touchend(o,p,y){const T=this._zoomIn.touchend(o,p,y),A=this._zoomOut.touchend(o,p,y);return T?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(T)},{originalEvent:o})}):A?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(A)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const bh={0:1,2:2};class Wa{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,p){return!1}_move(o,p){return{}}mousedown(o,p){if(this._lastPoint)return;const y=I.mouseButton(o);this._correctButton(o,y)&&(this._lastPoint=p,this._eventButton=y)}mousemoveWindow(o,p){const y=this._lastPoint;if(y){if(o.preventDefault(),function(T,A){const M=bh[A];return T.buttons===void 0||(T.buttons&M)!==M}(o,this._eventButton))this.reset();else if(this._moved||!(p.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(y,p)}}mouseupWindow(o){this._lastPoint&&I.mouseButton(o)===this._eventButton&&(this._moved&&I.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ca extends Wa{mousedown(o,p){super.mousedown(o,p),this._lastPoint&&(this._active=!0)}_correctButton(o,p){return p===0&&!o.ctrlKey}_move(o,p){return{around:p,panDelta:p.sub(o)}}}class jt extends Wa{_correctButton(o,p){return p===0&&o.ctrlKey||p===2}_move(o,p){const y=.8*(p.x-o.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(o){o.preventDefault()}}class xh extends Wa{_correctButton(o,p){return p===0&&o.ctrlKey||p===2}_move(o,p){const y=-.5*(p.y-o.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(o){o.preventDefault()}}class wc{constructor(o,p){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=p,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,p,y){return this._calculateTransform(o,p,y)}touchmove(o,p,y){if(this._map._cooperativeGestures&&(this._minTouches===2&&y.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,y.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(y.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,p,y)}touchend(o,p,y){this._calculateTransform(o,p,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,p,y){y.length>0&&(this._active=!0);const T=Ts(y,p),A=new a.pointGeometry(0,0),M=new a.pointGeometry(0,0);let B=0;for(const U in T){const $=T[U],Y=this._touches[U];Y&&(A._add($),M._add($.sub(Y)),B++,T[U]=$)}if(this._touches=T,B<this._minTouches||!M.mag())return;const z=M.div(B);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(B),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,p,y){return{}}touchstart(o,p,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([p[0],p[1]]))}touchmove(o,p,y){if(!this._firstTwoTouches)return;o.preventDefault();const[T,A]=this._firstTwoTouches,M=yl(y,p,T),B=yl(y,p,A);if(!M||!B)return;const z=this._aroundCenter?null:M.add(B).div(2);return this._move([M,B],z,o)}touchend(o,p,y){if(!this._firstTwoTouches)return;const[T,A]=this._firstTwoTouches,M=yl(y,p,T),B=yl(y,p,A);M&&B||(this._active&&I.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yl(v,o,p){for(let y=0;y<v.length;y++)if(v[y].identifier===p)return o[y]}function It(v,o){return Math.log(v/o)/Math.LN2}class ds extends Xa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,p){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(It(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:It(this._distance,y),pinchAround:p}}}function vh(v,o){return 180*v.angleWith(o)/Math.PI}class Ss extends Xa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,p){const y=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vh(this._vector,y),pinchAround:p}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const p=25/(Math.PI*this._minDiameter)*360,y=vh(o,this._startVector);return Math.abs(y)<p}}function Br(v){return Math.abs(v.y)>Math.abs(v.x)}class Lo extends Xa{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,p,y){super.touchstart(o,p,y),this._currentTouchCount=y.length}_start(o){this._lastPoints=o,Br(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,p,y){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const T=o[0].sub(this._lastPoints[0]),A=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(T,A,y.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(T.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(o,p,y){if(this._valid!==void 0)return this._valid;const T=o.mag()>=2,A=p.mag()>=2;if(!T&&!A)return;if(!T||!A)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const M=o.y>0==p.y>0;return Br(o)&&Br(p)&&M}}const lu={panStep:100,bearingStep:15,pitchStep:10};class cu{constructor(){const o=lu;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let p=0,y=0,T=0,A=0,M=0;switch(o.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),A=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),A=1);break;case 38:o.shiftKey?T=1:(o.preventDefault(),M=-1);break;case 40:o.shiftKey?T=-1:(o.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(y=0,T=0),{cameraAnimation:B=>{const z=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:uu,zoom:p?Math.round(z)+p*(o.shiftKey?2:1):z,bearing:B.getBearing()+y*this._bearingStep,pitch:B.getPitch()+T*this._pitchStep,offset:[-A*this._panStep,-M*this._panStep],center:B.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uu(v){return v*(2-v)}const bl=4.000244140625;class Za{constructor(o,p){this._map=o,this._el=o.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let p=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=a.exported.now(),T=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,p!==0&&p%bl==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":T>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(T*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),o.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=o,this._delta-=p,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=I.mousePos(this._el,o);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(p)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>bl?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&z!==0&&(z=1/z);const U=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(U*z))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,y=this._startZoom,T=this._easing;let A,M=!1;if(this._type==="wheel"&&y&&T){const B=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),z=T(B);A=a.number(y,p,z),B<1?this._frameId||(this._frameId=!0):M=!0}else A=p,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:A-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let p=a.ease;if(this._prevEase){const y=this._prevEase,T=(a.exported.now()-y.start)/y.duration,A=y.easing(T+.01)-y.easing(T),M=.27/Math.sqrt(A*A+1e-4)*.01,B=Math.sqrt(.0729-M*M);p=a.bezier(M,B,.25,1)}return this._prevEase={start:a.exported.now(),duration:o,easing:p},p}reset(){this._active=!1}}class hu{constructor(o,p){this._clickZoom=o,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xl{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,p){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(o.shiftKey?-1:1),around:y.unproject(p)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sr{constructor(){this._tap=new ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,p,y){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=p[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(o,p,y))}touchmove(o,p,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const T=p[0],A=T.y-this._swipePoint.y;return this._swipePoint=T,o.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(o,p,y)}touchend(o,p,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(o,p,y)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ya{constructor(o,p,y){this._el=o,this._mousePan=p,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rs{constructor(o,p,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=p,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Tc{constructor(o,p,y,T){this._el=o,this._touchZoom=p,this._touchRotate=y,this._tapDragZoom=T,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ss=v=>v.zoom||v.drag||v.pitch||v.rotate;class fu extends a.Event{}function Fo(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class dr{constructor(o,p){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gh(o),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p),a.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[T,A,M]of this._listeners)I.addEventListener(T,A,T===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[o,p,y]of this._listeners)I.removeEventListener(o,p,o===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(o){const p=this._map,y=p.getCanvasContainer();this._add("mapEvent",new da(p,o));const T=p.boxZoom=new fs(p,o);this._add("boxZoom",T);const A=new zo,M=new xl;p.doubleClickZoom=new hu(M,A),this._add("tapZoom",A),this._add("clickZoom",M);const B=new sr;this._add("tapDragZoom",B);const z=p.touchPitch=new Lo(p);this._add("touchPitch",z);const U=new jt(o),$=new xh(o);p.dragRotate=new rs(o,U,$),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const Y=new Ca(o),K=new wc(o,p);p.dragPan=new Ya(y,Y,K),this._add("mousePan",Y),this._add("touchPan",K,["touchZoom","touchRotate"]);const fe=new Ss,se=new ds;p.touchZoomRotate=new Tc(y,se,fe,B),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]);const ue=p.scrollZoom=new Za(p,this);this._add("scrollZoom",ue,["mousePan"]);const Re=p.keyboard=new cu;this._add("keyboard",Re),this._add("blockableMapEvent",new _h(p));for(const Pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Pe]&&p[Pe].enable(o[Pe])}_add(o,p,y){this._handlers.push({handlerName:o,handler:p,allowed:y}),this._handlersById[o]=p}stop(o){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ss(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,p,y){for(const T in o)if(T!==y&&(!p||p.indexOf(T)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const p=[];for(const y of o)this._el.contains(y.target)&&p.push(y);return p}handleEvent(o,p){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=o.type==="renderFrame"?void 0:o,T={needsRenderFrame:!1},A={},M={},B=o.touches,z=B?this._getMapTouches(B):void 0,U=z?I.touchPos(this._el,z):I.mousePos(this._el,o);for(const{handlerName:K,handler:fe,allowed:se}of this._handlers){if(!fe.isEnabled())continue;let ue;this._blockedByActive(M,se,K)?fe.reset():fe[p||o.type]&&(ue=fe[p||o.type](o,U,z),this.mergeHandlerResult(T,A,ue,K,y),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||fe.isActive())&&(M[K]=fe)}const $={};for(const K in this._previousActiveHandlers)M[K]||($[K]=y);this._previousActiveHandlers=M,(Object.keys($).length||Fo(T))&&(this._changes.push([T,A,$]),this._triggerRenderFrame()),(Object.keys(M).length||Fo(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Y}=T;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))}mergeHandlerResult(o,p,y,T,A){if(!y)return;a.extend(o,y);const M={handlerName:T,originalEvent:y.originalEvent||A};y.zoomDelta!==void 0&&(p.zoom=M),y.panDelta!==void 0&&(p.drag=M),y.pitchDelta!==void 0&&(p.pitch=M),y.bearingDelta!==void 0&&(p.rotate=M)}_applyChanges(){const o={},p={},y={};for(const[T,A,M]of this._changes)T.panDelta&&(o.panDelta=(o.panDelta||new a.pointGeometry(0,0))._add(T.panDelta)),T.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(o.around=T.around),T.pinchAround!==void 0&&(o.pinchAround=T.pinchAround),T.noInertia&&(o.noInertia=T.noInertia),a.extend(p,A),a.extend(y,M);this._updateMapTransform(o,p,y),this._changes=[]}_updateMapTransform(o,p,y){const T=this._map,A=T.transform,M=T.style&&T.style.terrain;if(!(Fo(o)||M&&this._drag))return this._fireEvents(p,y,!0);let{panDelta:B,zoomDelta:z,bearingDelta:U,pitchDelta:$,around:Y,pinchAround:K}=o;K!==void 0&&(Y=K),T._stop(!0),Y=Y||T.transform.centerPoint;const fe=A.pointLocation(B?Y.sub(B):Y);U&&(A.bearing+=U),$&&(A.pitch+=$),z&&(A.zoom+=z),M?p.drag&&!this._drag?(this._drag={center:A.centerPoint,lngLat:A.pointLocation(Y),point:Y,handlerName:p.drag.handlerName},T.fire(new a.Event("freezeElevation",{freeze:!0}))):this._drag&&y[this._drag.handlerName]?(T.fire(new a.Event("freezeElevation",{freeze:!1})),this._drag=null):p.drag&&this._drag&&(A.center=A.pointLocation(A.centerPoint.sub(B))):A.setLocationAtPoint(fe,Y),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(p,y,!0)}_fireEvents(o,p,y){const T=ss(this._eventsInProgress),A=ss(o),M={};for(const $ in o){const{originalEvent:Y}=o[$];this._eventsInProgress[$]||(M[`${$}start`]=Y),this._eventsInProgress[$]=o[$]}!T&&A&&this._fireEvent("movestart",A.originalEvent);for(const $ in M)this._fireEvent($,M[$]);A&&this._fireEvent("move",A.originalEvent);for(const $ in o){const{originalEvent:Y}=o[$];this._fireEvent($,Y)}const B={};let z;for(const $ in this._eventsInProgress){const{handlerName:Y,originalEvent:K}=this._eventsInProgress[$];this._handlersById[Y].isActive()||(delete this._eventsInProgress[$],z=p[Y]||K,B[`${$}end`]=z)}for(const $ in B)this._fireEvent($,B[$]);const U=ss(this._eventsInProgress);if(y&&(T||A)&&!U){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;$?(Y($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:z})):(this._map.fire(new a.Event("moveend",{originalEvent:z})),Y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,p){this._map.fire(new a.Event(o,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new fu("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ui={extend:(v,...o)=>a.extend(v,...o),run(v){v()},logToElement(v,o=!1,p="log"){const y=window.document.getElementById(p);y&&(o&&(y.innerHTML=""),y.innerHTML+=`<br>${v}`)}};class vl extends a.Evented{constructor(o,p){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=p.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,p){return this.jumpTo({center:o},p)}panBy(o,p,y){return o=a.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,a.extend({offset:o},p),y)}panTo(o,p,y){return this.easeTo(a.extend({center:o},p),y)}getZoom(){return this.transform.zoom}setZoom(o,p){return this.jumpTo({zoom:o},p),this}zoomTo(o,p,y){return this.easeTo(a.extend({zoom:o},p),y)}zoomIn(o,p){return this.zoomTo(this.getZoom()+1,o,p),this}zoomOut(o,p){return this.zoomTo(this.getZoom()-1,o,p),this}getBearing(){return this.transform.bearing}setBearing(o,p){return this.jumpTo({bearing:o},p),this}getPadding(){return this.transform.padding}setPadding(o,p){return this.jumpTo({padding:o},p),this}rotateTo(o,p,y){return this.easeTo(a.extend({bearing:o},p),y)}resetNorth(o,p){return this.rotateTo(0,a.extend({duration:1e3},o),p),this}resetNorthPitch(o,p){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},o),p),this}snapToNorth(o,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,p):this}getPitch(){return this.transform.pitch}setPitch(o,p){return this.jumpTo({pitch:o},p),this}cameraForBounds(o,p){o=a.LngLatBounds.convert(o);const y=p&&p.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,p)}_cameraForBoxAndBearing(o,p,y,T){const A={top:0,bottom:0,right:0,left:0};if(typeof(T=a.extend({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){const He=T.padding;T.padding={top:He,bottom:He,right:He,left:He}}T.padding=a.extend(A,T.padding);const M=this.transform,B=M.padding,z=M.project(a.LngLat.convert(o)),U=M.project(a.LngLat.convert(p)),$=z.rotate(-y*Math.PI/180),Y=U.rotate(-y*Math.PI/180),K=new a.pointGeometry(Math.max($.x,Y.x),Math.max($.y,Y.y)),fe=new a.pointGeometry(Math.min($.x,Y.x),Math.min($.y,Y.y)),se=K.sub(fe),ue=(M.width-(B.left+B.right+T.padding.left+T.padding.right))/se.x,Re=(M.height-(B.top+B.bottom+T.padding.top+T.padding.bottom))/se.y;if(Re<0||ue<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Pe=Math.min(M.scaleZoom(M.scale*Math.min(ue,Re)),T.maxZoom),$e=a.pointGeometry.convert(T.offset),me=new a.pointGeometry((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(y*Math.PI/180),Fe=$e.add(me).mult(M.scale/M.zoomScale(Pe));return{center:M.unproject(z.add(U).div(2).sub(Fe)),zoom:Pe,bearing:y}}fitBounds(o,p,y){return this._fitInternal(this.cameraForBounds(o,p),p,y)}fitScreenCoordinates(o,p,y,T,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(o)),this.transform.pointLocation(a.pointGeometry.convert(p)),y,T),T,A)}_fitInternal(o,p,y){return o?(delete(p=a.extend(o,p)).padding,p.linear?this.easeTo(p,y):this.flyTo(p,y)):this}jumpTo(o,p){this.stop();const y=this.transform;let T=!1,A=!1,M=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(T=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=a.LngLat.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(A=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(M=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),this.fire(new a.Event("movestart",p)).fire(new a.Event("move",p)),T&&this.fire(new a.Event("zoomstart",p)).fire(new a.Event("zoom",p)).fire(new a.Event("zoomend",p)),A&&this.fire(new a.Event("rotatestart",p)).fire(new a.Event("rotate",p)).fire(new a.Event("rotateend",p)),M&&this.fire(new a.Event("pitchstart",p)).fire(new a.Event("pitch",p)).fire(new a.Event("pitchend",p)),this.fire(new a.Event("moveend",p))}calculateCameraOptionsFromTo(o,p,y,T=0){const A=a.MercatorCoordinate.fromLngLat(o,p),M=a.MercatorCoordinate.fromLngLat(y,T),B=M.x-A.x,z=M.y-A.y,U=M.z-A.z,$=Math.hypot(B,z,U);if($===0)throw new Error("Can't calculate camera options with same From and To");const Y=Math.hypot(B,z),K=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),fe=180*Math.atan2(B,-z)/Math.PI;let se=180*Math.acos(Y/$)/Math.PI;return se=U<0?90-se:90+se,{center:M.toLngLat(),zoom:K,pitch:se,bearing:fe}}easeTo(o,p){this._stop(!1,o.easeId),((o=a.extend({offset:[0,0],duration:500,easing:a.ease},o)).animate===!1||!o.essential&&a.exported.prefersReducedMotion)&&(o.duration=0);const y=this.transform,T=this.getZoom(),A=this.getBearing(),M=this.getPitch(),B=this.getPadding(),z="zoom"in o?+o.zoom:T,U="bearing"in o?this._normalizeBearing(o.bearing,A):A,$="pitch"in o?+o.pitch:M,Y="padding"in o?o.padding:y.padding,K=a.pointGeometry.convert(o.offset);let fe=y.centerPoint.add(K);const se=y.pointLocation(fe),ue=a.LngLat.convert(o.center||se);this._normalizeCenter(ue);const Re=y.project(se),Pe=y.project(ue).sub(Re),$e=y.zoomScale(z-T);let me,Fe;o.around&&(me=a.LngLat.convert(o.around),Fe=y.locationPoint(me));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||z!==T,this._rotating=this._rotating||A!==U,this._pitching=this._pitching||$!==M,this._padding=!y.isPaddingEqual(Y),this._easeId=o.easeId,this._prepareEase(p,o.noMoveStart,He),this._ease(rt=>{if(this._zooming&&(y.zoom=a.number(T,z,rt)),this._rotating&&(y.bearing=a.number(A,U,rt)),this._pitching&&(y.pitch=a.number(M,$,rt)),this._padding&&(y.interpolatePadding(B,Y,rt),fe=y.centerPoint.add(K)),me)y.setLocationAtPoint(me,Fe);else{const st=y.zoomScale(y.zoom-T),bt=z>T?Math.min(2,$e):Math.max(.5,$e),Qe=Math.pow(bt,1-rt),Mt=y.unproject(Re.add(Pe.mult(rt*Qe)).mult(st));y.setLocationAtPoint(y.renderWorldCopies?Mt.wrap():Mt,fe)}this._fireMoveEvents(p)},rt=>{this._afterEase(p,rt)},o),this}_prepareEase(o,p,y={}){this._moving=!0,this.fire(new a.Event("freezeElevation",{freeze:!0})),p||y.moving||this.fire(new a.Event("movestart",o)),this._zooming&&!y.zooming&&this.fire(new a.Event("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new a.Event("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new a.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new a.Event("move",o)),this._zooming&&this.fire(new a.Event("zoom",o)),this._rotating&&this.fire(new a.Event("rotate",o)),this._pitching&&this.fire(new a.Event("pitch",o))}_afterEase(o,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId,this.fire(new a.Event("freezeElevation",{freeze:!1}));const y=this._zooming,T=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new a.Event("zoomend",o)),T&&this.fire(new a.Event("rotateend",o)),A&&this.fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o))}flyTo(o,p){if(!o.essential&&a.exported.prefersReducedMotion){const Kt=a.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Kt,p)}this.stop(),o=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},o);const y=this.transform,T=this.getZoom(),A=this.getBearing(),M=this.getPitch(),B=this.getPadding(),z="zoom"in o?a.clamp(+o.zoom,y.minZoom,y.maxZoom):T,U="bearing"in o?this._normalizeBearing(o.bearing,A):A,$="pitch"in o?+o.pitch:M,Y="padding"in o?o.padding:y.padding,K=y.zoomScale(z-T),fe=a.pointGeometry.convert(o.offset);let se=y.centerPoint.add(fe);const ue=y.pointLocation(se),Re=a.LngLat.convert(o.center||ue);this._normalizeCenter(Re);const Pe=y.project(ue),$e=y.project(Re).sub(Pe);let me=o.curve;const Fe=Math.max(y.width,y.height),He=Fe/K,rt=$e.mag();if("minZoom"in o){const Kt=a.clamp(Math.min(o.minZoom,T,z),y.minZoom,y.maxZoom),Wn=Fe/y.zoomScale(Kt-T);me=Math.sqrt(Wn/rt*2)}const st=me*me;function bt(Kt){const Wn=(He*He-Fe*Fe+(Kt?-1:1)*st*st*rt*rt)/(2*(Kt?He:Fe)*st*rt);return Math.log(Math.sqrt(Wn*Wn+1)-Wn)}function Qe(Kt){return(Math.exp(Kt)-Math.exp(-Kt))/2}function Mt(Kt){return(Math.exp(Kt)+Math.exp(-Kt))/2}const kt=bt(0);let Ut=function(Kt){return Mt(kt)/Mt(kt+me*Kt)},un=function(Kt){return Fe*((Mt(kt)*(Qe(Wn=kt+me*Kt)/Mt(Wn))-Qe(kt))/st)/rt;var Wn},yn=(bt(1)-kt)/me;if(Math.abs(rt)<1e-6||!isFinite(yn)){if(Math.abs(Fe-He)<1e-6)return this.easeTo(o,p);const Kt=He<Fe?-1:1;yn=Math.abs(Math.log(He/Fe))/me,un=function(){return 0},Ut=function(Wn){return Math.exp(Kt*me*Wn)}}return o.duration="duration"in o?+o.duration:1e3*yn/("screenSpeed"in o?+o.screenSpeed/me:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=A!==U,this._pitching=$!==M,this._padding=!y.isPaddingEqual(Y),this._prepareEase(p,!1),this._ease(Kt=>{const Wn=Kt*yn,$n=1/Ut(Wn);y.zoom=Kt===1?z:T+y.scaleZoom($n),this._rotating&&(y.bearing=a.number(A,U,Kt)),this._pitching&&(y.pitch=a.number(M,$,Kt)),this._padding&&(y.interpolatePadding(B,Y,Kt),se=y.centerPoint.add(fe));const Pn=Kt===1?Re:y.unproject(Pe.add($e.mult(un(Wn))).mult($n));y.setLocationAtPoint(y.renderWorldCopies?Pn.wrap():Pn,se),this._fireMoveEvents(p)},()=>this._afterEase(p),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,p)}if(!o){const y=this.handlers;y&&y.stop(!1)}return this}_ease(o,p,y){y.animate===!1||y.duration===0?(o(1),p()):(this._easeStart=a.exported.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,p){o=a.wrap(o,-180,180);const y=Math.abs(o-p);return Math.abs(o-360-p)<y&&(o-=360),Math.abs(o+360-p)<y&&(o+=360),o}_normalizeCenter(o){const p=this.transform;if(!p.renderWorldCopies||p.lngRange)return;const y=o.lng-p.center.lng;o.lng+=y>180?-360:y<-180?360:0}}class Ra{constructor(o={}){this.options=o,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=I.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=I.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=I.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){I.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,p){const y=this._map._getUIString(`AttributionControl.${p}`);o.title=y,o.setAttribute("aria-label",y)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(T=>typeof T!="string"?"":T)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const T=this._map.style.stylesheet;this.styleOwner=T.owner,this.styleId=T.id}const p=this._map.style.sourceCaches;for(const T in p){const A=p[T];if(A.used||A.usedForTerrain){const M=A.getSource();M.attribution&&o.indexOf(M.attribution)<0&&o.push(M.attribution)}}o=o.filter(T=>String(T).trim()),o.sort((T,A)=>T.length-A.length),o=o.filter((T,A)=>{for(let M=A+1;M<o.length;M++)if(o[M].indexOf(T)>=0)return!1;return!0});const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Ga{constructor(o={}){this.options=o,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=I.create("div","maplibregl-ctrl mapboxgl-ctrl");const p=I.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://maplibre.org/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){I.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const p=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact","mapboxgl-compact"):p.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Sc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const p=++this._id;return this._queue.push({callback:o,id:p,cancelled:!1}),p}remove(o){const p=this._currentlyRunning,y=p?this._queue.concat(p):this._queue;for(const T of y)if(T.id===o)return void(T.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const p=this._currentlyRunning=this._queue;this._queue=[];for(const y of p)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Ec={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Es={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Hi={showCompass:!0,showZoom:!0,visualizePitch:!1};class pa{constructor(o,p,y=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new jt({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,y&&(this.mousePitch=new xh({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),I.addEventListener(p,"mousedown",this.mousedown),I.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),I.addEventListener(p,"touchmove",this.touchmove),I.addEventListener(p,"touchend",this.touchend),I.addEventListener(p,"touchcancel",this.reset)}down(o,p){this.mouseRotate.mousedown(o,p),this.mousePitch&&this.mousePitch.mousedown(o,p),I.disableDrag()}move(o,p){const y=this.map,T=this.mouseRotate.mousemoveWindow(o,p);if(T&&T.bearingDelta&&y.setBearing(y.getBearing()+T.bearingDelta),this.mousePitch){const A=this.mousePitch.mousemoveWindow(o,p);A&&A.pitchDelta&&y.setPitch(y.getPitch()+A.pitchDelta)}}off(){const o=this.element;I.removeEventListener(o,"mousedown",this.mousedown),I.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),I.removeEventListener(o,"touchmove",this.touchmove),I.removeEventListener(o,"touchend",this.touchend),I.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){I.enableDrag(),I.removeEventListener(window,"mousemove",this.mousemove),I.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(a.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),I.mousePos(this.element,o)),I.addEventListener(window,"mousemove",this.mousemove),I.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,I.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=I.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=I.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function $t(v,o,p){if(v=new a.LngLat(v.lng,v.lat),o){const y=new a.LngLat(v.lng-360,v.lat),T=new a.LngLat(v.lng+360,v.lat),A=p.locationPoint(v).distSqr(o);p.locationPoint(y).distSqr(o)<A?v=y:p.locationPoint(T).distSqr(o)<A&&(v=T)}for(;Math.abs(v.lng-p.center.lng)>180;){const y=p.locationPoint(v);if(y.x>=0&&y.y>=0&&y.x<=p.width&&y.y<=p.height)break;v.lng>p.center.lng?v.lng-=360:v.lng+=360}return v}const Gt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xs(v,o,p){const y=v.classList;for(const T in Gt)y.remove(`maplibregl-${p}-anchor-${T}`,`mapboxgl-${p}-anchor-${T}`);y.add(`maplibregl-${p}-anchor-${o}`,`mapboxgl-${p}-anchor-${o}`)}class wl extends a.Evented{constructor(o,p){if(super(),(o instanceof HTMLElement||p)&&(o=a.extend({element:o},p)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=a.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=I.create("div"),this._element.setAttribute("aria-label","Map marker");const y=I.createNS("http://www.w3.org/2000/svg","svg"),T=41,A=27;y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height",`${T}px`),y.setAttributeNS(null,"width",`${A}px`),y.setAttributeNS(null,"viewBox",`0 0 ${A} ${T}`);const M=I.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");const B=I.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const z=I.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const U=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const $e of U){const me=I.createNS("http://www.w3.org/2000/svg","ellipse");me.setAttributeNS(null,"opacity","0.04"),me.setAttributeNS(null,"cx","10.5"),me.setAttributeNS(null,"cy","5.80029008"),me.setAttributeNS(null,"rx",$e.rx),me.setAttributeNS(null,"ry",$e.ry),z.appendChild(me)}const $=I.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"fill",this._color);const Y=I.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),$.appendChild(Y);const K=I.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const fe=I.createNS("http://www.w3.org/2000/svg","path");fe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(fe);const se=I.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const ue=I.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Re=I.createNS("http://www.w3.org/2000/svg","circle");Re.setAttributeNS(null,"fill","#000000"),Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"cx","5.5"),Re.setAttributeNS(null,"cy","5.5"),Re.setAttributeNS(null,"r","5.4999962");const Pe=I.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#FFFFFF"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962"),ue.appendChild(Re),ue.appendChild(Pe),B.appendChild(z),B.appendChild($),B.appendChild(K),B.appendChild(se),B.appendChild(ue),y.appendChild(B),y.setAttributeNS(null,"height",T*this._scale+"px"),y.setAttributeNS(null,"width",A*this._scale+"px"),this._element.appendChild(y),this._offset=a.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()}),Xs(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),I.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const T=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[T,-1*(38.1-13.5+T)],"bottom-right":[-T,-1*(38.1-13.5+T)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const p=o.code,y=o.charCode||o.keyCode;p!=="Space"&&p!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(o){const p=o.originalEvent.target,y=this._element;this._popup&&(p===y||y.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=$t(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),I.setTransform(this._element,`${Gt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const T=this._map.unproject(this._pos),A=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=T.distanceTo(this._lngLat)>20*A?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=a.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ac={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qi,Wi=0,Vn=!1;const Gn={maxWidth:100,unit:"metric"};function Zs(v,o,p){const y=p&&p.maxWidth||100,T=v._container.clientHeight/2,A=v.unproject([0,T]),M=v.unproject([y,T]),B=A.distanceTo(M);if(p&&p.unit==="imperial"){const z=3.2808*B;z>5280?jn(o,y,z/5280,v._getUIString("ScaleControl.Miles")):jn(o,y,z,v._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?jn(o,y,B/1852,v._getUIString("ScaleControl.NauticalMiles")):B>=1e3?jn(o,y,B/1e3,v._getUIString("ScaleControl.Kilometers")):jn(o,y,B,v._getUIString("ScaleControl.Meters"))}function jn(v,o,p,y){const T=function(A){const M=Math.pow(10,`${Math.floor(A)}`.length-1);let B=A/M;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(z){const U=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*U)/U}(B),M*B}(p);v.style.width=o*(T/p)+"px",v.innerHTML=`${T}&nbsp;${y}`}const Ni={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ka=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Uo(v){if(v){if(typeof v=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,v),"top-left":new a.pointGeometry(o,o),"top-right":new a.pointGeometry(-o,o),bottom:new a.pointGeometry(0,-v),"bottom-left":new a.pointGeometry(o,-o),"bottom-right":new a.pointGeometry(-o,-o),left:new a.pointGeometry(v,0),right:new a.pointGeometry(-v,0)}}if(v instanceof a.pointGeometry||Array.isArray(v)){const o=a.pointGeometry.convert(v);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.pointGeometry.convert(v.center||[0,0]),top:a.pointGeometry.convert(v.top||[0,0]),"top-left":a.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(v["top-right"]||[0,0]),bottom:a.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(v["bottom-right"]||[0,0]),left:a.pointGeometry.convert(v.left||[0,0]),right:a.pointGeometry.convert(v.right||[0,0])}}return Uo(new a.pointGeometry(0,0))}const Tl={supported:_,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends vl{constructor(v){var o;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(v=a.extend({},Es,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new au(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),{bearingSnap:v.bearingSnap}),this._interactive=v.interactive,this._cooperativeGestures=v.cooperativeGestures,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new Sc,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Ec,v.locale),this._clickTolerance=v.clickTolerance,this._pixelRatio=(o=v.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new N(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new dr(this,v),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=v.hash&&new Af(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,a.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new Ra({customAttribution:v.customAttribution})),v.maplibreLogo&&this.addControl(new Ga,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",p=>{this._update(p.dataType==="style"),this.fire(new a.Event(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new a.Event(`${p.dataType}dataloading`,p))}),this.on("dataabort",p=>{this.fire(new a.Event("sourcedataabort",p))})}_getMapId(){return this._mapId}addControl(v,o){if(o===void 0&&(o=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=v.onAdd(this);this._controls.push(v);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(p,y.firstChild):y.appendChild(p),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(v);return o>-1&&this._controls.splice(o,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,o,p,y){return y==null&&this.style.terrain&&(y=this.transform.getElevation(p,this.style.terrain)),super.calculateCameraOptionsFromTo(v,o,p,y)}resize(v){const o=this._containerDimensions(),p=o[0],y=o[1];this._resizeCanvas(p,y,this.getPixelRatio()),this.transform.resize(p,y),this.painter.resize(p,y,this.getPixelRatio());const T=!this._moving;return T&&(this.stop(),this.fire(new a.Event("movestart",v)).fire(new a.Event("move",v))),this.fire(new a.Event("resize",v)),T&&this.fire(new a.Event("moveend",v)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(v){const[o,p]=this._containerDimensions();this._pixelRatio=v,this._resizeCanvas(o,p,v),this.painter.resize(o,p,v)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(a.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(a.LngLat.convert(v),this.style&&this.style.terrain)}unproject(v){return this.transform.pointLocation(a.pointGeometry.convert(v),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(v,o,p){if(v==="mouseenter"||v==="mouseover"){let y=!1;return{layer:o,listener:p,delegates:{mousemove:A=>{const M=this.getLayer(o)?this.queryRenderedFeatures(A.point,{layers:[o]}):[];M.length?y||(y=!0,p.call(this,new hr(v,this,A.originalEvent,{features:M}))):y=!1},mouseout:()=>{y=!1}}}}if(v==="mouseleave"||v==="mouseout"){let y=!1;return{layer:o,listener:p,delegates:{mousemove:M=>{(this.getLayer(o)?this.queryRenderedFeatures(M.point,{layers:[o]}):[]).length?y=!0:y&&(y=!1,p.call(this,new hr(v,this,M.originalEvent)))},mouseout:M=>{y&&(y=!1,p.call(this,new hr(v,this,M.originalEvent)))}}}}{const y=T=>{const A=this.getLayer(o)?this.queryRenderedFeatures(T.point,{layers:[o]}):[];A.length&&(T.features=A,p.call(this,T),delete T.features)};return{layer:o,listener:p,delegates:{[v]:y}}}}on(v,o,p){if(p===void 0)return super.on(v,o);const y=this._createDelegatedListener(v,o,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(y);for(const T in y.delegates)this.on(T,y.delegates[T]);return this}once(v,o,p){if(p===void 0)return super.once(v,o);const y=this._createDelegatedListener(v,o,p);for(const T in y.delegates)this.once(T,y.delegates[T]);return this}off(v,o,p){return p===void 0?super.off(v,o):(this._delegatedListeners&&this._delegatedListeners[v]&&(y=>{const T=this._delegatedListeners[v];for(let A=0;A<T.length;A++){const M=T[A];if(M.layer===o&&M.listener===p){for(const B in M.delegates)this.off(B,M.delegates[B]);return T.splice(A,1),this}}})(),this)}queryRenderedFeatures(v,o){if(!this.style)return[];let p;if(o!==void 0||v===void 0||v instanceof a.pointGeometry||Array.isArray(v)||(o=v,v=void 0),o=o||{},(v=v||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||typeof v[0]=="number")p=[a.pointGeometry.convert(v)];else{const y=a.pointGeometry.convert(v[0]),T=a.pointGeometry.convert(v[1]);p=[y,new a.pointGeometry(T.x,y.y),T,new a.pointGeometry(y.x,T.y),y]}return this.style.queryRenderedFeatures(p,o,this.transform)}querySourceFeatures(v,o){return this.style.querySourceFeatures(v,o)}setStyle(v,o){return(o=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(v,o))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const o=this._locale[v];if(o==null)throw new Error(`Missing UI string '${v}'`);return o}_updateStyle(v,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),v?(this.style=new rr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v):this.style.loadJSON(v),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new rr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,o){if(typeof v=="string"){const p=this._requestManager.transformRequest(v,a.ResourceType.Style);a.getJSON(p,(y,T)=>{y?this.fire(new a.ErrorEvent(y)):T&&this._updateDiff(T,o)})}else typeof v=="object"&&this._updateDiff(v,o)}_updateDiff(v,o){try{this.style.setState(v)&&this._update(!0)}catch(p){a.warnOnce(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(v,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(v,o){return this._lazyInitEmptyStyle(),this.style.addSource(v,o),this._update(!0)}isSourceLoaded(v){const o=this.style&&this.style.sourceCaches[v];if(o!==void 0)return o.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){return this.style.setTerrain(v),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const o in v){const p=v[o]._tiles;for(const y in p){const T=p[y];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}addSourceType(v,o,p){return this._lazyInitEmptyStyle(),this.style.addSourceType(v,o,p)}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,o,{pixelRatio:p=1,sdf:y=!1,stretchX:T,stretchY:A,content:M}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||a.isImageBitmap(o)){const{width:B,height:z,data:U}=a.exported.getImageData(o);this.style.addImage(v,{data:new a.RGBAImage({width:B,height:z},U),pixelRatio:p,stretchX:T,stretchY:A,content:M,sdf:y,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:z,data:U}=o,$=o;this.style.addImage(v,{data:new a.RGBAImage({width:B,height:z},new Uint8Array(U)),pixelRatio:p,stretchX:T,stretchY:A,content:M,sdf:y,version:0,userImage:$}),$.onAdd&&$.onAdd(this,v)}}}updateImage(v,o){const p=this.style.getImage(v);if(!p)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=o instanceof HTMLImageElement||a.isImageBitmap(o)?a.exported.getImageData(o):o,{width:T,height:A,data:M}=y;if(T===void 0||A===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==p.data.width||A!==p.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(o instanceof HTMLImageElement||a.isImageBitmap(o));p.data.replace(M,B),this.style.updateImage(v,p)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,o){a.getImage(this._requestManager.transformRequest(v,a.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(v,o){return this._lazyInitEmptyStyle(),this.style.addLayer(v,o),this._update(!0)}moveLayer(v,o){return this.style.moveLayer(v,o),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,o,p){return this.style.setLayerZoomRange(v,o,p),this._update(!0)}setFilter(v,o,p={}){return this.style.setFilter(v,o,p),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,o,p,y={}){return this.style.setPaintProperty(v,o,p,y),this._update(!0)}getPaintProperty(v,o){return this.style.getPaintProperty(v,o)}setLayoutProperty(v,o,p,y={}){return this.style.setLayoutProperty(v,o,p,y),this._update(!0)}getLayoutProperty(v,o){return this.style.getLayoutProperty(v,o)}setLight(v,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(v,o){return this.style.setFeatureState(v,o),this._update()}removeFeatureState(v,o){return this.style.removeFeatureState(v,o),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,o=0;return this._container&&(v=this._container.clientWidth||400,o=this._container.clientHeight||300),[v,o]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=I.create("div","maplibregl-canvas-container mapboxgl-canvas-container",v);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=I.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const p=this._containerDimensions();this._resizeCanvas(p[0],p[1],this.getPixelRatio());const y=this._controlContainer=I.create("div","maplibregl-control-container mapboxgl-control-container",v),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{T[A]=I.create("div",`maplibregl-ctrl-${A} mapboxgl-ctrl-${A}`,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const v=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=I.create("div","maplibregl-cooperative-gesture-screen",v);let o="Control",p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${p}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",y=>{y.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",y=>{y.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",y=>{this._onCooperativeGesture(y,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(v,o,p){this._canvas.width=p*v,this._canvas.height=p*o,this._canvas.style.width=`${v}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const v=a.extend({},_.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);o?(this.painter=new dh(o,this.transform),a.exported$1.testSupport(o)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(v,o,p){return!o&&p<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){let o,p=0;const y=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=y.createQueryEXT(),y.beginQueryEXT(y.TIME_ELAPSED_EXT,o),p=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,B=a.exported.now();this.style.zoomHistory.update(M,B);const z=new a.EvaluationParameters(M,{now:B,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=z.crossFadingFactor();U===1&&U===this._crossFadingFactor||(T=!0,this._crossFadingFactor=U),this.style.update(z)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const M=a.exported.now()-p;y.endQueryEXT(y.TIME_ELAPSED_EXT,o),setTimeout(()=>{const B=y.getQueryObjectEXT(o,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(o),this.fire(new a.Event("gpu-timing-frame",{cpuTime:M,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(M);this.fire(new a.Event("gpu-timing-layer",{layerTimes:B}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),I.remove(this._canvasContainer),I.remove(this._controlContainer),this._cooperativeGestures&&I.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(v=>{a.PerformanceUtils.frame(v),this._frame=null,this._render(v)}))}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}_setCacheLimits(v,o){a.setCacheLimits(v,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(v){this.options=a.extend({},Hi,v),this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),I.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),I.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=I.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map.getZoom(),o=v===this._map.getMaxZoom(),p=v===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const v=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=v}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){I.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,o){const p=I.create("button",v,this._container);return p.type="button",p.addEventListener("click",o),p}_setButtonTitle(v,o){const p=this._map._getUIString(`NavigationControl.${o}`);v.title=p,v.setAttribute("aria-label",p)}},GeolocateControl:class extends a.Evented{constructor(v){super(),this.options=a.extend({},Ac,v),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(v){var o;return this._map=v,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,qi!==void 0?o(qi):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(p=>{qi=p.state!=="denied",o(qi)}):(qi=!!window.navigator.geolocation,o(qi)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),I.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wi=0,Vn=!1}_isOutOfMapMaxBounds(v){const o=this._map.getMaxBounds(),p=v.coords;return o&&(p.longitude<o.getWest()||p.longitude>o.getEast()||p.latitude<o.getSouth()||p.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",v)),this._finish()}}_updateCamera(v){const o=new a.LngLat(v.coords.longitude,v.coords.latitude),p=v.coords.accuracy,y=this._map.getBearing(),T=a.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(p),T,{geolocateSource:!0})}_updateMarker(v){if(v){const o=new a.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map._container.clientHeight/2,o=this._map.unproject([0,v]),p=this._map.unproject([1,v]),y=o.distanceTo(p),T=Math.ceil(2*this._accuracy/y);this._circleElement.style.width=`${T}px`,this._circleElement.style.height=`${T}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&Vn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=I.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),I.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",v===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new wl(this._dotElement),this._circleElement=I.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wi--,Vn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wi++,Wi>1?(v={maximumAge:6e5,timeout:0},Vn=!0):(v=this.options.positionOptions,Vn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ra,LogoControl:Ga,ScaleControl:class{constructor(v){this.options=a.extend({},Gn,v),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Zs(this._map,this._container,this.options)}onAdd(v){return this._map=v,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){I.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(v){this.options.unit=v,Zs(this._map,this._container,this.options)}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=I.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){I.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=I.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);I.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(v){this.options=v,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(v){return this._map=v,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=I.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),I.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){I.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(v){super(),this.options=a.extend(Object.create(Ni),v),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&I.remove(this._content),this._container&&(I.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=a.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const o=document.createDocumentFragment(),p=document.createElement("body");let y;for(p.innerHTML=v;y=p.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=I.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){this._container&&this._container.classList.add(v)}removeClassName(v){this._container&&this._container.classList.remove(v)}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}_createCloseButton(){this.options.closeButton&&(this._closeButton=I.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(v){this._update(v.point)}_onMouseMove(v){this._update(v.point)}_onDrag(v){this._update(v.point)}_update(v){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=I.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=I.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(A=>this._container.classList.add(A)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$t(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!v))return;const o=this._pos=this._trackPointer&&v?v:this._map.project(this._lngLat);let p=this.options.anchor;const y=Uo(this.options.offset);if(!p){const A=this._container.offsetWidth,M=this._container.offsetHeight;let B;B=o.y+y.bottom.y<M?["top"]:o.y>this._map.transform.height-M?["bottom"]:[],o.x<A/2?B.push("left"):o.x>this._map.transform.width-A/2&&B.push("right"),p=B.length===0?"bottom":B.join("-")}const T=o.add(y[p]).round();I.setTransform(this._container,`${Gt[p]} translate(${T.x}px,${T.y}px)`),Xs(this._container,p,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Ka);v&&v.focus()}_onClose(){this.remove()}},Marker:wl,Style:rr,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:Ke,GeoJSONSource:Ye,ImageSource:Dt,RasterDEMTileSource:we,RasterTileSource:Le,VectorTileSource:Ve,VideoSource:X,prewarm:function(){xs().acquire(Sr)},clearPrewarmedResources:function(){const v=nr;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Sr),nr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return tr.workerCount},set workerCount(v){tr.workerCount=v},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){a.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){a.clearTileCache(v)},workerUrl:"",addProtocol(v,o){a.config.REGISTERED_PROTOCOLS[v]=o},removeProtocol(v){delete a.config.REGISTERED_PROTOCOLS[v]}};return ui.extend(Tl,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),Tl});var f=r;return f})}(a_)),a_.exports}var hA=uA();const fA=yx(hA),dA="modulepreload",pA=function(t){return"/wikidata-henry/"+t},Jv={},mA=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){let x=function(S){return Promise.all(S.map(R=>Promise.resolve(R).then(I=>({status:"fulfilled",value:I}),I=>({status:"rejected",reason:I}))))};var f=x;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),_=a?.nonce||a?.getAttribute("nonce");r=x(n.map(S=>{if(S=pA(S),S in Jv)return;Jv[S]=!0;const R=S.endsWith(".css"),I=R?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${I}`))return;const N=document.createElement("link");if(N.rel=R?"stylesheet":dA,R||(N.as="script"),N.crossOrigin="",N.href=S,_&&N.setAttribute("nonce",_),document.head.appendChild(N),R)return new Promise((L,H)=>{N.addEventListener("load",L),N.addEventListener("error",()=>H(new Error(`Unable to preload CSS for ${S}`)))})}))}function c(a){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=a,window.dispatchEvent(_),!_.defaultPrevented)throw a}return r.then(a=>{for(const _ of a||[])_.status==="rejected"&&c(_.reason);return e().catch(c)})},gA=St.createContext(null);function _A(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===c}function Uc(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Uc(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!Uc(t[r],e[r]))return!1;return!0}return!1}function yA(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function e0(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();Uc(n,i)||e.setProjection(n)}function t0(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function n0(t,e){const n=e.viewState||e;let i=!1;if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}if(n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),"longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}return i}const bA=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function i0(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const c=e[i.ref];if(c){r=r||Object.assign({},i),delete r.ref;for(const f of bA)f in c&&(r[f]=c[f])}return r||i});return{...t,layers:n}}var r0={};const s0={version:8,sources:{},layers:[]},a0={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Iy={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},o0={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},xA=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],vA=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Rd{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const c=this.props[o0[r.type]];c?c(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const c=this.props[a0[r.type]];c&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),c(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const c=this.props[Iy[r.type]];c&&c(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),c=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Rd.savedMaps.pop();if(!i)return null;const r=i.map,c=r.getContainer();for(n.className=c.className;c.childNodes.length>0;)n.appendChild(c.childNodes[0]);r._container=n;const f=r._resizeObserver;f&&(f.disconnect(),f.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:a}=e;return a&&(a.bounds?r.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):i._updateViewState(a,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=s0}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||wA()||null,container:e,style:i0(i)},c=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),n.gl){const S=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=S,n.gl)}const f=new this._MapClass(r);c.padding&&f.setPadding(c.padding),n.cursor&&(f.getCanvas().style.cursor=n.cursor),this._createShadowTransform(f);const a=f._render;f._render=S=>{this._inRender=!0,a.call(f,S),this._inRender=!1};const _=f._renderTaskQueue.run;f._renderTaskQueue.run=S=>{_.call(f._renderTaskQueue,S),this._onBeforeRepaint()},f.on("render",()=>this._onAfterRepaint());const x=f.fire;f.fire=this._fireEvent.bind(this,x),f.on("resize",()=>{this._renderTransform.resize(f.transform.width,f.transform.height)}),f.on("styledata",()=>{this._updateStyleComponents(this.props,{}),e0(f.transform,this._renderTransform)}),f.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const S in a0)f.on(S,this._onPointerEvent);for(const S in Iy)f.on(S,this._onCameraEvent);for(const S in o0)f.on(S,this._onEvent);this._map=f}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n?.remove(),Rd.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=yA(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:c,pitch:f,bearing:a}=r,_=i.isMoving();_&&(r.cameraElevationReference="sea");const x=n0(r,{...t0(i.transform),...e});if(_&&(r.cameraElevationReference="ground"),x&&n){const S=this._deferredEvents;S.move=!0,S.zoom||(S.zoom=c!==r.zoom),S.rotate||(S.rotate=a!==r.bearing),S.pitch||(S.pitch=f!==r.pitch)}return _||n0(i.transform,e),x}_updateSettings(e,n){const i=this._map;let r=!1;for(const c of xA)if(c in e&&!Uc(e[c],n[c])){r=!0;const f=i[`set${c[0].toUpperCase()}${c.slice(1)}`];f?.call(i,e[c])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=s0,styleDiffing:r=!0}=e,c={diff:r};return"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(i0(i),c),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Uc(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Uc(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Uc(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){var i,r;const c=this._map;let f=!1;for(const a of vA){const _=(i=e[a])!==null&&i!==void 0?i:!0,x=(r=n[a])!==null&&r!==void 0?r:!0;Uc(_,x)||(f=!0,_?c[a].enable(_):c[a].disable())}return f}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const c=e.type,f=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),_=a.length>0;!_&&f&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,_&&!f&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=c}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,c=r.transform,f=typeof n=="string"?n:n.type;return f==="move"&&this._updateViewState(this.props,!1),f in Iy&&(typeof n=="object"&&(n.viewState=t0(c)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=c,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{e0(this._renderTransform,n),e.transform=n}}}Rd.savedMaps=[];function wA(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||r0.MapboxAccessToken}catch{}try{t=t||r0.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const TA=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function SA(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const r=e.transform;e.transform=t.transform;const c=e.project(i);return e.transform=r,c},unproject:i=>{const r=e.transform;e.transform=t.transform;const c=e.unproject(i);return e.transform=r,c},queryTerrainElevation:(i,r)=>{const c=e.transform;e.transform=t.transform;const f=e.queryTerrainElevation(i,r);return e.transform=c,f},queryRenderedFeatures:(i,r)=>{const c=e.transform;e.transform=t.transform;const f=e.queryRenderedFeatures(i,r);return e.transform=c,f}};for(const i of EA(e))!(i in n)&&!TA.includes(i)&&(n[i]=e[i].bind(e));return n}function EA(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const AA=typeof document<"u"?St.useLayoutEffect:St.useEffect,CA=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function RA(t,e){for(const i of CA)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!0)}const j_=St.createContext(null);function kA(t,e,n){const i=St.useContext(gA),[r,c]=St.useState(null),f=St.useRef(),{current:a}=St.useRef({mapLib:null,map:null});St.useEffect(()=>{const S=t.mapLib;let R=!0,I;return Promise.resolve(S||n).then(N=>{if(!R)return;if(!N)throw new Error("Invalid mapLib");const L="Map"in N?N:N.default;if(!L.Map)throw new Error("Invalid mapLib");if(RA(L,t),!L.supported||L.supported(t))t.reuseMaps&&(I=Rd.reuse(t,f.current)),I||(I=new Rd(L.Map,t,f.current)),a.map=SA(I),a.mapLib=L,c(I),i?.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(N=>{const{onError:L}=t;L?L({type:"error",target:null,originalEvent:null,error:N}):console.error(N)}),()=>{R=!1,I&&(i?.onMapUnmount(t.id),t.reuseMaps?I.recycle():I.destroy())}},[]),AA(()=>{r&&r.setProps(t)}),St.useImperativeHandle(e,()=>a.map,[r]);const _=St.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),x={height:"100%"};return St.createElement("div",{id:t.id,ref:f,style:_},r&&St.createElement(j_.Provider,{value:a},St.createElement("div",{"mapboxgl-children":"",style:x},t.children)))}var a2=r2();const IA=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function mf(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!IA.test(i)?n[i]=`${r}px`:n[i]=r}}function MA(t,e){const{map:n,mapLib:i}=St.useContext(j_),r=St.useRef({props:t});r.current.props=t;const c=St.useMemo(()=>{let H=!1;St.Children.forEach(t.children,he=>{he&&(H=!0)});const ie={...t,element:H?document.createElement("div"):null},ne=new i.Marker(ie);return ne.setLngLat([t.longitude,t.latitude]),ne.getElement().addEventListener("click",he=>{var re,ge;(ge=(re=r.current.props).onClick)===null||ge===void 0||ge.call(re,{type:"click",target:ne,originalEvent:he})}),ne.on("dragstart",he=>{var re,ge;const _e=he;_e.lngLat=c.getLngLat(),(ge=(re=r.current.props).onDragStart)===null||ge===void 0||ge.call(re,_e)}),ne.on("drag",he=>{var re,ge;const _e=he;_e.lngLat=c.getLngLat(),(ge=(re=r.current.props).onDrag)===null||ge===void 0||ge.call(re,_e)}),ne.on("dragend",he=>{var re,ge;const _e=he;_e.lngLat=c.getLngLat(),(ge=(re=r.current.props).onDragEnd)===null||ge===void 0||ge.call(re,_e)}),ne},[]);St.useEffect(()=>(c.addTo(n.getMap()),()=>{c.remove()}),[]);const{longitude:f,latitude:a,offset:_,style:x,draggable:S=!1,popup:R=null,rotation:I=0,rotationAlignment:N="auto",pitchAlignment:L="auto"}=t;return St.useEffect(()=>{mf(c.getElement(),x)},[x]),St.useImperativeHandle(e,()=>c,[]),(c.getLngLat().lng!==f||c.getLngLat().lat!==a)&&c.setLngLat([f,a]),_&&!_A(c.getOffset(),_)&&c.setOffset(_),c.isDraggable()!==S&&c.setDraggable(S),c.getRotation()!==I&&c.setRotation(I),c.getRotationAlignment()!==N&&c.setRotationAlignment(N),c.getPitchAlignment()!==L&&c.setPitchAlignment(L),c.getPopup()!==R&&c.setPopup(R),a2.createPortal(t.children,c.getElement())}St.memo(St.forwardRef(MA));function l0(t){return new Set(t?t.trim().split(/\s+/):[])}function PA(t,e){const{map:n,mapLib:i}=St.useContext(j_),r=St.useMemo(()=>document.createElement("div"),[]),c=St.useRef({props:t});c.current.props=t;const f=St.useMemo(()=>{const a={...t},_=new i.Popup(a);return _.setLngLat([t.longitude,t.latitude]),_.once("open",x=>{var S,R;(R=(S=c.current.props).onOpen)===null||R===void 0||R.call(S,x)}),_},[]);if(St.useEffect(()=>{const a=_=>{var x,S;(S=(x=c.current.props).onClose)===null||S===void 0||S.call(x,_)};return f.on("close",a),f.setDOMContent(r).addTo(n.getMap()),()=>{f.off("close",a),f.isOpen()&&f.remove()}},[]),St.useEffect(()=>{mf(f.getElement(),t.style)},[t.style]),St.useImperativeHandle(e,()=>f,[]),f.isOpen()&&((f.getLngLat().lng!==t.longitude||f.getLngLat().lat!==t.latitude)&&f.setLngLat([t.longitude,t.latitude]),t.offset&&!Uc(f.options.offset,t.offset)&&f.setOffset(t.offset),(f.options.anchor!==t.anchor||f.options.maxWidth!==t.maxWidth)&&(f.options.anchor=t.anchor,f.setMaxWidth(t.maxWidth)),f.options.className!==t.className)){const a=l0(f.options.className),_=l0(t.className);for(const x of a)_.has(x)||f.removeClassName(x);for(const x of _)a.has(x)||f.addClassName(x);f.options.className=t.className}return a2.createPortal(t.children,r)}St.memo(St.forwardRef(PA));function Lm(t,e,n,i){const r=St.useContext(j_),c=St.useMemo(()=>t(r),[]);return St.useEffect(()=>{const f=e,a=null,_=typeof e=="function"?e:null,{map:x}=r;return x.hasControl(c)||(x.addControl(c,f?.position),a&&a(r)),()=>{_&&_(r),x.hasControl(c)&&x.removeControl(c)}},[]),c}function DA(t){const e=Lm(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return St.useEffect(()=>{mf(e._container,t.style)},[t.style]),null}St.memo(DA);function OA(t){const e=Lm(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return St.useEffect(()=>{mf(e._controlContainer,t.style)},[t.style]),null}St.memo(OA);function BA(t,e){const n=St.useRef({props:t}),i=Lm(({mapLib:r})=>{const c=new r.GeolocateControl(t),f=c._setupUI;return c._setupUI=a=>{c._container.hasChildNodes()||f(a)},c.on("geolocate",a=>{var _,x;(x=(_=n.current.props).onGeolocate)===null||x===void 0||x.call(_,a)}),c.on("error",a=>{var _,x;(x=(_=n.current.props).onError)===null||x===void 0||x.call(_,a)}),c.on("outofmaxbounds",a=>{var _,x;(x=(_=n.current.props).onOutOfMaxBounds)===null||x===void 0||x.call(_,a)}),c.on("trackuserlocationstart",a=>{var _,x;(x=(_=n.current.props).onTrackUserLocationStart)===null||x===void 0||x.call(_,a)}),c.on("trackuserlocationend",a=>{var _,x;(x=(_=n.current.props).onTrackUserLocationEnd)===null||x===void 0||x.call(_,a)}),c},{position:t.position});return n.current.props=t,St.useImperativeHandle(e,()=>i,[]),St.useEffect(()=>{mf(i._container,t.style)},[t.style]),null}St.memo(St.forwardRef(BA));function NA(t){const e=Lm(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return St.useEffect(()=>{mf(e._container,t.style)},[t.style]),null}St.memo(NA);function zA(t){const e=Lm(({mapLib:c})=>new c.ScaleControl(t),{position:t.position}),n=St.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),St.useEffect(()=>{mf(e._container,r)},[r]),null}St.memo(zA);const LA=mA(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl_false-DwML_u3w.js"),[]),FA=St.forwardRef(function(e,n){return kA(e,n,LA)});function m_(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const bx=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),c0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);c0&&parseFloat(c0[1]);const u0=globalThis,h0=globalThis.process||{},UA=globalThis.navigator||{};function o2(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function gf(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||o2()}function VA(t){return gf()?o2()?"Electron":(UA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const l2="4.1.0";function jA(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class $A{constructor(e,n,i="sessionStorage"){this.storage=jA(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function HA(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function qA(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var g_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(g_||(g_={}));const WA=10;function f0(t){return typeof t!="string"?t:(t=t.toUpperCase(),g_[t]||g_.WHITE)}function XA(t,e,n){return!gf&&typeof t=="string"&&(e&&(t=`\x1B[${f0(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${f0(n)+WA}m${t}\x1B[49m`)),t}function ZA(t,e=["constructor"]){const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const c of i){const f=r[c];typeof f=="function"&&(e.find(a=>c===a)||(r[c]=f.bind(t)))}}function xx(t,e){if(!t)throw new Error("Assertion failed")}function ld(){let t;if(gf()&&u0.performance)t=u0?.performance?.now?.();else if("hrtime"in h0){const e=h0?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const cd={debug:gf()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},YA={enabled:!0,level:0};function ud(){}const d0={},p0={once:!0};class Fm{constructor({id:e}={id:""}){this.VERSION=l2,this._startTs=ld(),this._deltaTs=ld(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new $A(`__probe-${this.id}__`,YA),this.timeStamp(`${this.id} started`),ZA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ld()-this._startTs).toPrecision(10))}getDelta(){return Number((ld()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,cd.warn,arguments,p0)}error(e){return this._getLogFunction(0,e,cd.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,cd.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,cd.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,cd.debug||cd.info,arguments,p0)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ud,i&&[i],{tag:KA(n)}):ud}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ud)}group(e,n,i={collapsed:!1}){const r=m0({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return r.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n,i={}){return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ud)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=c2(e)}_getLogFunction(e,n,i,r,c){if(this._shouldLog(e)){c=m0({logLevel:e,message:n,args:r,opts:c}),i=i||c.method,xx(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=ld();const f=c.tag||c.message;if(c.once&&f)if(!d0[f])d0[f]=ld();else return ud;return n=GA(this.id,c.message,c),i.bind(console,n,...c.args)}return ud}}Fm.VERSION=l2;function c2(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return xx(Number.isFinite(e)&&e>=0),e}function m0(t){const{logLevel:e,message:n}=t;t.logLevel=c2(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return xx(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function GA(t,e,n){if(typeof e=="string"){const i=n.time?qA(HA(n.total)):"";e=n.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=XA(e,n.color,n.background)}return e}function KA(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const My="4.3.3",QA=My[0]>="0"&&My[0]<="9"?`v${My}`:"";function JA(){const t=new Fm({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=QA,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const e3=JA();function t3(t,e){return u2(t||{},e)}function u2(t,e,n=0){if(n>3)return e;const i={...t};for(const[r,c]of Object.entries(e))c&&typeof c=="object"&&!Array.isArray(c)?i[r]=u2(i[r]||{},e[r],n+1):i[r]=e[r];return i}const n3="latest";function i3(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const r3=i3();function Ku(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const af=typeof process!="object"||String(process)!=="[object process]"||process.browser,s3=typeof window<"u"&&typeof window.orientation<"u",g0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);g0&&parseFloat(g0[1]);class a3{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,n){this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Ku(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ku(this.isRunning),this.isRunning=!1,this._reject(e)}}class Py{terminate(){}}const Dy=new Map;function o3(t){Ku(t.source&&!t.url||!t.source&&t.url);let e=Dy.get(t.source||t.url);return e||(t.url&&(e=l3(t.url),Dy.set(t.url,e)),t.source&&(e=h2(t.source),Dy.set(t.source,e))),Ku(e),e}function l3(t){if(!t.startsWith("http"))return t;const e=c3(t);return h2(e)}function h2(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function c3(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function f2(t,e=!0,n){const i=n||new Set;if(t){if(_0(t))i.add(t);else if(_0(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)f2(t[r],e,i)}}return n===void 0?Array.from(i):[]}function _0(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Oy=()=>{};class Cb{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&af||typeof Py<"u"&&!af}constructor(e){const{name:n,source:i,url:r}=e;Ku(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Oy,this.onError=c=>console.log(c),this.worker=af?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Oy,this.onError=Oy,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||f2(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=o3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Py(i,{eval:!1})}else if(this.source)e=new Py(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class u3{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Cb.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,c,f)=>r.done(f),i=(r,c)=>r.error(c)){const r=new Promise(c=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:c}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new a3(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!af||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Cb({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return s3?this.maxMobileConcurrency:this.maxConcurrency}}const h3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class qu{props;workerPools=new Map;static _workerFarm;static isSupported(){return Cb.isSupported()}static getWorkerFarm(e={}){return qu._workerFarm=qu._workerFarm||new qu({}),qu._workerFarm.setProps(e),qu._workerFarm}constructor(e){this.props={...h3},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let c=this.workerPools.get(n);return c||(c=new u3({name:n,source:i,url:r}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function f3(t,e={}){const n=e[t.id]||{},i=af?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(af?r=`modules/${t.module}/dist/${i}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let c=t.version;c==="latest"&&(c=n3);const f=c?`@${c}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${f}/dist/${i}`}return Ku(r),r}function d3(t,e=r3){Ku(t,"no worker provided");const n=t.version;return!(!e||!n)}function p3(t,e){return!qu.isSupported()||!af&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function m3(t,e,n,i,r){const c=t.id,f=f3(t,n),_=qu.getWorkerFarm(n).getWorkerPool({name:c,url:f});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const x=await _.startJob("process-on-worker",g3.bind(null,r));return x.postMessage("process",{input:e,options:n,context:i}),await(await x.result).result}async function g3(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:c,options:f}=i;try{const a=await t(c,f);e.postMessage("done",{id:r,result:a})}catch(a){const _=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:_})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function _3(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let c=0;c<i.length;++c)if(i[c]!==r[c])return!1;return!0}function y3(...t){return b3(t)}function b3(t){const e=t.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),n=e.reduce((c,f)=>c+f.byteLength,0),i=new Uint8Array(n);let r=0;for(const c of e)i.set(c,r),r+=c.byteLength;return i.buffer}async function x3(t){const e=[];for await(const n of t)e.push(n);return y3(...e)}function y0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class b0{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=y0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(y0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class $_{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof b0?r=e:r=new b0(n,i),this.stats[n]=r),r}}let v3="";const x0={};function w3(t){for(const e in x0)if(t.startsWith(e)){const n=x0[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${v3}${t}`),t}function T3(t){return t&&typeof t=="object"&&t.isBuffer}function d2(t){if(T3(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function p2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function S3(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const E3=t=>typeof t=="boolean",xm=t=>typeof t=="function",Um=t=>t!==null&&typeof t=="object",v0=t=>Um(t)&&t.constructor==={}.constructor,A3=t=>!!t&&typeof t[Symbol.iterator]=="function",C3=t=>t&&typeof t[Symbol.asyncIterator]=="function",_f=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,yf=t=>typeof Blob<"u"&&t instanceof Blob,R3=t=>t&&typeof t=="object"&&t.isBuffer,k3=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Um(t)&&xm(t.tee)&&xm(t.cancel)&&xm(t.getReader),I3=t=>Um(t)&&xm(t.read)&&xm(t.pipe)&&E3(t.readable),m2=t=>k3(t)||I3(t);class M3 extends Error{constructor(e,n){super(e),this.reason=n.reason,this.url=n.url,this.response=n.response}reason;url;response}const P3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,D3=/^([-\w.]+\/[-\w.+]+)/;function w0(t,e){return t.toLowerCase()===e.toLowerCase()}function O3(t){const e=D3.exec(t);return e?e[1]:t}function T0(t){const e=P3.exec(t);return e?e[1]:""}const g2=/\?.*/;function B3(t){const e=t.match(g2);return e&&e[0]}function vx(t){return t.replace(g2,"")}function N3(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function H_(t){return _f(t)?t.url:yf(t)?t.name||"":typeof t=="string"?t:""}function wx(t){if(_f(t)){const e=t,n=e.headers.get("content-type")||"",i=vx(e.url);return O3(n)||T0(i)}return yf(t)?t.type||"":typeof t=="string"?T0(t):""}function z3(t){return _f(t)?t.headers["content-length"]||-1:yf(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function _2(t){if(_f(t))return t;const e={},n=z3(t);n>=0&&(e["content-length"]=String(n));const i=H_(t),r=wx(t);r&&(e["content-type"]=r);const c=await U3(t);c&&(e["x-first-bytes"]=c),typeof t=="string"&&(t=new TextEncoder().encode(t));const f=new Response(t,{headers:e});return Object.defineProperty(f,"url",{value:i}),f}async function L3(t){if(!t.ok)throw await F3(t)}async function F3(t){const e=N3(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&r?.includes("application/json")?await t.json():await t.text()}catch{}return new M3(n,i)}async function U3(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=c=>i(c?.target?.result),r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${V3(n)}`}return null}function V3(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}function j3(t){return!$3(t)&&!H3(t)}function $3(t){return t.startsWith("http:")||t.startsWith("https:")}function H3(t){return t.startsWith("data:")}async function S0(t,e){if(typeof t=="string"){const n=w3(t);return j3(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,e):await fetch(n,e)}return await _2(t)}const E0=new Fm({id:"loaders.gl"});class q3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class W3{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const y2={fetch:null,mimeType:void 0,nothrow:!1,log:new W3,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:bx,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},X3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function b2(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function x2(){const t=b2();return t.globalOptions=t.globalOptions||{...y2},t.globalOptions}function Z3(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],Y3(t,n),K3(e,t,i)}function Y3(t,e){A0(t,null,y2,X3,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},c=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};A0(i,n.id,r,c,e)}}function A0(t,e,n,i,r){const c=e||"Top level",f=e?`${e}.`:"";for(const a in t){const _=!e&&Um(t[a]),x=a==="baseUri"&&!e,S=a==="workerUrl"&&e;if(!(a in n)&&!x&&!S){if(a in i)E0.warn(`${c} loader option '${f}${a}' no longer supported, use '${i[a]}'`)();else if(!_){const R=G3(a,r);E0.warn(`${c} loader option '${f}${a}' not recognized. ${R}`)()}}}}function G3(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const c in r.options){if(t===c)return`Did you mean '${r.id}.${c}'?`;const f=c.toLowerCase();(n.startsWith(f)||f.startsWith(n))&&(i=i||`Did you mean '${r.id}.${c}'?`)}return i}function K3(t,e,n){const r={...t.options||{}};return Q3(r,n),r.log===null&&(r.log=new q3),C0(r,x2()),C0(r,e),r}function C0(t,e){for(const n in e)if(n in e){const i=e[n];v0(i)&&v0(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function Q3(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Tx(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function Sx(t){m_(t,"null loader"),m_(Tx(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const v2=()=>{const t=b2();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function J3(t){const e=v2();t=Array.isArray(t)?t:[t];for(const n of t){const i=Sx(n);e.find(r=>i===r)||e.unshift(i)}}function eC(){return v2()}const tC=/\.([^.]+)$/;async function nC(t,e=[],n,i){if(!w2(t))return null;let r=R0(t,e,{...n,nothrow:!0},i);if(r)return r;if(yf(t)&&(t=await t.slice(0,10).arrayBuffer(),r=R0(t,e,n,i)),!r&&!n?.nothrow)throw new Error(T2(t));return r}function R0(t,e=[],n,i){if(!w2(t))return null;if(e&&!Array.isArray(e))return Sx(e);let r=[];e&&(r=r.concat(e)),n?.ignoreRegisteredLoaders||r.push(...eC()),rC(r);const c=iC(t,r,n,i);if(!c&&!n?.nothrow)throw new Error(T2(t));return c}function iC(t,e,n,i){const r=H_(t),c=wx(t),f=vx(r)||i?.url;let a=null,_="";return n?.mimeType&&(a=By(e,n?.mimeType),_=`match forced by supplied MIME type ${n?.mimeType}`),a=a||sC(e,f),_=_||(a?`matched url ${f}`:""),a=a||By(e,c),_=_||(a?`matched MIME type ${c}`:""),a=a||oC(e,t),_=_||(a?`matched initial data ${S2(t)}`:""),n?.fallbackMimeType&&(a=a||By(e,n?.fallbackMimeType),_=_||(a?`matched fallback MIME type ${c}`:"")),_&&e3.log(1,`selectLoader selected ${a?.name}: ${_}.`),a}function w2(t){return!(t instanceof Response&&t.status===204)}function T2(t){const e=H_(t),n=wx(t);let i="No valid loader found (";i+=e?`${p2(e)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=t?S2(t):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function rC(t){for(const e of t)Sx(e)}function sC(t,e){const n=e&&tC.exec(e),i=n&&n[1];return i?aC(t,i):null}function aC(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function By(t,e){for(const n of t)if(n.mimeTypes?.some(i=>w0(e,i))||w0(e,`application/x.${n.id}`))return n;return null}function oC(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(lC(e,n))return n}else if(ArrayBuffer.isView(e)){if(k0(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&k0(e,0,n))return n;return null}function lC(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function k0(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>cC(t,e,n,r))}function cC(t,e,n,i){if(i instanceof ArrayBuffer)return _3(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const r=Rb(t,e,i.length);return i===r;default:return!1}}function S2(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Rb(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Rb(t,0,e):""}function Rb(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let c=0;c<n;c++)r+=String.fromCharCode(i.getUint8(e+c));return r}const uC=256*1024;function*hC(t,e){const n=e?.chunkSize||uC;let i=0;const r=new TextEncoder;for(;i<t.length;){const c=Math.min(t.length-i,n),f=t.slice(i,i+c);i+=c,yield r.encode(f)}}const fC=256*1024;function*dC(t,e={}){const{chunkSize:n=fC}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),c=new ArrayBuffer(r),f=new Uint8Array(t,i,r);new Uint8Array(c).set(f),i+=r,yield c}}const pC=1024*1024;async function*mC(t,e){const n=e?.chunkSize||pC;let i=0;for(;i<t.size;){const r=i+n,c=await t.slice(i,r).arrayBuffer();i=r,yield c}}function I0(t,e){return bx?gC(t,e):_C(t)}async function*gC(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e?._streamReadAhead&&(i=n.read());const{done:c,value:f}=await r;if(c)return;yield d2(f)}}catch{n.releaseLock()}}async function*_C(t,e){for await(const n of t)yield d2(n)}function yC(t,e){if(typeof t=="string")return hC(t,e);if(t instanceof ArrayBuffer)return dC(t,e);if(yf(t))return mC(t,e);if(m2(t))return I0(t,e);if(_f(t))return I0(t.body,e);throw new Error("makeIterator")}const E2="Cannot convert supplied data type";function bC(t,e,n){if(e.text&&typeof t=="string")return t;if(R3(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(E2)}async function xC(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return bC(t,e);if(yf(t)&&(t=await _2(t)),_f(t)){const r=t;return await L3(r),e.binary?await r.arrayBuffer():await r.text()}if(m2(t)&&(t=yC(t,n)),A3(t)||C3(t))return x3(t);throw new Error(E2)}function A2(t,e){const n=x2(),i=t||n;return typeof i.fetch=="function"?i.fetch:Um(i.fetch)?r=>S0(r,i.fetch):e?.fetch?e?.fetch:S0}function vC(t,e,n){if(n)return n;const i={fetch:A2(e,t),...t};if(i.url){const r=vx(i.url);i.baseUrl=r,i.queryString=B3(i.url),i.filename=p2(r),i.baseUrl=S3(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function wC(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:void 0}async function __(t,e,n,i){e&&!Array.isArray(e)&&!Tx(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=H_(t),f=wC(e,i),a=await nC(t,f,n);return a?(n=Z3(n,a,f,r),i=vC({url:r,_parse:__,loaders:f},n,i||null),await TC(a,t,n,i)):null}async function TC(t,e,n,i){if(d3(t),n=t3(t.options,n),_f(e)){const c=e,{ok:f,redirected:a,status:_,statusText:x,type:S,url:R}=c,I=Object.fromEntries(c.headers.entries());i.response={headers:I,ok:f,redirected:a,status:_,statusText:x,type:S,url:R}}e=await xC(e,t,n);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,n,i);if(p3(t,n))return await m3(t,e,n,i,__);if(r.parseText&&typeof e=="string")return await r.parseText(e,n,i);if(r.parse)return await r.parse(e,n,i);throw Ku(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function kb(t,e,n,i){let r,c;!Array.isArray(e)&&!Tx(e)?(r=[],c=e):(r=e,c=n);const f=A2(c);let a=t;return typeof t=="string"&&(a=await f(t)),yf(t)&&(a=await f(t)),Array.isArray(r)?await __(a,r,c):await __(a,r,c)}const SC="4.3.3",EC=globalThis.loaders?.parseImageNode,Ib=typeof Image<"u",Mb=typeof ImageBitmap<"u",AC=!!EC,Pb=bx?!0:AC;function CC(t){switch(t){case"auto":return Mb||Ib||Pb;case"imagebitmap":return Mb;case"image":return Ib;case"data":return Pb;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function RC(){if(Mb)return"imagebitmap";if(Ib)return"image";if(Pb)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function kC(t){const e=MC(t);if(!e)throw new Error("Not an image");return e}function IC(t){switch(kC(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function MC(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const PC=/^data:image\/svg\+xml/,DC=/\.svg((\?|#).*)?$/;function Ex(t){return t&&(PC.test(t)||DC.test(t))}function OC(t,e){if(Ex(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(c){throw new Error(c.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return C2(t,e)}function C2(t,e){if(Ex(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function R2(t,e,n){const i=OC(t,n),r=self.URL||self.webkitURL,c=typeof i!="string"&&r.createObjectURL(i);try{return await BC(c||i,e)}finally{c&&r.revokeObjectURL(c)}}async function BC(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=c=>{const f=c instanceof Error?c.message:"error";r(new Error(f))}}catch(c){r(c)}})}const NC={};let M0=!0;async function zC(t,e,n){let i;Ex(n)?i=await R2(t,e,n):i=C2(t,n);const r=e&&e.imagebitmap;return await LC(i,r)}async function LC(t,e=null){if((FC(e)||!M0)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),M0=!1}return await createImageBitmap(t)}function FC(t){for(const e in t||NC)return!1;return!0}function UC(t){return!HC(t,"ftyp",4)||(t[8]&96)===0?null:VC(t)}function VC(t){switch(jC(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function jC(t,e,n){return String.fromCharCode(...t.slice(e,n))}function $C(t){return[...t].map(e=>e.charCodeAt(0))}function HC(t,e,n=0){const i=$C(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const Ql=!1,vm=!0;function k2(t){const e=Vm(t);return WC(e)||YC(e)||XC(e)||ZC(e)||qC(e)}function qC(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=UC(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function WC(t){const e=Vm(t);return e.byteLength>=24&&e.getUint32(0,Ql)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ql),height:e.getUint32(20,Ql)}:null}function XC(t){const e=Vm(t);return e.byteLength>=10&&e.getUint32(0,Ql)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,vm),height:e.getUint16(8,vm)}:null}function ZC(t){const e=Vm(t);return e.byteLength>=14&&e.getUint16(0,Ql)===16973&&e.getUint32(2,vm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,vm),height:e.getUint32(22,vm)}:null}function YC(t){const e=Vm(t);if(!(e.byteLength>=3&&e.getUint16(0,Ql)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=GC();let c=2;for(;c+9<e.byteLength;){const f=e.getUint16(c,Ql);if(r.has(f))return{mimeType:"image/jpeg",height:e.getUint16(c+5,Ql),width:e.getUint16(c+7,Ql)};if(!i.has(f))return null;c+=2,c+=e.getUint16(c,Ql)}return null}function GC(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Vm(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function KC(t,e){const{mimeType:n}=k2(t)||{},i=globalThis.loaders?.parseImageNode;return m_(i),await i(t,n)}async function QC(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:c}=n||{},f=JC(r);let a;switch(f){case"imagebitmap":a=await zC(t,e,c);break;case"image":a=await R2(t,e,c);break;case"data":a=await KC(t);break;default:m_(!1)}return r==="data"&&(a=IC(a)),a}function JC(t){switch(t){case"auto":case"data":return RC();default:return CC(t),t}}const eR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],tR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],nR={image:{type:"auto",decode:!0}},iR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:SC,mimeTypes:tR,extensions:eR,parse:QC,tests:[t=>!!k2(new DataView(t))],options:nR},ji=new Fm({id:"deck"});let Db={};function rR(t){Db=t}function ta(t,e,n,i){ji.level>0&&Db[t]&&Db[t].call(null,e,n,i)}function sR(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const aR={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:sR,parseTextSync:JSON.parse};function oR(){const t="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ji.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ji,_registerLoggers:rR},J3([aR,[iR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const lR=oR();function Ax(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Ny={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function cR(t){const e={};for(const[n,i]of Object.entries(t))e[n]=uR(i);return e}function uR(t){let e=P0(t);if(e!=="object")return{value:t,...Ny[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Ny[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=P0(t.value),{...t,...Ny[e],type:e}):{type:"object",value:null};throw new Error("props")}function P0(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const hR=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fR=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,dR={vertex:hR,fragment:fR},D0=/void\s+main\s*\([^)]*\)\s*\{\n?/,O0=/}\n?[^{}]*$/,zy=[],o_="__LUMA_INJECT_DECLARATIONS__";function pR(t){const e={vertex:{},fragment:{}};for(const n in t){let i=t[n];const r=mR(n);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function mR(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function y_(t,e,n,i=!1){const r=e==="vertex";for(const c in n){const f=n[c];f.sort((_,x)=>_.order-x.order),zy.length=f.length;for(let _=0,x=f.length;_<x;++_)zy[_]=f[_].injection;const a=`${zy.join(`
`)}
`;switch(c){case"vs:#decl":r&&(t=t.replace(o_,a));break;case"vs:#main-start":r&&(t=t.replace(D0,_=>_+a));break;case"vs:#main-end":r&&(t=t.replace(O0,_=>a+_));break;case"fs:#decl":r||(t=t.replace(o_,a));break;case"fs:#main-start":r||(t=t.replace(D0,_=>_+a));break;case"fs:#main-end":r||(t=t.replace(O0,_=>a+_));break;default:t=t.replace(c,_=>_+a)}}return t=t.replace(o_,""),i&&(t=t.replace(/\}\s*$/,c=>c+dR[e])),t}function b_(t){t.map(e=>gR(e))}function gR(t){if(t.instance)return;b_(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:i={}}=t,r={normalizedInjections:pR(i),parsedDeprecations:_R(n)};e&&(r.propValidators=cR(e)),t.instance=r;let c={};e&&(c=Object.entries(e).reduce((f,[a,_])=>{const x=_?.value;return x&&(f[a]=x),f},{})),t.defaultUniforms={...t.defaultUniforms,...c}}function I2(t,e,n){t.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function _R(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function Cx(t){b_(t);const e={},n={};M2({modules:t,level:0,moduleMap:e,moduleDepth:n});const i=Object.keys(n).sort((r,c)=>n[c]-n[r]).map(r=>e[r]);return b_(i),i}function M2(t){const{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)i[c.name]=c,(r[c.name]===void 0||r[c.name]<n)&&(r[c.name]=n);for(const c of e)c.dependencies&&M2({modules:c.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function yR(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function bR(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=B0(t,xR),t;case"fragment":return t=B0(t,vR),t;default:throw new Error(e)}}const P2=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],xR=[...P2,[Ob("attribute"),"in $1"],[Ob("varying"),"out $1"]],vR=[...P2,[Ob("varying"),"in $1"]];function B0(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function Ob(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function D2(t,e){let n="";for(const i in t){const r=t[i];if(n+=`void ${r.signature} {
`,r.header&&(n+=`  ${r.header}`),e[i]){const c=e[i];c.sort((f,a)=>f.order-a.order);for(const f of c)n+=`  ${f.injection}
`}r.footer&&(n+=`  ${r.footer}`),n+=`}
`}return n}function O2(t){const e={vertex:{},fragment:{}};for(const n of t){let i,r;typeof n!="string"?(i=n,r=i.hook):(i={},r=n),r=r.trim();const[c,f]=r.split(":"),a=r.replace(/\(.+/,""),_=Object.assign(i,{signature:f});switch(c){case"vs":e.vertex[a]=_;break;case"fs":e.fragment[a]=_;break;default:throw new Error(c)}}return e}function wR(t,e){return{name:TR(t,e),language:"glsl",version:SR(t)}}function TR(t,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function SR(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const B2=`

${o_}
`,ER=`precision highp float;
`;function AR(t){const e=Cx(t.modules||[]);return{source:RR(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:N2(e)}}function CR(t){const{vs:e,fs:n}=t,i=Cx(t.modules||[]);return{vs:N0(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:N0(t.platformInfo,{...t,source:n,stage:"fragment",modules:i}),getUniforms:N2(i)}}function RR(t,e){const{source:n,stage:i,modules:r,hookFunctions:c=[],inject:f={},log:a}=e;Ax(typeof n=="string","shader source must be a string");const _=n;let x="";const S=O2(c),R={},I={},N={};for(const H in f){const ie=typeof f[H]=="string"?{injection:f[H],order:0}:f[H],ne=/^(v|f)s:(#)?([\w-]+)$/.exec(H);if(ne){const he=ne[2],re=ne[3];he?re==="decl"?I[H]=[ie]:N[H]=[ie]:R[H]=[ie]}else N[H]=[ie]}const L=r;for(const H of L){a&&I2(H,_,a);const ie=z2(H,"wgsl");x+=ie;const ne=H.injections?.[i]||{};for(const he in ne){const re=/^(v|f)s:#([\w-]+)$/.exec(he);if(re){const _e=re[2]==="decl"?I:N;_e[he]=_e[he]||[],_e[he].push(ne[he])}else R[he]=R[he]||[],R[he].push(ne[he])}}return x+=B2,x=y_(x,i,I),x+=D2(S[i],R),x+=_,x=y_(x,i,N),x}function N0(t,e){const{id:n,source:i,stage:r,language:c="glsl",modules:f,defines:a={},hookFunctions:_=[],inject:x={},prologue:S=!0,log:R}=e;Ax(typeof i=="string","shader source must be a string");const I=c==="glsl"?wR(i).version:-1,N=t.shaderLanguageVersion,L=I===100?"#version 100":"#version 300 es",ie=i.split(`
`).slice(1).join(`
`),ne={};f.forEach(it=>{Object.assign(ne,it.defines)}),Object.assign(ne,a);let he="";switch(c){case"wgsl":break;case"glsl":he=S?`${L}

// ----- PROLOGUE -------------------------
${kR({id:n,source:i,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${yR(t)}
${r==="fragment"?ER:""}

// ----- APPLICATION DEFINES -------------------------

${IR(ne)}

`:`${L}
`;break}const re=O2(_),ge={},_e={},pe={};for(const it in x){const mt=typeof x[it]=="string"?{injection:x[it],order:0}:x[it],nt=/^(v|f)s:(#)?([\w-]+)$/.exec(it);if(nt){const Ce=nt[2],ht=nt[3];Ce?ht==="decl"?_e[it]=[mt]:pe[it]=[mt]:ge[it]=[mt]}else pe[it]=[mt]}for(const it of f){R&&I2(it,ie,R);const mt=z2(it,r);he+=mt;const nt=it.instance?.normalizedInjections[r]||{};for(const Ce in nt){const ht=/^(v|f)s:#([\w-]+)$/.exec(Ce);if(ht){const Ve=ht[2]==="decl"?_e:pe;Ve[Ce]=Ve[Ce]||[],Ve[Ce].push(nt[Ce])}else ge[Ce]=ge[Ce]||[],ge[Ce].push(nt[Ce])}}return he+="// ----- MAIN SHADER SOURCE -------------------------",he+=B2,he=y_(he,r,_e),he+=D2(re[r],ge),he+=ie,he=y_(he,r,pe),c==="glsl"&&I!==N&&(he=bR(he,r)),he.trim()}function N2(t){return function(n){const i={};for(const r of t){const c=r.getUniforms?.(n,i);Object.assign(i,c)}return i}}function kR(t){const{id:e,source:n,stage:i}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function IR(t={}){let e="";for(const n in t){const i=t[n];(i||Number.isFinite(i))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function z2(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:Ax(!1)}if(!t.name)throw new Error("Shader module must have a name");const i=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(r+=`#define MODULE_${i}
`),r+=`${n}
`,r}const MR=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,PR=/^\s*\#\s*endif\s*$/;function DR(t,e){const n=t.split(`
`),i=[];let r=!0,c=null;for(const f of n){const a=f.match(MR),_=f.match(PR);a?(c=a[1],r=!!e?.defines?.[c]):_?r=!0:r&&i.push(f)}return i.join(`
`)}class rf{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return rf.defaultShaderAssembler=rf.defaultShaderAssembler||new rf,rf.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),i=this._hookFunctions,{source:r,getUniforms:c}=AR({...e,source:e.source,modules:n,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?DR(r):r,getUniforms:c,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),i=this._hookFunctions;return{...CR({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:i}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let c=0,f=this._defaultModules.length;c<f;++c){const a=this._defaultModules[c],_=a.name;n[r++]=a,i[_]=!0}for(let c=0,f=e.length;c<f;++c){const a=e[c],_=a.name;i[_]||(n[r++]=a,i[_]=!0)}return n.length=r,b_(n),n}}const OR=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,BR=`#version 300 es
${OR}`;function NR(t){const{input:e,inputChannels:n,output:i}={};if(!e)return BR;if(!n)throw new Error("inputChannels");const r=zR(n),c=LR(e,n);return`#version 300 es
in ${r} ${e};
out vec4 ${i};
void main() {
  ${i} = ${c};
}`}function zR(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function LR(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class FR{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new $_({id:e})),this.stats.get(e)}}const L2=new FR,At=new Fm({id:"luma.gl"}),Ly={};function q_(t="id"){Ly[t]=Ly[t]||1;const e=Ly[t]++;return`${t}-${e}`}let ki=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,n,i){if(!e)throw new Error("no device");this._device=e,this.props=UR(n,i);const r=this.props.id!=="undefined"?this.props.id:q_(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}};function UR(t,e){const n={...e};for(const i in t)t[i]!==void 0&&(n[i]=t[i]);return n}class $i extends ki{static defaultProps={...ki.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,n){const i={...n};(n.usage||0)&$i.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,$i.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,n){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,n,i){const r=ArrayBuffer.isView(e)?e.buffer:e,c=Math.min(e?e.byteLength:i,$i.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(c):n===0&&i===r.byteLength?this.debugData=r.slice(0,c):this.debugData=r.slice(n,n+c)}}function F2(t){const e=z0[t],n=VR(e),i=t.includes("norm"),r=!i&&!t.startsWith("float"),c=t.startsWith("s");return{dataType:z0[t],byteLength:n,integer:r,signed:c,normalized:i}}function VR(t){return jR[t]}const z0={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},jR={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},zs="texture-compression-bc",Ci="texture-compression-astc",Zl="texture-compression-etc2",$R="texture-compression-etc1-webgl",jg="texture-compression-pvrtc-webgl",Fy="texture-compression-atc-webgl",$g="float32-renderable-webgl",Uy="float16-renderable-webgl",HR="rgb9e5ufloat-renderable-webgl",Vy="snorm8-renderable-webgl",rm="norm16-renderable-webgl",jy="snorm16-renderable-webgl",Hg="float32-filterable",L0="float16-filterable-webgl";function U2(t){const e=qR[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const qR={r8unorm:{},r8snorm:{render:Vy},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Vy},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Uy,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:rm},"r16snorm-webgl":{f:jy},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Vy},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Uy,filter:L0},"rg16unorm-webgl":{render:rm},"rg16snorm-webgl":{render:jy},r32uint:{},r32sint:{},r32float:{render:$g,filter:Hg},rgb9e5ufloat:{channels:"rgb",packed:!0,render:HR},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:$g},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:rm},"rgb16snorm-webgl":{f:rm},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Hg},rgba16uint:{},rgba16sint:{},rgba16float:{render:Uy,filter:L0},"rgba16unorm-webgl":{render:rm},"rgba16snorm-webgl":{render:jy},"rgb32float-webgl":{render:$g,filter:Hg},rgba32uint:{},rgba32sint:{},rgba32float:{render:$g,filter:Hg},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:zs},"bc1-rgb-unorm-srgb-webgl":{f:zs},"bc1-rgba-unorm":{f:zs},"bc1-rgba-unorm-srgb":{f:zs},"bc2-rgba-unorm":{f:zs},"bc2-rgba-unorm-srgb":{f:zs},"bc3-rgba-unorm":{f:zs},"bc3-rgba-unorm-srgb":{f:zs},"bc4-r-unorm":{f:zs},"bc4-r-snorm":{f:zs},"bc5-rg-unorm":{f:zs},"bc5-rg-snorm":{f:zs},"bc6h-rgb-ufloat":{f:zs},"bc6h-rgb-float":{f:zs},"bc7-rgba-unorm":{f:zs},"bc7-rgba-unorm-srgb":{f:zs},"etc2-rgb8unorm":{f:Zl},"etc2-rgb8unorm-srgb":{f:Zl},"etc2-rgb8a1unorm":{f:Zl},"etc2-rgb8a1unorm-srgb":{f:Zl},"etc2-rgba8unorm":{f:Zl},"etc2-rgba8unorm-srgb":{f:Zl},"eac-r11unorm":{f:Zl},"eac-r11snorm":{f:Zl},"eac-rg11unorm":{f:Zl},"eac-rg11snorm":{f:Zl},"astc-4x4-unorm":{f:Ci},"astc-4x4-unorm-srgb":{f:Ci},"astc-5x4-unorm":{f:Ci},"astc-5x4-unorm-srgb":{f:Ci},"astc-5x5-unorm":{f:Ci},"astc-5x5-unorm-srgb":{f:Ci},"astc-6x5-unorm":{f:Ci},"astc-6x5-unorm-srgb":{f:Ci},"astc-6x6-unorm":{f:Ci},"astc-6x6-unorm-srgb":{f:Ci},"astc-8x5-unorm":{f:Ci},"astc-8x5-unorm-srgb":{f:Ci},"astc-8x6-unorm":{f:Ci},"astc-8x6-unorm-srgb":{f:Ci},"astc-8x8-unorm":{f:Ci},"astc-8x8-unorm-srgb":{f:Ci},"astc-10x5-unorm":{f:Ci},"astc-10x5-unorm-srgb":{f:Ci},"astc-10x6-unorm":{f:Ci},"astc-10x6-unorm-srgb":{f:Ci},"astc-10x8-unorm":{f:Ci},"astc-10x8-unorm-srgb":{f:Ci},"astc-10x10-unorm":{f:Ci},"astc-10x10-unorm-srgb":{f:Ci},"astc-12x10-unorm":{f:Ci},"astc-12x10-unorm-srgb":{f:Ci},"astc-12x12-unorm":{f:Ci},"astc-12x12-unorm-srgb":{f:Ci},"pvrtc-rgb4unorm-webgl":{f:jg},"pvrtc-rgba4unorm-webgl":{f:jg},"pvrtc-rbg2unorm-webgl":{f:jg},"pvrtc-rgba2unorm-webgl":{f:jg},"etc1-rbg-unorm-webgl":{f:$R},"atc-rgb-unorm-webgl":{f:Fy},"atc-rgba-unorm-webgl":{f:Fy},"atc-rgbai-unorm-webgl":{f:Fy}},WR=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],XR=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function V2(t){return WR.some(e=>t.startsWith(e))}function Rx(t){let e=ZR(t);if(V2(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=YR(t);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const n=XR.exec(t);if(n){const[,i,r,c,f,a]=n,_=`${c}${r}`,x=F2(_),S=x.byteLength*8,R=i.length,I=[S,R>=2?S:0,R>=3?S:0,R>=4?S:0];e={format:t,attachment:e.attachment,dataType:x.dataType,components:R,channels:i,integer:x.integer,signed:x.signed,normalized:x.normalized,bitsPerChannel:I,bytesPerPixel:x.byteLength*i.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),f==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function ZR(t){const e=U2(t),n=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:n,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function YR(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,i,r]=n;return{blockWidth:Number(i),blockHeight:Number(r)}}return null}function GR(t){const e=U2(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=Rx(t),r=t.startsWith("depth")||t.startsWith("stencil"),c=i?.signed,f=i?.integer,a=i?.webgl;return n.render&&=!c,n.filter&&=!r&&!c&&!f&&!a,n}class KR{}class QR{features;disabledFeatures;constructor(e=[],n){this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Yu{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>At.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:At.get("debug")||void 0,debugShaders:At.get("debug-shaders")||void 0,debugFramebuffers:!!At.get("debug-framebuffers"),debugWebGL:!!At.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Yu.defaultProps,...e},this.id=this.props.id||q_(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=L2;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const n=GR(e),i=f=>(typeof f=="string"?this.features.has(f):f)??!0,r=i(n.create),c={format:e,create:r,render:r&&i(n.render),filter:r&&i(n.filter),blend:r&&i(n.blend),store:r&&i(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(c)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return V2(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&$i.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":At.warn("indices buffer content must be of integer type")()),n}}const JR=gf()&&typeof document<"u",ek=()=>JR&&document.readyState==="complete",tk="set luma.log.level=1 (or higher) to trace rendering",F0="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class yd{static defaultProps={...Yu.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=nk().then(()=>{At.probe(2,"DOM is loaded")()});stats=L2;log=At;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw At.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),At.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");At.error("This version of luma.gl has already been initialized")()}At.log(1,`${this.VERSION} - ${tk}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){const n=this.getAdapterMap(e);return n.get("webgpu")?.isSupported?.()?"webgpu":n.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(yd.defaultProps,e)}async createDevice(e={}){e={...yd.defaultProps,...e},e.waitForPageLoad&&await yd.pageLoaded;const n=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const f=await(this.getAdapterMap(e.adapters)||n).get(i)?.create?.(e);if(f)return f;throw new Error(F0)}async attachDevice(e){const n=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await yd.pageLoaded,e.handle===null&&(i="unknown");const c=await n.get(i)?.attach?.(null);if(c)return c;throw new Error(F0)}enforceWebGL2(e=!0,n=[]){const r=this.getAdapterMap(n).get("webgl");r||At.warn("enforceWebGL2: webgl adapter not found")(),r?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const i of e)n.set(i.type,i);return n}registerDevices(e){At.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const i=n.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}}const Bb=new yd;function nk(){return ek()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class ik{}class kx{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...kx.defaultProps,...e},e=this.props,!gf()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=sk(e.canvas):this.canvas=e.canvas;else{const n=ak(e),i=rk(e?.container||null);i.insertBefore(n,i.firstChild),this.canvas=n,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const i of n)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const i=this.cssToDeviceRatio(),[r,c]=this.getDrawingBufferSize();return ok(e,i,r,c,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let i="width"in n?n.width:this.htmlCanvas.clientWidth,r="height"in n?n.height:this.htmlCanvas.clientHeight;(!i||!r)&&(At.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const c=this._canvasSizeInfo;if(c.clientWidth!==i||c.clientHeight!==r||c.devicePixelRatio!==e){let f=e;const a=Math.floor(i*f),_=Math.floor(r*f);if(this.htmlCanvas.width=a,this.htmlCanvas.height=_,this.device.gl){const[S,R]=this.getDrawingBufferSize();(S!==a||R!==_)&&(f=Math.min(S/i,R/r),this.htmlCanvas.width=Math.floor(i*f),this.htmlCanvas.height=Math.floor(r*f),At.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function rk(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function sk(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function ak(t){const{width:e,height:n}=t,i=document.createElement("canvas");return i.id=q_("lumagl-auto-created-canvas"),i.width=e||1,i.height=n||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",i}function ok(t,e,n,i,r){const c=t,f=U0(c[0],e,n);let a=V0(c[1],e,i,r),_=U0(c[0]+1,e,n);const x=_===n-1?_:_-1;_=V0(c[1]+1,e,i,r);let S;return r?(_=_===0?_:_+1,S=a,a=_):S=_===i-1?_:_-1,{x:f,y:a,width:Math.max(x-f+1,1),height:Math.max(S-a+1,1)}}function U0(t,e,n){return Math.min(Math.round(t*e),n-1)}function V0(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}class Ri extends ki{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...ki.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,n){if(n=Ri.normalizeProps(e,n),super(e,n,Ri.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Ri.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Ri.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const n=e?.data;return ArrayBuffer.isView(n)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return Ri.getTextureDataSize(e[0]);if(Ri.isExternalImage(e))return Ri.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,n){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:n.width,height:n.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,n){return Math.floor(Math.log2(Math.max(e,n)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,n){const i={...n},r=e?.props?._resourceDefaults?.texture||{};Object.assign(i,r);const{width:c,height:f}=i;return typeof c=="number"&&(i.width=Math.max(1,Math.ceil(c))),typeof f=="number"&&(i.height=Math.max(1,Math.ceil(f))),i}}class W_ extends ki{static defaultProps={...ki.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,W_.defaultProps)}}function lk(t,e,n){let i="";const r=e.split(/\r?\n/),c=t.slice().sort((f,a)=>f.lineNum-a.lineNum);switch(n?.showSourceCode||"no"){case"all":let f=0;for(let a=1;a<=r.length;a++)for(i+=j2(r[a-1],a,n);c.length>f&&c[f].lineNum===a;){const _=c[f++];i+=j0(_,r,_.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const a of t)i+=j0(a,r,a.lineNum,{inlineSource:n?.showSourceCode!=="no"});return i}}function j0(t,e,n,i){if(i?.inlineSource){const c=ck(e,n),f=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${c}${f}${t.type.toUpperCase()}: ${t.message}

`}const r=t.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function ck(t,e,n){let i="";for(let r=e-2;r<=e;r++){const c=t[r-1];c!==void 0&&(i+=j2(c,e,n))}return i}function j2(t,e,n){const i=n?.html?hk(t):t;return`${uk(String(e),4)}: ${i}${n?.html?"<br/>":`
`}`}function uk(t,e){let n="";for(let i=t.length;i<e;++i)n+=" ";return n+t}function hk(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class X_ extends ki{static defaultProps={...ki.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,n){n={...n,debugShaders:n.debugShaders||e.props.debugShaders||"errors"},super(e,{id:fk(n),...n},X_.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();e==="warnings"&&n?.length===0||this._displayShaderLog(n)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const n=$2(this.source),i=`${this.stage} ${n}`;let r=lk(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const f=document.createElement("Button");f.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,f.style.top="10px",f.style.left="10px",f.style.position="absolute",f.style.zIndex="9999",f.style.width="100%",f.style.textAlign="left",document.body.appendChild(f),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),f.onclick=()=>{const _=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(_)}}}function fk(t){return $2(t.source)||t.id||q_(`unnamed ${t.stage}-shader`)}function $2(t,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}class Im extends ki{static defaultProps={...ki.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=Im.normalizeProps(e,n),super(e,n,Im.defaultProps)}static normalizeProps(e,n){const i=e?.props?._resourceDefaults?.sampler||{};return{...n,...i}}}class Z_ extends ki{static defaultProps={...ki.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,n={}){super(e,n,Z_.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const n=this.colorAttachments.map(r=>r.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:i})}resize(e){let n=!e;if(e){const[i,r]=Array.isArray(e)?e:[e.width,e.height];n=n||r!==this.height||i!==this.width,this.width=i,this.height=r}n&&(At.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,i)=>{if(typeof n=="string"){const r=this.createColorTexture(n,i);return this.attachResource(r),r.view}return n instanceof Ri?n.view:n});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const n=this.createDepthStencilTexture(e);this.attachResource(n),this.depthStencilAttachment=n.view}else e instanceof Ri?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:Ri.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ri.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const r=this.colorAttachments[i].texture.clone({width:e,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}}class kd extends ki{static defaultProps={...ki.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,n){super(e,n,kd.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class nf extends ki{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...ki.defaultProps,framebuffer:null,parameters:void 0,clearColor:nf.defaultClearColor,clearColors:void 0,clearDepth:nf.defaultClearDepth,clearStencil:nf.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=nf.normalizeProps(e,n),super(e,n,nf.defaultProps)}static normalizeProps(e,n){return{...e.props._resourceDefaults?.renderPass,...n}}}class x_ extends ki{static defaultProps={...ki.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,n){super(e,n,x_.defaultProps),this.shaderLayout=n.shaderLayout}}class Ix extends ki{static defaultProps={...ki.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Ix.defaultProps)}}class Mx extends ki{static defaultProps={...ki.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Mx.defaultProps)}}function dk(t){const[e,n]=mk[t],i=e==="i32"||e==="u32",r=e!=="u32",c=gk[e]*n,f=pk(e,n);return{dataType:e,components:n,defaultVertexFormat:f,byteLength:c,integer:i,signed:r}}function pk(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const mk={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},gk={f32:4,f16:2,i32:4,u32:4};function H2(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,i]=t.split("x"),r=n,c=i?parseInt(i):1,f=F2(r),a={type:r,components:c,byteLength:f.byteLength*c,integer:f.integer,signed:f.signed,normalized:f.normalized};return e&&(a.webglOnly=!0),a}function q2(t,e){const n={};for(const i of t.attributes){const r=yk(t,e,i.name);r&&(n[i.name]=r)}return n}function _k(t,e,n=16){const i=q2(t,e),r=new Array(n).fill(null);for(const c of Object.values(i))r[c.location]=c;return r}function yk(t,e,n){const i=bk(t,n),r=xk(e,n);if(!i)return null;const c=dk(i.type),f=r?.vertexFormat||c.defaultVertexFormat,a=H2(f);return{attributeName:r?.attributeName||i.name,bufferName:r?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:f,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:c.integer,stepMode:r?.stepMode||i.stepMode||"vertex",byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function bk(t,e){const n=t.attributes.find(i=>i.name===e);return n||At.warn(`shader layout attribute "${e}" not present in shader`),n||null}function xk(t,e){vk(t);let n=wk(t,e);return n||(n=Tk(t,e),n)?n:(At.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function vk(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&At.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function wk(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function Tk(t,e){for(const n of t){let i=n.byteStride;if(typeof n.byteStride!="number")for(const c of n.attributes||[]){const f=H2(c.format);i+=f.byteLength}const r=n.attributes?.find(c=>c.attribute===e);if(r)return{attributeName:r.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:i}}return null}class Px extends ki{static defaultProps={...ki.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,n){super(e,n,Px.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:r}=n.renderPipeline||{};if(!i||!r)throw new Error("VertexArray");this.attributeInfos=_k(i,r,this.maxVertexAttributes)}setConstantWebGL(e,n){this.device.reportError(new Error("constant attributes not supported"))}}class Dx extends ki{static defaultProps={...ki.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Dx.defaultProps)}}class Ox extends ki{static defaultProps={...ki.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Ox.defaultProps)}}const Sk={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Ek(t){return Sk[t]}function Ak(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let qg;function W2(t){return(!qg||qg.byteLength<t)&&(qg=new ArrayBuffer(t)),qg}function Ck(t,e){const n=W2(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function Rk(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function v_(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":Rk(t)}const $0=1024;class kk{layout={};byteLength;constructor(e){let n=0;for(const[r,c]of Object.entries(e)){const f=Ek(c),{type:a,components:_}=f;n=Ak(n,_);const x=n;n+=_,this.layout[r]={type:a,size:_,offset:x}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,$0)}getData(e){const n=Math.max(this.byteLength,$0),i=W2(n),r={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[c,f]of Object.entries(e)){const a=this.layout[c];if(!a){At.warn(`Supplied uniform value ${c} not present in uniform block layout`)();continue}const{type:_,size:x,offset:S}=a,R=r[_];if(x===1){if(typeof f!="number"&&typeof f!="boolean"){At.warn(`Supplied value for single component uniform ${c} is not a number: ${f}`)();continue}R[S]=Number(f)}else{if(!v_(f)){At.warn(`Supplied value for multi component / array uniform ${c} is not a numeric array: ${f}`)();continue}R.set(f,S)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Ik(t,e,n=16){if(t!==e)return!1;const i=t,r=e;if(!v_(i))return!1;if(v_(r)&&i.length===r.length){for(let c=0;c<i.length;++c)if(r[c]!==i[c])return!1}return!0}function Mk(t){return v_(t)?t.slice():t}class Pk{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const n=e?.shaderLayout.bindings?.find(r=>r.type==="uniform"&&r.name===e?.name);if(!n)throw new Error(e?.name);const i=n;for(const r of i.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(e){for(const[n,i]of Object.entries(e))this._setUniform(n,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){Ik(this.uniforms[e],n)||(this.uniforms[e]=Mk(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Dk{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[n,i]of Object.entries(e)){const r=n,c=new kk(i.uniformTypes||{});this.uniformBufferLayouts.set(r,c);const f=new Pk({name:n});f.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(r,f)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,i]of Object.entries(e))this.uniformBlocks.get(n)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const n=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(n)}createUniformBuffer(e,n,i){i&&this.setUniforms(i);const r=this.getUniformBufferByteLength(n),c=e.createBuffer({usage:$i.UNIFORM|$i.COPY_DST,byteLength:r}),f=this.getUniformBufferData(n);return c.write(f),c}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const i=this.getUniformBufferByteLength(n),r=e.createBuffer({usage:$i.UNIFORM|$i.COPY_DST,byteLength:i});this.uniformBuffers.set(n,r)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(n);e||=i}return e&&At.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),r=!1;if(i&&n?.needsRedraw){r||=n.needsRedraw;const c=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(c);const f=this.uniformBlocks.get(e)?.getAllUniforms();At.log(4,`Writing to uniform buffer ${String(e)}`,c,f)()}return r}}function X2(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Z2(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function Ok(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let r=X2(t);if(r==="uint8"&&n&&i===1)return"unorm8-webgl";if(r==="uint8"&&n&&i===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}if(r==="uint16"||r==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}return i===1?r:`${r}x${i}`}class $y{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,n){const i=[...e];for(const r of n){const c=i.findIndex(f=>f.name===r.name);c<0?i.push(r):i[c]=r}return i}getBufferIndex(e){const n=this.bufferLayouts.findIndex(i=>i.name===e);return n===-1&&At.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function Bk(t,e){const n=Object.fromEntries(t.attributes.map(r=>[r.name,r.location])),i=e.slice();return i.sort((r,c)=>{const f=r.attributes?r.attributes.map(S=>S.attribute):[r.name],a=c.attributes?c.attributes.map(S=>S.attribute):[c.name],_=Math.min(...f.map(S=>n[S])),x=Math.min(...a.map(S=>n[S]));return _-x}),i}class yo{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class H0{constructor(e,n,i){this.name=e,this.type=n,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Wu extends yo{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Gu extends yo{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Nb extends yo{constructor(e,n,i){super(e,i),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class hf extends yo{constructor(e,n,i,r){super(e,i),this.format=n,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Hu;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Hu||(Hu={}));class Wg{constructor(e,n,i,r,c,f,a){this.name=e,this.type=n,this.group=i,this.binding=r,this.attributes=c,this.resourceType=f,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Nk{constructor(e,n){this.name=e,this.type=n}}class zk{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r,this.interpolation=null}}class q0{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r}}class Lk{constructor(e,n,i,r){this.name=e,this.type=n,this.attributes=i,this.id=r}}class Fk{constructor(e,n,i){this.name=e,this.type=n,this.attributes=i}}class Uk{constructor(e,n=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=i}}class Vk{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function jk(t){var e=(32768&t)>>15,n=(31744&t)>>10,i=1023&t;return n==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):n==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))}const Y2=new Float32Array(1),$k=new Int32Array(Y2.buffer),Ls=new Uint16Array(1);function Hk(t){Y2[0]=t;const e=$k[0],n=e>>31&1;let i=e>>23&255,r=8388607&e;if(i===255)return Ls[0]=n<<15|31744|(r!==0?512:0),Ls[0];if(i===0){if(r===0)return Ls[0]=n<<15,Ls[0];r|=8388608;let c=113;for(;!(8388608&r);)r<<=1,c--;return i=127-c,r&=8388607,i>0?(r=(r>>126-i)+(r>>127-i&1),Ls[0]=n<<15|i<<10|r>>13,Ls[0]):(Ls[0]=n<<15,Ls[0])}return i=i-127+15,i>=31?(Ls[0]=n<<15|31744,Ls[0]):i<=0?i<-10?(Ls[0]=n<<15,Ls[0]):(r=(8388608|r)>>1-i,Ls[0]=n<<15|r>>13,Ls[0]):(r>>=13,Ls[0]=n<<15|i<<10|r,Ls[0])}const Bx=new Uint32Array(1),G2=new Float32Array(Bx.buffer,0,1);function W0(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return Bx[0]=e,G2[0]}function qk(t,e,n,i,r,c,f,a,_){const x=i*(f>>=r)*(c>>=r)+n*f+e*a;switch(_){case"r8unorm":return[mi(t,x,"8unorm",1)[0]];case"r8snorm":return[mi(t,x,"8snorm",1)[0]];case"r8uint":return[mi(t,x,"8uint",1)[0]];case"r8sint":return[mi(t,x,"8sint",1)[0]];case"rg8unorm":{const S=mi(t,x,"8unorm",2);return[S[0],S[1]]}case"rg8snorm":{const S=mi(t,x,"8snorm",2);return[S[0],S[1]]}case"rg8uint":{const S=mi(t,x,"8uint",2);return[S[0],S[1]]}case"rg8sint":{const S=mi(t,x,"8sint",2);return[S[0],S[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const S=mi(t,x,"8unorm",4);return[S[0],S[1],S[2],S[3]]}case"rgba8snorm":{const S=mi(t,x,"8snorm",4);return[S[0],S[1],S[2],S[3]]}case"rgba8uint":{const S=mi(t,x,"8uint",4);return[S[0],S[1],S[2],S[3]]}case"rgba8sint":{const S=mi(t,x,"8sint",4);return[S[0],S[1],S[2],S[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const S=mi(t,x,"8unorm",4);return[S[2],S[1],S[0],S[3]]}case"r16uint":return[mi(t,x,"16uint",1)[0]];case"r16sint":return[mi(t,x,"16sint",1)[0]];case"r16float":return[mi(t,x,"16float",1)[0]];case"rg16uint":{const S=mi(t,x,"16uint",2);return[S[0],S[1]]}case"rg16sint":{const S=mi(t,x,"16sint",2);return[S[0],S[1]]}case"rg16float":{const S=mi(t,x,"16float",2);return[S[0],S[1]]}case"rgba16uint":{const S=mi(t,x,"16uint",4);return[S[0],S[1],S[2],S[3]]}case"rgba16sint":{const S=mi(t,x,"16sint",4);return[S[0],S[1],S[2],S[3]]}case"rgba16float":{const S=mi(t,x,"16float",4);return[S[0],S[1],S[2],S[3]]}case"r32uint":return[mi(t,x,"32uint",1)[0]];case"r32sint":return[mi(t,x,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[mi(t,x,"32float",1)[0]];case"rg32uint":{const S=mi(t,x,"32uint",2);return[S[0],S[1]]}case"rg32sint":{const S=mi(t,x,"32sint",2);return[S[0],S[1]]}case"rg32float":{const S=mi(t,x,"32float",2);return[S[0],S[1]]}case"rgba32uint":{const S=mi(t,x,"32uint",4);return[S[0],S[1],S[2],S[3]]}case"rgba32sint":{const S=mi(t,x,"32sint",4);return[S[0],S[1],S[2],S[3]]}case"rgba32float":{const S=mi(t,x,"32float",4);return[S[0],S[1],S[2],S[3]]}case"rg11b10ufloat":{const S=new Uint32Array(t.buffer,x,1)[0],R=(4192256&S)>>11,I=(4290772992&S)>>22;return[W0(2047&S),W0(R),function(N){const L=112+(N>>5&31)<<23|(31&N)<<18;return Bx[0]=L,G2[0]}(I),1]}}return null}function mi(t,e,n,i){const r=[0,0,0,0];for(let c=0;c<i;++c)switch(n){case"8unorm":r[c]=t[e]/255,e++;break;case"8snorm":r[c]=t[e]/255*2-1,e++;break;case"8uint":r[c]=t[e],e++;break;case"8sint":r[c]=t[e]-127,e++;break;case"16uint":r[c]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":r[c]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":r[c]=jk(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":r[c]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":r[c]=new Float32Array(t.buffer,e,1)[0],e+=4}return r}function bi(t,e,n,i,r){for(let c=0;c<i;++c)switch(n){case"8unorm":t[e]=255*r[c],e++;break;case"8snorm":t[e]=.5*(r[c]+1)*255,e++;break;case"8uint":t[e]=r[c],e++;break;case"8sint":t[e]=r[c]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=r[c],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=r[c],e+=2;break;case"16float":{const f=Hk(r[c]);new Uint16Array(t.buffer,e,1)[0]=f,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=r[c],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=r[c],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=r[c],e+=4}return r}const Hy={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class wo{constructor(){this.id=wo._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(w_.instance);for(const i of e)i instanceof Array?this.searchBlock(i,n):i.search(n);n(T_.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}wo._id=0;class w_ extends wo{}w_.instance=new w_;class T_ extends wo{}T_.instance=new T_;const K2=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class er extends wo{constructor(){super()}}class Mm extends er{constructor(e,n,i,r,c,f){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=i,this.body=r,this.startLine=c,this.endLine=f}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class Wk extends er{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Q2 extends er{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class zb extends er{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class J2 extends er{constructor(e,n,i,r){super(),this.init=e,this.condition=n,this.increment=i,this.body=r}get astNodeType(){return"for"}search(e){var n,i,r;(n=this.init)===null||n===void 0||n.search(e),(i=this.condition)===null||i===void 0||i.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class Vc extends er{constructor(e,n,i,r,c){super(),this.attributes=null,this.name=e,this.type=n,this.storage=i,this.access=r,this.value=c}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Nx extends er{constructor(e,n,i){super(),this.attributes=null,this.name=e,this.type=n,this.value=i}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class wm extends er{constructor(e,n,i,r,c){super(),this.attributes=null,this.name=e,this.type=n,this.storage=i,this.access=r,this.value=c}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class l_ extends er{constructor(e,n,i,r,c){super(),this.attributes=null,this.name=e,this.type=n,this.storage=i,this.access=r,this.value=c}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var bd,mm,qe,Be;(t=>{t.increment="++",t.decrement="--"})(bd||(bd={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(bd||(bd={}));class eT extends er{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(mm||(mm={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(mm||(mm={}));class tT extends er{constructor(e,n,i){super(),this.operator=e,this.variable=n,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class zx extends er{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return K2.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class nT extends er{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}search(e){var n;this.searchBlock(this.body,e),(n=this.continuing)===null||n===void 0||n.search(e)}}class iT extends er{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class rT extends er{constructor(e,n,i,r){super(),this.condition=e,this.body=n,this.elseif=i,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class sT extends er{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Xk extends er{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Zk extends er{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class aT extends er{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class Lx extends er{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class Yk extends er{constructor(){super()}get astNodeType(){return"discard"}}class oT extends er{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let lT=class extends er{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}};class yt extends er{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let i=1;i<e.length;++i){const r=yt._priority.get(n.name);yt._priority.get(e[i].name)<r&&(n=e[i])}return n.name==="x32"?yt.i32:n}getTypeName(){return this.name}}yt.x32=new yt("x32"),yt.f32=new yt("f32"),yt.i32=new yt("i32"),yt.u32=new yt("u32"),yt.f16=new yt("f16"),yt.bool=new yt("bool"),yt.void=new yt("void"),yt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class X0 extends yt{constructor(e){super(e)}}class Lc extends yt{constructor(e,n,i,r){super(e),this.members=n,this.startLine=i,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class je extends yt{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}je.vec2f=new je("vec2",yt.f32,null),je.vec3f=new je("vec3",yt.f32,null),je.vec4f=new je("vec4",yt.f32,null),je.vec2i=new je("vec2",yt.i32,null),je.vec3i=new je("vec3",yt.i32,null),je.vec4i=new je("vec4",yt.i32,null),je.vec2u=new je("vec2",yt.u32,null),je.vec3u=new je("vec3",yt.u32,null),je.vec4u=new je("vec4",yt.u32,null),je.vec2h=new je("vec2",yt.f16,null),je.vec3h=new je("vec3",yt.f16,null),je.vec4h=new je("vec4",yt.f16,null),je.vec2b=new je("vec2",yt.bool,null),je.vec3b=new je("vec3",yt.bool,null),je.vec4b=new je("vec4",yt.bool,null),je.mat2x2f=new je("mat2x2",yt.f32,null),je.mat2x3f=new je("mat2x3",yt.f32,null),je.mat2x4f=new je("mat2x4",yt.f32,null),je.mat3x2f=new je("mat3x2",yt.f32,null),je.mat3x3f=new je("mat3x3",yt.f32,null),je.mat3x4f=new je("mat3x4",yt.f32,null),je.mat4x2f=new je("mat4x2",yt.f32,null),je.mat4x3f=new je("mat4x3",yt.f32,null),je.mat4x4f=new je("mat4x4",yt.f32,null),je.mat2x2h=new je("mat2x2",yt.f16,null),je.mat2x3h=new je("mat2x3",yt.f16,null),je.mat2x4h=new je("mat2x4",yt.f16,null),je.mat3x2h=new je("mat3x2",yt.f16,null),je.mat3x3h=new je("mat3x3",yt.f16,null),je.mat3x4h=new je("mat3x4",yt.f16,null),je.mat4x2h=new je("mat4x2",yt.f16,null),je.mat4x3h=new je("mat4x3",yt.f16,null),je.mat4x4h=new je("mat4x4",yt.f16,null),je.mat2x2i=new je("mat2x2",yt.i32,null),je.mat2x3i=new je("mat2x3",yt.i32,null),je.mat2x4i=new je("mat2x4",yt.i32,null),je.mat3x2i=new je("mat3x2",yt.i32,null),je.mat3x3i=new je("mat3x3",yt.i32,null),je.mat3x4i=new je("mat3x4",yt.i32,null),je.mat4x2i=new je("mat4x2",yt.i32,null),je.mat4x3i=new je("mat4x3",yt.i32,null),je.mat4x4i=new je("mat4x4",yt.i32,null),je.mat2x2u=new je("mat2x2",yt.u32,null),je.mat2x3u=new je("mat2x3",yt.u32,null),je.mat2x4u=new je("mat2x4",yt.u32,null),je.mat3x2u=new je("mat3x2",yt.u32,null),je.mat3x3u=new je("mat3x3",yt.u32,null),je.mat3x4u=new je("mat3x4",yt.u32,null),je.mat4x2u=new je("mat4x2",yt.u32,null),je.mat4x3u=new je("mat4x3",yt.u32,null),je.mat4x4u=new je("mat4x4",yt.u32,null);class c_ extends yt{constructor(e,n,i,r){super(e),this.storage=n,this.type=i,this.access=r}get astNodeType(){return"pointer"}}class Tm extends yt{constructor(e,n,i,r){super(e),this.attributes=n,this.format=i,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class gm extends yt{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"sampler"}}class nl extends wo{constructor(){super(),this.postfix=null}}class ff extends nl{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Kl extends nl{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class Fx extends nl{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return K2.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class Fa extends nl{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class cT extends nl{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class Jr extends nl{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof Oe}get isVector(){return this.value instanceof de||this.value instanceof mn}get scalarValue(){return this.value instanceof Oe?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof de||this.value instanceof mn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class uT extends nl{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Id extends nl{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class hT extends nl{constructor(){super()}}class $r extends hT{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Qo extends hT{constructor(e,n,i){super(),this.operator=e,this.left=n,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?yt.f32:e.name==="u32"||n.name==="u32"?yt.u32:yt.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class fT extends wo{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class u_ extends nl{constructor(){super()}get astNodeType(){return"default"}}class dT extends fT{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class pT extends fT{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Z0 extends wo{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"argument"}}class Gk extends wo{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Y0 extends wo{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"member"}}class mT extends wo{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class vo{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=vo._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,i,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}vo._id=0;class Lb extends vo{constructor(){super(new yo("void",null),null)}toString(){return"void"}}Lb.void=new Lb;class hd extends vo{constructor(e){super(new Nb("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,i,r){this.reference.setDataValue(e,n,i,r)}getSubData(e,n,i){return n?this.reference.getSubData(e,n,i):this}toString(){return`&${this.reference.toString()}`}}class Oe extends vo{constructor(e,n,i=null){super(n,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new Oe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Oe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Oe(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,i,r){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(n instanceof Oe))return void console.error("SetDataValue: Invalid value",n);let c=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?c=Math.floor(c):this.typeInfo.name==="bool"&&(c=c?1:0),this.data[0]=c}getSubData(e,n,i){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function Kk(t,e,n){const i=e.length;return i===2?n==="f32"?new de(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new de(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new de(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new de(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):i===3?n==="f32"?new de(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new de(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new de(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new de(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):i===4?n==="f32"?new de(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new de(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new de(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new de(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class de extends vo{constructor(e,n,i=null){if(super(n,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(e):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(e):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(e):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(e):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(e):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new de(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new de(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new de(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,i,r){i instanceof ff?console.error("TODO: Set vector postfix"):n instanceof de?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,i){if(n===null)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof hf)r=this.typeInfo.format||r;else{const f=this.typeInfo.name;f==="vec2f"||f==="vec3f"||f==="vec4f"?r=e.getTypeInfo("f32"):f==="vec2i"||f==="vec3i"||f==="vec4i"?r=e.getTypeInfo("i32"):f==="vec2b"||f==="vec3b"||f==="vec4b"?r=e.getTypeInfo("bool"):f==="vec2u"||f==="vec3u"||f==="vec4u"?r=e.getTypeInfo("u32"):f==="vec2h"||f==="vec3h"||f==="vec4h"?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${f}`)}let c=this;for(;n!==null&&c!==null;){if(n instanceof Id){const f=n.index;let a=-1;if(f instanceof Jr){if(!(f.value instanceof Oe))return console.error(`GetSubData: Invalid array index ${f.value}`),null;a=f.value.value}else{const _=e.evalExpression(f,i);if(!(_ instanceof Oe))return console.error("GetSubData: Unknown index type",f),null;a=_.value}if(a<0||a>=c.data.length)return console.error("GetSubData: Index out of range",a),null;if(c.data instanceof Float32Array){const _=new Float32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Oe(_,r)}if(c.data instanceof Int32Array){const _=new Int32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Oe(_,r)}if(c.data instanceof Uint32Array){const _=new Uint32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Oe(_,r)}throw"GetSubData: Invalid data type"}if(!(n instanceof ff))return console.error("GetSubData: Unknown postfix",n),null;{const f=n.value.toLowerCase();if(f.length===1){let _=0;if(f==="x"||f==="r")_=0;else if(f==="y"||f==="g")_=1;else if(f==="z"||f==="b")_=2;else{if(f!=="w"&&f!=="a")return console.error(`GetSubData: Unknown member ${f}`),null;_=3}if(this.data instanceof Float32Array){let x=new Float32Array(this.data.buffer,this.data.byteOffset+4*_,1);return new Oe(x,r,this)}if(this.data instanceof Int32Array){let x=new Int32Array(this.data.buffer,this.data.byteOffset+4*_,1);return new Oe(x,r,this)}if(this.data instanceof Uint32Array){let x=new Uint32Array(this.data.buffer,this.data.byteOffset+4*_,1);return new Oe(x,r,this)}}const a=[];for(const _ of f)_==="x"||_==="r"?a.push(this.data[0]):_==="y"||_==="g"?a.push(this.data[1]):_==="z"||_==="b"?a.push(this.data[2]):_==="w"||_==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${_}`);c=Kk(e,a,r.name)}n=n.postfix}return c}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class mn extends vo{constructor(e,n,i=null){super(n,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new mn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,i,r){i instanceof ff?console.error("TODO: Set matrix postfix"):n instanceof mn?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,i){if(n===null)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof hf)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(n instanceof Id){const c=n.index;let f=-1;if(c instanceof Jr){if(!(c.value instanceof Oe))return console.error(`GetDataValue: Invalid array index ${c.value}`),null;f=c.value.value}else{const x=e.evalExpression(c,i);if(!(x instanceof Oe))return console.error("GetDataValue: Unknown index type",c),null;f=x.value}if(f<0||f>=this.data.length)return console.error("GetDataValue: Index out of range",f),null;const a=r.endsWith("h")?"h":"f";let _;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")_=new de(new Float32Array(this.data.buffer,this.data.byteOffset+2*f*4,2),e.getTypeInfo(`vec2${a}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")_=new de(new Float32Array(this.data.buffer,this.data.byteOffset+3*f*4,3),e.getTypeInfo(`vec3${a}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;_=new de(new Float32Array(this.data.buffer,this.data.byteOffset+4*f*4,4),e.getTypeInfo(`vec4${a}`))}return n.postfix?_.getSubData(e,n.postfix,i):_}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Tr extends vo{constructor(e,n,i=0,r=null){super(n,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Tr(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,i,r){if(n===null)return void console.log("setDataValue: NULL data.");let c=this.offset,f=this.typeInfo;for(;i;){if(i instanceof Id)if(f instanceof Gu){const a=i.index;if(a instanceof Jr){if(!(a.value instanceof Oe))return void console.error(`SetDataValue: Invalid index type ${a.value}`);c+=a.value.value*f.stride}else{const _=e.evalExpression(a,r);if(!(_ instanceof Oe))return void console.error("SetDataValue: Unknown index type",a);c+=_.value*f.stride}f=f.format}else console.error(`SetDataValue: Type ${f.getTypeName()} is not an array`);else{if(!(i instanceof ff))return void console.error("SetDataValue: Unknown postfix type",i);{const a=i.value;if(f instanceof Wu){let _=!1;for(const x of f.members)if(x.name===a){c+=x.offset,f=x.type,_=!0;break}if(!_)return void console.error(`SetDataValue: Member ${a} not found`)}else if(f instanceof yo){const _=f.getTypeName();let x=0;if(a==="x"||a==="r")x=0;else if(a==="y"||a==="g")x=1;else if(a==="z"||a==="b")x=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);x=3}if(!(n instanceof Oe))return void console.error("SetDataValue: Invalid value",n);const S=n.value;return _==="vec2f"?void(new Float32Array(this.buffer,c,2)[x]=S):_==="vec3f"?void(new Float32Array(this.buffer,c,3)[x]=S):_==="vec4f"?void(new Float32Array(this.buffer,c,4)[x]=S):_==="vec2i"?void(new Int32Array(this.buffer,c,2)[x]=S):_==="vec3i"?void(new Int32Array(this.buffer,c,3)[x]=S):_==="vec4i"?void(new Int32Array(this.buffer,c,4)[x]=S):_==="vec2u"?void(new Uint32Array(this.buffer,c,2)[x]=S):_==="vec3u"?void(new Uint32Array(this.buffer,c,3)[x]=S):_==="vec4u"?void(new Uint32Array(this.buffer,c,4)[x]=S):void console.error(`SetDataValue: Type ${_} is not a struct`)}}}i=i.postfix}this.setData(e,n,f,c,r)}setData(e,n,i,r,c){const f=i.getTypeName();if(f!=="f32"&&f!=="f16")if(f!=="i32"&&f!=="atomic<i32>"&&f!=="x32")if(f!=="u32"&&f!=="atomic<u32>")if(f!=="bool"){if(f==="vec2f"||f==="vec2h"){const a=new Float32Array(this.buffer,r,2);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(f==="vec3f"||f==="vec3h"){const a=new Float32Array(this.buffer,r,3);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(f==="vec4f"||f==="vec4h"){const a=new Float32Array(this.buffer,r,4);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(f==="vec2i"){const a=new Int32Array(this.buffer,r,2);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(f==="vec3i"){const a=new Int32Array(this.buffer,r,3);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(f==="vec4i"){const a=new Int32Array(this.buffer,r,4);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(f==="vec2u"){const a=new Uint32Array(this.buffer,r,2);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(f==="vec3u"){const a=new Uint32Array(this.buffer,r,3);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(f==="vec4u"){const a=new Uint32Array(this.buffer,r,4);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(f==="vec2b"){const a=new Uint32Array(this.buffer,r,2);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(f==="vec3b"){const a=new Uint32Array(this.buffer,r,3);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(f==="vec4b"){const a=new Uint32Array(this.buffer,r,4);return void(n instanceof de?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(f==="mat2x2f"||f==="mat2x2h"){const a=new Float32Array(this.buffer,r,4);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(f==="mat2x3f"||f==="mat2x3h"){const a=new Float32Array(this.buffer,r,6);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5]))}if(f==="mat2x4f"||f==="mat2x4h"){const a=new Float32Array(this.buffer,r,8);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7]))}if(f==="mat3x2f"||f==="mat3x2h"){const a=new Float32Array(this.buffer,r,6);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5]))}if(f==="mat3x3f"||f==="mat3x3h"){const a=new Float32Array(this.buffer,r,9);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8]))}if(f==="mat3x4f"||f==="mat3x4h"){const a=new Float32Array(this.buffer,r,12);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]))}if(f==="mat4x2f"||f==="mat4x2h"){const a=new Float32Array(this.buffer,r,8);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7]))}if(f==="mat4x3f"||f==="mat4x3h"){const a=new Float32Array(this.buffer,r,12);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]))}if(f==="mat4x4f"||f==="mat4x4h"){const a=new Float32Array(this.buffer,r,16);return void(n instanceof mn?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11],a[12]=n.data[12],a[13]=n.data[13],a[14]=n.data[14],a[15]=n.data[15]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]))}if(n instanceof Tr){if(i===n.typeInfo)return void new Uint8Array(this.buffer,r,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",f,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${f}`)}else n instanceof Oe&&(new Int32Array(this.buffer,r,1)[0]=n.value);else n instanceof Oe&&(new Uint32Array(this.buffer,r,1)[0]=n.value);else n instanceof Oe&&(new Int32Array(this.buffer,r,1)[0]=n.value);else n instanceof Oe&&(new Float32Array(this.buffer,r,1)[0]=n.value)}getSubData(e,n,i){var r,c,f;if(n===null)return this;let a=this.offset,_=this.typeInfo;for(;n;){if(n instanceof Id){const S=n.index,R=S instanceof nl?e.evalExpression(S,i):S;let I=0;if(R instanceof Oe?I=R.value:typeof R=="number"?I=R:console.error("GetDataValue: Invalid index type",S),_ instanceof Gu)a+=I*_.stride,_=_.format;else{const N=_.getTypeName();N==="mat4x4"||N==="mat4x4f"||N==="mat4x4h"?(a+=16*I,_=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${_.getTypeName()} is not an array`)}}else{if(!(n instanceof ff))return console.error("GetDataValue: Unknown postfix type",n),null;{const S=n.value;if(_ instanceof Wu){let R=!1;for(const I of _.members)if(I.name===S){a+=I.offset,_=I.type,R=!0;break}if(!R)return console.error(`GetDataValue: Member ${S} not found`),null}else if(_ instanceof yo){const R=_.getTypeName();if(R==="vec2f"||R==="vec3f"||R==="vec4f"||R==="vec2i"||R==="vec3i"||R==="vec4i"||R==="vec2u"||R==="vec3u"||R==="vec4u"||R==="vec2b"||R==="vec3b"||R==="vec4b"||R==="vec2h"||R==="vec3h"||R==="vec4h"||R==="vec2"||R==="vec3"||R==="vec4"){if(S.length>0&&S.length<5){let I="f";const N=[];for(let L=0;L<S.length;++L){const H=S[L].toLowerCase();let ie=0;if(H==="x"||H==="r")ie=0;else if(H==="y"||H==="g")ie=1;else if(H==="z"||H==="b")ie=2;else{if(H!=="w"&&H!=="a")return console.error(`Unknown member ${S}`),null;ie=3}if(S.length===1){if(R.endsWith("f"))return this.buffer.byteLength<a+4*ie+4?(console.log("Insufficient buffer data"),null):new Oe(new Float32Array(this.buffer,a+4*ie,1),e.getTypeInfo("f32"),this);if(R.endsWith("h"))return new Oe(new Float32Array(this.buffer,a+4*ie,1),e.getTypeInfo("f16"),this);if(R.endsWith("i"))return new Oe(new Int32Array(this.buffer,a+4*ie,1),e.getTypeInfo("i32"),this);if(R.endsWith("b"))return new Oe(new Int32Array(this.buffer,a+4*ie,1),e.getTypeInfo("bool"),this);if(R.endsWith("u"))return new Oe(new Uint32Array(this.buffer,a+4*ie,1),e.getTypeInfo("i32"),this)}if(R==="vec2f")N.push(new Float32Array(this.buffer,a,2)[ie]);else if(R==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const ne=new Float32Array(this.buffer,a,3);N.push(ne[ie])}else if(R==="vec4f")N.push(new Float32Array(this.buffer,a,4)[ie]);else if(R==="vec2i")I="i",N.push(new Int32Array(this.buffer,a,2)[ie]);else if(R==="vec3i")I="i",N.push(new Int32Array(this.buffer,a,3)[ie]);else if(R==="vec4i")I="i",N.push(new Int32Array(this.buffer,a,4)[ie]);else if(R==="vec2u"){I="u";const ne=new Uint32Array(this.buffer,a,2);N.push(ne[ie])}else R==="vec3u"?(I="u",N.push(new Uint32Array(this.buffer,a,3)[ie])):R==="vec4u"&&(I="u",N.push(new Uint32Array(this.buffer,a,4)[ie]))}return N.length===2?_=e.getTypeInfo(`vec2${I}`):N.length===3?_=e.getTypeInfo(`vec3${I}`):N.length===4?_=e.getTypeInfo(`vec4${I}`):console.error(`GetDataValue: Invalid vector length ${N.length}`),new de(N,_,null)}return console.error(`GetDataValue: Unknown member ${S}`),null}return console.error(`GetDataValue: Type ${R} is not a struct`),null}}}n=n.postfix}const x=_.getTypeName();return x==="f32"?new Oe(new Float32Array(this.buffer,a,1),_,this):x==="i32"?new Oe(new Int32Array(this.buffer,a,1),_,this):x==="u32"?new Oe(new Uint32Array(this.buffer,a,1),_,this):x==="vec2f"?new de(new Float32Array(this.buffer,a,2),_,this):x==="vec3f"?new de(new Float32Array(this.buffer,a,3),_,this):x==="vec4f"?new de(new Float32Array(this.buffer,a,4),_,this):x==="vec2i"?new de(new Int32Array(this.buffer,a,2),_,this):x==="vec3i"?new de(new Int32Array(this.buffer,a,3),_,this):x==="vec4i"?new de(new Int32Array(this.buffer,a,4),_,this):x==="vec2u"?new de(new Uint32Array(this.buffer,a,2),_,this):x==="vec3u"?new de(new Uint32Array(this.buffer,a,3),_,this):x==="vec4u"?new de(new Uint32Array(this.buffer,a,4),_,this):_ instanceof hf&&_.name==="atomic"?((r=_.format)===null||r===void 0?void 0:r.name)==="u32"?new Oe(new Uint32Array(this.buffer,a,1)[0],_.format,this):((c=_.format)===null||c===void 0?void 0:c.name)==="i32"?new Oe(new Int32Array(this.buffer,a,1)[0],_.format,this):(console.error(`GetDataValue: Invalid atomic format ${(f=_.format)===null||f===void 0?void 0:f.name}`),null):new Tr(this.buffer,_,a,this)}toString(){let e="";if(this.typeInfo instanceof Gu)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let i=1;i<n.length;++i)e+=`, ${n[i]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let i=1;i<n.length;++i)e+=`, ${n[i]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let i=1;i<n.length;++i)e+=`, ${n[i]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let i=1;i<n.length/2;++i)e+=`, [${n[2*i]}, ${n[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let i=4;i<n.length;i+=4)e+=`, [${n[i]}, ${n[i+1]}, ${n[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let i=4;i<n.length;i+=4)e+=`, [${n[i]}, ${n[i+1]}, ${n[i+2]}, ${n[i+3]}]`}else e="[...]";else this.typeInfo instanceof Wu?e+="{...}":e="[...]";return e}}class Fc extends vo{constructor(e,n,i,r){super(n,null),this.data=e,this.descriptor=i,this.view=r}clone(){return new Fc(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(n=i.width)!==null&&n!==void 0?n:0}get height(){var e,n;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(n=i.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(n=i.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<n.length;++i)n[i]=Math.max(1,n[i]>>e);return n}get texelByteSize(){const e=this.format,n=Hy[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=Hy[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=Hy[e],i=this.width;if(!e||i<=0||!n)return-1;const r=this.height,c=this.depthOrArrayLayers,f=this.dimension;return i/n.blockWidth*(f==="1d"?1:r/n.blockHeight)*n.bytesPerBlock*c}getPixel(e,n,i=0,r=0){const c=this.texelByteSize,f=this.bytesPerRow,a=this.height,_=this.data[r];return qk(new Uint8Array(_),e,n,i,r,a,f,c,this.format)}setPixel(e,n,i,r,c){const f=this.texelByteSize,a=this.bytesPerRow,_=this.height,x=this.data[r];(function(S,R,I,N,L,H,ie,ne,he,re){const ge=N*(ie>>=L)*(H>>=L)+I*ie+R*ne;switch(he){case"r8unorm":return void bi(S,ge,"8unorm",1,re);case"r8snorm":return void bi(S,ge,"8snorm",1,re);case"r8uint":return void bi(S,ge,"8uint",1,re);case"r8sint":return void bi(S,ge,"8sint",1,re);case"rg8unorm":return void bi(S,ge,"8unorm",2,re);case"rg8snorm":return void bi(S,ge,"8snorm",2,re);case"rg8uint":return void bi(S,ge,"8uint",2,re);case"rg8sint":return void bi(S,ge,"8sint",2,re);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void bi(S,ge,"8unorm",4,re);case"rgba8snorm":return void bi(S,ge,"8snorm",4,re);case"rgba8uint":return void bi(S,ge,"8uint",4,re);case"rgba8sint":return void bi(S,ge,"8sint",4,re);case"r16uint":return void bi(S,ge,"16uint",1,re);case"r16sint":return void bi(S,ge,"16sint",1,re);case"r16float":return void bi(S,ge,"16float",1,re);case"rg16uint":return void bi(S,ge,"16uint",2,re);case"rg16sint":return void bi(S,ge,"16sint",2,re);case"rg16float":return void bi(S,ge,"16float",2,re);case"rgba16uint":return void bi(S,ge,"16uint",4,re);case"rgba16sint":return void bi(S,ge,"16sint",4,re);case"rgba16float":return void bi(S,ge,"16float",4,re);case"r32uint":return void bi(S,ge,"32uint",1,re);case"r32sint":return void bi(S,ge,"32sint",1,re);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void bi(S,ge,"32float",1,re);case"rg32uint":return void bi(S,ge,"32uint",2,re);case"rg32sint":return void bi(S,ge,"32sint",2,re);case"rg32float":return void bi(S,ge,"32float",2,re);case"rgba32uint":return void bi(S,ge,"32uint",4,re);case"rgba32sint":return void bi(S,ge,"32sint",4,re);case"rgba32float":return void bi(S,ge,"32float",4,re);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(x),e,n,i,r,_,a,f,this.format,c)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Be||(Be={}));class ze{constructor(e,n,i){this.name=e,this.type=n,this.rule=i}toString(){return this.name}}class oe{}qe=oe,oe.none=new ze("",Be.reserved,""),oe.eof=new ze("EOF",Be.token,""),oe.reserved={asm:new ze("asm",Be.reserved,"asm"),bf16:new ze("bf16",Be.reserved,"bf16"),do:new ze("do",Be.reserved,"do"),enum:new ze("enum",Be.reserved,"enum"),f16:new ze("f16",Be.reserved,"f16"),f64:new ze("f64",Be.reserved,"f64"),handle:new ze("handle",Be.reserved,"handle"),i8:new ze("i8",Be.reserved,"i8"),i16:new ze("i16",Be.reserved,"i16"),i64:new ze("i64",Be.reserved,"i64"),mat:new ze("mat",Be.reserved,"mat"),premerge:new ze("premerge",Be.reserved,"premerge"),regardless:new ze("regardless",Be.reserved,"regardless"),typedef:new ze("typedef",Be.reserved,"typedef"),u8:new ze("u8",Be.reserved,"u8"),u16:new ze("u16",Be.reserved,"u16"),u64:new ze("u64",Be.reserved,"u64"),unless:new ze("unless",Be.reserved,"unless"),using:new ze("using",Be.reserved,"using"),vec:new ze("vec",Be.reserved,"vec"),void:new ze("void",Be.reserved,"void")},oe.keywords={array:new ze("array",Be.keyword,"array"),atomic:new ze("atomic",Be.keyword,"atomic"),bool:new ze("bool",Be.keyword,"bool"),f32:new ze("f32",Be.keyword,"f32"),i32:new ze("i32",Be.keyword,"i32"),mat2x2:new ze("mat2x2",Be.keyword,"mat2x2"),mat2x3:new ze("mat2x3",Be.keyword,"mat2x3"),mat2x4:new ze("mat2x4",Be.keyword,"mat2x4"),mat3x2:new ze("mat3x2",Be.keyword,"mat3x2"),mat3x3:new ze("mat3x3",Be.keyword,"mat3x3"),mat3x4:new ze("mat3x4",Be.keyword,"mat3x4"),mat4x2:new ze("mat4x2",Be.keyword,"mat4x2"),mat4x3:new ze("mat4x3",Be.keyword,"mat4x3"),mat4x4:new ze("mat4x4",Be.keyword,"mat4x4"),ptr:new ze("ptr",Be.keyword,"ptr"),sampler:new ze("sampler",Be.keyword,"sampler"),sampler_comparison:new ze("sampler_comparison",Be.keyword,"sampler_comparison"),struct:new ze("struct",Be.keyword,"struct"),texture_1d:new ze("texture_1d",Be.keyword,"texture_1d"),texture_2d:new ze("texture_2d",Be.keyword,"texture_2d"),texture_2d_array:new ze("texture_2d_array",Be.keyword,"texture_2d_array"),texture_3d:new ze("texture_3d",Be.keyword,"texture_3d"),texture_cube:new ze("texture_cube",Be.keyword,"texture_cube"),texture_cube_array:new ze("texture_cube_array",Be.keyword,"texture_cube_array"),texture_multisampled_2d:new ze("texture_multisampled_2d",Be.keyword,"texture_multisampled_2d"),texture_storage_1d:new ze("texture_storage_1d",Be.keyword,"texture_storage_1d"),texture_storage_2d:new ze("texture_storage_2d",Be.keyword,"texture_storage_2d"),texture_storage_2d_array:new ze("texture_storage_2d_array",Be.keyword,"texture_storage_2d_array"),texture_storage_3d:new ze("texture_storage_3d",Be.keyword,"texture_storage_3d"),texture_depth_2d:new ze("texture_depth_2d",Be.keyword,"texture_depth_2d"),texture_depth_2d_array:new ze("texture_depth_2d_array",Be.keyword,"texture_depth_2d_array"),texture_depth_cube:new ze("texture_depth_cube",Be.keyword,"texture_depth_cube"),texture_depth_cube_array:new ze("texture_depth_cube_array",Be.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ze("texture_depth_multisampled_2d",Be.keyword,"texture_depth_multisampled_2d"),texture_external:new ze("texture_external",Be.keyword,"texture_external"),u32:new ze("u32",Be.keyword,"u32"),vec2:new ze("vec2",Be.keyword,"vec2"),vec3:new ze("vec3",Be.keyword,"vec3"),vec4:new ze("vec4",Be.keyword,"vec4"),bitcast:new ze("bitcast",Be.keyword,"bitcast"),block:new ze("block",Be.keyword,"block"),break:new ze("break",Be.keyword,"break"),case:new ze("case",Be.keyword,"case"),continue:new ze("continue",Be.keyword,"continue"),continuing:new ze("continuing",Be.keyword,"continuing"),default:new ze("default",Be.keyword,"default"),diagnostic:new ze("diagnostic",Be.keyword,"diagnostic"),discard:new ze("discard",Be.keyword,"discard"),else:new ze("else",Be.keyword,"else"),enable:new ze("enable",Be.keyword,"enable"),fallthrough:new ze("fallthrough",Be.keyword,"fallthrough"),false:new ze("false",Be.keyword,"false"),fn:new ze("fn",Be.keyword,"fn"),for:new ze("for",Be.keyword,"for"),function:new ze("function",Be.keyword,"function"),if:new ze("if",Be.keyword,"if"),let:new ze("let",Be.keyword,"let"),const:new ze("const",Be.keyword,"const"),loop:new ze("loop",Be.keyword,"loop"),while:new ze("while",Be.keyword,"while"),private:new ze("private",Be.keyword,"private"),read:new ze("read",Be.keyword,"read"),read_write:new ze("read_write",Be.keyword,"read_write"),return:new ze("return",Be.keyword,"return"),requires:new ze("requires",Be.keyword,"requires"),storage:new ze("storage",Be.keyword,"storage"),switch:new ze("switch",Be.keyword,"switch"),true:new ze("true",Be.keyword,"true"),alias:new ze("alias",Be.keyword,"alias"),type:new ze("type",Be.keyword,"type"),uniform:new ze("uniform",Be.keyword,"uniform"),var:new ze("var",Be.keyword,"var"),override:new ze("override",Be.keyword,"override"),workgroup:new ze("workgroup",Be.keyword,"workgroup"),write:new ze("write",Be.keyword,"write"),r8unorm:new ze("r8unorm",Be.keyword,"r8unorm"),r8snorm:new ze("r8snorm",Be.keyword,"r8snorm"),r8uint:new ze("r8uint",Be.keyword,"r8uint"),r8sint:new ze("r8sint",Be.keyword,"r8sint"),r16uint:new ze("r16uint",Be.keyword,"r16uint"),r16sint:new ze("r16sint",Be.keyword,"r16sint"),r16float:new ze("r16float",Be.keyword,"r16float"),rg8unorm:new ze("rg8unorm",Be.keyword,"rg8unorm"),rg8snorm:new ze("rg8snorm",Be.keyword,"rg8snorm"),rg8uint:new ze("rg8uint",Be.keyword,"rg8uint"),rg8sint:new ze("rg8sint",Be.keyword,"rg8sint"),r32uint:new ze("r32uint",Be.keyword,"r32uint"),r32sint:new ze("r32sint",Be.keyword,"r32sint"),r32float:new ze("r32float",Be.keyword,"r32float"),rg16uint:new ze("rg16uint",Be.keyword,"rg16uint"),rg16sint:new ze("rg16sint",Be.keyword,"rg16sint"),rg16float:new ze("rg16float",Be.keyword,"rg16float"),rgba8unorm:new ze("rgba8unorm",Be.keyword,"rgba8unorm"),rgba8unorm_srgb:new ze("rgba8unorm_srgb",Be.keyword,"rgba8unorm_srgb"),rgba8snorm:new ze("rgba8snorm",Be.keyword,"rgba8snorm"),rgba8uint:new ze("rgba8uint",Be.keyword,"rgba8uint"),rgba8sint:new ze("rgba8sint",Be.keyword,"rgba8sint"),bgra8unorm:new ze("bgra8unorm",Be.keyword,"bgra8unorm"),bgra8unorm_srgb:new ze("bgra8unorm_srgb",Be.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ze("rgb10a2unorm",Be.keyword,"rgb10a2unorm"),rg11b10float:new ze("rg11b10float",Be.keyword,"rg11b10float"),rg32uint:new ze("rg32uint",Be.keyword,"rg32uint"),rg32sint:new ze("rg32sint",Be.keyword,"rg32sint"),rg32float:new ze("rg32float",Be.keyword,"rg32float"),rgba16uint:new ze("rgba16uint",Be.keyword,"rgba16uint"),rgba16sint:new ze("rgba16sint",Be.keyword,"rgba16sint"),rgba16float:new ze("rgba16float",Be.keyword,"rgba16float"),rgba32uint:new ze("rgba32uint",Be.keyword,"rgba32uint"),rgba32sint:new ze("rgba32sint",Be.keyword,"rgba32sint"),rgba32float:new ze("rgba32float",Be.keyword,"rgba32float"),static_assert:new ze("static_assert",Be.keyword,"static_assert")},oe.tokens={decimal_float_literal:new ze("decimal_float_literal",Be.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new ze("hex_float_literal",Be.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new ze("int_literal",Be.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ze("uint_literal",Be.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new ze("name",Be.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new ze("ident",Be.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ze("and",Be.token,"&"),and_and:new ze("and_and",Be.token,"&&"),arrow:new ze("arrow ",Be.token,"->"),attr:new ze("attr",Be.token,"@"),forward_slash:new ze("forward_slash",Be.token,"/"),bang:new ze("bang",Be.token,"!"),bracket_left:new ze("bracket_left",Be.token,"["),bracket_right:new ze("bracket_right",Be.token,"]"),brace_left:new ze("brace_left",Be.token,"{"),brace_right:new ze("brace_right",Be.token,"}"),colon:new ze("colon",Be.token,":"),comma:new ze("comma",Be.token,","),equal:new ze("equal",Be.token,"="),equal_equal:new ze("equal_equal",Be.token,"=="),not_equal:new ze("not_equal",Be.token,"!="),greater_than:new ze("greater_than",Be.token,">"),greater_than_equal:new ze("greater_than_equal",Be.token,">="),shift_right:new ze("shift_right",Be.token,">>"),less_than:new ze("less_than",Be.token,"<"),less_than_equal:new ze("less_than_equal",Be.token,"<="),shift_left:new ze("shift_left",Be.token,"<<"),modulo:new ze("modulo",Be.token,"%"),minus:new ze("minus",Be.token,"-"),minus_minus:new ze("minus_minus",Be.token,"--"),period:new ze("period",Be.token,"."),plus:new ze("plus",Be.token,"+"),plus_plus:new ze("plus_plus",Be.token,"++"),or:new ze("or",Be.token,"|"),or_or:new ze("or_or",Be.token,"||"),paren_left:new ze("paren_left",Be.token,"("),paren_right:new ze("paren_right",Be.token,")"),semicolon:new ze("semicolon",Be.token,";"),star:new ze("star",Be.token,"*"),tilde:new ze("tilde",Be.token,"~"),underscore:new ze("underscore",Be.token,"_"),xor:new ze("xor",Be.token,"^"),plus_equal:new ze("plus_equal",Be.token,"+="),minus_equal:new ze("minus_equal",Be.token,"-="),times_equal:new ze("times_equal",Be.token,"*="),division_equal:new ze("division_equal",Be.token,"/="),modulo_equal:new ze("modulo_equal",Be.token,"%="),and_equal:new ze("and_equal",Be.token,"&="),or_equal:new ze("or_equal",Be.token,"|="),xor_equal:new ze("xor_equal",Be.token,"^="),shift_right_equal:new ze("shift_right_equal",Be.token,">>="),shift_left_equal:new ze("shift_left_equal",Be.token,"<<=")},oe.simpleTokens={"@":qe.tokens.attr,"{":qe.tokens.brace_left,"}":qe.tokens.brace_right,":":qe.tokens.colon,",":qe.tokens.comma,"(":qe.tokens.paren_left,")":qe.tokens.paren_right,";":qe.tokens.semicolon},oe.literalTokens={"&":qe.tokens.and,"&&":qe.tokens.and_and,"->":qe.tokens.arrow,"/":qe.tokens.forward_slash,"!":qe.tokens.bang,"[":qe.tokens.bracket_left,"]":qe.tokens.bracket_right,"=":qe.tokens.equal,"==":qe.tokens.equal_equal,"!=":qe.tokens.not_equal,">":qe.tokens.greater_than,">=":qe.tokens.greater_than_equal,">>":qe.tokens.shift_right,"<":qe.tokens.less_than,"<=":qe.tokens.less_than_equal,"<<":qe.tokens.shift_left,"%":qe.tokens.modulo,"-":qe.tokens.minus,"--":qe.tokens.minus_minus,".":qe.tokens.period,"+":qe.tokens.plus,"++":qe.tokens.plus_plus,"|":qe.tokens.or,"||":qe.tokens.or_or,"*":qe.tokens.star,"~":qe.tokens.tilde,_:qe.tokens.underscore,"^":qe.tokens.xor,"+=":qe.tokens.plus_equal,"-=":qe.tokens.minus_equal,"*=":qe.tokens.times_equal,"/=":qe.tokens.division_equal,"%=":qe.tokens.modulo_equal,"&=":qe.tokens.and_equal,"|=":qe.tokens.or_equal,"^=":qe.tokens.xor_equal,">>=":qe.tokens.shift_right_equal,"<<=":qe.tokens.shift_left_equal},oe.regexTokens={decimal_float_literal:qe.tokens.decimal_float_literal,hex_float_literal:qe.tokens.hex_float_literal,int_literal:qe.tokens.int_literal,uint_literal:qe.tokens.uint_literal,ident:qe.tokens.ident},oe.storage_class=[qe.keywords.function,qe.keywords.private,qe.keywords.workgroup,qe.keywords.uniform,qe.keywords.storage],oe.access_mode=[qe.keywords.read,qe.keywords.write,qe.keywords.read_write],oe.sampler_type=[qe.keywords.sampler,qe.keywords.sampler_comparison],oe.sampled_texture_type=[qe.keywords.texture_1d,qe.keywords.texture_2d,qe.keywords.texture_2d_array,qe.keywords.texture_3d,qe.keywords.texture_cube,qe.keywords.texture_cube_array],oe.multisampled_texture_type=[qe.keywords.texture_multisampled_2d],oe.storage_texture_type=[qe.keywords.texture_storage_1d,qe.keywords.texture_storage_2d,qe.keywords.texture_storage_2d_array,qe.keywords.texture_storage_3d],oe.depth_texture_type=[qe.keywords.texture_depth_2d,qe.keywords.texture_depth_2d_array,qe.keywords.texture_depth_cube,qe.keywords.texture_depth_cube_array,qe.keywords.texture_depth_multisampled_2d],oe.texture_external_type=[qe.keywords.texture_external],oe.any_texture_type=[...qe.sampled_texture_type,...qe.multisampled_texture_type,...qe.storage_texture_type,...qe.depth_texture_type,...qe.texture_external_type],oe.texel_format=[qe.keywords.r8unorm,qe.keywords.r8snorm,qe.keywords.r8uint,qe.keywords.r8sint,qe.keywords.r16uint,qe.keywords.r16sint,qe.keywords.r16float,qe.keywords.rg8unorm,qe.keywords.rg8snorm,qe.keywords.rg8uint,qe.keywords.rg8sint,qe.keywords.r32uint,qe.keywords.r32sint,qe.keywords.r32float,qe.keywords.rg16uint,qe.keywords.rg16sint,qe.keywords.rg16float,qe.keywords.rgba8unorm,qe.keywords.rgba8unorm_srgb,qe.keywords.rgba8snorm,qe.keywords.rgba8uint,qe.keywords.rgba8sint,qe.keywords.bgra8unorm,qe.keywords.bgra8unorm_srgb,qe.keywords.rgb10a2unorm,qe.keywords.rg11b10float,qe.keywords.rg32uint,qe.keywords.rg32sint,qe.keywords.rg32float,qe.keywords.rgba16uint,qe.keywords.rgba16sint,qe.keywords.rgba16float,qe.keywords.rgba32uint,qe.keywords.rgba32sint,qe.keywords.rgba32float],oe.const_literal=[qe.tokens.int_literal,qe.tokens.uint_literal,qe.tokens.decimal_float_literal,qe.tokens.hex_float_literal,qe.keywords.true,qe.keywords.false],oe.literal_or_ident=[qe.tokens.ident,qe.tokens.int_literal,qe.tokens.uint_literal,qe.tokens.decimal_float_literal,qe.tokens.hex_float_literal,qe.tokens.name],oe.element_count_expression=[qe.tokens.int_literal,qe.tokens.uint_literal,qe.tokens.ident],oe.template_types=[qe.keywords.vec2,qe.keywords.vec3,qe.keywords.vec4,qe.keywords.mat2x2,qe.keywords.mat2x3,qe.keywords.mat2x4,qe.keywords.mat3x2,qe.keywords.mat3x3,qe.keywords.mat3x4,qe.keywords.mat4x2,qe.keywords.mat4x3,qe.keywords.mat4x4,qe.keywords.atomic,qe.keywords.bitcast,...qe.any_texture_type],oe.attribute_name=[qe.tokens.ident,qe.keywords.block,qe.keywords.diagnostic],oe.assignment_operators=[qe.tokens.equal,qe.tokens.plus_equal,qe.tokens.minus_equal,qe.tokens.times_equal,qe.tokens.division_equal,qe.tokens.modulo_equal,qe.tokens.and_equal,qe.tokens.or_equal,qe.tokens.xor_equal,qe.tokens.shift_right_equal,qe.tokens.shift_left_equal],oe.increment_operators=[qe.tokens.plus_plus,qe.tokens.minus_minus];class G0{constructor(e,n,i,r,c){this.type=e,this.lexeme=n,this.line=i,this.start=r,this.end=c}toString(){return this.lexeme}isTemplateType(){return oe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==oe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Qk{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new G0(oe.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let f=1;for(;f>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),f--,f==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),f++)}return!0}}const n=oe.simpleTokens[e];if(n)return this._addToken(n),!0;let i=oe.none;const r=this._isAlpha(e),c=e==="_";if(this._isAlphaNumeric(e)){let f=this._peekAhead();for(;this._isAlphaNumeric(f);)e+=this._advance(),f=this._peekAhead()}if(r){const f=oe.keywords[e];if(f)return this._addToken(f),!0}if(r||c)return this._addToken(oe.tokens.ident),!0;for(;;){let f=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(oe.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(oe.tokens.minus_minus),!0;const _=this._tokens.length-1;if((oe.literal_or_ident.indexOf(this._tokens[_].type)!=-1||this._tokens[_].type==oe.tokens.paren_right)&&a!=">")return this._addToken(f),!0}if(e==">"&&(a==">"||a=="=")){let _=!1,x=this._tokens.length-1;for(let S=0;S<5&&x>=0&&oe.assignment_operators.indexOf(this._tokens[x].type)===-1;++S,--x)if(this._tokens[x].type===oe.tokens.less_than){x>0&&this._tokens[x-1].isArrayOrTemplateType()&&(_=!0);break}if(_)return this._addToken(f),!0}if(f===oe.none){let _=e,x=0;const S=2;for(let R=0;R<S;++R)if(_+=this._peekAhead(R),f=this._findType(_),f!==oe.none){x=R;break}if(f===oe.none)return i!==oe.none&&(this._current--,this._addToken(i),!0);e=_,this._current+=x+1}if(i=f,this._isAtEnd())break;e+=this._advance()}return i!==oe.none&&(this._addToken(i),!0)}_findType(e){for(const i in oe.regexTokens){const r=oe.regexTokens[i];if(this._match(e,r.rule))return r}return oe.literalTokens[e]||oe.none}_match(e,n){const i=n.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new G0(e,n,this._line,this._start,this._current))}}function Ht(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}const S_=new Float32Array(1),Jk=new Uint32Array(S_.buffer),eI=new Uint32Array(S_.buffer),E_=new Int32Array(1),tI=new Float32Array(E_.buffer),nI=new Uint32Array(E_.buffer),A_=new Uint32Array(1),iI=new Float32Array(A_.buffer),rI=new Int32Array(A_.buffer);function K0(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return S_[0]=t,Jk[0];if(n==="u32")return S_[0]=t,eI[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return E_[0]=t,tI[0];if(n==="u32")return E_[0]=t,nI[0]}else if(e==="u32"){if(n==="f32")return A_[0]=t,iI[0];if(n==="i32"||n==="x32")return A_[0]=t,rI[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class sI{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Xg{constructor(e,n){this.align=e,this.size=n}}class Jl{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Vk,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof Mm&&this._functions.set(n.name,new sI(n));for(const n of e)if(n instanceof Lc){const i=this.getTypeInfo(n,null);i instanceof Wu&&this.structs.push(i)}for(const n of e)if(n instanceof Lx)this.aliases.push(this._getAliasInfo(n));else{if(n instanceof Nx){const i=n,r=this._getAttributeNum(i.attributes,"id",0),c=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new Lk(i.name,c,i.attributes,r));continue}if(this._isUniformVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),f=this.getTypeInfo(i.type,i.attributes),a=new Wg(i.name,f,r,c,i.attributes,Hu.Uniform,i.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),f=this.getTypeInfo(i.type,i.attributes),a=this._isStorageTexture(f),_=new Wg(i.name,f,r,c,i.attributes,a?Hu.StorageTexture:Hu.Storage,i.access);_.access||(_.access="read"),this.storage.push(_);continue}if(this._isTextureVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),f=this.getTypeInfo(i.type,i.attributes),a=this._isStorageTexture(f),_=new Wg(i.name,f,r,c,i.attributes,a?Hu.StorageTexture:Hu.Texture,i.access);_.access||(_.access="read"),a?this.storage.push(_):this.textures.push(_);continue}if(this._isSamplerVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),f=this.getTypeInfo(i.type,i.attributes),a=new Wg(i.name,f,r,c,i.attributes,Hu.Sampler,i.access);this.samplers.push(a);continue}}for(const n of e)if(n instanceof Mm){const i=this._getAttribute(n,"vertex"),r=this._getAttribute(n,"fragment"),c=this._getAttribute(n,"compute"),f=i||r||c,a=new Uk(n.name,f?.name,n.attributes);a.attributes=n.attributes,a.startLine=n.startLine,a.endLine=n.endLine,this.functions.push(a),this._functions.get(n.name).info=a,f&&(this._functions.get(n.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(n,!!f),a.inputs=this._getInputs(n.args),a.outputs=this._getOutputs(n.returnType),this.entry[f.name].push(a)),a.arguments=n.args.map(_=>new Fk(_.name,this.getTypeInfo(_.type,_.attributes),_.attributes)),a.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null;continue}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(i=>{var r,c,f;if(i instanceof mT){if(i.value)if(Ht(i.value))for(const a of i.value)for(const _ of this.overrides)a===_.name&&((r=n.info)===null||r===void 0||r.overrides.push(_));else for(const a of this.overrides)i.value===a.name&&((c=n.info)===null||c===void 0||c.overrides.push(a))}else if(i instanceof Fa)for(const a of this.overrides)i.name===a.name&&((f=n.info)===null||f===void 0||f.overrides.push(a))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getFunctionInfo(e){for(const n of this.functions)if(n.name==e)return n;return null}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var i;for(const r of e.calls){const c=(i=this._functions.get(r.name))===null||i===void 0?void 0:i.info;c&&n.add(c)}}findResource(e,n,i){if(i){for(const r of this.entry.compute)if(r.name===i){for(const c of r.resources)if(c.group==e&&c.binding==n)return c}for(const r of this.entry.vertex)if(r.name===i){for(const c of r.resources)if(c.group==e&&c.binding==n)return c}for(const r of this.entry.fragment)if(r.name===i){for(const c of r.resources)if(c.group==e&&c.binding==n)return c}}for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const i=[],r=this,c=[];return e.search(f=>{if(f instanceof w_)c.push({});else if(f instanceof T_)c.pop();else if(f instanceof Vc){const a=f;n&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(f instanceof Kl){const a=f;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(f instanceof wm){const a=f;n&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(f instanceof Fa){const a=f;if(c.length>0&&c[c.length-1][a.name])return;const _=r._findResource(a.name);_&&i.push(_)}else if(f instanceof Fx){const a=f,_=r._functions.get(a.name);_&&(n&&(_.inUse=!0),e.calls.add(_.node),_.resources===null&&(_.resources=r._findResources(_.node,n)),i.push(..._.resources))}else if(f instanceof zx){const a=f,_=r._functions.get(a.name);_&&(n&&(_.inUse=!0),e.calls.add(_.node),_.resources===null&&(_.resources=r._findResources(_.node,n)),i.push(..._.resources))}}),[...new Map(i.map(f=>[f.name,f])).values()]}getBindGroups(){const e=[];function n(i,r){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),r>=e[i].length&&(e[i].length=r+1)}for(const i of this.uniforms)n(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)n(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)n(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)n(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof Lc)this._getStructOutputs(e,n);else{const i=this._getOutputInfo(e);i!==null&&n.push(i)}return n}_getStructOutputs(e,n){for(const i of e.members)if(i.type instanceof Lc)this._getStructOutputs(i.type,n);else{const r=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(r!==null){const c=this.getTypeInfo(i.type,i.type.attributes),f=this._parseInt(r.value),a=new q0(i.name,c,r.name,f);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this.getTypeInfo(e,e.attributes),r=this._parseInt(n.value);return new q0("",i,n.name,r)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const i of e)if(i.type instanceof Lc)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}return n}_getStructInputs(e,n){for(const i of e.members)if(i.type instanceof Lc)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),c=this._parseInt(n.value),f=new zk(e.name,r,n.name,c);return i!==null&&(f.interpolation=this._parseString(i.value)),f}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new Nk(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof c_){const r=e.type?this.getTypeInfo(e.type,e.attributes):null,c=new Nb(e.name,r,n);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Tm){const r=e,c=r.format?this.getTypeInfo(r.format,r.attributes):null,f=new Gu(r.name,n);return f.format=c,f.count=r.count,this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof Lc){const r=e,c=new Wu(r.name,n);c.startLine=r.startLine,c.endLine=r.endLine;for(const f of r.members){const a=this.getTypeInfo(f.type,f.attributes);c.members.push(new H0(f.name,a,f.attributes))}return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof gm){const r=e,c=r.format instanceof yt,f=r.format?c?this.getTypeInfo(r.format,null):new yo(r.format,null):null,a=new hf(r.name,f,n,r.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof je){const r=e,c=r.format?this.getTypeInfo(r.format,null):null,f=new hf(r.name,c,n,r.access);return this._types.set(e,f),this._updateTypeInfo(f),f}const i=new yo(e.name,n);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var n,i,r;const c=this._getTypeSize(e);if(e.size=(n=c?.size)!==null&&n!==void 0?n:0,e instanceof Gu&&e.format){const f=this._getTypeSize(e.format);e.stride=Math.max((i=f?.size)!==null&&i!==void 0?i:0,(r=f?.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(e.format)}e instanceof Nb&&this._updateTypeInfo(e.format),e instanceof Wu&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let i=0,r=0,c=0,f=0;for(let a=0,_=e.members.length;a<_;++a){const x=e.members[a],S=this._getTypeSize(x);if(!S)continue;(n=this._getAlias(x.type.name))!==null&&n!==void 0||x.type;const R=S.align,I=S.size;i=this._roundUp(R,i+r),r=I,c=i,f=Math.max(f,R),x.offset=i,x.size=I,this._updateTypeInfo(x.type)}e.size=this._roundUp(f,c+r),e.align=f}_getTypeSize(e){var n,i;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),c=this._getAttributeNum(e.attributes,"align",0);if(e instanceof H0&&(e=e.type),e instanceof yo){const f=this._getAlias(e.name);f!==null&&(e=f)}{const f=Jl._typeInfo[e.name];if(f!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new Xg(Math.max(c,f.align/a),Math.max(r,f.size/a))}}{const f=Jl._typeInfo[e.name.substring(0,e.name.length-1)];if(f){const a=e.name[e.name.length-1]==="h"?2:1;return new Xg(Math.max(c,f.align/a),Math.max(r,f.size/a))}}if(e instanceof Gu){let f=e,a=8,_=8;const x=this._getTypeSize(f.format);return x!==null&&(_=x.size,a=x.align),_=f.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(a,_)),r&&(_=r),new Xg(Math.max(c,a),Math.max(r,_))}if(e instanceof Wu){let f=0,a=0,_=0,x=0,S=0;for(const R of e.members){const I=this._getTypeSize(R.type);I!==null&&(f=Math.max(I.align,f),_=this._roundUp(I.align,_+x),x=I.size,S=_)}return a=this._roundUp(f,S+x),new Xg(Math.max(c,f),Math.max(r,a))}return null}_isUniformVar(e){return e instanceof Vc&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Vc&&e.storage=="storage"}_isTextureVar(e){return e instanceof Vc&&e.type!==null&&Jl._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Vc&&e.type!==null&&Jl._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const i=e;if(!i||!i.attributes)return null;const r=i.attributes;for(let c of r)if(c.name==n)return c;return null}_getAttributeNum(e,n,i){if(e===null)return i;for(let r of e)if(r.name==n){let c=r!==null&&r.value!==null?r.value:i;return c instanceof Array&&(c=c[0]),typeof c=="number"?c:typeof c=="string"?parseInt(c):i}return i}_roundUp(e,n){return Math.ceil(n/e)*e}}Jl._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Jl._textureTypes=oe.any_texture_type.map(t=>t.name),Jl._samplerTypes=oe.sampler_type.map(t=>t.name);let Ux=0;class Vx{constructor(e,n,i){this.id=Ux++,this.name=e,this.value=n,this.node=i}clone(){return new Vx(this.name,this.value,this.node)}}class jx{constructor(e){this.id=Ux++,this.name=e.name,this.node=e}clone(){return new jx(this.node)}}class $x{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Ux++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,i){this.variables.set(e,new Vx(e,n,i??null))}setVariable(e,n,i){const r=this.getVariable(e);r!==null?r.value=n:this.createVariable(e,n,i)}getVariableValue(e){var n;const i=this.getVariable(e);return(n=i?.value)!==null&&n!==void 0?n:null}clone(){return new $x(this)}}class aI{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class oI{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const i=this.exec.evalExpression(e.args[0],n);let r=!0;if(i instanceof de)return i.data.forEach(c=>{c||(r=!1)}),new Oe(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de){const r=i.data.some(c=>c);return new Oe(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const i=this.exec.evalExpression(e.args[2],n);if(!(i instanceof Oe))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.evalExpression(i,n);if(r instanceof Tr&&r.typeInfo.size===0){const c=r.typeInfo,f=r.buffer.byteLength/c.stride;return new Oe(f,this.getTypeInfo("u32"))}return new Oe(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.abs(c)),i.typeInfo);const r=i;return new Oe(Math.abs(r.value),r.typeInfo)}Acos(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.acos(c)),i.typeInfo);const r=i;return new Oe(Math.acos(r.value),i.typeInfo)}Acosh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.acosh(c)),i.typeInfo);const r=i;return new Oe(Math.acosh(r.value),i.typeInfo)}Asin(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.asin(c)),i.typeInfo);const r=i;return new Oe(Math.asin(r.value),i.typeInfo)}Asinh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.asinh(c)),i.typeInfo);const r=i;return new Oe(Math.asinh(r.value),i.typeInfo)}Atan(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.atan(c)),i.typeInfo);const r=i;return new Oe(Math.atan(r.value),i.typeInfo)}Atanh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.atanh(c)),i.typeInfo);const r=i;return new Oe(Math.atanh(r.value),i.typeInfo)}Atan2(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de)return new de(i.data.map((a,_)=>Math.atan2(a,r.data[_])),i.typeInfo);const c=i,f=r;return new Oe(Math.atan2(c.value,f.value),i.typeInfo)}Ceil(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.ceil(c)),i.typeInfo);const r=i;return new Oe(Math.ceil(r.value),i.typeInfo)}_clamp(e,n,i){return Math.min(Math.max(e,n),i)}Clamp(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(i instanceof de&&r instanceof de&&c instanceof de)return new de(i.data.map((x,S)=>this._clamp(x,r.data[S],c.data[S])),i.typeInfo);const f=i,a=r,_=c;return new Oe(this._clamp(f.value,a.value,_.value),i.typeInfo)}Cos(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.cos(c)),i.typeInfo);const r=i;return new Oe(Math.cos(r.value),i.typeInfo)}Cosh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.cosh(c)),i.typeInfo);const r=i;return new Oe(Math.cos(r.value),i.typeInfo)}CountLeadingZeros(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.clz32(c)),i.typeInfo);const r=i;return new Oe(Math.clz32(r.value),i.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>this._countOneBits(c)),i.typeInfo);const r=i;return new Oe(this._countOneBits(r.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>this._countTrailingZeros(c)),i.typeInfo);const r=i;return new Oe(this._countTrailingZeros(r.value),i.typeInfo)}Cross(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de){if(i.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const c=i.data,f=r.data;return new de([c[1]*f[2]-f[1]*c[2],c[2]*f[0]-f[2]*c[0],c[0]*f[1]-f[0]*c[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const i=this.exec.evalExpression(e.args[0],n),r=180/Math.PI;return i instanceof de?new de(i.data.map(c=>c*r),i.typeInfo):new Oe(i.value*r,this.getTypeInfo("f32"))}Determinant(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof mn){const r=i.data,c=i.typeInfo.getTypeName(),f=c.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h")return new Oe(r[0]*r[3]-r[1]*r[2],f);if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h")return new Oe(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),f);if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h")console.error(`TODO: Determinant for ${c}`);else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h")console.error(`TODO: Determinant for ${c}`);else{if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h")return new Oe(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),f);c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"||c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"||c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"?console.error(`TODO: Determinant for ${c}`):c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h"||console.error(`TODO: Determinant for ${c}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de){let a=0;for(let _=0;_<i.data.length;++_)a+=(i.data[_]-r.data[_])*(i.data[_]-r.data[_]);return new Oe(Math.sqrt(a),this.getTypeInfo("f32"))}const c=i,f=r;return new Oe(Math.abs(c.value-f.value),i.typeInfo)}_dot(e,n){let i=0;for(let r=0;r<e.length;++r)i+=n[r]*e[r];return i}Dot(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);return i instanceof de&&r instanceof de?new Oe(this._dot(i.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.exp(c)),i.typeInfo);const r=i;return new Oe(Math.exp(r.value),i.typeInfo)}Exp2(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.pow(2,c)),i.typeInfo);const r=i;return new Oe(Math.pow(2,r.value),i.typeInfo)}ExtractBits(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const f=r.value,a=c.value;if(i instanceof de)return new de(i.data.map(x=>x>>f&(1<<a)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const _=i.value;return new Oe(_>>f&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(i instanceof de&&r instanceof de&&c instanceof de){const f=this._dot(r.data,c.data);return new de(f<0?Array.from(i.data):i.data.map(a=>-a),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>this._firstLeadingBit(c)),i.typeInfo);const r=i;return new Oe(this._firstLeadingBit(r.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>this._firstTrailingBit(c)),i.typeInfo);const r=i;return new Oe(this._firstTrailingBit(r.value),i.typeInfo)}Floor(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.floor(c)),i.typeInfo);const r=i;return new Oe(Math.floor(r.value),i.typeInfo)}Fma(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(i instanceof de&&r instanceof de&&c instanceof de)return i.data.length!==r.data.length||i.data.length!==c.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new de(i.data.map((x,S)=>x*r.data[S]+c.data[S]),i.typeInfo);const f=i,a=r,_=c;return new Oe(f.value*a.value+_.value,f.typeInfo)}Fract(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>c-Math.floor(c)),i.typeInfo);const r=i;return new Oe(r.value-Math.floor(r.value),i.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n),f=this.exec.evalExpression(e.args[3],n);if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=c.value,_=(1<<f.value)-1<<a,x=~_;if(i instanceof de&&r instanceof de)return new de(i.data.map((I,N)=>I&x|r.data[N]<<a&_),i.typeInfo);const S=i.value,R=r.value;return new Oe(S&x|R<<a&_,i.typeInfo)}InverseSqrt(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>1/Math.sqrt(c)),i.typeInfo);const r=i;return new Oe(1/Math.sqrt(r.value),i.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de){let c=0;return i.data.forEach(f=>{c+=f*f}),new Oe(Math.sqrt(c),this.getTypeInfo("f32"))}const r=i;return new Oe(Math.abs(r.value),i.typeInfo)}Log(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.log(c)),i.typeInfo);const r=i;return new Oe(Math.log(r.value),i.typeInfo)}Log2(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.log2(c)),i.typeInfo);const r=i;return new Oe(Math.log2(r.value),i.typeInfo)}Max(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de)return new de(i.data.map((a,_)=>Math.max(a,r.data[_])),i.typeInfo);const c=i,f=r;return new Oe(Math.max(c.value,f.value),i.typeInfo)}Min(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de)return new de(i.data.map((a,_)=>Math.min(a,r.data[_])),i.typeInfo);const c=i,f=r;return new Oe(Math.min(c.value,f.value),i.typeInfo)}Mix(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(i instanceof de&&r instanceof de&&c instanceof de)return new de(i.data.map((_,x)=>i.data[x]*(1-c.data[x])+r.data[x]*c.data[x]),i.typeInfo);const f=r,a=c;return new Oe(i.value*(1-a.value)+f.value*a.value,i.typeInfo)}Modf(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de)return new de(i.data.map((f,a)=>f%r.data[a]),i.typeInfo);const c=r;return new Oe(i.value%c.value,i.typeInfo)}Normalize(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de){const r=this.Length(e,n).value;return new de(i.data.map(c=>c/r),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de)return new de(i.data.map((a,_)=>Math.pow(a,r.data[_])),i.typeInfo);const c=i,f=r;return new Oe(Math.pow(c.value,f.value),i.typeInfo)}QuantizeToF16(e,n){const i=this.exec.evalExpression(e.args[0],n);return i instanceof de?new de(i.data.map(r=>r),i.typeInfo):new Oe(i.value,i.typeInfo)}Radians(e,n){const i=this.exec.evalExpression(e.args[0],n);return i instanceof de?new de(i.data.map(r=>r*Math.PI/180),i.typeInfo):new Oe(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof de&&r instanceof de){const c=this._dot(i.data,r.data);return new de(i.data.map((f,a)=>f-2*c*r.data[a]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(i instanceof de&&r instanceof de&&c instanceof Oe){const f=this._dot(r.data,i.data);return new de(i.data.map((a,_)=>{const x=1-c.value*c.value*(1-f*f);if(x<0)return 0;const S=Math.sqrt(x);return c.value*a-(c.value*f+S)*r.data[_]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.round(c)),i.typeInfo);const r=i;return new Oe(Math.round(r.value),i.typeInfo)}Saturate(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.min(Math.max(c,0),1)),i.typeInfo);const r=i;return new Oe(Math.min(Math.max(r.value,0),1),i.typeInfo)}Sign(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.sign(c)),i.typeInfo);const r=i;return new Oe(Math.sign(r.value),i.typeInfo)}Sin(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.sin(c)),i.typeInfo);const r=i;return new Oe(Math.sin(r.value),i.typeInfo)}Sinh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.sinh(c)),i.typeInfo);const r=i;return new Oe(Math.sinh(r.value),i.typeInfo)}_smoothstep(e,n,i){const r=Math.min(Math.max((i-e)/(n-e),0),1);return r*r*(3-2*r)}SmoothStep(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),c=this.exec.evalExpression(e.args[2],n);if(c instanceof de&&i instanceof de&&r instanceof de)return new de(c.data.map((x,S)=>this._smoothstep(i.data[S],r.data[S],x)),c.typeInfo);const f=i,a=r,_=c;return new Oe(this._smoothstep(f.value,a.value,_.value),c.typeInfo)}Sqrt(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.sqrt(c)),i.typeInfo);const r=i;return new Oe(Math.sqrt(r.value),i.typeInfo)}Step(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(r instanceof de&&i instanceof de)return new de(r.data.map((f,a)=>f<i.data[a]?0:1),r.typeInfo);const c=i;return new Oe(r.value<c.value?0:1,c.typeInfo)}Tan(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.tan(c)),i.typeInfo);const r=i;return new Oe(Math.tan(r.value),i.typeInfo)}Tanh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.tanh(c)),i.typeInfo);const r=i;return new Oe(Math.tanh(r.value),i.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const i=this.exec.evalExpression(e.args[0],n);if(!(i instanceof mn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const r=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const c=i.data;return new mn([c[0],c[2],c[1],c[3]],r)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const c=i.data;return new mn([c[0],c[3],c[6],c[1],c[4],c[7]],r)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const c=i.data;return new mn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13]],r)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const c=i.data;return new mn([c[0],c[3],c[1],c[4],c[2],c[5]],r)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const c=i.data;return new mn([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]],r)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const c=i.data;return new mn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14]],r)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const c=i.data;return new mn([c[0],c[4],c[1],c[5],c[2],c[6]],r)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const c=i.data;return new mn([c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]],r)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const c=i.data;return new mn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]],r)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof de)return new de(i.data.map(c=>Math.trunc(c)),i.typeInfo);const r=i;return new Oe(Math.trunc(r.value),i.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const i=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(i instanceof Fa){const c=i.name,f=n.getVariableValue(c);if(f instanceof Fc){if(r<0||r>=f.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=f.getMipLevelSize(r),_=f.dimension;return _==="1d"?new Oe(a[0],this.getTypeInfo("u32")):_==="3d"?new de(a,this.getTypeInfo("vec3u")):_==="2d"?new de(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${_} not found. Line ${e.line}`),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const i=e.args[0],r=this.exec.evalExpression(e.args[1],n),c=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(r instanceof de)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof Fa){const f=i.name,a=n.getVariableValue(f);if(a instanceof Fc){const _=Math.floor(r.data[0]),x=Math.floor(r.data[1]);if(_<0||_>=a.width||x<0||x>=a.height)return console.error(`Texture ${f} out of bounds. Line ${e.line}`),null;const S=a.getPixel(_,x,0,c);return S===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new de(S,this.getTypeInfo("vec4f"))}return console.error(`Texture ${f} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const i=e.args[0];if(i instanceof Fa){const r=i.name,c=n.getVariableValue(r);return c instanceof Fc?new Oe(c.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const i=e.args[0];if(i instanceof Fa){const r=i.name,c=n.getVariableValue(r);return c instanceof Fc?new Oe(c.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const i=e.args[0];if(i instanceof Fa){const r=i.name,c=n.getVariableValue(r);return c instanceof Fc?new Oe(c.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const i=e.args[0],r=this.exec.evalExpression(e.args[1],n),c=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,f=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(f.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof de)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof Fa){const a=i.name,_=n.getVariableValue(a);if(_ instanceof Fc){const x=_.getMipLevelSize(0),S=Math.floor(r.data[0]),R=Math.floor(r.data[1]);return S<0||S>=x[0]||R<0||R>=x[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(_.setPixel(S,R,0,c,Array.from(f)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n);return n.getVariable(r).value.getSubData(this.exec,i.postfix,n)}AtomicStore(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n);return _ instanceof Oe&&a instanceof Oe&&(_.value=a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),null}AtomicAdd(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value+=a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicSub(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value-=a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicMax(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value=Math.max(_.value,a.value)),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicMin(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value=Math.min(_.value,a.value)),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicAnd(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value=_.value&a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicOr(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value=_.value|a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicXor(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value=_.value^a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicExchange(e,n){let i=e.args[0];i instanceof $r&&(i=i.right);const r=this.exec.getVariableName(i,n),c=n.getVariable(r);let f=e.args[1];const a=this.exec.evalExpression(f,n),_=c.value.getSubData(this.exec,i.postfix,n),x=new Oe(_.value,_.typeInfo);return _ instanceof Oe&&a instanceof Oe&&(_.value=a.value),c.value instanceof Tr&&c.value.setDataValue(this.exec,_,i.postfix,n),x}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const qy={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},ea={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Fs extends aI{constructor(e,n){var i;super(),this.ast=e??[],this.reflection=new Jl,this.reflection.updateAST(this.ast),this.context=(i=n?.clone())!==null&&i!==void 0?i:new $x,this.builtins=new oI(this),this.typeInfo={bool:this.getTypeInfo(yt.bool),i32:this.getTypeInfo(yt.i32),u32:this.getTypeInfo(yt.u32),f32:this.getTypeInfo(yt.f32),f16:this.getTypeInfo(yt.f16),vec2f:this.getTypeInfo(je.vec2f),vec2u:this.getTypeInfo(je.vec2u),vec2i:this.getTypeInfo(je.vec2i),vec2h:this.getTypeInfo(je.vec2h),vec3f:this.getTypeInfo(je.vec3f),vec3u:this.getTypeInfo(je.vec3u),vec3i:this.getTypeInfo(je.vec3i),vec3h:this.getTypeInfo(je.vec3h),vec4f:this.getTypeInfo(je.vec4f),vec4u:this.getTypeInfo(je.vec4u),vec4i:this.getTypeInfo(je.vec4i),vec4h:this.getTypeInfo(je.vec4h),mat2x2f:this.getTypeInfo(je.mat2x2f),mat2x3f:this.getTypeInfo(je.mat2x3f),mat2x4f:this.getTypeInfo(je.mat2x4f),mat3x2f:this.getTypeInfo(je.mat3x2f),mat3x3f:this.getTypeInfo(je.mat3x3f),mat3x4f:this.getTypeInfo(je.mat3x4f),mat4x2f:this.getTypeInfo(je.mat4x2f),mat4x3f:this.getTypeInfo(je.mat4x3f),mat4x4f:this.getTypeInfo(je.mat4x4f)}}getVariableValue(e){var n,i;const r=(i=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&i!==void 0?i:null;if(r===null)return null;if(r instanceof Oe)return r.value;if(r instanceof de||r instanceof mn)return Array.from(r.data);if(r instanceof Tr&&r.typeInfo instanceof Gu){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,i,r){const c=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,c),this._execStatements(this.ast,c);const f=c.getFunction(e);if(!f)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const a=n[0],_=n[1],x=n[2],S=this.getTypeInfo("vec3u");c.setVariable("@num_workgroups",new de(n,S));const R=this.reflection.getFunctionInfo(e);R===null&&console.error(`Function ${e} not found in reflection data`);for(const I in i)for(const N in i[I]){const L=i[I][N];c.variables.forEach(H=>{var ie;const ne=H.node;if(ne?.attributes){let he=null,re=null;for(const ge of ne.attributes)ge.name==="binding"?he=ge.value:ge.name==="group"&&(re=ge.value);if(N==he&&I==re){let ge=!1;for(const _e of R.resources)if(_e.name===H.name&&_e.group===parseInt(I)&&_e.binding===parseInt(N)){ge=!0;break}if(ge)if(L.texture!==void 0&&L.descriptor!==void 0){const _e=new Fc(L.texture,this.getTypeInfo(ne.type),L.descriptor,(ie=L.texture.view)!==null&&ie!==void 0?ie:null);H.value=_e}else L.uniform!==void 0?H.value=new Tr(L.uniform,this.getTypeInfo(ne.type)):H.value=new Tr(L,this.getTypeInfo(ne.type))}}})}for(let I=0;I<x;++I)for(let N=0;N<_;++N)for(let L=0;L<a;++L)c.setVariable("@workgroup_id",new de([L,N,I],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(f,[L,N,I],c)}execStatement(e,n){if(e instanceof sT)return this.evalExpression(e.value,n);if(e instanceof oT){if(e.condition){const i=this.evalExpression(e.condition,n);if(!(i instanceof Oe))throw new Error("Invalid break-if condition");if(!i.value)return null}return Fs._breakObj}if(e instanceof lT)return Fs._continueObj;if(e instanceof wm)this._let(e,n);else if(e instanceof Vc)this._var(e,n);else if(e instanceof l_)this._const(e,n);else if(e instanceof Mm)this._function(e,n);else{if(e instanceof rT)return this._if(e,n);if(e instanceof iT)return this._switch(e,n);if(e instanceof J2)return this._for(e,n);if(e instanceof Q2)return this._while(e,n);if(e instanceof nT)return this._loop(e,n);if(e instanceof zb){const i=n.clone();return i.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof tT)this._assign(e,n);else if(e instanceof eT)this._increment(e,n);else{if(e instanceof Lc)return null;if(e instanceof Nx){const i=e.name;n.getVariable(i)===null&&n.setVariable(i,new Oe(0,this.getTypeInfo("u32")))}else if(e instanceof zx)this._call(e,n);else{if(e instanceof aT||e instanceof Lx)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Qo?this._evalBinaryOp(e,n):e instanceof Jr?this._evalLiteral(e,n):e instanceof Fa?this._evalVariable(e,n):e instanceof Fx?this._evalCall(e,n):e instanceof Kl?this._evalCreate(e,n):e instanceof cT?this._evalConst(e,n):e instanceof uT?this._evalBitcast(e,n):e instanceof $r?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof yt){const r=this.reflection.getTypeInfo(e);if(r!==null)return r}let i=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,n){for(const i in e){const r=e[i],c=this.reflection.getOverrideInfo(i);c!==null?(c.type===null&&(c.type=this.getTypeInfo("u32")),c.type.name==="u32"||c.type.name==="i32"||c.type.name==="f32"||c.type.name==="f16"?n.setVariable(i,new Oe(r,c.type)):c.type.name==="bool"?n.setVariable(i,new Oe(r?1:0,c.type)):c.type.name==="vec2"||c.type.name==="vec3"||c.type.name==="vec4"||c.type.name==="vec2f"||c.type.name==="vec3f"||c.type.name==="vec4f"||c.type.name==="vec2i"||c.type.name==="vec3i"||c.type.name==="vec4i"||c.type.name==="vec2u"||c.type.name==="vec3u"||c.type.name==="vec4u"||c.type.name==="vec2h"||c.type.name==="vec3h"||c.type.name==="vec4h"?n.setVariable(i,new de(r,c.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,i){const r=[1,1,1];for(const S of e.node.attributes)if(S.name==="workgroup_size"){if(S.value.length>0){const R=i.getVariableValue(S.value[0]);r[0]=R instanceof Oe?R.value:parseInt(S.value[0])}if(S.value.length>1){const R=i.getVariableValue(S.value[1]);r[1]=R instanceof Oe?R.value:parseInt(S.value[1])}if(S.value.length>2){const R=i.getVariableValue(S.value[2]);r[2]=R instanceof Oe?R.value:parseInt(S.value[2])}}const c=this.getTypeInfo("vec3u"),f=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new de(r,c));const a=r[0],_=r[1],x=r[2];for(let S=0,R=0;S<x;++S)for(let I=0;I<_;++I)for(let N=0;N<a;++N,++R){const L=[N,I,S],H=[N+n[0]*r[0],I+n[1]*r[1],S+n[2]*r[2]];i.setVariable("@local_invocation_id",new de(L,c)),i.setVariable("@global_invocation_id",new de(H,c)),i.setVariable("@local_invocation_index",new Oe(R,f)),this._dispatchExec(e,i)}}_dispatchExec(e,n){for(const i of e.node.args)for(const r of i.attributes)if(r.name==="builtin"){const c=`@${r.value}`,f=n.getVariable(c);f!==void 0&&n.variables.set(i.name,f)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof $r;)e=e.right;return e instanceof Fa?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const i of e){if(i instanceof Array){const c=n.clone(),f=this._execStatements(i,c);if(f)return f;continue}const r=this.execStatement(i,n);if(r)return r}return null}_call(e,n){const i=n.clone();i.currentFunctionName=e.name;const r=n.getFunction(e.name);if(r){for(let c=0;c<r.node.args.length;++c){const f=r.node.args[c],a=this.evalExpression(e.args[c],i);i.setVariable(f.name,a,f)}this._execStatements(r.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const i=this.getVariableName(e.variable,n),r=n.getVariable(i);r?e.operator==="++"?r.value instanceof Oe?r.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?r.value instanceof Oe?r.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof Fa){const i=this.getVariableName(e,n),r=n.getVariable(i);return r===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,n)}if(e instanceof $r){if(e.operator==="*"){const i=this._getVariableData(e.right,n);return i instanceof hd?i.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,n);return new hd(i)}}return null}_assign(e,n){let i=null,r="<var>",c=null;if(e.variable instanceof $r){const _=this._getVariableData(e.variable,n),x=this.evalExpression(e.value,n),S=e.operator;if(S==="="){if(_ instanceof Oe||_ instanceof de||_ instanceof mn){if(x instanceof Oe||x instanceof de||x instanceof mn&&_.data.length===x.data.length)return void _.data.set(x.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(_ instanceof Tr&&x instanceof Tr&&_.buffer.byteLength-_.offset>=x.buffer.byteLength-x.offset)return void(_.buffer.byteLength%4==0?new Uint32Array(_.buffer,_.offset,_.typeInfo.size/4).set(new Uint32Array(x.buffer,x.offset,x.typeInfo.size/4)):new Uint8Array(_.buffer,_.offset,_.typeInfo.size).set(new Uint8Array(x.buffer,x.offset,x.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(S==="+=")return _ instanceof Oe||_ instanceof de||_ instanceof mn?x instanceof Oe||x instanceof de||x instanceof mn?void _.data.set(x.data.map((R,I)=>_.data[I]+R)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(S==="-=")return(_ instanceof Oe||_ instanceof de||_ instanceof mn)&&(x instanceof Oe||x instanceof de||x instanceof mn)?void _.data.set(x.data.map((R,I)=>_.data[I]-R)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof $r){if(e.variable.operator==="*"){r=this.getVariableName(e.variable.right,n);const _=n.getVariable(r);if(!(_&&_.value instanceof hd))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);i=_.value.reference;let x=e.variable.postfix;if(!x){let S=e.variable.right;for(;S instanceof $r;){if(S.postfix){x=S.postfix;break}S=S.right}}x&&(i=i.getSubData(this,x,n))}}else{c=e.variable.postfix,r=this.getVariableName(e.variable,n);const _=n.getVariable(r);if(_===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);i=_.value}if(i instanceof hd&&(i=i.reference),i===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);const f=this.evalExpression(e.value,n),a=e.operator;if(a!=="="){const _=i.getSubData(this,c,n);if(_ instanceof de&&f instanceof Oe){const x=_.data,S=f.value;if(a==="+=")for(let R=0;R<x.length;++R)x[R]+=S;else if(a==="-=")for(let R=0;R<x.length;++R)x[R]-=S;else if(a==="*=")for(let R=0;R<x.length;++R)x[R]*=S;else if(a==="/=")for(let R=0;R<x.length;++R)x[R]/=S;else if(a==="%=")for(let R=0;R<x.length;++R)x[R]%=S;else if(a==="&=")for(let R=0;R<x.length;++R)x[R]&=S;else if(a==="|=")for(let R=0;R<x.length;++R)x[R]|=S;else if(a==="^=")for(let R=0;R<x.length;++R)x[R]^=S;else if(a==="<<=")for(let R=0;R<x.length;++R)x[R]<<=S;else if(a===">>=")for(let R=0;R<x.length;++R)x[R]>>=S;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(_ instanceof de&&f instanceof de){const x=_.data,S=f.data;if(x.length!==S.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let R=0;R<x.length;++R)x[R]+=S[R];else if(a==="-=")for(let R=0;R<x.length;++R)x[R]-=S[R];else if(a==="*=")for(let R=0;R<x.length;++R)x[R]*=S[R];else if(a==="/=")for(let R=0;R<x.length;++R)x[R]/=S[R];else if(a==="%=")for(let R=0;R<x.length;++R)x[R]%=S[R];else if(a==="&=")for(let R=0;R<x.length;++R)x[R]&=S[R];else if(a==="|=")for(let R=0;R<x.length;++R)x[R]|=S[R];else if(a==="^=")for(let R=0;R<x.length;++R)x[R]^=S[R];else if(a==="<<=")for(let R=0;R<x.length;++R)x[R]<<=S[R];else if(a===">>=")for(let R=0;R<x.length;++R)x[R]>>=S[R];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(_ instanceof Oe&&f instanceof Oe))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?_.value+=f.value:a==="-="?_.value-=f.value:a==="*="?_.value*=f.value:a==="/="?_.value/=f.value:a==="%="?_.value%=f.value:a==="&="?_.value&=f.value:a==="|="?_.value|=f.value:a==="^="?_.value^=f.value:a==="<<="?_.value<<=f.value:a===">>="?_.value>>=f.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(i instanceof Tr&&i.setDataValue(this,_,c,n))}if(i instanceof Tr)i.setDataValue(this,f,c,n);else if(c){if(!(i instanceof de||i instanceof mn))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(c instanceof Id){const _=this.evalExpression(c.index,n).value;if(i instanceof de){if(!(f instanceof Oe))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[_]=f.value}else{if(!(i instanceof mn))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const x=this.evalExpression(c.index,n).value;if(x<0)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(f instanceof de))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const S=i.typeInfo.getTypeName();if(S==="mat2x2"||S==="mat2x2f"||S==="mat2x2h"){if(!(x<2&&f.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*x]=f.data[0],i.data[2*x+1]=f.data[1]}else if(S==="mat2x3"||S==="mat2x3f"||S==="mat2x3h"){if(!(x<2&&f.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*x]=f.data[0],i.data[3*x+1]=f.data[1],i.data[3*x+2]=f.data[2]}else if(S==="mat2x4"||S==="mat2x4f"||S==="mat2x4h"){if(!(x<2&&f.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*x]=f.data[0],i.data[4*x+1]=f.data[1],i.data[4*x+2]=f.data[2],i.data[4*x+3]=f.data[3]}else if(S==="mat3x2"||S==="mat3x2f"||S==="mat3x2h"){if(!(x<3&&f.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*x]=f.data[0],i.data[2*x+1]=f.data[1]}else if(S==="mat3x3"||S==="mat3x3f"||S==="mat3x3h"){if(!(x<3&&f.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*x]=f.data[0],i.data[3*x+1]=f.data[1],i.data[3*x+2]=f.data[2]}else if(S==="mat3x4"||S==="mat3x4f"||S==="mat3x4h"){if(!(x<3&&f.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*x]=f.data[0],i.data[4*x+1]=f.data[1],i.data[4*x+2]=f.data[2],i.data[4*x+3]=f.data[3]}else if(S==="mat4x2"||S==="mat4x2f"||S==="mat4x2h"){if(!(x<4&&f.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*x]=f.data[0],i.data[2*x+1]=f.data[1]}else if(S==="mat4x3"||S==="mat4x3f"||S==="mat4x3h"){if(!(x<4&&f.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*x]=f.data[0],i.data[3*x+1]=f.data[1],i.data[3*x+2]=f.data[2]}else{if(S!=="mat4x4"&&S!=="mat4x4f"&&S!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(x<4&&f.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*x]=f.data[0],i.data[4*x+1]=f.data[1],i.data[4*x+2]=f.data[2],i.data[4*x+3]=f.data[3]}}}}}else if(c instanceof ff){const _=c.value;if(!(i instanceof de))return void console.error(`Invalid assignment to ${_}. Variable ${r} is not a vector. Line ${e.line}`);if(f instanceof Oe){if(_.length>1)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${e.line}`);if(_==="x")i.data[0]=f.value;else if(_==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${e.line}`);i.data[1]=f.value}else if(_==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${e.line}`);i.data[2]=f.value}else if(_==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${e.line}`);i.data[3]=f.value}}else{if(!(f instanceof de))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(_.length!==f.data.length)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${e.line}`);for(let x=0;x<_.length;++x){const S=_[x];if(S==="x"||S==="r")i.data[0]=f.data[x];else if(S==="y"||S==="g"){if(f.data.length<2)return void console.error(`Invalid assignment to ${S} for variable ${r}. Line ${e.line}`);i.data[1]=f.data[x]}else if(S==="z"||S==="b"){if(f.data.length<3)return void console.error(`Invalid assignment to ${S} for variable ${r}. Line ${e.line}`);i.data[2]=f.data[x]}else{if(S!=="w"&&S!=="a")return void console.error(`Invalid assignment to ${S} for variable ${r}. Line ${e.line}`);if(f.data.length<4)return void console.error(`Invalid assignment to ${S} for variable ${r}. Line ${e.line}`);i.data[3]=f.data[x]}}}}}else i instanceof Oe&&f instanceof Oe?i.value=f.value:i instanceof de&&f instanceof de||i instanceof mn&&f instanceof mn?i.data.set(f.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`)}_function(e,n){const i=new jx(e);n.functions.set(e.name,i)}_const(e,n){let i=null;e.value!==null&&(i=this.evalExpression(e.value,n)),n.createVariable(e.name,i,e)}_let(e,n){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,n),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof $r||(i=i.clone())}else{const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const c=new Kl(e.type,[]);i=this._evalCreate(c,n)}}n.createVariable(e.name,i,e)}_var(e,n){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,n),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof $r||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||e.type instanceof Tm||e.type instanceof Lc||e.type instanceof je){const c=new Kl(e.type,[]);i=this._evalCreate(c,n)}}n.createVariable(e.name,i,e)}_switch(e,n){n=n.clone();const i=this.evalExpression(e.condition,n);if(!(i instanceof Oe))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(const c of e.cases)if(c instanceof dT)for(const f of c.selectors){if(f instanceof u_){r=c;continue}const a=this.evalExpression(f,n);if(!(a instanceof Oe))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===i.value)return this._execStatements(c.body,n)}else c instanceof pT&&(r=c);return r?this._execStatements(r.body,n):null}_if(e,n){n=n.clone();const i=this.evalExpression(e.condition,n);if(!(i instanceof Oe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,n);for(const r of e.elseif){const c=this.evalExpression(r.condition,n);if(!(c instanceof Oe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(c.value)return this._execStatements(r.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof Oe?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const i=this._execStatements(e.body,n);if(i===Fs._breakObj)break;if(i!==null&&i!==Fs._continueObj)return i;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const i=this._execStatements(e.body,n);if(i===Fs._breakObj)break;if(i===Fs._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===Fs._breakObj)break}else if(i!==null)return i}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const i=this._execStatements(e.body,n);if(i===Fs._breakObj)break;if(i!==Fs._continueObj&&i!==null)return i}return null}_evalBitcast(e,n){const i=this.evalExpression(e.value,n),r=e.type;if(i instanceof Oe){const c=K0(i.value,i.typeInfo.name,r.name);return new Oe(c,this.getTypeInfo(r))}if(i instanceof de){const c=i.typeInfo.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;f="f16"}const a=r.getTypeName();let _="";if(a.endsWith("f"))_="f32";else if(a.endsWith("i"))_="i32";else if(a.endsWith("u"))_="u32";else if(a.endsWith("b"))_="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${_}. Line ${e.line}`),null;_="f16"}const x=function(S,R,I){if(R===I)return S;const N=new Array(S.length);for(let L=0;L<S.length;L++)N[L]=K0(S[L],R,I);return N}(Array.from(i.data),f,_);return new de(x,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var i;if(e instanceof Kl){if(e.type===null)return Lb.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const r=e instanceof Kl?e.type.name:e.name,c=e instanceof Kl?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(c===null)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(c.size===0)return null;const f=new Tr(new ArrayBuffer(c.size),c,0);if(c instanceof Wu){if(e.args)for(let a=0;a<e.args.length;++a){const _=c.members[a],x=e.args[a],S=this.evalExpression(x,n);f.setData(this,S,_.type,_.offset,n)}}else if(c instanceof Gu){let a=0;if(e.args)for(let _=0;_<e.args.length;++_){const x=e.args[_],S=this.evalExpression(x,n);c.format===null&&(((i=S.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?c.format=this.getTypeInfo("i32"):c.format=S.typeInfo),f.setData(this,S,c.format,a,n),a+=c.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof Kl?f.getSubData(this,e.postfix,n):f}_evalLiteral(e,n){const i=this.getTypeInfo(e.type),r=i.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new Oe(e.scalarValue,i):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(e,n):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const i=n.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let i=1;i<e.length;++i){const r=Fs._priority.get(n.name);Fs._priority.get(e[i].name)<r&&(n=e[i])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const i=this.evalExpression(e.right,n);if(e.operator==="&")return new hd(i);if(e.operator==="*")return i instanceof hd?i.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const r=i instanceof Oe?i.value:i instanceof de?Array.from(i.data):null;switch(e.operator){case"+":{if(Ht(r)){const a=r.map((_,x)=>+_);return new de(a,i.typeInfo)}const c=r,f=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new Oe(+c,f)}case"-":{if(Ht(r)){const a=r.map((_,x)=>-_);return new de(a,i.typeInfo)}const c=r,f=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new Oe(-c,f)}case"!":{if(Ht(r)){const a=r.map((_,x)=>_?0:1);return new de(a,i.typeInfo)}const c=r,f=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new Oe(c?0:1,f)}case"~":{if(Ht(r)){const a=r.map((_,x)=>~_);return new de(a,i.typeInfo)}const c=r,f=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new Oe(~c,f)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const i=this.evalExpression(e.left,n),r=this.evalExpression(e.right,n),c=i instanceof Oe?i.value:i instanceof de||i instanceof mn?Array.from(i.data):null,f=r instanceof Oe?r.value:r instanceof de||r instanceof mn?Array.from(r.data):null;switch(e.operator){case"+":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N+R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I+S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S+I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a+_,x)}case"-":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N-R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I-S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S-I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a-_,x)}case"*":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(i instanceof mn&&r instanceof mn){const I=function(ie,ne,he,re){if(ea[ne.name]===void 0||ea[re.name]===void 0)return null;const ge=ea[ne.name][0],_e=ea[ne.name][1],pe=ea[re.name][0];if(ge!==ea[re.name][1])return null;const it=new Array(pe*_e);for(let mt=0;mt<_e;mt++)for(let nt=0;nt<pe;nt++){let Ce=0;for(let ht=0;ht<ge;ht++)Ce+=ie[ht*_e+mt]*he[nt*ge+ht];it[mt*pe+nt]=Ce}return it}(S,i.typeInfo,R,r.typeInfo);if(I===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const N=ea[r.typeInfo.name][0],L=ea[i.typeInfo.name][1],H=this.getTypeInfo(`mat${N}x${L}f`);return new mn(I,H)}if(i instanceof mn&&r instanceof de){const I=function(N,L,H,ie){if(ea[L.name]===void 0||qy[ie.name]===void 0)return null;const ne=ea[L.name][0],he=ea[L.name][1];if(ne!==H.length)return null;const re=new Array(he);for(let ge=0;ge<he;ge++){let _e=0;for(let pe=0;pe<ne;pe++)_e+=N[pe*he+ge]*H[pe];re[ge]=_e}return re}(S,i.typeInfo,R,r.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new de(I,r.typeInfo)}if(i instanceof de&&r instanceof mn){const I=function(N,L,H,ie){if(qy[L.name]===void 0||ea[ie.name]===void 0)return null;const ne=ea[ie.name][0],he=ea[ie.name][1];if(he!==N.length)return null;const re=[];for(let ge=0;ge<ne;ge++){let _e=0;for(let pe=0;pe<he;pe++)_e+=N[pe]*H[pe*ne+ge];re[ge]=_e}return re}(S,i.typeInfo,R,r.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new de(I,i.typeInfo)}{if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N*R[L]);return new de(I,i.typeInfo)}}if(Ht(c)){const S=f,R=c.map((I,N)=>I*S);return i instanceof mn?new mn(R,i.typeInfo):new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S*I);return r instanceof mn?new mn(R,r.typeInfo):new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a*_,x)}case"%":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N%R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I%S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S%I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a%_,x)}case"/":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N/R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I/S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S/I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a/_,x)}case"&":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N&R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I&S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S&I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a&_,x)}case"|":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N|R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I|S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S|I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a|_,x)}case"^":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N^R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I^S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S^I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a^_,x)}case"<<":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N<<R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I<<S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S<<I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a<<_,x)}case">>":{if(Ht(c)&&Ht(f)){const S=c,R=f;if(S.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=S.map((N,L)=>N>>R[L]);return new de(I,i.typeInfo)}if(Ht(c)){const S=f,R=c.map((I,N)=>I>>S);return new de(R,i.typeInfo)}if(Ht(f)){const S=c,R=f.map((I,N)=>S>>I);return new de(R,r.typeInfo)}const a=c,_=f,x=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new Oe(a>>_,x)}case">":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S>_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x>a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a>x?1:0);return new de(_,r.typeInfo)}return new Oe(c>f?1:0,this.getTypeInfo("bool"));case"<":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S<_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x<a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a<x?1:0);return new de(_,r.typeInfo)}return new Oe(c<f?1:0,this.getTypeInfo("bool"));case"==":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S===_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x==a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a==x?1:0);return new de(_,r.typeInfo)}return new Oe(c===f?1:0,this.getTypeInfo("bool"));case"!=":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S!==_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x!==a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a!==x?1:0);return new de(_,r.typeInfo)}return new Oe(c!==f?1:0,this.getTypeInfo("bool"));case">=":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S>=_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x>=a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a>=x?1:0);return new de(_,r.typeInfo)}return new Oe(c>=f?1:0,this.getTypeInfo("bool"));case"<=":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S<=_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x<=a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a<=x?1:0);return new de(_,r.typeInfo)}return new Oe(c<=f?1:0,this.getTypeInfo("bool"));case"&&":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S&&_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x&&a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a&&x?1:0);return new de(_,r.typeInfo)}return new Oe(c&&f?1:0,this.getTypeInfo("bool"));case"||":if(Ht(c)&&Ht(f)){const a=c,_=f;if(a.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const x=a.map((S,R)=>S||_[R]?1:0);return new de(x,i.typeInfo)}if(Ht(c)){const a=f,_=c.map((x,S)=>x||a?1:0);return new de(_,i.typeInfo)}if(Ht(f)){const a=c,_=f.map((x,S)=>a||x?1:0);return new de(_,r.typeInfo)}return new Oe(c||f?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=n.clone();i.currentFunctionName=e.name;const r=n.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let c=0;c<r.node.args.length;++c){const f=r.node.args[c],a=this.evalExpression(e.args[c],i);i.createVariable(f.name,a,f)}return this._execStatements(r.node.body,i)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothstep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const i=n.getFunction(e.name);if(i){const r=n.clone();for(let c=0;c<i.node.args.length;++c){const f=i.node.args[c],a=this.evalExpression(e.args[c],r);r.setVariable(f.name,a,f)}return this._execStatements(i.node.body,r)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new Oe(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],n);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const i=this.getTypeInfo(e.type),r=e.type.getTypeName(),c=qy[r];if(c===void 0)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;const f=[];if(e instanceof Jr)if(e.isVector){const a=e.vectorValue;for(const _ of a)f.push(_)}else f.push(e.scalarValue);else if(e.args)for(const a of e.args){const _=this.evalExpression(a,n);if(_ instanceof de){const x=_.data;for(let S=0;S<x.length;++S){let R=x[S];f.push(R)}}else if(_ instanceof Oe){let x=_.value;f.push(x)}}if(e.type instanceof je&&e.type.format===null&&(e.type.format=je.f32),f.length===0){const a=new Array(c).fill(0);return new de(a,i).getSubData(this,e.postfix,n)}if(f.length===1)for(;f.length<c;)f.push(f[0]);return f.length<c?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new de(f.length>c?f.slice(0,c):f,i).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const i=this.getTypeInfo(e.type),r=e.type.getTypeName(),c=ea[r];if(c===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;const f=[];if(e instanceof Jr)if(e.isVector){const a=e.vectorValue;for(const _ of a)f.push(_)}else f.push(e.scalarValue);else if(e.args)for(const a of e.args){const _=this.evalExpression(a,n);_ instanceof de?f.push(..._.data):_ instanceof Oe?f.push(_.value):_ instanceof mn&&f.push(..._.data)}if(i instanceof hf&&i.format===null&&(i.format=this.getTypeInfo("f32")),f.length===0){const a=new Array(c[2]).fill(0);return new mn(a,i).getSubData(this,e.postfix,n)}return f.length!==c[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new mn(f,i).getSubData(this,e.postfix,n)}}Fs._breakObj=new vo(new yo("BREAK",null),null),Fs._continueObj=new vo(new yo("CONTINUE",null),null),Fs._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class lI{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class cI{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new lI,this._exec=new Fs,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;n.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const r=i.arrayType,c=i.countNode;if(c instanceof Fa){const f=c.name,a=this._context.constants.get(f);if(a)try{const _=a.constEvaluate(this._exec);r.count=_}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of n)i.search(r=>{r instanceof Y0||r instanceof c_?r.type=this._forwardType(r.type):r instanceof Tm?r.format=this._forwardType(r.format):r instanceof Vc||r instanceof wm||r instanceof l_?r.type=this._forwardType(r.type):r instanceof Mm?r.returnType=this._forwardType(r.returnType):r instanceof Z0&&(r.type=this._forwardType(r.type))});return n}_forwardType(e){if(e instanceof X0){const n=this._getType(e.name);if(n)return n}else e instanceof c_?e.type=this._forwardType(e.type):e instanceof Tm&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new Qk(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==oe.eof}_match(e){if(e instanceof ze)return!!this._check(e)&&(this._advance(),!0);for(let n=0,i=e.length;n<i;++n){const r=e[n];if(this._check(r))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const i=n.type;let r=!1;for(const c of e){if(i===c)return!0;c===oe.tokens.name&&(r=!0)}if(r){const c=oe.tokens.name.rule.exec(n.lexeme);if(c&&c.index==0&&c[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===oe.tokens.name){const i=oe.tokens.name.rule.exec(n.lexeme);return i&&i.index==0&&i[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(oe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(oe.keywords.alias)){const n=this._type_alias();return this._consume(oe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(oe.keywords.diagnostic)){const n=this._diagnostic();return this._consume(oe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(oe.keywords.requires)){const n=this._requires_directive();return this._consume(oe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(oe.keywords.enable)){const n=this._enable_directive();return this._consume(oe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(oe.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(oe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(oe.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(oe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(oe.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(oe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(oe.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(oe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(oe.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(oe.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(oe.keywords.fn))return null;const e=this._currentLine,n=this._consume(oe.tokens.ident,"Expected function name.").toString();this._consume(oe.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(oe.tokens.paren_right))do{if(this._check(oe.tokens.paren_right))break;const a=this._attribute(),_=this._consume(oe.tokens.name,"Expected argument name.").toString();this._consume(oe.tokens.colon,"Expected ':' for argument type.");const x=this._attribute(),S=this._type_decl();S!=null&&(S.attributes=x,i.push(this._updateNode(new Z0(_,S,a))))}while(this._match(oe.tokens.comma));this._consume(oe.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(oe.tokens.arrow)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}const c=this._compound_statement(),f=this._currentLine;return this._updateNode(new Mm(n,i,r,c,e,f),e)}_compound_statement(){const e=[];for(this._consume(oe.tokens.brace_left,"Expected '{' for block.");!this._check(oe.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(oe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(oe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(oe.tokens.attr)&&this._attribute(),this._check(oe.keywords.if))return this._if_statement();if(this._check(oe.keywords.switch))return this._switch_statement();if(this._check(oe.keywords.loop))return this._loop_statement();if(this._check(oe.keywords.for))return this._for_statement();if(this._check(oe.keywords.while))return this._while_statement();if(this._check(oe.keywords.continuing))return this._continuing_statement();if(this._check(oe.keywords.static_assert))return this._static_assert_statement();if(this._check(oe.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(oe.keywords.return))e=this._return_statement();else if(this._check([oe.keywords.var,oe.keywords.let,oe.keywords.const]))e=this._variable_statement();else if(this._match(oe.keywords.discard))e=this._updateNode(new Yk);else if(this._match(oe.keywords.break)){const n=this._updateNode(new oT);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];n.loopId=i.id}e=n,this._check(oe.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(oe.keywords.continue)){const n=this._updateNode(new lT);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const i=this._currentLoop[this._currentLoop.length-1];n.loopId=i.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(oe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(oe.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new Wk(n),e)}_while_statement(){if(!this._match(oe.keywords.while))return null;const e=this._updateNode(new Q2(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(oe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(oe.keywords.continuing))return null;const n=this._currentLine,i=this._compound_statement();return this._updateNode(new zb(i,e),n)}_for_statement(){if(!this._match(oe.keywords.for))return null;this._consume(oe.tokens.paren_left,"Expected '('.");const e=this._updateNode(new J2(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(oe.tokens.semicolon)?null:this._for_init(),this._consume(oe.tokens.semicolon,"Expected ';'."),e.condition=this._check(oe.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(oe.tokens.semicolon,"Expected ';'."),e.increment=this._check(oe.tokens.paren_right)?null:this._for_increment(),this._consume(oe.tokens.paren_right,"Expected ')'."),this._check(oe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(oe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(oe.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new Vc(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(oe.keywords.let)){const e=this._currentLine,n=this._consume(oe.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(oe.tokens.colon)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}this._consume(oe.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new wm(n,i,null,null,r),e)}if(this._match(oe.keywords.const)){const e=this._currentLine,n=this._consume(oe.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(oe.tokens.colon)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}this._consume(oe.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return i===null&&r instanceof Jr&&(i=r.type),this._updateNode(new l_(n,i,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(oe.increment_operators))return this._current=e,null;const i=this._consume(oe.increment_operators,"Expected increment operator");return this._updateNode(new eT(i.type===oe.tokens.plus_plus?bd.increment:bd.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(oe.tokens.brace_right))return null;let i=this._match(oe.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const r=this._consume(oe.assignment_operators,"Expected assignment operator."),c=this._short_circuit_or_expression();return this._updateNode(new tT(mm.parse(r.lexeme),e,c),n)}_func_call_statement(){if(!this._check(oe.tokens.ident))return null;const e=this._currentLine,n=this._current,i=this._consume(oe.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=n,null):this._updateNode(new zx(i.lexeme,r),e)}_loop_statement(){if(!this._match(oe.keywords.loop))return null;this._check(oe.tokens.attr)&&this._attribute(),this._consume(oe.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new nT([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.body.push(i);else e.body.push(n);if(n instanceof zb){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(oe.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(oe.keywords.switch))return null;const e=this._updateNode(new iT(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(oe.tokens.attr)&&this._attribute(),this._consume(oe.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(oe.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([oe.keywords.default,oe.keywords.case]);){if(this._match(oe.keywords.case)){const i=this._case_selectors();for(const c of i)if(c instanceof u_){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(oe.tokens.colon),this._check(oe.tokens.attr)&&this._attribute(),this._consume(oe.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(oe.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new dT(i,r)))}if(this._match(oe.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(oe.tokens.colon),this._check(oe.tokens.attr)&&this._attribute(),this._consume(oe.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(oe.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new pT(i)))}}return e}_case_selectors(){const e=[];for(this._match(oe.keywords.default)?e.push(this._updateNode(new u_)):e.push(this._shift_expression());this._match(oe.tokens.comma);)this._match(oe.keywords.default)?e.push(this._updateNode(new u_)):e.push(this._shift_expression());return e}_case_body(){if(this._match(oe.keywords.fallthrough))return this._consume(oe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(oe.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(oe.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(oe.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let c=null;return this._match(oe.keywords.else)&&(this._check(oe.tokens.attr)&&this._attribute(),c=this._compound_statement()),this._updateNode(new rT(n,i,r,c),e)}_match_elseif(){return this._tokens[this._current].type===oe.keywords.else&&this._tokens[this._current+1].type===oe.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new Gk(n,i))),this._match_elseif()&&(this._check(oe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(oe.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new sT(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(oe.tokens.or_or);)e=this._updateNode(new Qo(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(oe.tokens.and_and);)e=this._updateNode(new Qo(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(oe.tokens.or);)e=this._updateNode(new Qo(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(oe.tokens.xor);)e=this._updateNode(new Qo(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(oe.tokens.and);)e=this._updateNode(new Qo(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([oe.tokens.equal_equal,oe.tokens.not_equal])?this._updateNode(new Qo(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([oe.tokens.less_than,oe.tokens.greater_than,oe.tokens.less_than_equal,oe.tokens.greater_than_equal]);)e=this._updateNode(new Qo(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([oe.tokens.shift_left,oe.tokens.shift_right]);)e=this._updateNode(new Qo(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([oe.tokens.plus,oe.tokens.minus]);)e=this._updateNode(new Qo(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([oe.tokens.star,oe.tokens.forward_slash,oe.tokens.modulo]);)e=this._updateNode(new Qo(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([oe.tokens.minus,oe.tokens.bang,oe.tokens.tilde,oe.tokens.star,oe.tokens.and])?this._updateNode(new $r(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(oe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(oe.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new Id(e)),i=this._postfix_expression();return i&&(n.postfix=i),n}if(this._match(oe.tokens.period)){const e=this._consume(oe.tokens.name,"Expected member name."),n=this._postfix_expression(),i=this._updateNode(new ff(e.lexeme));return n&&(i.postfix=n),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return yt.void;case"bool":return yt.bool;case"i32":return yt.i32;case"u32":return yt.u32;case"f32":return yt.f32;case"f16":return yt.f16;case"vec2f":return je.vec2f;case"vec3f":return je.vec3f;case"vec4f":return je.vec4f;case"vec2i":return je.vec2i;case"vec3i":return je.vec3i;case"vec4i":return je.vec4i;case"vec2u":return je.vec2u;case"vec3u":return je.vec3u;case"vec4u":return je.vec4u;case"vec2h":return je.vec2h;case"vec3h":return je.vec3h;case"vec4h":return je.vec4h;case"mat2x2f":return je.mat2x2f;case"mat2x3f":return je.mat2x3f;case"mat2x4f":return je.mat2x4f;case"mat3x2f":return je.mat3x2f;case"mat3x3f":return je.mat3x3f;case"mat3x4f":return je.mat3x4f;case"mat4x2f":return je.mat4x2f;case"mat4x3f":return je.mat4x3f;case"mat4x4f":return je.mat4x4f;case"mat2x2h":return je.mat2x2h;case"mat2x3h":return je.mat2x3h;case"mat2x4h":return je.mat2x4h;case"mat3x2h":return je.mat3x2h;case"mat3x3h":return je.mat3x3h;case"mat3x4h":return je.mat3x4h;case"mat4x2h":return je.mat4x2h;case"mat4x3h":return je.mat4x3h;case"mat4x4h":return je.mat4x4h;case"mat2x2i":return je.mat2x2i;case"mat2x3i":return je.mat2x3i;case"mat2x4i":return je.mat2x4i;case"mat3x2i":return je.mat3x2i;case"mat3x3i":return je.mat3x3i;case"mat3x4i":return je.mat3x4i;case"mat4x2i":return je.mat4x2i;case"mat4x3i":return je.mat4x3i;case"mat4x4i":return je.mat4x4i;case"mat2x2u":return je.mat2x2u;case"mat2x3u":return je.mat2x3u;case"mat2x4u":return je.mat2x4u;case"mat3x2u":return je.mat3x2u;case"mat3x3u":return je.mat3x3u;case"mat3x4u":return je.mat3x4u;case"mat4x2u":return je.mat4x2u;case"mat4x3u":return je.mat4x3u;case"mat4x4u":return je.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(oe.tokens.ident)){const i=this._previous().toString();if(this._check(oe.tokens.paren_left)){const r=this._argument_expression_list(),c=this._getType(i);return c!==null?this._updateNode(new Kl(c,r)):this._updateNode(new Fx(i,r))}if(this._context.constants.has(i)){const r=this._context.constants.get(i);return this._updateNode(new cT(i,r.value))}return this._updateNode(new Fa(i))}if(this._match(oe.tokens.int_literal)){const i=this._previous().toString();let r=i.endsWith("i")||i.endsWith("i")?yt.i32:i.endsWith("u")||i.endsWith("U")?yt.u32:yt.x32;const c=parseInt(i);return this._validateTypeRange(c,r),this._updateNode(new Jr(new Oe(c,this._exec.getTypeInfo(r)),r))}if(this._match(oe.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,yt.u32),this._updateNode(new Jr(new Oe(i,this._exec.getTypeInfo(yt.u32)),yt.u32))}if(this._match([oe.tokens.decimal_float_literal,oe.tokens.hex_float_literal])){let i=this._previous().toString(),r=i.endsWith("h");r&&(i=i.substring(0,i.length-1));const c=parseFloat(i);this._validateTypeRange(c,r?yt.f16:yt.f32);const f=r?yt.f16:yt.f32;return this._updateNode(new Jr(new Oe(c,this._exec.getTypeInfo(f)),f))}if(this._match([oe.keywords.true,oe.keywords.false])){let i=this._previous().toString()===oe.keywords.true.rule;return this._updateNode(new Jr(new Oe(i?1:0,this._exec.getTypeInfo(yt.bool)),yt.bool))}if(this._check(oe.tokens.paren_left))return this._paren_expression();if(this._match(oe.keywords.bitcast)){this._consume(oe.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(oe.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new uT(i,r))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new Kl(e,n))}_argument_expression_list(){if(!this._match(oe.tokens.paren_left))return null;const e=[];do{if(this._check(oe.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(oe.tokens.comma));return this._consume(oe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(oe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(oe.tokens.paren_right),e}_paren_expression(){this._consume(oe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(oe.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(oe.keywords.struct))return null;const e=this._currentLine,n=this._consume(oe.tokens.ident,"Expected name for struct.").toString();this._consume(oe.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(oe.tokens.brace_right);){const f=this._attribute(),a=this._consume(oe.tokens.name,"Expected variable name.").toString();this._consume(oe.tokens.colon,"Expected ':' for struct member type.");const _=this._attribute(),x=this._type_decl();x!=null&&(x.attributes=_),this._check(oe.tokens.brace_right)?this._match(oe.tokens.comma):this._consume(oe.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new Y0(a,x,f)))}this._consume(oe.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,c=this._updateNode(new Lc(n,i,e,r),e);return this._context.structs.set(n,c),c}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(oe.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Jr){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Jr&&(e.type=e.value.type.name==="x32"?yt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(oe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(oe.keywords.const))return null;const n=this._consume(oe.tokens.name,"Expected variable name"),i=this._currentLine;let r=null;if(this._match(oe.tokens.colon)){const _=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=_)}let c=null;this._consume(oe.tokens.equal,"const declarations require an assignment");const f=this._short_circuit_or_expression();try{let _=[yt.f32],x=f.constEvaluate(this._exec,_);x instanceof Oe&&this._validateTypeRange(x.value,_[0]),_[0]instanceof je&&_[0].format===null&&x.typeInfo instanceof hf&&x.typeInfo.format!==null&&(x.typeInfo.format.name==="f16"?_[0].format=yt.f16:x.typeInfo.format.name==="f32"?_[0].format=yt.f32:x.typeInfo.format.name==="i32"?_[0].format=yt.i32:x.typeInfo.format.name==="u32"?_[0].format=yt.u32:x.typeInfo.format.name==="bool"?_[0].format=yt.bool:console.error(`TODO: impelement template format type ${x.typeInfo.format.name}`)),c=this._updateNode(new Jr(x,_[0])),this._exec.context.setVariable(n.toString(),x)}catch{c=f}if(r!==null&&c instanceof Jr){if(c.type.name!=="x32"&&r.getTypeName()!==c.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${c.type.name} to ${r.name}. Line:${this._currentLine}`);c.type=r,c.isScalar&&this._validateTypeRange(c.scalarValue,c.type)}else r===null&&c instanceof Jr&&(r=(e=c?.type)!==null&&e!==void 0?e:yt.f32,r===yt.x32&&(r=yt.i32));const a=this._updateNode(new l_(n.toString(),r,"","",c),i);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(oe.keywords.let))return null;const e=this._currentLine,n=this._consume(oe.tokens.name,"Expected variable name");let i=null;if(this._match(oe.tokens.colon)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}let r=null;if(this._match(oe.tokens.equal)&&(r=this._const_expression()),i!==null&&r instanceof Jr){if(r.type.name!=="x32"&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i}else i===null&&r instanceof Jr&&(i=r.type.name==="x32"?yt.i32:r.type);return r instanceof Jr&&r.isScalar&&this._validateTypeRange(r.scalarValue,i),this._updateNode(new wm(n.toString(),i,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(oe.keywords.var))return null;const e=this._currentLine;let n="",i="";this._match(oe.tokens.less_than)&&(n=this._consume(oe.storage_class,"Expected storage_class.").toString(),this._match(oe.tokens.comma)&&(i=this._consume(oe.access_mode,"Expected access_mode.").toString()),this._consume(oe.tokens.greater_than,"Expected '>'."));const r=this._consume(oe.tokens.name,"Expected variable name");let c=null;if(this._match(oe.tokens.colon)){const f=this._attribute();c=this._type_decl(),c!=null&&(c.attributes=f)}return this._updateNode(new Vc(r.toString(),c,n,i,null),e)}_override_decl(){if(!this._match(oe.keywords.override))return null;const e=this._consume(oe.tokens.name,"Expected variable name");let n=null;if(this._match(oe.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}return this._updateNode(new Nx(e.toString(),n,null))}_diagnostic(){this._consume(oe.tokens.paren_left,"Expected '('");const e=this._consume(oe.tokens.ident,"Expected severity control name.");this._consume(oe.tokens.comma,"Expected ','");let n=this._consume(oe.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(oe.tokens.period)&&(n+=`.${this._consume(oe.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(oe.tokens.paren_right,"Expected ')'"),this._updateNode(new aT(e.toString(),n))}_enable_directive(){const e=this._consume(oe.tokens.ident,"identity expected.");return this._updateNode(new Xk(e.toString()))}_requires_directive(){const e=[this._consume(oe.tokens.ident,"identity expected.").toString()];for(;this._match(oe.tokens.comma);){const n=this._consume(oe.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new Zk(e))}_type_alias(){const e=this._consume(oe.tokens.ident,"identity expected.");this._consume(oe.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const i=this._updateNode(new Lx(e.toString(),n));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([oe.tokens.ident,...oe.texel_format,oe.keywords.bool,oe.keywords.f32,oe.keywords.i32,oe.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const r=this._updateNode(new X0(i));return this._forwardTypeCount++,r}return this._updateNode(new yt(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(oe.template_types)){let i=this._advance().toString(),r=null,c=null;return this._match(oe.tokens.less_than)&&(r=this._type_decl(),c=null,this._match(oe.tokens.comma)&&(c=this._consume(oe.access_mode,"Expected access_mode for pointer").toString()),this._consume(oe.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new je(i,r,c))}if(this._match(oe.keywords.ptr)){let i=this._previous().toString();this._consume(oe.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(oe.storage_class,"Expected storage_class for pointer");this._consume(oe.tokens.comma,"Expected ',' for pointer.");const c=this._type_decl();let f=null;return this._match(oe.tokens.comma)&&(f=this._consume(oe.access_mode,"Expected access_mode for pointer").toString()),this._consume(oe.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new c_(i,r.toString(),c,f))}const n=this._attribute();if(this._match(oe.keywords.array)){let i=null,r=-1;const c=this._previous();let f=null;if(this._match(oe.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let _="";if(this._match(oe.tokens.comma)){f=this._shift_expression();try{_=f.constEvaluate(this._exec).toString(),f=null}catch{_="1"}}this._consume(oe.tokens.greater_than,"Expected '>' for array."),r=_?parseInt(_):0}const a=this._updateNode(new Tm(c.toString(),n,i,r));return f&&this._deferArrayCountEval.push({arrayType:a,countNode:f}),a}return null}_texture_sampler_types(){if(this._match(oe.sampler_type))return this._updateNode(new gm(this._previous().toString(),null,null));if(this._match(oe.depth_texture_type))return this._updateNode(new gm(this._previous().toString(),null,null));if(this._match(oe.sampled_texture_type)||this._match(oe.multisampled_texture_type)){const e=this._previous();this._consume(oe.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(oe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new gm(e.toString(),n,null))}if(this._match(oe.storage_texture_type)){const e=this._previous();this._consume(oe.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(oe.texel_format,"Invalid texel format.").toString();this._consume(oe.tokens.comma,"Expected ',' after texel format.");const i=this._consume(oe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(oe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new gm(e.toString(),n,i))}return null}_attribute(){let e=[];for(;this._match(oe.tokens.attr);){const n=this._consume(oe.attribute_name,"Expected attribute name"),i=this._updateNode(new mT(n.toString(),null));if(this._match(oe.tokens.paren_left)){if(i.value=this._consume(oe.literal_or_ident,"Expected attribute value").toString(),this._check(oe.tokens.comma)){this._advance();do{const r=this._consume(oe.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(r)}while(this._match(oe.tokens.comma))}this._consume(oe.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class uI extends Jl{constructor(e){super(),e&&this.update(e)}update(e){const n=new cI().parse(e);this.updateAST(n)}}function hI(t){const e={attributes:[],bindings:[]};let n;try{n=fI(t)}catch(c){return At.error(c.message)(),e}for(const c of n.uniforms){const f=[];for(const a of c.type?.members||[])f.push({name:a.name,type:Q0(a.type)});e.bindings.push({type:"uniform",name:c.name,group:c.group,location:c.binding,members:f})}for(const c of n.textures)e.bindings.push({type:"texture",name:c.name,group:c.group,location:c.binding});for(const c of n.samplers)e.bindings.push({type:"sampler",name:c.name,group:c.group,location:c.binding});const i=n.entry.vertex[0],r=i?.inputs.length||0;for(let c=0;c<r;c++){const f=i.inputs[c];if(f.locationType==="location"){const a=Q0(f.type);e.attributes.push({name:f.name,location:Number(f.location),type:a})}}return e}function Q0(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function fI(t){try{return new uI(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&e?.message&&(n+=`: ${e.message} `),typeof e=="object"&&e?.token&&(n+=e.token.line||""),new Error(n,{cause:e})}}const dI={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...dI}};const bo=globalThis.mathgl.config;function pI(t,{precision:e=bo.precision}={}){return t=mI(t),`${parseFloat(t.toPrecision(e))}`}function Md(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Xu(t,e,n){return _I(t,i=>Math.max(e,Math.min(n,i)))}function C_(t,e,n){return Md(t)?t.map((i,r)=>C_(i,e[r],n)):n*e+(1-n)*t}function Pm(t,e,n){const i=bo.EPSILON;try{if(t===e)return!0;if(Md(t)&&Md(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Pm(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=bo.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{bo.EPSILON=i}}function mI(t){return Math.round(t/bo.EPSILON)*bo.EPSILON}function gI(t){return t.clone?t.clone():new Array(t.length)}function _I(t,e,n){if(Md(t)){const i=t;n=n||gI(i);for(let r=0;r<n.length&&r<i.length;++r){const c=typeof t=="number"?t:t[r];n[r]=e(c,r,n)}return n}return e(t)}class gT extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Md(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(bo)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+pI(this[i],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Pm(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const c=e[r],f=typeof n=="number"?n:n[r];this[r]=c+i*(f-c)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(bo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function yI(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function La(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Wy(t,e,n=""){if(bo.debug&&!yI(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function J0(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class bI extends gT{get x(){return this[0]}set x(e){this[0]=La(e)}get y(){return this[1]}set y(e){this[1]=La(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return La(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return La(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return J0(e>=0&&e<this.ELEMENTS,"index is out of range"),La(this[e])}setComponent(e,n){return J0(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const h_=1e-6;let Pd=typeof Float32Array<"u"?Float32Array:Array;function xI(){const t=new Pd(2);return Pd!=Float32Array&&(t[0]=0,t[1]=0),t}function e1(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function vI(t,e){return t[0]=-e[0],t[1]=-e[1],t}function _T(t,e,n,i){const r=e[0],c=e[1];return t[0]=r+i*(n[0]-r),t[1]=c+i*(n[1]-c),t}function wI(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){const t=xI();return function(e,n,i,r,c,f){let a,_;for(n||(n=2),i||(i=0),r?_=Math.min(r*n+i,e.length):_=e.length,a=i;a<_;a+=n)t[0]=e[a],t[1]=e[a+1],c(t,t,f),e[a]=t[0],e[a+1]=t[1];return e}})();function TI(t,e,n){const i=e[0],r=e[1],c=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/c,t[1]=(n[1]*i+n[5]*r)/c,t}function yT(t,e,n){const i=e[0],r=e[1],c=e[2],f=n[3]*i+n[7]*r+n[11]*c||1;return t[0]=(n[0]*i+n[4]*r+n[8]*c)/f,t[1]=(n[1]*i+n[5]*r+n[9]*c)/f,t[2]=(n[2]*i+n[6]*r+n[10]*c)/f,t}function SI(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function EI(){const t=new Pd(3);return Pd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function AI(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function CI(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function RI(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function kI(t,e,n){const i=e[0],r=e[1],c=e[2],f=n[0],a=n[1],_=n[2];return t[0]=r*_-c*a,t[1]=c*f-i*_,t[2]=i*a-r*f,t}function bT(t,e,n){const i=e[0],r=e[1],c=e[2];let f=n[3]*i+n[7]*r+n[11]*c+n[15];return f=f||1,t[0]=(n[0]*i+n[4]*r+n[8]*c+n[12])/f,t[1]=(n[1]*i+n[5]*r+n[9]*c+n[13])/f,t[2]=(n[2]*i+n[6]*r+n[10]*c+n[14])/f,t}function II(t,e,n){const i=e[0],r=e[1],c=e[2];return t[0]=i*n[0]+r*n[3]+c*n[6],t[1]=i*n[1]+r*n[4]+c*n[7],t[2]=i*n[2]+r*n[5]+c*n[8],t}function MI(t,e,n){const i=n[0],r=n[1],c=n[2],f=n[3],a=e[0],_=e[1],x=e[2];let S=r*x-c*_,R=c*a-i*x,I=i*_-r*a,N=r*I-c*R,L=c*S-i*I,H=i*R-r*S;const ie=f*2;return S*=ie,R*=ie,I*=ie,N*=2,L*=2,H*=2,t[0]=a+S+N,t[1]=_+R+L,t[2]=x+I+H,t}function PI(t,e,n,i){const r=[],c=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],c[0]=r[0],c[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),c[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function DI(t,e,n,i){const r=[],c=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],c[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),c[1]=r[1],c[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function OI(t,e,n,i){const r=[],c=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],c[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),c[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),c[2]=r[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function BI(t,e){const n=t[0],i=t[1],r=t[2],c=e[0],f=e[1],a=e[2],_=Math.sqrt((n*n+i*i+r*r)*(c*c+f*f+a*a)),x=_&&RI(t,e)/_;return Math.acos(Math.min(Math.max(x,-1),1))}const NI=AI;(function(){const t=EI();return function(e,n,i,r,c,f){let a,_;for(n||(n=3),i||(i=0),r?_=Math.min(r*n+i,e.length):_=e.length,a=i;a<_;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],c(t,t,f),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Xy=[0,0,0];let Zg;class ec extends bI{static get ZERO(){return Zg||(Zg=new ec(0,0,0),Object.freeze(Zg)),Zg}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Md(e)?this.copy(e):(bo.debug&&(La(e),La(n),La(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return bo.debug&&(La(e.x),La(e.y),La(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=La(e)}angle(e){return BI(this,e)}cross(e){return kI(this,this,e),this.check()}rotateX({radians:e,origin:n=Xy}){return PI(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Xy}){return DI(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Xy}){return OI(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return bT(this,this,e),this.check()}transformAsVector(e){return yT(this,this,e),this.check()}transformByMatrix3(e){return II(this,this,e),this.check()}transformByMatrix2(e){return SI(this,this,e),this.check()}transformByQuaternion(e){return MI(this,this,e),this.check()}}class zI extends gT{toString(){let e="[";if(bo.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=La(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function LI(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function FI(t,e){if(t===e){const n=e[1],i=e[2],r=e[3],c=e[6],f=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=c,t[11]=e[14],t[12]=r,t[13]=f,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Fb(t,e){const n=e[0],i=e[1],r=e[2],c=e[3],f=e[4],a=e[5],_=e[6],x=e[7],S=e[8],R=e[9],I=e[10],N=e[11],L=e[12],H=e[13],ie=e[14],ne=e[15],he=n*a-i*f,re=n*_-r*f,ge=n*x-c*f,_e=i*_-r*a,pe=i*x-c*a,it=r*x-c*_,mt=S*H-R*L,nt=S*ie-I*L,Ce=S*ne-N*L,ht=R*ie-I*H,Me=R*ne-N*H,Ve=I*ne-N*ie;let Le=he*Ve-re*Me+ge*ht+_e*Ce-pe*nt+it*mt;return Le?(Le=1/Le,t[0]=(a*Ve-_*Me+x*ht)*Le,t[1]=(r*Me-i*Ve-c*ht)*Le,t[2]=(H*it-ie*pe+ne*_e)*Le,t[3]=(I*pe-R*it-N*_e)*Le,t[4]=(_*Ce-f*Ve-x*nt)*Le,t[5]=(n*Ve-r*Ce+c*nt)*Le,t[6]=(ie*ge-L*it-ne*re)*Le,t[7]=(S*it-I*ge+N*re)*Le,t[8]=(f*Me-a*Ce+x*mt)*Le,t[9]=(i*Ce-n*Me-c*mt)*Le,t[10]=(L*pe-H*ge+ne*he)*Le,t[11]=(R*ge-S*pe-N*he)*Le,t[12]=(a*nt-f*ht-_*mt)*Le,t[13]=(n*ht-i*nt+r*mt)*Le,t[14]=(H*re-L*_e-ie*he)*Le,t[15]=(S*_e-R*re+I*he)*Le,t):null}function UI(t){const e=t[0],n=t[1],i=t[2],r=t[3],c=t[4],f=t[5],a=t[6],_=t[7],x=t[8],S=t[9],R=t[10],I=t[11],N=t[12],L=t[13],H=t[14],ie=t[15],ne=e*f-n*c,he=e*a-i*c,re=n*a-i*f,ge=x*L-S*N,_e=x*H-R*N,pe=S*H-R*L,it=e*pe-n*_e+i*ge,mt=c*pe-f*_e+a*ge,nt=x*re-S*he+R*ne,Ce=N*re-L*he+H*ne;return _*it-r*mt+ie*nt-I*Ce}function of(t,e,n){const i=e[0],r=e[1],c=e[2],f=e[3],a=e[4],_=e[5],x=e[6],S=e[7],R=e[8],I=e[9],N=e[10],L=e[11],H=e[12],ie=e[13],ne=e[14],he=e[15];let re=n[0],ge=n[1],_e=n[2],pe=n[3];return t[0]=re*i+ge*a+_e*R+pe*H,t[1]=re*r+ge*_+_e*I+pe*ie,t[2]=re*c+ge*x+_e*N+pe*ne,t[3]=re*f+ge*S+_e*L+pe*he,re=n[4],ge=n[5],_e=n[6],pe=n[7],t[4]=re*i+ge*a+_e*R+pe*H,t[5]=re*r+ge*_+_e*I+pe*ie,t[6]=re*c+ge*x+_e*N+pe*ne,t[7]=re*f+ge*S+_e*L+pe*he,re=n[8],ge=n[9],_e=n[10],pe=n[11],t[8]=re*i+ge*a+_e*R+pe*H,t[9]=re*r+ge*_+_e*I+pe*ie,t[10]=re*c+ge*x+_e*N+pe*ne,t[11]=re*f+ge*S+_e*L+pe*he,re=n[12],ge=n[13],_e=n[14],pe=n[15],t[12]=re*i+ge*a+_e*R+pe*H,t[13]=re*r+ge*_+_e*I+pe*ie,t[14]=re*c+ge*x+_e*N+pe*ne,t[15]=re*f+ge*S+_e*L+pe*he,t}function R_(t,e,n){const i=n[0],r=n[1],c=n[2];let f,a,_,x,S,R,I,N,L,H,ie,ne;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*c+e[12],t[13]=e[1]*i+e[5]*r+e[9]*c+e[13],t[14]=e[2]*i+e[6]*r+e[10]*c+e[14],t[15]=e[3]*i+e[7]*r+e[11]*c+e[15]):(f=e[0],a=e[1],_=e[2],x=e[3],S=e[4],R=e[5],I=e[6],N=e[7],L=e[8],H=e[9],ie=e[10],ne=e[11],t[0]=f,t[1]=a,t[2]=_,t[3]=x,t[4]=S,t[5]=R,t[6]=I,t[7]=N,t[8]=L,t[9]=H,t[10]=ie,t[11]=ne,t[12]=f*i+S*r+L*c+e[12],t[13]=a*i+R*r+H*c+e[13],t[14]=_*i+I*r+ie*c+e[14],t[15]=x*i+N*r+ne*c+e[15]),t}function Hx(t,e,n){const i=n[0],r=n[1],c=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function VI(t,e,n,i){let r=i[0],c=i[1],f=i[2],a=Math.sqrt(r*r+c*c+f*f),_,x,S,R,I,N,L,H,ie,ne,he,re,ge,_e,pe,it,mt,nt,Ce,ht,Me,Ve,Le,lt;return a<h_?null:(a=1/a,r*=a,c*=a,f*=a,x=Math.sin(n),_=Math.cos(n),S=1-_,R=e[0],I=e[1],N=e[2],L=e[3],H=e[4],ie=e[5],ne=e[6],he=e[7],re=e[8],ge=e[9],_e=e[10],pe=e[11],it=r*r*S+_,mt=c*r*S+f*x,nt=f*r*S-c*x,Ce=r*c*S-f*x,ht=c*c*S+_,Me=f*c*S+r*x,Ve=r*f*S+c*x,Le=c*f*S-r*x,lt=f*f*S+_,t[0]=R*it+H*mt+re*nt,t[1]=I*it+ie*mt+ge*nt,t[2]=N*it+ne*mt+_e*nt,t[3]=L*it+he*mt+pe*nt,t[4]=R*Ce+H*ht+re*Me,t[5]=I*Ce+ie*ht+ge*Me,t[6]=N*Ce+ne*ht+_e*Me,t[7]=L*Ce+he*ht+pe*Me,t[8]=R*Ve+H*Le+re*lt,t[9]=I*Ve+ie*Le+ge*lt,t[10]=N*Ve+ne*Le+_e*lt,t[11]=L*Ve+he*Le+pe*lt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function xT(t,e,n){const i=Math.sin(n),r=Math.cos(n),c=e[4],f=e[5],a=e[6],_=e[7],x=e[8],S=e[9],R=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*r+x*i,t[5]=f*r+S*i,t[6]=a*r+R*i,t[7]=_*r+I*i,t[8]=x*r-c*i,t[9]=S*r-f*i,t[10]=R*r-a*i,t[11]=I*r-_*i,t}function jI(t,e,n){const i=Math.sin(n),r=Math.cos(n),c=e[0],f=e[1],a=e[2],_=e[3],x=e[8],S=e[9],R=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*r-x*i,t[1]=f*r-S*i,t[2]=a*r-R*i,t[3]=_*r-I*i,t[8]=c*i+x*r,t[9]=f*i+S*r,t[10]=a*i+R*r,t[11]=_*i+I*r,t}function vT(t,e,n){const i=Math.sin(n),r=Math.cos(n),c=e[0],f=e[1],a=e[2],_=e[3],x=e[4],S=e[5],R=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*r+x*i,t[1]=f*r+S*i,t[2]=a*r+R*i,t[3]=_*r+I*i,t[4]=x*r-c*i,t[5]=S*r-f*i,t[6]=R*r-a*i,t[7]=I*r-_*i,t}function $I(t,e){const n=e[0],i=e[1],r=e[2],c=e[3],f=n+n,a=i+i,_=r+r,x=n*f,S=i*f,R=i*a,I=r*f,N=r*a,L=r*_,H=c*f,ie=c*a,ne=c*_;return t[0]=1-R-L,t[1]=S+ne,t[2]=I-ie,t[3]=0,t[4]=S-ne,t[5]=1-x-L,t[6]=N+H,t[7]=0,t[8]=I+ie,t[9]=N-H,t[10]=1-x-R,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function HI(t,e,n,i,r,c,f){const a=1/(n-e),_=1/(r-i),x=1/(c-f);return t[0]=c*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c*2*_,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*_,t[10]=(f+c)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*c*2*x,t[15]=0,t}function qI(t,e,n,i,r){const c=1/Math.tan(e/2);if(t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const f=1/(i-r);t[10]=(r+i)*f,t[14]=2*r*i*f}else t[10]=-1,t[14]=-2*i;return t}const WI=qI;function XI(t,e,n,i,r,c,f){const a=1/(e-n),_=1/(i-r),x=1/(c-f);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*_,t[14]=(f+c)*x,t[15]=1,t}const ZI=XI;function YI(t,e,n,i){let r,c,f,a,_,x,S,R,I,N;const L=e[0],H=e[1],ie=e[2],ne=i[0],he=i[1],re=i[2],ge=n[0],_e=n[1],pe=n[2];return Math.abs(L-ge)<h_&&Math.abs(H-_e)<h_&&Math.abs(ie-pe)<h_?LI(t):(R=L-ge,I=H-_e,N=ie-pe,r=1/Math.sqrt(R*R+I*I+N*N),R*=r,I*=r,N*=r,c=he*N-re*I,f=re*R-ne*N,a=ne*I-he*R,r=Math.sqrt(c*c+f*f+a*a),r?(r=1/r,c*=r,f*=r,a*=r):(c=0,f=0,a=0),_=I*a-N*f,x=N*c-R*a,S=R*f-I*c,r=Math.sqrt(_*_+x*x+S*S),r?(r=1/r,_*=r,x*=r,S*=r):(_=0,x=0,S=0),t[0]=c,t[1]=_,t[2]=R,t[3]=0,t[4]=f,t[5]=x,t[6]=I,t[7]=0,t[8]=a,t[9]=S,t[10]=N,t[11]=0,t[12]=-(c*L+f*H+a*ie),t[13]=-(_*L+x*H+S*ie),t[14]=-(R*L+I*H+N*ie),t[15]=1,t)}function GI(){const t=new Pd(4);return Pd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function KI(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function jm(t,e,n){const i=e[0],r=e[1],c=e[2],f=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*c+n[12]*f,t[1]=n[1]*i+n[5]*r+n[9]*c+n[13]*f,t[2]=n[2]*i+n[6]*r+n[10]*c+n[14]*f,t[3]=n[3]*i+n[7]*r+n[11]*c+n[15]*f,t}(function(){const t=GI();return function(e,n,i,r,c,f){let a,_;for(n||(n=4),i||(i=0),r?_=Math.min(r*n+i,e.length):_=e.length,a=i;a<_;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],c(t,t,f),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Ub;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Ub||(Ub={}));const QI=45*Math.PI/180,JI=1,Zy=.1,Yy=500,eM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class tc extends zI{static get IDENTITY(){return nM()}static get ZERO(){return tM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ub}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,c,f,a,_,x,S,R,I,N,L,H,ie){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=c,this[5]=f,this[6]=a,this[7]=_,this[8]=x,this[9]=S,this[10]=R,this[11]=I,this[12]=N,this[13]=L,this[14]=H,this[15]=ie,this.check()}setRowMajor(e,n,i,r,c,f,a,_,x,S,R,I,N,L,H,ie){return this[0]=e,this[1]=c,this[2]=x,this[3]=N,this[4]=n,this[5]=f,this[6]=S,this[7]=L,this[8]=i,this[9]=a,this[10]=R,this[11]=H,this[12]=r,this[13]=_,this[14]=I,this[15]=ie,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(eM)}fromObject(e){return this.check()}fromQuaternion(e){return $I(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:c,near:f=Zy,far:a=Yy}=e;return a===1/0?iM(this,n,i,r,c,f):HI(this,n,i,r,c,f,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return YI(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:c,near:f=Zy,far:a=Yy}=e;return ZI(this,n,i,r,c,f,a),this.check()}orthographic(e){const{fovy:n=QI,aspect:i=JI,focalDistance:r=1,near:c=Zy,far:f=Yy}=e;t1(n);const a=n/2,_=r*Math.tan(a),x=_*i;return this.ortho({left:-x,right:x,bottom:-_,top:_,near:c,far:f})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:c=500}=e;return t1(n),WI(this,n,i,r,c),this.check()}determinant(){return UI(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],c=1/i[1],f=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*c,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*c,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*c,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],c=1/i[1],f=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*c,e[2]=this[2]*f,e[3]=this[4]*r,e[4]=this[5]*c,e[5]=this[6]*f,e[6]=this[8]*r,e[7]=this[9]*c,e[8]=this[10]*f,e}transpose(){return FI(this,this),this.check()}invert(){return Fb(this,this),this.check()}multiplyLeft(e){return of(this,e,this),this.check()}multiplyRight(e){return of(this,this,e),this.check()}rotateX(e){return xT(this,this,e),this.check()}rotateY(e){return jI(this,this,e),this.check()}rotateZ(e){return vT(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return VI(this,this,e,n),this.check()}scale(e){return Hx(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return R_(this,this,e),this.check()}transform(e,n){return e.length===4?(n=jm(n||[-0,-0,-0,-0],e,this),Wy(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=wI(n||[-0,-0],e,this);break;case 3:r=bT(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Wy(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=TI(n||[-0,-0],e,this);break;case 3:i=yT(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Wy(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Yg,Gg;function tM(){return Yg||(Yg=new tc([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Yg)),Yg}function nM(){return Gg||(Gg=new tc,Object.freeze(Gg)),Gg}function t1(t){if(t>Math.PI*2)throw Error("expected radians")}function iM(t,e,n,i,r,c){const f=2*c/(n-e),a=2*c/(r-i),_=(n+e)/(n-e),x=(r+i)/(r-i),S=-1,R=-1,I=-2*c;return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=_,t[9]=x,t[10]=S,t[11]=R,t[12]=0,t[13]=0,t[14]=I,t[15]=0,t}function wT(t,e=[],n=0){const i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}function rM(t){return t-Math.fround(t)}function sM(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=n*4+i;wT(t[i*4+n],e,r*2)}return e}const aM=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,oM={name:"fp32",vs:aM},lM=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,cM={ONE:1},uM={name:"fp64arithmetic",vs:lM,defaultUniforms:cM,uniformTypes:{ONE:"f32"},fp64ify:wT,fp64LowPart:rM,fp64ifyMatrix4:sM},hM=[0,1,1,1],fM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,dM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,n1={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:hM},vs:fM,fs:dM,getUniforms:pM};function pM(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,r=>r/255);Number.isFinite(i[3])||(i[3]=1),n.highlightColor=i}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const i1=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,mM={name:"layer",vs:i1,fs:i1,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},gM=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,TT="#define SMOOTH_EDGE_RADIUS 0.5",_M=`${TT}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,yM=`${TT}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,ST={name:"geometry",source:gM,vs:_M,fs:yM},bM=25;var Hr;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Hr||(Hr={}));var es;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(es||(es={}));var In;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(In||(In={}));const xM="compute",vM="auto",Vb="manipulation",f_="none",jb="pan-x",$b="pan-y";function wM(t){if(t.includes(f_))return f_;const e=t.includes(jb),n=t.includes($b);return e&&n?f_:e||n?e?jb:$b:t.includes(Vb)?Vb:vM}class TM{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===xM&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return wM(e.join(" "))}}function k_(t){return t.trim().split(/\s+/g)}function Gy(t,e,n){if(t)for(const i of k_(e))t.addEventListener(i,n,!1)}function Ky(t,e,n){if(t)for(const i of k_(e))t.removeEventListener(i,n,!1)}function r1(t){return(t.ownerDocument||t).defaultView}function SM(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function ET(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,i=0,r=0;for(;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:Math.round(n/e),y:Math.round(i/e)}}function s1(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:ET(e),deltaX:t.deltaX,deltaY:t.deltaY}}function AT(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function a1(t,e){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(n*n+i*i)}function EM(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.atan2(i,n)*180/Math.PI}function o1(t,e){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.atan2(i,n)*180/Math.PI}function CT(t,e){return t===e?es.None:Math.abs(t)>=Math.abs(e)?t<0?es.Left:es.Right:e<0?es.Up:es.Down}function AM(t,e){const n=e.center;let i=t.offsetDelta,r=t.prevDelta;const c=t.prevInput;return(e.eventType===Hr.Start||c?.eventType===Hr.End)&&(r=t.prevDelta={x:c?.deltaX||0,y:c?.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}function RT(t,e,n){return{x:e/t||0,y:n/t||0}}function CM(t,e){return a1(e[0],e[1])/a1(t[0],t[1])}function RM(t,e){return o1(e[1],e[0])-o1(t[1],t[0])}function kM(t,e){const n=t.lastInterval||e,i=e.timeStamp-n.timeStamp;let r,c,f,a;if(e.eventType!==Hr.Cancel&&(i>bM||n.velocity===void 0)){const _=e.deltaX-n.deltaX,x=e.deltaY-n.deltaY,S=RT(i,_,x);c=S.x,f=S.y,r=Math.abs(S.x)>Math.abs(S.y)?S.x:S.y,a=CT(_,x),t.lastInterval=e}else r=n.velocity,c=n.velocityX,f=n.velocityY,a=n.direction;e.velocity=r,e.velocityX=c,e.velocityY=f,e.direction=a}function IM(t,e){const{session:n}=t,{pointers:i}=e,{length:r}=i;n.firstInput||(n.firstInput=s1(e)),r>1&&!n.firstMultiple?n.firstMultiple=s1(e):r===1&&(n.firstMultiple=!1);const{firstInput:c,firstMultiple:f}=n,a=f?f.center:c.center,_=e.center=ET(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-c.timeStamp,e.angle=EM(a,_),e.distance=AT(a,_);const{deltaX:x,deltaY:S}=AM(n,e);e.deltaX=x,e.deltaY=S,e.offsetDirection=CT(e.deltaX,e.deltaY);const R=RT(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=R.x,e.overallVelocityY=R.y,e.overallVelocity=Math.abs(R.x)>Math.abs(R.y)?R.x:R.y,e.scale=f?CM(f.pointers,i):1,e.rotation=f?RM(f.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let I=t.element;return SM(e.srcEvent.target,I)&&(I=e.srcEvent.target),e.target=I,kM(n,e),e}function MM(t,e,n){const i=n.pointers.length,r=n.changedPointers.length,c=e&Hr.Start&&i-r===0,f=e&(Hr.End|Hr.Cancel)&&i-r===0;n.isFirst=!!c,n.isFinal=!!f,c&&(t.session={}),n.eventType=e;const a=IM(t,n);t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}let PM=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){MM(this.manager,e,n)}init(){Gy(this.element,this.evEl,this.domHandler),Gy(this.target,this.evTarget,this.domHandler),Gy(r1(this.element),this.evWin,this.domHandler)}destroy(){Ky(this.element,this.evEl,this.domHandler),Ky(this.target,this.evTarget,this.domHandler),Ky(r1(this.element),this.evWin,this.domHandler)}};const DM={pointerdown:Hr.Start,pointermove:Hr.Move,pointerup:Hr.End,pointercancel:Hr.Cancel,pointerout:Hr.Cancel},OM="pointerdown",BM="pointermove pointerup pointercancel";class NM extends PM{constructor(e){super(e),this.evEl=OM,this.evWin=BM,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let i=!1;const r=DM[e.type],c=e.pointerType,f=c==="touch";let a=n.findIndex(_=>_.pointerId===e.pointerId);r&Hr.Start&&(e.buttons||f)?a<0&&(n.push(e),a=n.length-1):r&(Hr.End|Hr.Cancel)&&(i=!0),!(a<0)&&(n[a]=e,this.callback(r,{pointers:n,changedPointers:[e],eventType:r,pointerType:c,srcEvent:e}),i&&n.splice(a,1))}}const zM=["","webkit","Moz","MS","ms","o"];function LM(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const i of zM){const r=i?i+n:e;if(r in t)return r}}const FM=1,l1=2,c1={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class UM{constructor(e,n){this.options={...c1,...n,cssProps:{...c1.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new NM(this),this.touchAction=new TM(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?l1:FM}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:r}=this;let{curRecognizer:c}=n;(!c||c&&c.state&In.Recognized)&&(c=n.curRecognizer=null);let f=0;for(;f<r.length;)i=r[f],n.stopped!==l1&&(!c||i===c||i.canRecognizeWith(c))?i.recognize(e):i.reset(),!c&&i.state&(In.Began|In.Changed|In.Ended)&&(c=n.curRecognizer=i),f++}get(e){const{recognizers:n}=this;for(let i=0;i<n.length;i++)if(n[i].options.event===e)return n[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:i}=this,r=i.indexOf(n);r!==-1&&(i.splice(r,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:i}=this;for(const r of k_(e))i[r]=i[r]||[],i[r].push(n)}off(e,n){if(!e)return;const{handlers:i}=this;for(const r of k_(e))n?i[r]&&i[r].splice(i[r].indexOf(n),1):delete i[r]}emit(e,n){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const r=n;r.type=e,r.preventDefault=function(){n.srcEvent.preventDefault()};let c=0;for(;c<i.length;)i[c](r),c++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[i,r]of Object.entries(this.options.cssProps)){const c=LM(n.style,i);e?(this.oldCssProps[c]=n.style[c],n.style[c]=r):n.style[c]=this.oldCssProps[c]||""}e||(this.oldCssProps={})}}}let VM=1;function jM(){return VM++}function u1(t){return t&In.Cancelled?"cancel":t&In.Ended?"end":t&In.Changed?"move":t&In.Began?"start":""}class kT{constructor(e){this.options=e,this.id=jM(),this.state=In.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const r of e)this.recognizeWith(r);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:i}=this;return i[n.id]||(i[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const r of e)this.requireFailure(r);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:i}=this;return i.indexOf(n)===-1&&(i.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const i=this.requireFail.indexOf(n);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<In.Ended&&this.manager.emit(this.options.event+u1(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=In.Ended&&this.manager.emit(this.options.event+u1(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=In.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(In.Failed|In.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=In.Failed;return}this.state&(In.Recognized|In.Cancelled|In.Failed)&&(this.state=In.Possible),this.state=this.process(n),this.state&(In.Began|In.Changed|In.Ended|In.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class IT extends kT{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:i}=e,r=n&(In.Began|In.Changed),c=this.attrTest(e);return r&&(i&Hr.Cancel||!c)?n|In.Cancelled:r||c?i&Hr.End?n|In.Ended:n&In.Began?n|In.Changed:In.Began:In.Failed}}class h1 extends kT{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Vb]}process(e){const{options:n}=this,i=e.pointers.length===n.pointers,r=e.distance<n.threshold,c=e.deltaTime<n.time;if(this.reset(),e.eventType&Hr.Start&&this.count===0)return this.failTimeout();if(r&&c&&i){if(e.eventType!==Hr.End)return this.failTimeout();const f=this.pTime?e.timeStamp-this.pTime<n.interval:!0,a=!this.pCenter||AT(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!f?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=In.Recognized,this.tryEmit(this._input)},n.interval),In.Began):In.Recognized}return In.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=In.Failed},this.options.interval),In.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===In.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const $M=["","start","move","end","cancel","up","down","left","right"];class f1 extends IT{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:es.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&es.Horizontal&&n.push($b),e&es.Vertical&&n.push(jb),n}getEventNames(){return $M.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let i=!0,{distance:r}=e,{direction:c}=e;const f=e.deltaX,a=e.deltaY;return c&n.direction||(n.direction&es.Horizontal?(c=f===0?es.None:f<0?es.Left:es.Right,i=f!==this.pX,r=Math.abs(e.deltaX)):(c=a===0?es.None:a<0?es.Up:es.Down,i=a!==this.pY,r=Math.abs(e.deltaY))),e.direction=c,i&&r>n.threshold&&!!(c&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&In.Began)||!(this.state&In.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=es[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const HM=["","start","move","end","cancel","in","out"];class qM extends IT{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[f_]}getEventNames(){return HM.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&In.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class Y_{constructor(e,n,i){this.element=e,this.callback=n,this.options=i}}const WM=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",XM=WM.indexOf("firefox")!==-1,d1=4.000244140625,ZM=40,YM=.25;class GM extends Y_{constructor(e,n,i){super(e,n,{enable:!0,...i}),this.handleEvent=r=>{if(!this.options.enable)return;let c=r.deltaY;globalThis.WheelEvent&&(XM&&r.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(c/=globalThis.devicePixelRatio),r.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(c*=ZM)),c!==0&&c%d1===0&&(c=Math.floor(c/d1)),r.shiftKey&&c&&(c=c*YM),this.callback({type:"wheel",center:{x:r.clientX,y:r.clientY},delta:-c,srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const p1=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class KM extends Y_{constructor(e,n,i){super(e,n,{enable:!0,...i}),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,p1.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){p1.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const m1=["keydown","keyup"];class QM extends Y_{constructor(e,n,i){super(e,n,{enable:!0,tabIndex:0,...i}),this.handleEvent=r=>{const c=r.target||r.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:"keydown",srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:"keyup",srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",m1.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){m1.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class JM extends Y_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const g1=1,Hb=2,_1=4,eP={pointerdown:g1,pointermove:Hb,pointerup:_1,mousedown:g1,mousemove:Hb,mouseup:_1},tP=0,nP=1,iP=2,rP=1,sP=2,aP=4;function oP(t){const e=eP[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i}=t.srcEvent;let r=!1,c=!1,f=!1;return e===Hb?(r=!!(n&rP),c=!!(n&aP),f=!!(n&sP)):(r=i===tP,c=i===nP,f=i===iP),{leftButton:r,middleButton:c,rightButton:f}}function lP(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,c=i.height/e.offsetHeight||1,f={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/c};return{center:n,offsetCenter:f}}const cP={srcElement:"root",priority:0};class uP{constructor(e,n){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let c=i.srcEvent.target;for(;c&&c!==r.rootElement;){if(this._emit(r,c),r.handled)return;c=c.parentNode}this._emit(r,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,c=!1){const{handlers:f,handlersByElement:a}=this,_={...cP,...i};let x=a.get(_.srcElement);x||(x=[],a.set(_.srcElement,x));const S={type:e,handler:n,srcElement:_.srcElement,priority:_.priority};r&&(S.once=!0),c&&(S.passive=!0),f.push(S),this._active=this._active||!S.passive;let R=x.length-1;for(;R>=0&&!(x[R].priority>=S.priority);)R--;x.splice(R+1,0,S)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let c=i.length-1;c>=0;c--){const f=i[c];if(f.type===e&&f.handler===n){i.splice(c,1);const a=r.get(f.srcElement);a.splice(a.indexOf(f),1),a.length===0&&r.delete(f.srcElement)}}this._active=i.some(c=>!c.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const c=()=>{e.handled=!0},f=()=>{e.handled=!0,r=!0},a=[];for(let _=0;_<i.length;_++){const{type:x,handler:S,once:R}=i[_];if(S({...e,type:x,stopPropagation:c,stopImmediatePropagation:f}),R&&a.push(i[_]),r)break}for(let _=0;_<a.length;_++){const{type:x,handler:S}=a[_];this.remove(x,S)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...oP(e),...lP(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function hP(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const i=n.shift(),r=n.shift()||{};e=new i(r)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class fP{constructor(e=null,n={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new UM(e,this.options);for(const i of this.options.recognizers){const{recognizer:r,recognizeWith:c,requireFailure:f}=hP(i);this.manager.add(r),c&&r.recognizeWith(c),f&&r.requireFailure(f)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new GM(e,this._onOtherEvent,{enable:!1}),this.moveInput=new KM(e,this._onOtherEvent,{enable:!1}),this.keyInput=new QM(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new JM(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);r&&(r.set({enable:n}),i.touchAction.update()),this.wheelInput?.enableEventType(e,n),this.moveInput?.enableEventType(e,n),this.keyInput?.enableEventType(e,n),this.contextmenuInput?.enableEventType(e,n)}_addEventHandler(e,n,i,r,c){if(typeof e!="string"){i=n;for(const[x,S]of Object.entries(e))this._addEventHandler(x,S,i,r,c);return}const{manager:f,events:a}=this;if(!f)return;let _=a.get(e);if(!_){const x=this._getRecognizerName(e)||e;_=new uP(this,x),a.set(e,_),f&&f.on(e,_.handleEvent)}_.add(e,n,i,r,c),_.isEmpty()||this._toggleRecognizer(_.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[c,f]of Object.entries(e))this._removeEventHandler(c,f);return}const{events:i}=this,r=i.get(e);if(r&&(r.remove(e,n),r.isEmpty())){const{recognizerName:c}=r;let f=!1;for(const a of i.values())if(a.recognizerName===c&&!a.isEmpty()){f=!0;break}f||this._toggleRecognizer(c,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(n=>n.getEventNames().includes(e))?.options.event}}const gi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(gi,"IDENTITY",{get:()=>(ji.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const _o={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Dd={common:0,meters:1,pixels:2},qb={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},y1={multipan:[f1,{threshold:10,direction:es.Vertical,pointers:2}],pinch:[qM,{},null,["multipan"]],pan:[f1,{threshold:1},["pinch"],["multipan"]],dblclick:[h1,{event:"dblclick",taps:2}],click:[h1,{event:"click"},null,["dblclick"]]};function dP(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function $m(t){let e={},n;return i=>{for(const r in i)if(!dP(i[r],e[r])){n=t(i),e=i;break}return n}}const b1=[0,0,0,0],pP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],MT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mP=[0,0,0],PT=[0,0,0],gP=$m(bP);function DT(t,e,n=PT){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,c=!0;switch(e===gi.LNGLAT_OFFSETS||e===gi.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case _o.WEB_MERCATOR:(e===gi.LNGLAT||e===gi.CARTESIAN)&&(r=[0,0,0],c=!1);break;case _o.WEB_MERCATOR_AUTO_OFFSET:e===gi.LNGLAT?i=r:e===gi.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case _o.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case _o.GLOBE:c=!1,r=null;break;default:c=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:c}}function _P(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:c,viewProjectionMatrix:f}=t,a=b1,_=b1,x=t.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:R,offsetMode:I}=DT(t,e,n);return I&&(_=t.projectPosition(S||R),x=[x[0]-_[0],x[1]-_[1],x[2]-_[2]],_[3]=1,a=jm([],_,f),c=i||c,f=of([],r,c),f=of([],f,pP)),{viewMatrix:c,viewProjectionMatrix:f,projectionCenter:a,originCommon:_,cameraPosCommon:x,shaderCoordinateOrigin:R,geospatialOrigin:S}}function yP({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=gi.DEFAULT,coordinateOrigin:r=PT,autoWrapLongitude:c=!1}){i===gi.DEFAULT&&(i=t.isGeospatial?gi.LNGLAT:gi.CARTESIAN);const f=gP({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return f.wrapLongitude=c,f.modelMatrix=n||MT,f}function bP({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:c,originCommon:f,cameraPosCommon:a,shaderCoordinateOrigin:_,geospatialOrigin:x}=_P(t,n,i),S=t.getDistanceScales(),R=[t.width*e,t.height*e],I=jm([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:_,commonOrigin:f.slice(0,3),center:r,pseudoMeters:!!t._pseudoMeters,viewportSize:R,devicePixelRatio:e,focalDistance:I,commonUnitsPerMeter:S.unitsPerMeter,commonUnitsPerWorldUnit:S.unitsPerMeter,commonUnitsPerWorldUnit2:mP,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:c,modelMatrix:MT,cameraPosition:a};if(x){const L=t.getDistanceScales(x);switch(n){case gi.METER_OFFSETS:N.commonUnitsPerWorldUnit=L.unitsPerMeter,N.commonUnitsPerWorldUnit2=L.unitsPerMeter2;break;case gi.LNGLAT:case gi.LNGLAT_OFFSETS:t._pseudoMeters||(N.commonUnitsPerMeter=L.unitsPerMeter),N.commonUnitsPerWorldUnit=L.unitsPerDegree,N.commonUnitsPerWorldUnit2=L.unitsPerDegree2;break;case gi.CARTESIAN:N.commonUnitsPerWorldUnit=[1,1,L.unitsPerMeter[2]],N.commonUnitsPerWorldUnit2=[0,0,L.unitsPerMeter2[2]];break}}return N}const xP=Object.keys(gi).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${gi[t]};`).join(""),vP=Object.keys(_o).map(t=>`const PROJECTION_MODE_${t}: i32 = ${_o[t]};`).join(""),wP=Object.keys(Dd).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Dd[t]};`).join(""),TP=`${xP}
${vP}
${wP}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,SP=`${TP}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,EP=Object.keys(gi).map(t=>`const int COORDINATE_SYSTEM_${t} = ${gi[t]};`).join(""),AP=Object.keys(_o).map(t=>`const int PROJECTION_MODE_${t} = ${_o[t]};`).join(""),CP=Object.keys(Dd).map(t=>`const int UNIT_${t.toUpperCase()} = ${Dd[t]};`).join(""),RP=`${EP}
${AP}
${CP}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,kP={};function IP(t=kP){return"viewport"in t?yP(t):{}}const qx={name:"project",dependencies:[oM,ST],source:SP,vs:RP,getUniforms:IP,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},MP=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,PP=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,DP={name:"project32",dependencies:[qx],source:MP,vs:PP};function OP(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ed(t,e){const n=jm([],e,t);return KI(n,n,1/n[3]),n}function x1(t,e){const n=t%e;return n<0?e+n:n}function Wb(t,e,n){return t<e?e:t>n?n:t}function BP(t){return Math.log(t)*Math.LOG2E}const Wx=Math.log2||BP;function jc(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Jo=Math.PI,OT=Jo/4,xo=Jo/180,Xb=180/Jo,Od=512,I_=4003e4,Kg=85.051129,NP=1.5;function zP(t){return Wx(t)}function M_(t){const[e,n]=t;jc(Number.isFinite(e)),jc(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*xo,r=n*xo,c=Od*(i+Jo)/(2*Jo),f=Od*(Jo+Math.log(Math.tan(OT+r*.5)))/(2*Jo);return[c,f]}function Bd(t){const[e,n]=t,i=e/Od*(2*Jo)-Jo,r=2*(Math.atan(Math.exp(n/Od*(2*Jo)-Jo))-OT);return[i*Xb,r*Xb]}function LP(t){const{latitude:e}=t;jc(Number.isFinite(e));const n=Math.cos(e*xo);return zP(I_*n)-9}function Qy(t){const e=Math.cos(t*xo);return Od/I_/e}function Zb(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;jc(Number.isFinite(e)&&Number.isFinite(n));const r=Od,c=Math.cos(e*xo),f=r/360,a=f/c,_=r/I_/c,x={unitsPerMeter:[_,_,_],metersPerUnit:[1/_,1/_,1/_],unitsPerDegree:[f,a,_],degreesPerUnit:[1/f,1/a,1/_]};if(i){const S=xo*Math.tan(e*xo)/c,R=f*S/2,I=r/I_*S,N=I/a*_;x.unitsPerDegree2=[0,R,I],x.unitsPerMeter2=[N,0,N]}return x}function BT(t,e){const[n,i,r]=t,[c,f,a]=e,{unitsPerMeter:_,unitsPerMeter2:x}=Zb({longitude:n,latitude:i,highPrecision:!0}),S=M_(t);S[0]+=c*(_[0]+x[0]*f),S[1]+=f*(_[1]+x[1]*f);const R=Bd(S),I=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[R[0],R[1],I]:R}function FP(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:c,center:f}=t,a=OP();R_(a,a,[0,0,-r]),xT(a,a,-n*xo),vT(a,a,i*xo);const _=c/e;return Hx(a,a,[_,_,_]),f&&R_(a,a,CI([],f)),a}function UP(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:c,center:f,scale:a,nearZMultiplier:_=1,farZMultiplier:x=1}=t;let{fovy:S=P_(NP)}=t;i!==void 0&&(S=P_(i));const R=S*xo,I=r*xo,N=NT(S);let L=N;f&&(L+=f[2]*a/Math.cos(I)/n);const H=R*(.5+(c?c[1]:0)/n),ie=Math.sin(H)*L/Math.sin(Wb(Math.PI/2-I-H,.01,Math.PI-.01)),ne=Math.sin(I)*ie+L,he=L*10,re=Math.min(ne*x,he);return{fov:R,aspect:e/n,focalDistance:N,near:_,far:re}}function P_(t){return 2*Math.atan(.5/t)*Xb}function NT(t){return .5/Math.tan(.5*t*xo)}function zT(t,e){const[n,i,r=0]=t;return jc(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Ed(e,[n,i,r,1])}function Xx(t,e,n=0){const[i,r,c]=t;if(jc(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(c))return Ed(e,[i,r,c,1]);const f=Ed(e,[i,r,0,1]),a=Ed(e,[i,r,1,1]),_=f[2],x=a[2],S=_===x?0:((n||0)-_)/(x-_);return _T([],f,a,S)}function VP(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:c=24,offset:f=[0,0]}=t,[[a,_],[x,S]]=i,R=jP(t.padding),I=M_([a,Wb(S,-Kg,Kg)]),N=M_([x,Wb(_,-Kg,Kg)]),L=[Math.max(Math.abs(N[0]-I[0]),r),Math.max(Math.abs(N[1]-I[1]),r)],H=[e-R.left-R.right-Math.abs(f[0])*2,n-R.top-R.bottom-Math.abs(f[1])*2];jc(H[0]>0&&H[1]>0);const ie=H[0]/L[0],ne=H[1]/L[1],he=(R.right-R.left)/2/ie,re=(R.top-R.bottom)/2/ne,ge=[(N[0]+I[0])/2+he,(N[1]+I[1])/2+re],_e=Bd(ge),pe=Math.min(c,Wx(Math.abs(Math.min(ie,ne))));return jc(Number.isFinite(pe)),{longitude:_e[0],latitude:_e[1],zoom:pe}}function jP(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(jc(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const v1=Math.PI/180;function $P(t,e=0){const{width:n,height:i,unproject:r}=t,c={targetZ:e},f=r([0,i],c),a=r([n,i],c);let _,x;const S=t.fovy?.5*t.fovy*v1:Math.atan(.5/t.altitude),R=(90-t.pitch)*v1;return S>R-.01?(_=w1(t,0,e),x=w1(t,n,e)):(_=r([0,0],c),x=r([n,0],c)),[f,a,x,_]}function w1(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Ed(i,[e,0,1,1]),c=Ed(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(c[2]-r[2]),_=_T([],r,c,a),x=Bd(_);return x.push(n),x}const T1=512;function HP(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:c,zoom:f,bearing:a=0}=t;(r<-180||r>180)&&(r=x1(r+180,360)-180),(a<-180||a>180)&&(a=x1(a+180,360)-180);const _=Wx(n/T1);if(f<=_)f=_,c=0;else{const x=n/2/Math.pow(2,f),S=Bd([0,x])[1];if(c<S)c=S;else{const R=Bd([0,T1-x])[1];c>R&&(c=R)}}return{width:e,height:n,longitude:r,latitude:c,zoom:f,pitch:i,bearing:a}}const LT=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,qP=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,WP=`
${LT}
${qP}
`,XP=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,ZP=`
${LT}
${XP}
`,YP=$m(eD),GP=$m(tD),KP=[0,0,0,1],QP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function JP(t,e){const[n,i,r]=t,c=Xx([n,i,r],e);return Number.isFinite(r)?c:[c[0],c[1],0]}function eD({viewport:t,center:e}){return new tc(t.viewProjectionMatrix).invert().transform(e)}function tD({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,c=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(f=>JP(f,i));for(const f of e){const a=f.clone().translate(new ec(t.center).negate()),_=c.map(S=>a.transform(S)),x=new tc().ortho({left:Math.min(..._.map(S=>S[0])),right:Math.max(..._.map(S=>S[0])),bottom:Math.min(..._.map(S=>S[1])),top:Math.max(..._.map(S=>S[1])),near:Math.min(..._.map(S=>-S[2])),far:Math.max(..._.map(S=>-S[2]))});n.push(x.multiplyRight(f))}return n}function nD(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i=qx.getUniforms(n),r=YP({viewport:n.viewport,center:i.center}),c=[],f=GP({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let _=0;_<t.shadowMatrices.length;_++){const x=f[_],S=x.clone().translate(new ec(n.viewport.center).negate());i.coordinateSystem===gi.LNGLAT&&i.projectionMode===_o.WEB_MERCATOR?(f[_]=S,c[_]=r):(f[_]=x.clone().multiplyRight(QP),c[_]=S.transform(r))}const a={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||KP,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let _=0;_<f.length;_++)a[`viewProjectionMatrix${_}`]=f[_],a[`projectCenter${_}`]=c[_];for(let _=0;_<2;_++)a[`shadow_uShadowMap${_}`]=t.shadowMaps&&t.shadowMaps[_]||t.dummyShadowMap;return a}const S1={name:"shadow",dependencies:[qx],vs:WP,fs:ZP,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:nD,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},iD={...n1,defaultUniforms:{...n1.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},rD=[ST],sD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],aD=[];function oD(t){const e=rf.getDefaultShaderAssembler();for(const i of rD)e.addDefaultModule(i);const n=t==="glsl"?sD:aD;for(const i of n)e.addShaderHook(i);return e}const lD=[255,255,255],cD=1;let uD=0;class hD{constructor(e={}){this.type="ambient";const{color:n=lD}=e,{intensity:i=cD}=e;this.id=e.id||`ambient-${uD++}`,this.color=n,this.intensity=i}}const fD=[255,255,255],dD=1,pD=[0,0,-1];let mD=0;class E1{constructor(e={}){this.type="directional";const{color:n=fD}=e,{intensity:i=dD}=e,{direction:r=pD}=e,{_shadow:c=!1}=e;this.id=e.id||`directional-${mD++}`,this.color=n,this.intensity=i,this.type="directional",this.direction=new ec(r).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class gD{constructor(e,n={id:"pass"}){const{id:i}=n;this.id=i,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Zx extends gD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,i]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,c=e.clearColor??(r?[0,0,0,0]:!1),f=r?1:!1,a=r?0:!1,_=e.colorMask??15,x={viewport:[0,0,n,i]};e.colorMask&&(x.colorMask=_),e.scissorRect&&(x.scissorRect=e.scissorRect);const S=this.device.beginRenderPass({framebuffer:e.target,parameters:x,clearColor:c,clearDepth:f,clearStencil:a});try{return this._drawLayers(S,e)}finally{S.end(),this.device.submit()}}_drawLayers(e,n){const{target:i,shaderModuleProps:r,viewports:c,views:f,onViewportActive:a,clearStack:_=!0}=n;n.pass=n.pass||"unknown",_&&(this._lastRenderIndex=-1);const x=[];for(const S of c){const R=f&&f[S.id];a?.(S);const I=this._getDrawLayerParams(S,n),N=S.subViewports||[S];for(const L of N){const H=this._drawLayersInViewport(e,{target:i,shaderModuleProps:r,viewport:L,view:R,pass:n.pass,layers:n.layers},I);x.push(H)}}return x}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:c,cullRect:f,effects:a,shaderModuleProps:_},x=!1){const S=[],R=FT(this._lastRenderIndex+1),I={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:f},N={};for(let L=0;L<n.length;L++){const H=n[L],ie=this._shouldDrawLayer(H,I,c,N),ne={shouldDrawLayer:ie};ie&&!x&&(ne.shouldDrawLayer=!0,ne.layerRenderIndex=R(H,ie),ne.shaderModuleProps=this._getShaderModuleProps(H,a,i,_),ne.layerParameters={...H.context.deck?.props.parameters,...this.getLayerParameters(H,L,e)}),S[L]=ne}return S}_drawLayersInViewport(e,{layers:n,shaderModuleProps:i,pass:r,target:c,viewport:f,view:a},_){const x=_D(this.device,{shaderModuleProps:i,target:c,viewport:f});if(a&&a.props.clear){const R=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:c,parameters:{viewport:x,scissorRect:x},clearColor:R.color?[0,0,0,0]:!1,clearDepth:R.depth?1:!1}).end()}const S={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:x});for(let R=0;R<n.length;R++){const I=n[R],N=_[R],{shouldDrawLayer:L}=N;if(L&&I.props.pickable&&S.pickableCount++,I.isComposite&&S.compositeCount++,I.isDrawable&&N.shouldDrawLayer){const{layerRenderIndex:H,shaderModuleProps:ie,layerParameters:ne}=N;S.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,H),ie.project&&(ie.project.viewport=f),I.context.renderPass=e;try{I._drawLayer({renderPass:e,shaderModuleProps:ie,uniforms:{layerIndex:H},parameters:ne})}catch(he){I.raiseError(he,`drawing ${I} to ${r}`)}}}return S}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,i){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(n))return!1;n.layer=f,f=f.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,i,r){const c=this.device.canvasContext.cssToDeviceRatio(),f=e.internalState?.propsInTransition||e.props,a={layer:f,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:c,modelMatrix:f.modelMatrix,coordinateSystem:f.coordinateSystem,coordinateOrigin:f.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const _ of n)A1(a,_.getShaderModuleProps?.(e,a));return A1(a,this.getShaderModuleProps(e,n,a),r)}}function FT(t=0,e={}){const n={},i=(r,c)=>{const f=r.props._offset,a=r.id,_=r.parent&&r.parent.id;let x;if(_&&!(_ in e)&&i(r.parent,!1),_ in n){const S=n[_]=n[_]||FT(e[_],e);x=S(r,c),n[a]=S}else Number.isFinite(f)?(x=f+(e[_]||0),n[a]=null):x=t;return c&&x>=t&&(t=x+1),e[a]=x,x};return i}function _D(t,{shaderModuleProps:e,target:n,viewport:i}){const r=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,c]=t.canvasContext.getDrawingBufferSize(),f=n?n.height:c,a=i;return[a.x*r,f-(a.y+a.height)*r,a.width*r,a.height*r]}function A1(t,...e){for(const n of e)if(n)for(const i in n)t[i]?Object.assign(t[i],n[i]):t[i]=n[i];return t}class yD extends Zx{constructor(e,n){super(e,n);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],c=r.width*i,f=r.height*i,a=[1,1,1,1];(c!==n.width||f!==n.height)&&n.resize({width:c,height:f}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const bD={color:[255,255,255],intensity:1},C1=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],xD=[0,0,0,200/255];class UT{constructor(e={}){this.id="lighting-effect",this.shadowColor=xD,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),i._addDefaultShaderModule(S1),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:c}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:c,shaderModuleProps:{shadow:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const i=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(f=>f.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(f=>f.getProjectedLight({layer:e})),pointLights:this.pointLights.map(f=>f.getProjectedLight({layer:e}))},c=e.props.material;return{shadow:i,lighting:r,phongMaterial:c,gouraudMaterial:c}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(S1))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new tc().lookAt({eye:new ec(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new yD(e);this.shadowPasses[n]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new hD(bD),this.directionalLights.push(new E1(C1[0]),new E1(C1[1])))}}class vD{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:c=0,copy:f=!1,initialize:a=!1,maxCount:_}){const x=r||e&&e.constructor||Float32Array,S=n*i+c;if(ArrayBuffer.isView(e)){if(S<=e.length)return e;if(S*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new x(e.buffer,0,S)}let R=1/0;_&&(R=_*i+c);const I=this._allocate(x,S,a,R);return e&&f?I.set(e):a||I.fill(0,0,4),this._release(e),I}release(e){this._release(e)}_allocate(e,n,i,r){let c=Math.max(Math.ceil(n*this.opts.overAlloc),1);c>r&&(c=r);const f=this._pool,a=e.BYTES_PER_ELEMENT*c,_=f.findIndex(x=>x.byteLength>=a);if(_>=0){const x=new e(f.splice(_,1)[0],0,c);return i&&x.fill(0),x}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,c=n.findIndex(f=>f.byteLength>=r);c<0?n.push(i):(c>0||n.length<this.opts.poolSize)&&n.splice(c,0,i),n.length>this.opts.poolSize&&n.shift()}}const Dm=new vD;function _m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wD(t){return[t[12],t[13],t[14]]}function TD(t){return{left:fd(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:fd(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:fd(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:fd(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:fd(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:fd(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const R1=new ec;function fd(t,e,n,i){R1.set(t,e,n);const r=R1.len();return{distance:i/r,normal:new ec(-t/r,-e/r,-n/r)}}function SD(t){return t-Math.fround(t)}let sm;function Jy(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,c=(r-i)/n;sm=Dm.allocate(sm,c,{type:Float32Array,size:n*2});let f=i,a=0;for(;f<r;){for(let _=0;_<n;_++){const x=t[f++];sm[a+_]=x,sm[a+_+n]=SD(x)}a+=n*2}return sm.subarray(0,c*n*2)}function ED(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const AD=Math.PI/180,CD=_m(),k1=[0,0,0],RD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function kD({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:c,near:f,far:a}){const _=t/e,x=n?new tc().orthographic({fovy:i,aspect:_,focalDistance:r,near:f,far:a}):new tc().perspective({fovy:i,aspect:_,near:f,far:a});if(c){const{left:S=0,right:R=0,top:I=0,bottom:N=0}=c,L=Xu((S+t-R)/2,0,t)-t/2,H=Xu((I+e-N)/2,0,e)-e/2;x[8]-=L*2/t,x[9]+=H*2/e}return x}class Hm{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||RD,this.focalDistance=e.focalDistance||1,this.position=e.position||k1,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?_o.WEB_MERCATOR:_o.WEB_MERCATOR_AUTO_OFFSET:_o.IDENTITY}equals(e){return e instanceof Hm?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Pm(e.projectionMatrix,this.projectionMatrix)&&Pm(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=zT(i,this.pixelProjectionMatrix),[c,f]=r,a=n?f:this.height-f;return e.length===2?[c,a]:[c,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,c,f]=e,a=n?c:this.height-c,_=i&&i*this.distanceScales.unitsPerMeter[2],x=Xx([r,a,f],this.pixelUnprojectionMatrix,_),[S,R,I]=this.unprojectPosition(x);return Number.isFinite(f)?[S,R,I]:Number.isFinite(i)?[S,R,i]:[S,R]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=M_(e);return n[1]=Xu(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Bd(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),c=this.unproject([0,this.height],n),f=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],c[0],f[0]),Math.min(i[1],r[1],c[1],f[1]),Math.max(i[0],r[0],c[0],f[0]),Math.max(i[1],r[1],c[1],f[1])]}getDistanceScales(e){return e&&this.isGeospatial?Zb({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,TD(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=LP({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Zb({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:c,modelMatrix:f}=e;let a=k1;if(c&&(a=f?new tc(f).transformAsVector(c,[]):c),this.isGeospatial){const _=this.projectPosition([n,i,0]);this.center=new ec(a).scale(this.distanceScales.unitsPerMeter).add(_)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=CD,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:c,fovy:f=75,near:a=.1,far:_=1e3,padding:x=null,focalDistance:S=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new tc().multiplyRight(n).translate(new ec(this.center).negate()),this.projectionMatrix=i||kD({width:this.width,height:this.height,orthographic:r,fovyRadians:c||f*AD,focalDistance:S,padding:x,near:a,far:_});const R=_m();of(R,R,this.projectionMatrix),of(R,R,this.viewMatrix),this.viewProjectionMatrix=R,this.viewMatrixInverse=Fb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=wD(this.viewMatrixInverse);const I=_m(),N=_m();Hx(I,I,[this.width/2,-this.height/2,1]),R_(I,I,[1,-1,0]),of(N,I,this.viewProjectionMatrix),this.pixelProjectionMatrix=N,this.pixelUnprojectionMatrix=Fb(_m(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ji.warn("Pixel project matrix not invertible")()}}Hm.displayName="Viewport";class Nd extends Hm{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:c=0,bearing:f=0,nearZMultiplier:a=.1,farZMultiplier:_=1.01,nearZ:x,farZ:S,orthographic:R=!1,projectionMatrix:I,repeat:N=!1,worldOffset:L=0,position:H,padding:ie,legacyMeterSizes:ne=!1}=e;let{width:he,height:re,altitude:ge=1.5}=e;const _e=Math.pow(2,r);he=he||1,re=re||1;let pe,it=null;if(I)ge=I[5]/2,pe=P_(ge);else{e.fovy?(pe=e.fovy,ge=NT(pe)):pe=P_(ge);let nt;if(ie){const{top:Ce=0,bottom:ht=0}=ie;nt=[0,Xu((Ce+re-ht)/2,0,re)-re/2]}it=UP({width:he,height:re,scale:_e,center:H&&[0,0,H[2]*Qy(n)],offset:nt,pitch:c,fovy:pe,nearZMultiplier:a,farZMultiplier:_}),Number.isFinite(x)&&(it.near=x),Number.isFinite(S)&&(it.far=S)}let mt=FP({height:re,pitch:c,bearing:f,scale:_e,altitude:ge});L&&(mt=new tc().translate([512*L,0,0]).multiplyLeft(mt)),super({...e,width:he,height:re,viewMatrix:mt,longitude:i,latitude:n,zoom:r,...it,fovy:pe,focalDistance:ge}),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=c,this.bearing=f,this.altitude=ge,this.fovy=pe,this.orthographic=R,this._subViewports=N?[]:null,this._pseudoMeters=ne,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const c=r?new Nd({...this,worldOffset:r}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Qy(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Qy(i);return[n,i,r]}addMetersToLngLat(e,n){return BT(e,n)}panByPosition(e,n){const i=Xx(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),c=e1([],r,vI([],i)),f=e1([],this.center,c),[a,_]=this.unprojectFlat(f);return{longitude:a,latitude:_}}getBounds(e={}){const n=$P(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:c,latitude:f,zoom:a}=VP({width:i,height:r,bounds:e,...n});return new Nd({width:i,height:r,longitude:c,latitude:f,zoom:a})}}Nd.displayName="WebMercatorViewport";const I1=[0,0,0];function eb(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Nd){const[r,c,f=0]=t,a=e.getDistanceScales([r,c]);i[2]=f*a.unitsPerMeter[2]}return i}function ID(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:c,fromCoordinateOrigin:f}=t;return r===gi.DEFAULT&&(r=e.isGeospatial?gi.LNGLAT:gi.CARTESIAN),c===void 0&&(c=r),f===void 0&&(f=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:f}}function VT(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:c}){let[f,a,_=0]=t;switch(n&&([f,a,_]=jm([],[f,a,_,1],n)),i){case gi.LNGLAT:return eb([f,a,_],e,c);case gi.LNGLAT_OFFSETS:return eb([f+r[0],a+r[1],_+(r[2]||0)],e,c);case gi.METER_OFFSETS:return eb(BT(r,[f,a,_]),e,c);case gi.CARTESIAN:default:return e.isGeospatial?[f+r[0],a+r[1],_+r[2]]:e.projectPosition([f,a,_])}}function MD(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:c,fromCoordinateSystem:f,fromCoordinateOrigin:a}=ID(e),{autoOffset:_=!0}=e,{geospatialOrigin:x=I1,shaderCoordinateOrigin:S=I1,offsetMode:R=!1}=_?DT(n,i,r):{},I=VT(t,{viewport:n,modelMatrix:c,coordinateSystem:f,coordinateOrigin:a,offsetMode:R});if(R){const N=n.projectPosition(x||S);NI(I,I,N)}return I}let PD=1,DD=1;class jT{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:c=1}=e,f=PD++,a={time:0,delay:n,duration:i,rate:r,repeat:c};return this._setChannelTime(a,this.time),this.channels.set(f,a),f}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:c,channel:f}=r;c.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=DD++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function OD(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function BD(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let ND=0;const zD={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Bb.stats.get(`animation-loop-${ND++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class LD{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...zD,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new $_({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=OD(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(BD(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const r=this.device?.canvasContext?.canvas;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const tb={};function G_(t="id"){tb[t]=tb[t]||1;const e=tb[t]++;return`${t}-${e}`}class M1{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||G_("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&$i.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function FD(t,e){if(e instanceof M1)return e;const n=UD(t,e),{attributes:i,bufferLayout:r}=VD(t,e);return new M1({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:n,attributes:i})}function UD(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:$i.INDEX,data:n})}function VD(t,e){const n=[],i={};for(const[c,f]of Object.entries(e.attributes)){let a=c;switch(c){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(f){i[a]=t.createBuffer({data:f.value,id:`${c}-buffer`});const{value:_,size:x,normalized:S}=f;n.push({name:a,format:Ok(_,x,S)})}}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}class Yx{static defaultProps={...kd.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Yx(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const n={...kd.defaultProps,...e},i=this._hashRenderPipeline(n);if(!this._renderPipelineCache[i]){const r=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._renderPipelineCache[i]={pipeline:r,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const n={...x_.defaultProps,...e},i=this._hashComputePipeline(n);if(!this._computePipelineCache[i]){const r=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._computePipelineCache[i]={pipeline:r,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const n=e.hash,i=e instanceof x_?this._computePipelineCache:this._renderPipelineCache;i[n].useCount--,i[n].useCount===0&&this.destroyPolicy==="unused"&&(i[n].pipeline.destroy(),delete i[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,r="-",c=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${i}V${r}BL${c}`;default:const f=this._getHash(JSON.stringify(e.parameters));return`${n}/${i}V${r}T${e.topology}P${f}BL${c}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Gx{static defaultProps={...X_.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Gx(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const n=this._hashShader(e);let i=this._cache[n];if(!i){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=i={shader:r,useCount:0}}return i.useCount++,i.shader}release(e){const n=this._hashShader(e),i=this._cache[n];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function jD(t,e){const n={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const r of t.attributes)if(r){const c=`${r.location} ${r.name}: ${r.type}`;n[`in ${c}`]={[i]:r.stepMode||"vertex"}}for(const r of t.varyings||[]){const c=`${r.location} ${r.name}`;n[`out ${c}`]={[i]:JSON.stringify(r)}}return n}let hs=null,nb=null;function $D(t,{id:e,minimap:n,opaque:i,top:r="0",left:c="0",rgbaScale:f=1}){hs||(hs=document.createElement("canvas"),hs.id=e,hs.title=e,hs.style.zIndex="100",hs.style.position="absolute",hs.style.top=r,hs.style.left=c,hs.style.border="blue 5px solid",hs.style.transform="scaleY(-1)",document.body.appendChild(hs),nb=hs.getContext("2d")),(hs.width!==t.width||hs.height!==t.height)&&(hs.width=t.width/2,hs.height=t.height/2,hs.style.width="400px",hs.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),_=nb?.createImageData(t.width,t.height);if(_){for(let S=0;S<a.length;S+=4)_.data[0+S+0]=a[S+0]*f,_.data[0+S+1]=a[S+1]*f,_.data[0+S+2]=a[S+2]*f,_.data[0+S+3]=i?255:a[S+3]*f;nb?.putImageData(_,0,0)}}function Yb(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Yb(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!Yb(t[c],e[c],n-1))return!1;return!0}return!1}function HD(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function qD(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function $T(t){return HD(t)||qD(t)}function WD(t){return $T(t)||typeof t=="number"||typeof t=="boolean"}function HT(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];WD(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}class XD{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,n){Object.assign(this.options,n);const i=Cx(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;At.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,c]of Object.entries(e))this._addModule(c),c.name&&r!==c.name&&!this.options.disableWarnings&&At.warn(`Module name: ${r} vs ${c.name}`)()}destroy(){}setProps(e){for(const n of Object.keys(e)){const i=n,r=e[i]||{},c=this.modules[i];if(!c){this.options.disableWarnings||At.warn(`Module ${n} not found`)();continue}const f=this.moduleUniforms[i],a=this.moduleBindings[i],_=c.getUniforms?.(r,f)||r,{uniforms:x,bindings:S}=HT(_);this.moduleUniforms[i]={...f,...x},this.moduleBindings[i]={...a,...S}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,c]of Object.entries(i))e[`${n}.${r}`]={type:this.modules[n].uniformTypes?.[r],value:String(c)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let ZD="";async function YD(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:ZD+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class ib{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,n){this.device=e,this.id=n.id||G_("async-texture"),typeof n?.data=="string"&&n.dimension==="2d"&&(n={...n,data:YD(n.data)}),this.ready=new Promise((i,r)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=r}),this.initAsync(n)}async initAsync(e){const n=e.data;let i;try{i=await qT(n)}catch(c){this.rejectReady(c)}if(this.destroyed)return;const r={...e,data:i};this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function qT(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(qT));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),i=Object.keys(e),r={};for(let c=0;c<i.length;c++)r[i[c]]=n[c];return r}return t}const Jh=2,GD=1e4;class Om{static defaultProps={...kd.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:rf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,n){this.props={...Om.defaultProps,...n},n=this.props,this.id=n.id||G_("model"),this.device=e,Object.assign(this.userData,n.userData);const i=Object.fromEntries(this.props.modules?.map(_=>[_.name,_])||[]),r=n.shaderInputs||new XD(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const c=QD(e),f=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:_,getUniforms:x}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:f});this.source=_,this._getModuleUniforms=x,this.props.shaderLayout||=hI(this.source)}else{const{vs:_,fs:x,getUniforms:S}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:f});this.vs=_,this.fs=x,this._getModuleUniforms=S}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Yx.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Gx.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return At.info(Jh,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),Gb(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:c}=this.vertexArray,f=c?c.byteLength/(c.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:f,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const n=e&&FD(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new $y(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new $y(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Yb(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Dk(this.shaderInputs.modules);for(const[n,i]of Object.entries(this.shaderInputs.modules))if(KD(i)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const i=n?.disableWarnings??this.props.disableWarnings;e.indices&&At.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=Bk(this.pipeline.shaderLayout,this.bufferLayout);const r=new $y(this.bufferLayout);for(const[c,f]of Object.entries(e)){const a=r.getBufferLayout(c);if(!a){i||At.warn(`Model(${this.id}): Missing layout for buffer "${c}".`)();continue}const _=r.getAttributeNamesForBuffer(a);let x=!1;for(const S of _){const R=this._attributeInfos[S];if(R){const I=this.device.type==="webgpu"?r.getBufferIndex(R.bufferName):R.location;this.vertexArray.setBuffer(I,f),x=!0}}!x&&!i&&At.warn(`Model(${this.id}): Ignoring buffer "${f.id}" for unknown attribute "${c}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[i,r]of Object.entries(e)){const c=this._attributeInfos[i];c?this.vertexArray.setConstantWebGL(c.location,r):(n?.disableWarnings??this.props.disableWarnings)||At.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Gb(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:i}=HT(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof ib&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,i]of Object.entries(this.bindings))i instanceof ib?i.isReady&&(e[n]=i.texture):e[n]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof W_?e=Math.max(e,n.texture.updateTimestamp):n instanceof $i||n instanceof Ri?e=Math.max(e,n.updateTimestamp):n instanceof ib?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof Im||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[i]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(r=>r.name===i)&&i!=="positions"&&delete n[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(At.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=i:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:r}),this._attributeInfos=q2(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=At.level>3?0:GD;At.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,At.group(Jh,`>>> DRAWING MODEL ${this.id}`,{collapsed:At.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=jD(this.pipeline.shaderLayout,this.id);At.table(Jh,e)();const n=this.shaderInputs.getDebugTable();for(const[r,c]of Object.entries(this.uniforms))n[r]={value:c};At.table(Jh,n)();const i=this._getAttributeDebugTable();At.table(Jh,this._attributeInfos)(),At.table(Jh,i)(),At.groupEnd(Jh)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const i=e.props.framebuffer;i&&$D(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,i]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[i.location];e[i.location]={name:n,type:i.shaderType,values:r?this._getBufferOrConstantValues(r,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,i=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,n){const i=Z2(n);return(e instanceof $i?new i(e.debugData):e).toString()}}function KD(t){return!!(t.uniformTypes&&!Gb(t.uniformTypes))}function QD(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Gb(t){for(const e in t)return!1;return!0}class zd{device;model;transformFeedback;static defaultProps={...Om.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,n=zd.defaultProps){if(!zd.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Om(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||NR(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof $i)return n.readAsync();const{buffer:i,byteOffset:r=0,byteLength:c=i.byteLength}=n;return i.readAsync(r,c)}}class JD{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:n={},indices:i=null,vertexCount:r=null}=e;this.id=e.id||G_("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[c,f]of Object.entries(n)){const a=ArrayBuffer.isView(f)?{value:f}:f;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(c)}: must be typed array or object with value as typed array`);if((c==="POSITION"||c==="positions")&&!a.size&&(a.size=3),c==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[c]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r of Object.values(e)){const{value:c,size:f,constant:a}=r;!a&&c&&f!==void 0&&f>=1&&(i=Math.min(i,c.length/f))}return i}}const e4={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class WT extends Zx{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:c,pickingFBO:f,deviceRect:{x:a,y:_,width:x,height:S},cullRect:R,effects:I,pass:N="picking",pickZ:L,shaderModuleProps:H}){this.pickZ=L;const ie=this._resetColorEncoder(L),ne=[a,_,x,S],he=super.render({target:f,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:c,cullRect:R,effects:I?.filter(ge=>ge.useInPicking),pass:N,isPicking:!0,shaderModuleProps:H,clearColor:[0,0,0,0],colorMask:15,scissorRect:ne});return this._colorEncoderState=null,{decodePickingColor:ie&&n4.bind(null,ie),stats:he}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,n,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:c,operation:f}=e.props;return!this._colorEncoderState||f.includes("terrain")?r.blend=!1:c&&f.includes("draw")&&(Object.assign(r,e4),r.blend=!0,r.blendColor=t4(this._colorEncoderState,e,i)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function t4(t,e,n){const{byLayer:i,byAlpha:r}=t;let c,f=i.get(e);return f?(f.viewports.push(n),c=f.a):(c=i.size+1,c<=255?(f={a:c,layer:e,viewports:[n]},i.set(e,f),r[c]=f):(ji.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function n4(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const gd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},D_=Symbol.for("component"),lf=Symbol.for("propTypes"),rb=Symbol.for("deprecatedProps"),Ad=Symbol.for("asyncPropDefaults"),df=Symbol.for("asyncPropOriginal"),Zu=Symbol.for("asyncPropResolved");function XT(t,e=()=>!0){return Array.isArray(t)?ZT(t,e,[]):e(t)?[t]:[]}function ZT(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?ZT(r,e,n):e(r)&&n.push(r)}return n}function i4({target:t,source:e,start:n=0,count:i=1}){const r=e.length,c=i*r;let f=0;for(let a=n;f<r;f++)t[a++]=e[f];for(;f<c;)f<c-f?(t.copyWithin(n+f,n,n+f),f*=2):(t.copyWithin(n+f,n,n+c-f),f=c);return t}class r4{constructor(e,n,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=kb(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class s4{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let c=this._resources[e];c?c.setData(n,i):(c=new r4(e,n,this._context),this._resources[e]=c),c.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],c=this._resources[r.resourceId];c&&c.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:c,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=c[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const c=this._consumers,f=c[e]=c[e]||{};let a=f[n];const _=a&&a.resourceId&&this._resources[a.resourceId];_&&(_.unsubscribe(a),this.prune()),i&&(a?(a.onChange=r,a.resourceId=i.id):a={onChange:r,resourceId:i.id},f[n]=a,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const a4="layerManager.setLayers",o4="layerManager.activateViewport";class l4{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{ta(o4,this,a),a&&(this.context.viewport=a)};const{deck:i,stats:r,viewport:c,timeline:f}=n||{};this.layers=[],this.resourceManager=new s4({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:oD(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[mM],renderPass:void 0,stats:r||new $_({id:"deck.gl"}),viewport:c||new Hm({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:f||new jT,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){ta(a4,this,n,e),this._lastRenderedLayers=e;const i=XT(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(i=>i.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,i=n.findIndex(r=>r.name===e.name);i>=0&&(n.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,i){i.raiseError(n,`${e} of ${i}`)}_updateLayers(e,n){const i={};for(const f of e)i[f.id]?ji.warn(`Multiple old layers with same id ${f.id}`)():i[f.id]=f;if(this._defaultShaderModulesChanged){for(const f of e)f.setNeedsUpdate(),f.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let c=!1;for(const f of r)if(f.hasUniformTransition()){c=`Uniform transition in ${f}`;break}this._needsUpdate=c,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const c=n[r.id];c===null&&ji.warn(`Multiple new layers with same id ${r.id}`)(),n[r.id]=null;let f=null;try{this._debug&&c!==r&&r.validateProps(),c?(this._transferLayerState(c,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),f=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}f&&this._updateSublayersRecursively(f,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=gd.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=gd.MATCHED,n!==e&&(e.lifecycle=gd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=gd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=gd.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function el(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!el(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!el(t[c],e[c],n-1))return!1;return!0}return!1}class c4{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let c=i.length-1;c>=0;--c){const f=i[c];if(f.containsPixel(r)){const a=e.slice();return a[0]-=f.x,a[1]-=f.y,f.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=XT(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!el(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ji.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>this.getView(e.id)?.makeViewport({viewState:c,width:this.width,height:this.height})})}_updateController(e,n,i,r){const c=e.controller;if(c&&i){const f={...n,...c,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==c.type)&&(r=this._createController(e,f)),r&&r.setProps(f),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const c=e[r],f=this.getViewState(c),a=c.makeViewport({viewState:f,width:this.width,height:this.height});let _=n[c.id];const x=!!c.controller;x&&!_&&(i=!0),(i||!x)&&_&&(_.finalize(),_=null),this.controllers[c.id]=this._updateController(c,f,a,_),a&&this._viewports.unshift(a)}for(const r in n){const c=n[r];c&&!this.controllers[r]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const u4=/([0-9]+\.?[0-9]*)(%|px)/;function Fu(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=u4.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Uu(t,e){return t.relative?Math.round(t.position*e):t.position}class Ld{constructor(e){const{id:n,x:i=0,y:r=0,width:c="100%",height:f="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Fu(i),this._y=Fu(r),this._width=Fu(c),this._height=Fu(f),this._padding=a&&{left:Fu(a.left||0),right:Fu(a.right||0),top:Fu(a.top||0),bottom:Fu(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&el(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});if(!r.height||!r.width)return null;const c=this.getViewportType(i);return new c({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Uu(this._x,e),y:Uu(this._y,n),width:Uu(this._width,e),height:Uu(this._height,n)};return this._padding&&(i.padding={left:Uu(this._padding.left,e),top:Uu(this._padding.top,n),right:Uu(this._padding.right,e),bottom:Uu(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class K_{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:n}=this;this._handle=e.addChannel({delay:e.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const P1=()=>{},Kb={BREAK:1,SNAP_TO_END:2,IGNORE:3},h4=t=>t,f4=Kb.BREAK;class d4{constructor(e){this._onTransitionUpdate=n=>{const{time:i,settings:{interpolator:r,startProps:c,endProps:f,duration:a,easing:_}}=n,x=_(i/a),S=r.interpolateProps(c,f,x);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new K_(e.timeline),this.onViewStateChange=e.onViewStateChange||P1,this.onStateChange=e.onStateChange||P1}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:c,endProps:f}=this.transition.settings;r={...i,...c===Kb.SNAP_TO_END?f:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Kb.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),c=n.transitionInterpolator,f=c.getDuration?c.getDuration(e,n):n.transitionDuration;if(f===0)return;const a=c.initializeProps(e,r);this.propsInTransition={};const _={duration:f,easing:n.transitionEasing||h4,interpolator:c,interruption:n.transitionInterruption||f4,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(_),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(n)}}}function Us(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class p4{constructor(e){const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!Pm(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const c of this._propsToExtract)(c in e||c in n)&&(i[c]=e[c],r[c]=n[c]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Us(Number.isFinite(i)||Array.isArray(i),`${n} is required for transition`)})}}const m4=["longitude","latitude","zoom","bearing","pitch"],g4=["longitude","latitude","zoom"];class YT extends p4{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:m4,required:g4},super(i.transitionProps),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:c}=this.opts;if(r&&c){const f=r(e),a=r(n),_=f.unproject(c);i.start.around=c,Object.assign(i.end,{around:a.project(_),aroundPosition:_,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const c of this._propsToExtract)r[c]=C_(e[c]||0,n[c]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...n,...r});Object.assign(r,c.panByPosition(n.aroundPosition,C_(e.around,n.around,i)))}return r}}const Vu={transitionDuration:0},_4=300,Qg=t=>1-(1-t)*(1-t),dd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},ef={};class y4{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new d4({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const c=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return c&&n&&n.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?_4:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:c=!0,doubleClickZoom:f=!0,touchZoom:a=!0,touchRotate:_=!1,keyboard:x=!0}=e,S=!!this.onViewStateChange;this.toggleEvents(dd.WHEEL,S&&i),this.toggleEvents(dd.PAN,S),this.toggleEvents(dd.PINCH,S&&(a||_)),this.toggleEvents(dd.MULTI_PAN,S&&_),this.toggleEvents(dd.DOUBLE_CLICK,S&&f),this.toggleEvents(dd.KEYBOARD,S&&x),this.scrollZoom=i,this.dragPan=r,this.dragRotate=c,this.doubleClickZoom=f,this.touchZoom=a,this.touchRotate=_,this.keyboard=x}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),c){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:f,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Vu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Vu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qg},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Vu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qg},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let f=2/(1+Math.exp(-Math.abs(c*i)));c<0&&f!==0&&(f=1/f);const a=this.controllerState.zoom({pos:n,scale:f});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Vu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Vu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],c=this.controllerState.rotate({pos:r});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qg},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ef._startPinchRotation=e.rotation,ef._lastPinchEvent=e,this.updateViewport(i,Vu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:ef._startPinchRotation-i})}return this.updateViewport(n,Vu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ef._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=ef;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let c=this.controllerState.rotateEnd();const f=Math.log2(e.scale),a=(f-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),_=Math.pow(2,f+a*n/2);c=c.zoom({pos:r,scale:_}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Qg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ef._startPinchRotation=null,ef._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:c,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let _;const x={};switch(e.srcEvent.code){case"Minus":_=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),x.isZooming=!0;break;case"Equal":_=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),x.isZooming=!0;break;case"ArrowLeft":n?(_=a.rotateLeft(c),x.isRotating=!0):(_=a.moveLeft(r),x.isPanning=!0);break;case"ArrowRight":n?(_=a.rotateRight(c),x.isRotating=!0):(_=a.moveRight(r),x.isPanning=!0);break;case"ArrowUp":n?(_=a.rotateUp(f),x.isRotating=!0):(_=a.moveUp(r),x.isPanning=!0);break;case"ArrowDown":n?(_=a.rotateDown(f),x.isRotating=!0):(_=a.moveDown(r),x.isPanning=!0);break;default:return!1}return this.updateViewport(_,this._getTransitionProps(),x),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Vu:e?{...n,transitionInterpolator:new YT({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class b4{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const D1=5,x4=1.2;class v4 extends b4{constructor(e){const{width:n,height:i,latitude:r,longitude:c,zoom:f,bearing:a=0,pitch:_=0,altitude:x=1.5,position:S=[0,0,0],maxZoom:R=20,minZoom:I=0,maxPitch:N=60,minPitch:L=0,startPanLngLat:H,startZoomLngLat:ie,startRotatePos:ne,startBearing:he,startPitch:re,startZoom:ge,normalize:_e=!0}=e;Us(Number.isFinite(c)),Us(Number.isFinite(r)),Us(Number.isFinite(f)),super({width:n,height:i,latitude:r,longitude:c,zoom:f,bearing:a,pitch:_,altitude:x,maxZoom:R,minZoom:I,maxPitch:N,minPitch:L,normalize:_e,position:S},{startPanLngLat:H,startZoomLngLat:ie,startRotatePos:ne,startBearing:he,startPitch:re,startZoom:ge}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:c,startPitch:f}=this.getState();if(!r||c===void 0||f===void 0)return this;let a;return e?a=this._getNewRotation(e,r,f,c):a={bearing:c+n,pitch:f+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:c}=this.getState();if(c||(r=this.getViewportProps().zoom,c=this._unproject(n)||this._unproject(e)),!c)return this;const{maxZoom:f,minZoom:a}=this.getViewportProps();let _=r+Math.log2(i);_=Xu(_,a,f);const x=this.makeViewport({...this.getViewportProps(),zoom:_});return this._getUpdatedState({zoom:_,...x.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:c}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(c-n.longitude)>180&&(i.longitude=c<0?c+360:c-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=Xu(r,i,n);const{maxPitch:c,minPitch:f,pitch:a}=e;e.pitch=Xu(a,f,c);const{normalize:_=!0}=e;return _&&Object.assign(e,HP(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const c=e[0]-n[0],f=e[1]-n[1],a=e[1],_=n[1],{width:x,height:S}=this.getViewportProps(),R=c/x;let I=0;f>0?Math.abs(S-_)>D1&&(I=f/(_-S)*x4):f<0&&_>D1&&(I=1-a/_),I=Xu(I,-1,1);const{minPitch:N,maxPitch:L}=this.getViewportProps(),H=r+180*R;let ie=i;return I>0?ie=i+I*(L-i):I<0&&(ie=i-I*(N-i)),{pitch:ie,bearing:H}}}class w4 extends y4{constructor(){super(...arguments),this.ControllerState=v4,this.transition={transitionDuration:300,transitionInterpolator:new YT({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class GT extends Ld{constructor(e={}){super(e)}getViewportType(){return Nd}get ControllerType(){return w4}}GT.displayName="MapView";const T4=new UT;function S4(t,e){const n=t.order??1/0,i=e.order??1/0;return n-i}class E4{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>S4(r,e)>0);i<0?n.push(e):n.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(el(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const c=n[r.id];let f=r;c&&c!==r?c.setProps?(c.setProps(r.props),f=c):c.cleanup(this._context):c||r.setup(this._context),i.push(f),delete n[r.id]}for(const r in n)n[r].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof UT)||this._resolvedEffects.push(T4),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class A4 extends Zx{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const C4="deckRenderer.renderLayers";class R4{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new A4(e),this.pickLayersPass=new WT(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const c=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,ta(C4,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[r]}))});for(const i of e)i.resize(n)}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1]};for(const c of e)if(c.postRender){r.target=c.id===this.lastPostProcessEffect?n.target:void 0;const f=c.postRender(r);r.inputBuffer=f,r.swapBuffer=f===i[0]?i[1]:i[0]}}}const k4={pickedColor:null,pickedObjectIndex:-1};function I4({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:c}){const{x:f,y:a,width:_,height:x}=c;let S=r*r,R=-1,I=0;for(let N=0;N<x;N++){const L=N+a-i,H=L*L;if(H>S)I+=4*_;else for(let ie=0;ie<_;ie++){if(t[I+3]-1>=0){const he=ie+f-n,re=he*he+H;re<=S&&(S=re,R=I)}I+=4}}if(R>=0){const N=t.slice(R,R+4),L=e(N);if(L){const H=Math.floor(R/4/_),ie=R/4-H*_;return{...L,pickedColor:N,pickedX:f+ie,pickedY:a+H}}ji.error("Picked non-existent layer. Is picking buffer corrupt?")()}return k4}function M4({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const c=t.slice(i,i+4),f=c.join(",");if(!n.has(f)){const a=e(c);a?n.set(f,{...a,color:c}):ji.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function KT({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:c}){let f=e[0];e.length>1&&(f=D4(t?.pickedViewports||e,{x:i,y:r}));let a;if(f){const _=[i-f.x,r-f.y];c!==void 0&&(_[2]=c),a=f.unproject(_)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function P4(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:c,pickedLayer:f,pickedObjectIndex:a}=e,_=f?[f]:[];if(i==="hover"){const R=n.index,I=n.layerId,N=f?f.props.id:null;if(N!==I||a!==R){if(N!==I){const L=r.find(H=>H.props.id===I);L&&_.unshift(L)}n.layerId=N,n.index=a,n.info=null}}const x=KT(t),S=new Map;return S.set(null,x),_.forEach(R=>{let I={...x};R===f&&(I.color=c,I.index=a,I.picked=!0),I=QT({layer:R,info:I,mode:i});const N=I.layer;R===f&&i==="hover"&&(n.info=I),S.set(N.id,I),i==="hover"&&N.updateAutoHighlight(I)}),S}function QT({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function D4(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class O4{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new WT(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},c=this.lastPickedInfo.info){const f=c&&c.layer&&c.layer.id,a=c&&c.viewport&&c.viewport.id,_=f?i.find(I=>I.id===f):null,x=a&&r.find(I=>I.id===a)||r[0],S=x&&x.unproject([e-x.x,n-x.y]);return{...c,...{x:e,y:n,viewport:x,coordinate:S,layer:_}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const n=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=n}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:c,radius:f=0,depth:a=1,mode:_="query",unproject3D:x,onViewportActive:S,effects:R}){const I=this.device.canvasContext.cssToDeviceRatio(),N=this._getPickable(e);if(!N||i.length===0)return{result:[],emptyInfo:KT({viewports:i,x:r,y:c,pixelRatio:I})};this._resizeBuffer();const L=this.device.canvasContext.cssToDevicePixels([r,c],!0),H=[L.x+Math.floor(L.width/2),L.y+Math.floor(L.height/2)],ie=Math.round(f*I),{width:ne,height:he}=this.pickingFBO,re=this._getPickingRect({deviceX:H[0],deviceY:H[1],deviceRadius:ie,deviceWidth:ne,deviceHeight:he}),ge={x:r-f,y:c-f,width:f*2+1,height:f*2+1};let _e;const pe=[],it=new Set;for(let mt=0;mt<a;mt++){let nt;if(re){const ht=this._drawAndSample({layers:N,views:n,viewports:i,onViewportActive:S,deviceRect:re,cullRect:ge,effects:R,pass:`picking:${_}`});nt=I4({...ht,deviceX:H[0],deviceY:H[1],deviceRadius:ie,deviceRect:re})}else nt={pickedColor:null,pickedObjectIndex:-1};let Ce;if(nt.pickedLayer&&x&&this.depthFBO){const{pickedColors:ht}=this._drawAndSample({layers:[nt.pickedLayer],views:n,viewports:i,onViewportActive:S,deviceRect:{x:nt.pickedX,y:nt.pickedY,width:1,height:1},cullRect:ge,effects:R,pass:`picking:${_}:z`},!0);ht[3]&&(Ce=ht[0])}nt.pickedLayer&&mt+1<a&&(it.add(nt.pickedLayer),nt.pickedLayer.disablePickingIndex(nt.pickedObjectIndex)),_e=P4({pickInfo:nt,lastPickedInfo:this.lastPickedInfo,mode:_,layers:N,viewports:i,x:r,y:c,z:Ce,pixelRatio:I});for(const ht of _e.values())ht.layer&&pe.push(ht);if(!nt.pickedColor)break}for(const mt of it)mt.restorePickingColors();return{result:pe,emptyInfo:_e.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:c,width:f=1,height:a=1,mode:_="query",maxObjects:x=null,onViewportActive:S,effects:R}){const I=this._getPickable(e);if(!I||i.length===0)return[];this._resizeBuffer();const N=this.device.canvasContext.cssToDeviceRatio(),L=this.device.canvasContext.cssToDevicePixels([r,c],!0),H=L.x,ie=L.y+L.height,ne=this.device.canvasContext.cssToDevicePixels([r+f,c+a],!0),he=ne.x+ne.width,re=ne.y,ge={x:H,y:re,width:he-H,height:ie-re},_e=this._drawAndSample({layers:I,views:n,viewports:i,onViewportActive:S,deviceRect:ge,cullRect:{x:r,y:c,width:f,height:a},effects:R,pass:`picking:${_}`}),pe=M4(_e),it=new Map,mt=[],nt=Number.isFinite(x);for(let Ce=0;Ce<pe.length&&!(nt&&mt.length>=x);Ce++){const ht=pe[Ce];let Me={color:ht.pickedColor,layer:null,index:ht.pickedObjectIndex,picked:!0,x:r,y:c,pixelRatio:N};Me=QT({layer:ht.pickedLayer,info:Me,mode:_});const Ve=Me.layer.id;it.has(Ve)||it.set(Ve,new Set);const Le=it.get(Ve),lt=Me.object??Me.index;Le.has(lt)||(Le.add(lt),mt.push(Me))}return mt}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:c,cullRect:f,effects:a,pass:_},x=!1){const S=x?this.depthFBO:this.pickingFBO,R={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:S,deviceRect:c,cullRect:f,effects:a,pass:_,pickZ:x,preRenderStats:{},isPicking:!0};for(const he of a)he.useInPicking&&(R.preRenderStats[he.id]=he.preRender(R));const{decodePickingColor:I}=this.pickLayersPass.render(R),{x:N,y:L,width:H,height:ie}=c,ne=new(x?Float32Array:Uint8Array)(H*ie*4);return this.device.readPixelsToArrayWebGL(S,{sourceX:N,sourceY:L,sourceWidth:H,sourceHeight:ie,target:ne}),{pickedColors:ne,decodePickingColor:I}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:c}){const f=Math.max(0,e-i),a=Math.max(0,n-i),_=Math.min(r,e+i+1)-f,x=Math.min(c,n+i+1)-a;return _<=0||x<=0?null:{x:f,y:a,width:_,height:x}}}const B4={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},N4="top-left",O1="__root";class z4{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!el(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const i of this.resolvedWidgets)n[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)n[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const r=n[i.id];r?r.viewId!==i.viewId||r.placement!==i.placement?(this._remove(r),this._add(i)):i!==r&&(r.setProps(i.props),i=r):this._add(i),n[i.id]=null,this.resolvedWidgets.push(i)}for(const i in n){const r=n[i];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:n=null,placement:i=N4}=e,r=e.onAdd({deck:this.deck,viewId:n});r&&this._getContainer(n,i).append(r),e._element=r}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){const i=e||O1;let r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[i]=r);let c=r.querySelector(`.${n}`);return c||(c=document.createElement("div"),c.className=n,c.style.position="absolute",c.style.zIndex="2",Object.assign(c.style,B4[n]),r.append(c)),c}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const i in this.containers){const r=this.lastViewports[i]||null,c=i===O1||r,f=this.containers[i];c?(f.style.display="block",f.style.left=`${r?r.x:0}px`,f.style.top=`${r?r.y:0}px`,f.style.width=`${r?r.width:e}px`,f.style.height=`${r?r.height:n}px`):f.style.display="none"}}onRedraw({viewports:e,layers:n}){const i=e.reduce((r,c)=>(r[c.id]=c,r),{});for(const r of this.getWidgets()){const{viewId:c}=r;if(c){const f=i[c];f&&(r.onViewportChange&&r.onViewportChange(f),r.onRedraw?.({viewports:[f],layers:n}))}else{if(r.onViewportChange)for(const f of e)r.onViewportChange(f);r.onRedraw?.({viewports:e,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,n){for(const i of this.getWidgets()){const{viewId:r}=i;(!r||r===e.viewport?.id)&&i.onHover?.(e,n)}}onEvent(e,n){const i=qb[n.type];if(i)for(const r of this.getWidgets()){const{viewId:c}=r;(!c||c===e.viewport?.id)&&r[i]?.(e,n)}}}const L4={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class F4{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,L4),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,i=n&&n.props.getTooltip;if(!i)return;const r=i(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,n,i){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${n}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var xd;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(xd||(xd={}));const Kx={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Vr=(t,e,n)=>e?t.enable(n):t.disable(n),B1=(t,e,n)=>t.hint(n,e),Ba=(t,e,n)=>t.pixelStorei(n,e),N1=(t,e,n)=>{const i=n===36006?36009:36008;return t.bindFramebuffer(i,e)},am=(t,e,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(r,e)};function sb(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const U4={3042:Vr,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Vr,2885:(t,e)=>t.cullFace(e),2929:Vr,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Vr,35723:B1,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:N1,36010:N1,34964:am,36662:am,36663:am,35053:am,35055:am,2886:(t,e)=>t.frontFace(e),33170:B1,2849:(t,e)=>t.lineWidth(e),32823:Vr,32824:"polygonOffset",10752:"polygonOffset",35977:Vr,32926:Vr,32928:Vr,32938:"sampleCoverage",32939:"sampleCoverage",3089:Vr,3088:(t,e)=>t.scissor(...e),2960:Vr,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Vr,10754:Vr,12288:Vr,12289:Vr,12290:Vr,12291:Vr,12292:Vr,12293:Vr,12294:Vr,12295:Vr,3333:Ba,3317:Ba,37440:Ba,37441:Ba,37443:Ba,3330:Ba,3332:Ba,3331:Ba,3314:Ba,32878:Ba,3316:Ba,3315:Ba,32877:Ba,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=sb(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=sb(e)&&e.length===3?[...e,...e]:e;const[n,i,r,c,f,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,c,f,a)},stencilOp:(t,e)=>{e=sb(e)&&e.length===3?[...e,...e]:e;const[n,i,r,c,f,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,c,f,a)},viewport:(t,e)=>t.viewport(...e)};function wr(t,e,n){return e[t]!==void 0?e[t]:n[t]}const V4={blendEquation:(t,e,n)=>t.blendEquationSeparate(wr(32777,e,n),wr(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(wr(32969,e,n),wr(32968,e,n),wr(32971,e,n),wr(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(wr(32824,e,n),wr(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(wr(32938,e,n),wr(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,wr(2962,e,n),wr(2967,e,n),wr(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,wr(34816,e,n),wr(36003,e,n),wr(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,wr(2964,e,n),wr(2965,e,n),wr(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,wr(34817,e,n),wr(34818,e,n),wr(34819,e,n))},z1={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:n}):{valueChanged:!0}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},Yl=(t,e)=>t.isEnabled(e),L1={3042:Yl,2884:Yl,2929:Yl,3024:Yl,32823:Yl,32926:Yl,32928:Yl,3089:Yl,2960:Yl,35977:Yl},j4=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Vd(t,e){if(H4(e))return;const n={};for(const r in e){const c=Number(r),f=U4[r];f&&(typeof f=="string"?n[f]=!0:f(t,e[r],c))}const i=t.state&&t.state.cache;if(i)for(const r in n){const c=V4[r];c(t,e,i)}}function JT(t,e=Kx){if(typeof e=="number"){const r=e,c=L1[r];return c?c(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const c=L1[r];i[r]=c?c(t,Number(r)):t.getParameter(Number(r))}return i}function $4(t){Vd(t,Kx)}function H4(t){for(const e in t)return!1;return!0}function q4(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class cf{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,n){this.gl=e,this.log=n?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Vd(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?JT(e):Object.assign({},Kx),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,X4(e);for(const i in z1){const r=z1[i];W4(e,i,r)}F1(e,"getParameter"),F1(e,"isEnabled")}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const c in e){const f=e[c],a=this.cache[c];q4(f,a)||(n=!0,i=a,r&&!(c in r)&&(r[c]=a),this.cache[c]=f)}return{valueChanged:n,oldValue:i}}}function F1(t,e){const n=t[e].bind(t);t[e]=function(r){if(r===void 0||j4.has(r))return n(r);const c=cf.get(t);return r in c.cache||(c.cache[r]=n(r)),c.enable?c.cache[r]:n(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function W4(t,e,n){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...c){const f=cf.get(t),{valueChanged:a,oldValue:_}=n(f._updateCache,...c);return a&&i(...c),_},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function X4(t){const e=t.useProgram.bind(t);t.useProgram=function(i){const r=cf.get(t);r.program!==i&&(e(i),r.program=i)}}function Z4(t,e,n){let i="";const r={preserveDrawingBuffer:!0,...n};let c=null;if(c||=t.getContext("webgl2",r),r.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!c&&!n.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,c=t.getContext("webgl2",r),c.luma||={},c.luma.softwareRenderer=!0),c||(c=t.getContext("webgl",{}),c&&(c=null,i||="Your browser only supports WebGL1")),!c)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:f,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",_=>f(_),!1),t.addEventListener("webglcontextrestored",_=>a(_),!1),c.luma||={},c}function Fd(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function Y4(t,e){const n=t.getParameter(7936),i=t.getParameter(7937);Fd(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,c=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),f=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),a=c||n,_=f||i,x=t.getParameter(7938),S=eS(a,_),R=G4(a,_),I=K4(a,_);return{type:"webgl",gpu:S,gpuType:I,gpuBackend:R,vendor:a,renderer:_,version:x,shadingLanguage:"glsl",shadingLanguageVersion:300}}function eS(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function G4(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function K4(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(eS(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function tS(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const ym="WEBGL_compressed_texture_s3tc",bm="WEBGL_compressed_texture_s3tc_srgb",vd="EXT_texture_compression_rgtc",wd="EXT_texture_compression_bptc",Q4="WEBGL_compressed_texture_etc",J4="WEBGL_compressed_texture_astc",eO="WEBGL_compressed_texture_etc1",tO="WEBGL_compressed_texture_pvrtc",nO="WEBGL_compressed_texture_atc",U1="EXT_texture_norm16",V1="EXT_render_snorm",iO="EXT_color_buffer_float",Qx={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[V1],"norm16-renderable-webgl":[U1],"snorm16-renderable-webgl":[U1,V1],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[ym,bm,vd,wd],"texture-compression-bc5-webgl":[vd],"texture-compression-bc7-webgl":[wd],"texture-compression-etc2":[Q4],"texture-compression-astc":[J4],"texture-compression-etc1-webgl":[eO],"texture-compression-pvrtc-webgl":[tO],"texture-compression-atc-webgl":[nO]};function rO(t){return t in Qx}function sO(t,e,n){return(Qx[e]||[]).every(r=>Fd(t,r,n))}const Jx={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:iO,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:ym},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:bm},"bc1-rgba-unorm":{gl:33777,x:ym},"bc1-rgba-unorm-srgb":{gl:35916,x:bm},"bc2-rgba-unorm":{gl:33778,x:ym},"bc2-rgba-unorm-srgb":{gl:35918,x:bm},"bc3-rgba-unorm":{gl:33779,x:ym},"bc3-rgba-unorm-srgb":{gl:35919,x:bm},"bc4-r-unorm":{gl:36283,x:vd},"bc4-r-snorm":{gl:36284,x:vd},"bc5-rg-unorm":{gl:36285,x:vd},"bc5-rg-snorm":{gl:36286,x:vd},"bc6h-rgb-ufloat":{gl:36495,x:wd},"bc6h-rgb-float":{gl:36494,x:wd},"bc7-rgba-unorm":{gl:36492,x:wd},"bc7-rgba-unorm-srgb":{gl:36493,x:wd},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function aO(t,e,n){let i=e.create;const r=Jx[e.format];return r?.gl===void 0&&(i=!1),r?.x&&(i=i&&!!Fd(t,r.x,n)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function nS(t){const e=Jx[t],n=cO(t),i=Rx(t);return{internalFormat:n,format:e?.dataFormat||lO(i.channels,i.integer,i.normalized,n),type:i.dataType?tS(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function oO(t){switch(Rx(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function lO(t,e,n,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function cO(t){const n=Jx[t]?.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const j1={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class uO extends QR{gl;extensions;testedFeatures=new Set;constructor(e,n,i){super([],i),this.gl=e,this.extensions=n,Fd(e,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const e=this.getFeatures();for(const n of e)this.has(n)&&(yield n);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),rO(e)&&sO(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of e)this.has(n)}getFeatures(){return[...Object.keys(j1),...Object.keys(Qx)]}getWebGLFeature(e){const n=j1[e];return typeof n=="string"?!!Fd(this.gl,n,this.extensions):!!n}}class hO extends KR{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Sm extends Z_{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,n){super(e,n);const i=n.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const i=this.colorAttachments[n];if(i){const r=36064+n;this._attachTextureView(r,i)}}if(this.depthStencilAttachment){const n=oO(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${dO(n)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,n){const{gl:i}=this.device,{texture:r}=n,c=n.props.baseMipLevel,f=n.props.baseArrayLayer;switch(i.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,r.handle,c,f);break;case 34067:const a=fO(f);i.framebufferTexture2D(36160,e,a,r.handle,c);break;case 3553:i.framebufferTexture2D(36160,e,3553,r.handle,c);break;default:throw new Error("Illegal texture type")}i.bindTexture(r.glTarget,null)}}function fO(t){return t<34069?t+34069:t}function dO(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class pO extends kx{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,n){super(n),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Sm(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(n,e);return}}commit(){}}async function iS(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),new Promise((r,c)=>{i.onload=r,i.onerror=f=>c(new Error(`Unable to load script '${t}': ${f}`)),n.appendChild(i)})}const mO=1;let Na=null,$1=!1;const ev={debugSpectorJS:At.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function gO(t){if(!globalThis.SPECTOR)try{await iS(t.debugSpectorJSUrl||ev.debugSpectorJSUrl)}catch(e){At.warn(String(e))}}function _O(t){if(t={...ev,...t},!t.debugSpectorJS)return null;if(!Na&&globalThis.SPECTOR&&!globalThis.luma?.spector){At.probe(mO,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Na=new e,globalThis.luma&&(globalThis.luma.spector=Na)}if(!Na)return null;if($1||($1=!0,Na.spyCanvases(),Na?.onCaptureStarted.add(e=>At.info("Spector capture started:",e)()),Na?.onCapture.add(e=>{At.info("Spector capture complete:",e)(),Na?.getResultUI(),Na?.resultView.display(),Na?.resultView.addCapture(e)})),t.gl){const e=t.gl,n=e.device;Na?.startCapture(t.gl,500),e.device=n,new Promise(i=>setTimeout(i,2e3)).then(i=>{At.info("Spector capture stopped after 2 seconds")(),Na?.stopCapture()})}return Na}const yO="https://unpkg.com/webgl-debug@2.0.1/index.js";function rS(t){return t.luma=t.luma||{},t.luma}async function bO(){gf()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await iS(yO))}function xO(t,e={}){return e.debugWebGL||e.traceWebGL?wO(t,e):vO(t)}function vO(t){const e=rS(t);return e.realContext?e.realContext:t}function wO(t,e){if(!globalThis.WebGLDebugUtils)return At.warn("webgl-debug not loaded")(),t;const n=rS(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...xd,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,TO.bind(null,e),SO.bind(null,e));for(const f in xd)!(f in i)&&typeof xd[f]=="number"&&(i[f]=xd[f]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,i);const c=Object.create(r);return n.realContext=t,n.debugContext=c,c.debug=!0,c}function H1(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function TO(t,e,n,i){i=Array.from(i).map(a=>a===void 0?"undefined":a);const r=globalThis.WebGLDebugUtils.glEnumToString(e),c=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i),f=`${r} in gl.${n}(${c})`;At.error(f)();debugger}function SO(t,e,n){let i="";At.level>=1&&(i=H1(e,n),t.traceWebGL&&At.log(1,i)());for(const r of n)if(r===void 0){i=i||H1(e,n);debugger}}const ab={};function EO(t="id"){ab[t]=ab[t]||1;const e=ab[t]++;return`${t}-${e}`}class Em extends $i{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,n={}){super(e,n),this.device=e,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=AO(this.props.usage),this.glUsage=CO(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(e,n=0,i=e.byteLength+n){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let n=e;e===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,n,e.byteLength)}async readAsync(e=0,n){return this.readSyncWebGL(e,n)}readSyncWebGL(e=0,n){n=n??this.byteLength-e;const i=new Uint8Array(n),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,r,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,n),i}}function AO(t){return t&$i.INDEX?34963:t&$i.VERTEX?34962:t&$i.UNIFORM?35345:34962}function CO(t){return t&$i.INDEX||t&$i.VERTEX?35044:t&$i.UNIFORM?35048:35044}function RO(t){const e=t.split(/\r?\n/),n=[];for(const i of e){if(i.length<=1)continue;const r=i.split(":");if(r.length===2){const[R,I]=r;n.push({message:I.trim(),type:q1(R),lineNum:0,linePos:0});continue}const[c,f,a,..._]=r;let x=parseInt(a,10);isNaN(x)&&(x=0);let S=parseInt(f,10);isNaN(S)&&(S=0),n.push({message:_.join(":").trim(),type:q1(c),lineNum:x,linePos:S})}return n}function q1(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class kO extends X_{device;handle;constructor(e,n){switch(super(e,n),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?RO(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,e),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}At.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),At.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async r=>await new Promise(c=>setTimeout(c,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function IO(t,e,n,i){if(OO(e))return i(t);const r=t;r.pushState();try{return MO(t,e),Vd(r.gl,n),i(t)}finally{r.popState()}}function MO(t,e){const n=t,{gl:i}=n;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(uf("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const c=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,f=uf("provokingVertex",e.provokingVertex,{first:36429,last:36430});c?.provokingVertexWEBGL(f)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const c=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,f=uf("polygonMode",e.polygonMode,{fill:6914,line:6913});c?.polygonModeWEBGL(1028,f),c?.polygonModeWEBGL(1029,f)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(DO("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Qb("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;i.stencilMaskSeparate(1028,r),i.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&At.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,c=Qb("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,c,0,r),i.stencilFuncSeparate(1029,c,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=ob("stencilPassOperation",e.stencilPassOperation),c=ob("stencilFailOperation",e.stencilFailOperation),f=ob("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,c,f,r),i.stencilOpSeparate(1029,c,f,r)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const r=W1("blendColorOperation",e.blendColorOperation||"add"),c=W1("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(r,c);const f=Jg("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Jg("blendColorDstFactor",e.blendColorDstFactor||"zero"),_=Jg("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),x=Jg("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(f,a,_,x)}}function Qb(t,e){return uf(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function ob(t,e){return uf(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function W1(t,e){return uf(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Jg(t,e){return uf(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function PO(t,e){return`Illegal parameter ${e} for ${t}`}function uf(t,e,n){if(!(e in n))throw new Error(PO(t,e));return n[e]}function DO(t,e){return e}function OO(t){let e=!0;for(const n in t){e=!1;break}return e}function sS(t){const e={};return t.addressModeU&&(e[10242]=lb(t.addressModeU)),t.addressModeV&&(e[10243]=lb(t.addressModeV)),t.addressModeW&&(e[32882]=lb(t.addressModeW)),t.magFilter&&(e[10240]=Jb(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=BO(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Qb("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function lb(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Jb(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function BO(t,e="none"){if(!e)return Jb(t);switch(e){case"none":return Jb(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class ex extends Im{device;handle;parameters;constructor(e,n){super(e,n),this.device=e,this.parameters=sS(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[n,i]of Object.entries(e)){const r=Number(n);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,i);break;default:this.device.gl.samplerParameteri(this.handle,r,i);break}}}}class Td extends W_{device;gl;handle;texture;constructor(e,n){super(e,{...Ri.defaultProps,...n}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const NO="Failed to deduce GL constant from typed array";function zO(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(NO)}}function LO(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function aS(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function FO(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function O_(t,e,n){if(UO(e))return n(t);const{nocatch:i=!0}=e,r=cf.get(t);r.push(),Vd(t,e);let c;if(i)c=n(t),r.pop();else try{c=n(t)}finally{r.pop()}return c}function UO(t){for(const e in t)return!1;return!0}function VO(t,e,n){const{dimension:i,width:r,height:c,depth:f=0}=n,{glInternalFormat:a}=n,_=n.glTarget;switch(i){case"2d-array":case"3d":t.texStorage3D(_,e,a,r,c,f);break;default:t.texStorage2D(_,e,a,r,c)}}function X1(t,e,n,i){const{width:r,height:c}=i,{dimension:f,depth:a=0,mipLevel:_=0}=i,{x=0,y:S=0,z:R=0}=i,{glFormat:I,glType:N}=i,L=oS(i.glTarget,f,a),H=i.flipY?{37440:!0}:{};O_(t,H,()=>{switch(f){case"2d-array":case"3d":t.bindTexture(L,e),t.texSubImage3D(L,_,x,S,R,r,c,a,I,N,n),t.bindTexture(L,null);break;case"2d":case"cube":t.bindTexture(L,e),t.texSubImage2D(L,_,x,S,r,c,I,N,n),t.bindTexture(L,null);break;default:throw new Error(f)}})}function Z1(t,e,n){const{dimension:i,width:r,height:c,depth:f=0,mipLevel:a=0,byteOffset:_=0}=n,{x=0,y:S=0,z:R=0}=n,{glFormat:I,glType:N,compressed:L}=n,H=oS(n.glTarget,i,f);switch(i){case"2d-array":case"3d":L?t.compressedTexSubImage3D(H,a,x,S,R,r,c,f,I,e,_):t.texSubImage3D(H,a,x,S,R,r,c,f,I,N,e,_);break;case"2d":case"cube":L?t.compressedTexSubImage2D(H,a,x,S,r,c,I,e,_):t.texSubImage2D(H,a,x,S,r,c,I,N,e,_);break;default:throw new Error(i)}}function jO(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function oS(t,e,n){return e==="cube"?34069+n:t}function $O(t,e){const{sourceX:n=0,sourceY:i=0,sourceAttachment:r=0}=e||{};let{target:c=null,sourceWidth:f,sourceHeight:a,sourceDepth:_,sourceFormat:x,sourceType:S}=e||{};const{framebuffer:R,deleteFramebuffer:I}=lS(t),{gl:N,handle:L}=R;f||=R.width,a||=R.height;const H=R.colorAttachments[r]?.texture;if(!H)throw new Error(`Invalid framebuffer attachment ${r}`);_=H?.depth||1,x||=H?.glFormat||6408,S||=H?.glType||5121,c=WO(c,S,x,f,a),S=S||zO(c);const ie=N.bindFramebuffer(36160,L);return N.readBuffer(36064+r),N.readPixels(n,i,f,a,x,S,c),N.readBuffer(36064),N.bindFramebuffer(36160,ie||null),I&&R.destroy(),c}function HO(t,e){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:c=6408,targetByteOffset:f=0}=e||{};let{sourceWidth:a,sourceHeight:_,sourceType:x}=e||{};const{framebuffer:S,deleteFramebuffer:R}=lS(t);a=a||S.width,_=_||S.height;const I=S;x=x||5121;let N=n;if(!N){const H=aS(c),ie=FO(x),ne=f+a*_*H*ie;N=I.device.createBuffer({byteLength:ne})}const L=t.device.createCommandEncoder();return L.copyTextureToBuffer({sourceTexture:t,width:a,height:_,origin:[i,r],destinationBuffer:N,byteOffset:f}),L.destroy(),R&&S.destroy(),N}function lS(t){return t instanceof Z_?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:qO(t),deleteFramebuffer:!0}}function qO(t,e){const{device:n,width:i,height:r,id:c}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${c}`,width:i,height:r,colorAttachments:[t]})}function WO(t,e,n,i,r,c){if(t)return t;e||=5121;const f=LO(e,{clamped:!1}),a=aS(n);return new f(i*r*a)}class Am extends Ri{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,n){super(e,n);const i={...this.props};i.data=n.data,this.device=e,this.gl=this.device.gl,this.glTarget=jO(this.props.dimension);const r=nS(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:n,height:i}=e;if(!n||!i){const r=Ri.getTextureDataSize(e.data);n=r?.width||1,i=r?.height||1}if(this.width=n,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new Td(this.device,{...this.props,texture:this}),this.bind(),VO(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Td(this.device,{...e,texture:this})}setSampler(e={}){let n;e instanceof ex?(this.sampler=e,n=e.props):(this.sampler=new ex(this.device,e),n=e);const i=sS(n);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(At.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){At.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const n=Ri.getExternalImageSize(e.image),i={...Ri.defaultCopyExternalImageOptions,...n,...e},{image:r,depth:c,mipLevel:f,x:a,y:_,z:x,flipY:S}=i;let{width:R,height:I}=i;const{dimension:N,glTarget:L,glFormat:H,glInternalFormat:ie,glType:ne}=this;if(R=Math.min(R,this.width-a),I=Math.min(I,this.height-_),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return X1(this.device.gl,this.handle,r,{dimension:N,mipLevel:f,x:a,y:_,z:x,width:R,height:I,depth:c,glFormat:H,glType:ne,glTarget:L,flipY:S}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,n=0){this.bind();const i=Ri.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&At.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<i.length;r++){const c=i[r];this._setMipLevel(n,r,c)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),Z1(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Ri.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,n,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&At.warn(`${this.id} has mipmap and multiple LODs.`)();const r=Ri.CubeFaces.indexOf(n);this.setTexture2DData(e,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:c,data:f,format:a=6408,type:_=5121}=e,{gl:x}=this,S=c||f;this.bind(),S instanceof Promise?S.then(R=>this.setImageDataForFace(Object.assign({},e,{face:n,data:R,pixels:R}))):this.width||this.height?x.texImage2D(n,0,a,i,r,0,a,_,S):x.texImage2D(n,0,a,a,_,S)}_getImageDataMap(e){for(let n=0;n<Ri.CubeFaces.length;++n){const i=Ri.CubeFaces[n];e[i]&&(e[34069+n]=e[i],delete e[i])}return e}_setSamplerParameters(e){At.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,i]of Object.entries(e)){const r=Number(n),c=i;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,c);break;case 10241:this.gl.texParameteri(this.glTarget,r,c);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,c);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,c);break;default:this.gl.texParameteri(this.glTarget,r,c);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,n,i,r=this.glTarget){if(Ri.isExternalImage(i)){X1(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:n,glTarget:r,flipY:this.props.flipY});return}if(Ri.isTextureLevelData(i)){Z1(this.device.gl,i.data,{...this,depth:e,mipLevel:n,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.glTarget,null),e}}const XO=[1,2,4,8];class ZO extends nf{device;glParameters;constructor(e,n){super(e,n),this.device=e;let i;if(!n?.parameters?.viewport)if(n?.framebuffer){const{width:c,height:f}=n.framebuffer;i=[0,0,c,f]}else{const[c,f]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,c,f]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((f,a)=>36064+a);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(n.viewport=e.viewport.slice(0,4),n.depthRange=[e.viewport[4],e.viewport[5]]):n.viewport=e.viewport),e.scissorRect&&(n.scissorTest=!0,n.scissor=e.scissorRect),e.blendConstant&&(n.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(n.colorMask=XO.map(i=>!!(i&e.colorMask))),this.glParameters=n,Vd(this.device.gl,n)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((i,r)=>{i&&this.clearColorBuffer(r,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,e.clearStencil=this.props.clearStencil),n!==0&&O_(this.device.gl,e,()=>{this.device.gl.clear(n)})}clearColorBuffer(e=0,n=[0,0,0,0]){O_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function YO(t){return GO.includes(t)}const GO=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],cS={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function uS(t){const e=cS[t];if(!e)throw new Error("uniform");const[n,i,,r]=e;return{format:r,components:i,glType:n}}function KO(t){const e=cS[t];if(!e)throw new Error("attribute");const[,n,,i,r]=e;return{attributeType:i,vertexFormat:r,components:n}}function QO(t,e){const n={attributes:[],bindings:[]};n.attributes=JO(t,e);const i=nB(t,e);for(const a of i){const _=a.uniforms.map(x=>({name:x.name,format:x.format,byteOffset:x.byteOffset,byteStride:x.byteStride,arrayLength:x.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:_})}const r=tB(t,e);let c=0;for(const a of r)if(YO(a.type)){const{viewDimension:_,sampleType:x}=rB(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:c,viewDimension:_,sampleType:x}),a.textureUnit=c,c+=1}r.length&&(n.uniforms=r);const f=eB(t,e);return f?.length&&(n.varyings=f),n}function JO(t,e){const n=[],i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const c=t.getActiveAttrib(e,r);if(!c)throw new Error("activeInfo");const{name:f,type:a}=c,_=t.getAttribLocation(e,f);if(_>=0){const{attributeType:x}=KO(a),S=/instance/i.test(f)?"instance":"vertex";n.push({name:f,location:_,stepMode:S,type:x})}}return n.sort((r,c)=>r.location-c.location),n}function eB(t,e){const n=[],i=t.getProgramParameter(e,35971);for(let r=0;r<i;r++){const c=t.getTransformFeedbackVarying(e,r);if(!c)throw new Error("activeInfo");const{name:f,type:a,size:_}=c,{glType:x,components:S}=uS(a),R={location:r,name:f,type:x,size:_*S};n.push(R)}return n.sort((r,c)=>r.location-c.location),n}function tB(t,e){const n=[],i=t.getProgramParameter(e,35718);for(let r=0;r<i;r++){const c=t.getActiveUniform(e,r);if(!c)throw new Error("activeInfo");const{name:f,size:a,type:_}=c,{name:x,isArray:S}=sB(f);let R=t.getUniformLocation(e,x);const I={location:R,name:x,size:a,type:_,isArray:S};if(n.push(I),I.size>1)for(let N=0;N<I.size;N++){const L=`${x}[${N}]`;R=t.getUniformLocation(e,L);const H={...I,name:L,location:R};n.push(H)}}return n}function nB(t,e){const n=(c,f)=>t.getActiveUniformBlockParameter(e,c,f),i=[],r=t.getProgramParameter(e,35382);for(let c=0;c<r;c++){const f={name:t.getActiveUniformBlockName(e,c)||"",location:n(c,35391),byteLength:n(c,35392),vertex:n(c,35396),fragment:n(c,35398),uniformCount:n(c,35394),uniforms:[]},a=n(c,35395)||[],_=t.getActiveUniforms(e,a,35383),x=t.getActiveUniforms(e,a,35384),S=t.getActiveUniforms(e,a,35387),R=t.getActiveUniforms(e,a,35388);for(let I=0;I<f.uniformCount;++I){const N=t.getActiveUniform(e,a[I]);if(!N)throw new Error("activeInfo");f.uniforms.push({name:N.name,format:uS(_[I]).format,type:_[I],arrayLength:x[I],byteOffset:S[I],byteStride:R[I]})}i.push(f)}return i.sort((c,f)=>c.location-f.location),i}const iB={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function rB(t){const e=iB[t];if(!e)throw new Error("sampler");const[n,i]=e;return{viewDimension:n,sampleType:i}}function sB(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function aB(t,e,n,i){const r=t;let c=i;c===!0&&(c=1),c===!1&&(c=0);const f=typeof c=="number"?[c]:c;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,f);case 35664:return t.uniform2fv(e,f);case 35665:return t.uniform3fv(e,f);case 35666:return t.uniform4fv(e,f);case 5124:return t.uniform1iv(e,f);case 35667:return t.uniform2iv(e,f);case 35668:return t.uniform3iv(e,f);case 35669:return t.uniform4iv(e,f);case 35670:return t.uniform1iv(e,f);case 35671:return t.uniform2iv(e,f);case 35672:return t.uniform3iv(e,f);case 35673:return t.uniform4iv(e,f);case 5125:return r.uniform1uiv(e,f,1);case 36294:return r.uniform2uiv(e,f,2);case 36295:return r.uniform3uiv(e,f,3);case 36296:return r.uniform4uiv(e,f,4);case 35674:return t.uniformMatrix2fv(e,!1,f);case 35675:return t.uniformMatrix3fv(e,!1,f);case 35676:return t.uniformMatrix4fv(e,!1,f);case 35685:return r.uniformMatrix2x3fv(e,!1,f);case 35686:return r.uniformMatrix2x4fv(e,!1,f);case 35687:return r.uniformMatrix3x2fv(e,!1,f);case 35688:return r.uniformMatrix3x4fv(e,!1,f);case 35689:return r.uniformMatrix4x2fv(e,!1,f);case 35690:return r.uniformMatrix4x3fv(e,!1,f)}throw new Error("Illegal uniform")}function oB(t){return $T(t)!==null||typeof t=="number"||typeof t=="boolean"}function lB(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];oB(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}function cB(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function uB(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const Y1=4;class hB extends kd{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,n){super(e,n),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:r=35981}=n;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,r)),this._linkShaders(),At.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=QO(this.device.gl,this.handle),At.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=fB(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,n){for(const[i,r]of Object.entries(e)){const c=this.shaderLayout.bindings.find(f=>f.name===i)||this.shaderLayout.bindings.find(f=>f.name===`${i}Uniforms`);if(!c){const f=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");n?.disableWarnings||At.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${f}`,r)();continue}switch(r||At.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),c.type){case"uniform":if(!(r instanceof Em)&&!(r.buffer instanceof Em))throw new Error("buffer value");break;case"texture":if(!(r instanceof Td||r instanceof Am||r instanceof Sm))throw new Error("texture value");break;case"sampler":At.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(c.type)}this.bindings[i]=r}}draw(e){const{renderPass:n,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:c,vertexCount:f,instanceCount:a,isInstanced:_=!1,firstVertex:x=0,transformFeedback:S}=e,R=cB(r),I=!!c.indexBuffer,N=c.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return At.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return At.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),c.bindBeforeRender(n),S&&S.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const L=n;return IO(this.device,i,L.glParameters,()=>{I&&_?this.device.gl.drawElementsInstanced(R,f||0,N,x,a||0):I?this.device.gl.drawElements(R,f||0,N,x):_?this.device.gl.drawArraysInstanced(R,x,f||0,a||0):this.device.gl.drawArrays(R,x,f||0),S&&S.end()}),c.unbindAfterRender(n),!0}setUniformsWebGL(e){const{bindings:n}=lB(e);Object.keys(n).forEach(i=>{At.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),At.time(Y1,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),At.timeEnd(Y1,`linkProgram for ${this.id}`)(),At.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}At.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),At.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const n=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${n}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async r=>await new Promise(c=>setTimeout(c,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(At.warn(`Binding ${n.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let n=0,i=0;for(const r of this.shaderLayout.bindings){const c=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!c)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:f}=r,a=e.getUniformBlockIndex(this.handle,f);if(a===4294967295)throw new Error(`Invalid uniform block name ${f}`);e.uniformBlockBinding(this.handle,i,a),c instanceof Em?e.bindBufferBase(35345,i,c.handle):e.bindBufferRange(35345,i,c.buffer.handle,c.offset||0,c.size||c.buffer.byteLength-c.offset),i+=1;break;case"texture":if(!(c instanceof Td||c instanceof Am||c instanceof Sm))throw new Error("texture");let _;if(c instanceof Td)_=c.texture;else if(c instanceof Am)_=c;else if(c instanceof Sm&&c.colorAttachments[0]instanceof Td)At.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),_=c.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+n),e.bindTexture(_.glTarget,_.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:r,textureUnit:c}=e,f=this.uniforms[n]??c;f!==void 0&&aB(this.device.gl,i,r,f)}}}function fB(t,e){const n={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const r=n.attributes.find(c=>c.name===i.name);r?(r.type=i.type||r.type,r.stepMode=i.stepMode||r.stepMode):At.warn(`shader layout attribute ${i.name} not present in shader`)}return n}class dB extends Mx{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const n of e)switch(n.name){case"copy-buffer-to-buffer":pB(this.device,n.options);break;case"copy-buffer-to-texture":mB(this.device,n.options);break;case"copy-texture-to-buffer":gB(this.device,n.options);break;case"copy-texture-to-texture":_B(this.device,n.options);break;default:throw new Error(n.name)}}}function pB(t,e){const n=e.sourceBuffer,i=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function mB(t,e){throw new Error("Not implemented")}function gB(t,e){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:c=e.sourceTexture.width,height:f=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:_=[0,0],destinationBuffer:x,byteOffset:S=0,bytesPerRow:R,rowsPerImage:I}=e;if(r!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||a!==0||R||I)throw new Error("not implemented");const{framebuffer:N,destroyFramebuffer:L}=hS(n);let H;try{const ie=x,ne=c||N.width,he=f||N.height,re=nS(N.colorAttachments[0].texture.props.format),ge=re.format,_e=re.type;t.gl.bindBuffer(35051,ie.handle),H=t.gl.bindFramebuffer(36160,N.handle),t.gl.readPixels(_[0],_[1],ne,he,ge,_e,S)}finally{t.gl.bindBuffer(35051,null),H!==void 0&&t.gl.bindFramebuffer(36160,H),L&&N.destroy()}}function _B(t,e){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:c=[0,0],destinationTexture:f}=e;let{width:a=e.destinationTexture.width,height:_=e.destinationTexture.height}=e;const{framebuffer:x,destroyFramebuffer:S}=hS(n),[R,I]=r,[N,L,H]=c,ie=t.gl.bindFramebuffer(36160,x.handle);let ne=null,he;if(f instanceof Am)ne=f,a=Number.isFinite(a)?a:ne.width,_=Number.isFinite(_)?_:ne.height,ne.bind(0),he=ne.glTarget;else throw new Error("invalid destination");switch(he){case 3553:case 34067:t.gl.copyTexSubImage2D(he,i,N,L,R,I,a,_);break;case 35866:case 32879:t.gl.copyTexSubImage3D(he,i,N,L,H,R,I,a,_);break}ne&&ne.unbind(),t.gl.bindFramebuffer(36160,ie),S&&x.destroy()}function hS(t){if(t instanceof Ri){const{width:e,height:n,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class yB extends Ix{device;commandBuffer;constructor(e,n){super(e,n),this.device=e,this.commandBuffer=new dB(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,n,i){}}function bB(t){const{target:e,source:n,start:i=0,count:r=1}=t,c=n.length,f=r*c;let a=0;for(let _=i;a<c;a++)e[_++]=n[a];for(;a<f;)a<f-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+f-a),a=f);return t.target}class tv extends Px{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return VA()==="Chrome"}constructor(e,n){super(e,n),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const n=e;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(e,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:c,stride:f,offset:a,normalized:_,integer:x,divisor:S}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),x?this.device.gl.vertexAttribIPointer(e,r,c,f,a):this.device.gl.vertexAttribPointer(e,r,c,_,f,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,S||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,n){this._enable(e,!1),this.attributes[e]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const n=this.attributes[e];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(e,n)}}_getAccessor(e){const n=this.attributeInfos[e];if(!n)throw new Error(`Unknown attribute location ${e}`);const i=tS(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(e,n=!0){const r=tv.isConstantAttributeZeroSupported(this.device)||e!==0;(n||r)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,n){const i=xB(n),r=i.byteLength*e,c=i.length*e;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let f=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),f=f||!vB(i,this.bufferValue),f){const a=Ck(n.constructor,c);bB({target:a,source:i,start:0,count:c}),this.buffer.write(a),this.bufferValue=n}return this.buffer}}function xB(t){return Array.isArray(t)?new Float32Array(t):t}function vB(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class wB extends Dx{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,n){super(e,n),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(uB(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])})}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteLength:c,byteOffset:f}=this._getBufferRange(n);if(i<0){this.unusedBuffers[e]=r,At.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:r,byteLength:c,byteOffset:f},this.bindOnUse||this._bindBuffer(i,r,f,c)}getBuffer(e){if(G1(e))return this.buffers[e]||null;const n=this._getVaryingIndex(e);return n>=0?this.buffers[n]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let n;return this._bound?n=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Em)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:n,byteOffset:i=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:n,byteOffset:i,byteLength:r}}_getVaryingIndex(e){if(G1(e))return Number(e);for(const n of this.layout.varyings)if(e===n.name)return n.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:n,byteLength:i,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),n,r,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,n,i=0,r){const c=n&&n.handle;!c||r===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,i,r)}}function G1(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class TB extends Ox{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,n){if(super(e,n),this.device=e,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}}class Sd extends Yu{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||EO("webgl-device")});const n=Yu._getCanvasContextProps(e);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=n.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new pO(this,n),this.lost=new Promise(S=>{this._resolveContextLost=S});const r={...e.webgl};n.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),e.powerPreference!==void 0&&(r.powerPreference=e.powerPreference);const f=this.props._handle||Z4(this.canvasContext.canvas,{onContextLost:S=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:S=>console.log("WebGL context restored")},r);if(!f)throw new Error("WebGL context creation failed");if(i=f.device,i){if(e._reuseDevices)return At.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=f,this.gl=f,this.spectorJS=_O({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Y4(this.gl,this._extensions),this.limits=new hO(this.gl),this.features=new uO(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new cf(this.gl,{log:(...S)=>At.log(1,...S)()}).trackState(this.gl,{copyState:!1});const _=e.debugWebGL||e.debug,x=e.debugWebGL;_&&(this.gl=xO(this.gl,{debugWebGL:_,traceWebGL:x}),At.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(At.level=Math.max(At.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const n=this._normalizeBufferProps(e);return new Em(this,n)}createTexture(e){return new Am(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new ex(this,e)}createShader(e){return new kO(this,e)}createFramebuffer(e){return new Sm(this,e)}createVertexArray(e){return new tv(this,e)}createTransformFeedback(e){return new wB(this,e)}createQuerySet(e){return new TB(this,e)}createRenderPipeline(e){return new hB(this,e)}beginRenderPass(e){return new ZO(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new yB(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,n){return $O(e,n)}readPixelsToBufferWebGL(e,n){return HO(e,n)}setParametersWebGL(e){Vd(this.gl,e)}getParametersWebGL(e){return JT(this.gl,e)}withParametersWebGL(e,n){return O_(this.gl,e,n)}resetWebGL(){At.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),$4(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return aO(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){cf.get(this.gl).push()}popState(){cf.get(this.gl).pop()}setSpectorMetadata(e,n){e.__SPECTOR_Metadata=n}getGLKey(e,n){const i=Number(e);for(const r in this.gl)if(this.gl[r]===i)return`GL.${r}`;return n?.emptyIfUnknown?"":String(e)}getGLKeys(e){const n={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[r,c])=>(i[`${r}:${this.getGLKey(r,n)}`]=`${c}:${this.getGLKey(c,n)}`,i),{})}_constants;setConstantAttributeWebGL(e,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const r=this._constants[e];switch(r&&CB(r,n)&&At.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=n,n.constructor){case Float32Array:SB(this,e,n);break;case Int32Array:EB(this,e,n);break;case Uint32Array:AB(this,e,n);break;default:throw new Error("constant")}}getExtension(e){return Fd(this.gl,e,this._extensions),this._extensions}}function SB(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function EB(t,e,n){t.gl.vertexAttribI4iv(e,n)}function AB(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function CB(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const RB={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},kB=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),IB=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),MB=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function PB(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,i){if(n==="webgl"||n==="experimental-webgl"){const r=this.originalGetContext("webgl2",i);return r instanceof HTMLElement&&DB(r),r}return this.originalGetContext(n,i)}}function DB(t){t.getExtension("EXT_color_buffer_float");const e={...RB,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:kB(t),OES_vertex_array_object:IB(t),ANGLE_instanced_arrays:MB(t)},n=t.getExtension;t.getExtension=function(r){const c=n.call(t,r);return c||(r in e?e[r]:null)};const i=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(i.apply(t)||[])?.concat(Object.keys(e))}}const e_=1;class OB extends ik{type="webgl";constructor(){super(),Yu.defaultProps={...Yu.defaultProps,...ev},Sd.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){PB(e)}async attach(e){if(e instanceof Sd)return e;if(e?.device instanceof Yu)return e.device;if(!BB(e))throw new Error("Invalid WebGL2RenderingContext");return new Sd({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){At.groupCollapsed(e_,"WebGLDevice created")();const n=[];(e.debugWebGL||e.debug)&&n.push(bO()),e.debugSpectorJS&&n.push(gO(e));const i=await Promise.allSettled(n);for(const f of i)f.status==="rejected"&&At.error(`Failed to initialize debug libraries ${f.reason}`)();const r=new Sd(e),c=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return At.probe(e_,c)(),At.table(e_,r.info)(),At.groupEnd(e_)(),r}}function BB(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const K1=new OB;function ju(){}const NB=({isDragging:t})=>t?"grabbing":"grab",fS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ju,onWebGLInitialized:ju,onResize:ju,onViewStateChange:ju,onInteractionStateChange:ju,onBeforeRender:ju,onAfterRender:ju,onLoad:ju,onError:t=>ji.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:NB,getTooltip:null,debug:!1,drawPickingColors:!1};class nv{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new $_({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:r}=this;if(i.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(i.leftButton||i.rightButton)return;{const c=i.offsetCenter;if(!c)return;r.x=c.x,r.y=c.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=i},this._onEvent=i=>{const r=qb[i.type],c=i.offsetCenter;if(!r||!c||!this.layerManager)return;const f=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:f,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:_}=a,x=_&&(_[r]||_.props[r]),S=this.props[r];let R=!1;x&&(R=x.call(_,a,i)),R||(S?.(a,i),this.widgetManager.onEvent(a,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const r=i.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo},this.props={...fS,...e},e=this.props,e.viewState&&e.initialViewState&&ji.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ji.error("WebGL1 context not supported.")(),n=K1.attach(e.gl)),n||(n=Bb.createDevice({type:"best-available",_reuseDevices:!0,adapters:[K1],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Dm.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ji.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ji.removed("onLayerClick","onClick")(),e.initialViewState&&!el(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return n=n||i||r||c||f,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Us(this.viewManager),this.viewManager.views}getViewports(e){return Us(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,n,i){Us(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),c}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Us(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const r=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=r}if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,i=e.clientHeight??e.height;(n!==this.width||i!==this.height)&&(this.width=n,this.height=i,this.viewManager?.setProps({width:n,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:i}))}_createAnimationLoop(e,n){const{gl:i,onError:r,useDevicePixels:c}=n;return new LD({device:e,useDevicePixels:c,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:f=>this._setDevice(f.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new GT({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=n.length>0;let r=i,c=!1;for(const f of n)r=f,c=f.layer?.onHover(f,e.event)||c;c||(this.props.onHover?.(r,e.event),this.widgetManager.onHover(r,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new jT;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new fP(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(y1).map(r=>{const[c,f,a,_]=y1[r],x=this.props.eventRecognizerOptions?.[r],S={...f,...x,event:r};return{recognizer:new c(S),recognizeWith:a,requestFailure:_}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in qb)this.eventManager.on(r,this._onEvent);this.viewManager=new c4({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new l4(this.device,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new E4({deck:this,device:this.device}),this.deckRenderer=new R4(this.device),this.deckPicker=new O4(this.device),this.widgetManager=new z4({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new F4),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const c={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};this.deckRenderer?.renderLayers(c),c.pass==="screen"&&this.widgetManager.onRedraw({viewports:c.viewports,layers:c.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ji.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Bb.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}nv.defaultProps=fS;nv.VERSION=lR;function zB(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Z2(t)}}const LB=X2;function t_(t,e,n){const i=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function sf(t){return t.stride||t.size*t.bytesPerElement}function FB(t,e){return t.type===e.type&&t.size===e.size&&sf(t)===sf(e)&&(t.offset||0)===(e.offset||0)}function tx(t,e){e.offset&&ji.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=sf(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,c=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:c,stride:n}}function UB(t,e){const n=tx(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class VB{constructor(e,n,i){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,c=r==="float64";let{defaultValue:f}=n;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let a;c?a="float32":!r&&n.isIndexed?a="uint32":a=r||"float32";let _=zB(r||a);this.doublePrecision=c,c&&n.fp64===!1&&(_=Float32Array),this.value=null,this.settings={...n,defaultType:_,defaultValue:f,logicalType:r,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:_.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*sf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Dm.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const i={};if(this.state.constant){const r=this.value;if(n){const c=tx(this.getAccessor(),n),f=c.offset/r.BYTES_PER_ELEMENT,a=c.size||this.size;i[e]=r.subarray(f,f+a)}else i[e]=r}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,n=null){const i=this.getAccessor(),r=[],c={name:this.id,byteStride:sf(i),attributes:r};if(this.doublePrecision){const f=UB(i,n||{});r.push(t_(e,{...i,...f.high},this.device.type),t_(`${e}64Low`,{...i,...f.low},this.device.type))}else if(n){const f=tx(i,n);r.push(t_(e,{...i,...f},this.device.type))}else r.push(t_(e,i,this.device.type));return c}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,c=i*r;if(n&&c&&n.length>=c){const f=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let _=0;_<c;)for(let x=0;x<r;x++){const S=n[_++];S<f[x]&&(f[x]=S),S>a[x]&&(a[x]=S)}e=[f,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof $i?i={buffer:e}:i=e;const r={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)r.type="float32";else{const f=LB(i.value);r.type=r.normalized?f.replace("int","norm"):f}r.bytesPerElement=i.value.BYTES_PER_ELEMENT,r.stride=sf(r)}if(n.bounds=null,i.constant){let c=i.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!n.constant||!this._areValuesEqual(c,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(c)?c:new Float32Array(c)}else if(i.buffer){const c=i.buffer;n.externalBuffer=c,n.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let c=i.value;n.externalBuffer=null,n.constant=!1,this.value=c;let{buffer:f}=this;const a=sf(r),_=(r.vertexOffset||0)*a;if(this.doublePrecision&&c instanceof Float64Array&&(c=Jy(c,r)),this.settings.isIndexed){const S=this.settings.defaultType;c.constructor!==S&&(c=new S(c))}const x=c.byteLength+_+a*2;(!f||f.byteLength<x)&&(f=this._createBuffer(x)),f.write(c,_)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Jy(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),i*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,c=Dm.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=c;const{byteOffset:f}=this;let{buffer:a}=this;return(!a||a.byteLength<c.byteLength+f)&&(a=this._createBuffer(c.byteLength+f),n&&r&&a.write(r instanceof Float64Array?Jy(r,this):r,f)),i.allocatedValue=c,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&ji.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:c}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let f=c;for(;--f>=0;)n[i+f]=r[f];return n}switch(c){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let f=c;for(;--f>=0;)n[i+f]=Number.isFinite(e[f])?e[f]:r[f]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(n?$i.INDEX:$i.VERTEX)|$i.COPY_DST,indexType:n?i:void 0,byteLength:e}),this._buffer}}const Q1=[],J1=[];function jB(t,e=0,n=1/0){let i=Q1;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(J1.length=t.length,i=J1):i=Q1,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function dS(t){return t&&t[Symbol.asyncIterator]}function $B(t,e){const{size:n,stride:i,offset:r,startIndices:c,nested:f}=e,a=t.BYTES_PER_ELEMENT,_=i?i/a:n,x=r?r/a:0,S=Math.floor((t.length-x)/_);return(R,{index:I,target:N})=>{if(!c){const ne=I*_+x;for(let he=0;he<n;he++)N[he]=t[ne+he];return N}const L=c[I],H=c[I+1]||S;let ie;if(f){ie=new Array(H-L);for(let ne=L;ne<H;ne++){const he=ne*_+x;N=new Array(n);for(let re=0;re<n;re++)N[re]=t[he+re];ie[ne-L]=N}}else if(_===n)ie=t.subarray(L*n+x,H*n+x);else{ie=new t.constructor((H-L)*n);let ne=0;for(let he=L;he<H;he++){const re=he*_+x;for(let ge=0;ge<n;ge++)ie[ne++]=t[re+ge]}}return ie}}const HB=[],d_=[[0,1/0]];function qB(t,e){if(t===d_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let c=0;c<i;c++){const f=t[c];f[1]<e[0]?(n.push(f),r=c+1):f[0]>e[1]?n.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return n.splice(r,0,e),n}const WB={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function pS(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...WB[n],...e,...t,type:n}}class mS extends VB{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:d_}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!FB(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(c=>e[c])]:e[n];return pS(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=qB(this.state.updateRanges,[i,r])}else this.state.updateRanges=d_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=HB}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==d_),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:f,noAlloc:a}}=this;let _=!0;if(f){for(const[x,S]of c)f.call(r,this,{data:n,startRow:x,endRow:S,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[x,S]of c){const R=Number.isFinite(x)?this.getVertexOffset(x):0,I=Number.isFinite(S)?this.getVertexOffset(S):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:R,endOffset:I})}this._checkAttributeArray()}else _=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),_}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Us(ArrayBuffer.isView(f.value),`invalid ${r.accessor}`);const a=!!f.size&&f.size!==this.size;return i.binaryAccessor=$B(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const i in e)Object.assign(n,super.getValue(i,e[i]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=r??"vertex",!n)return i;for(const c in n){const f=super._getBufferLayout(c,n[c]);i.attributes.push(...f.attributes)}return i}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:c,numInstances:f}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:_,value:x,size:S,startIndices:R}=e,{accessor:I,transform:N}=a;let L=_.binaryAccessor||(typeof I=="function"?I:c[I]);typeof L!="function"&&(L=()=>L),Us(typeof L=="function",`accessor "${I}" is not a function`);let H=e.getVertexOffset(i);const{iterable:ie,objectInfo:ne}=jB(n,i,r);for(const he of ie){ne.index++;let re=L(he,ne);if(N&&(re=N.call(this,re)),R){const ge=(ne.index<R.length-1?R[ne.index+1]:f)-R[ne.index];if(re&&Array.isArray(re[0])){let _e=H;for(const pe of re)e._normalizeValue(pe,x,_e),_e+=S}else re&&re.length>S?x.set(re,H):(e._normalizeValue(re,ne.target,0),i4({target:x,source:ne.target,start:H,count:ge}));H+=ge*S}else e._normalizeValue(re,x,H),H+=S}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function cb(t){const{source:e,target:n,start:i=0,size:r,getData:c}=t,f=t.end||n.length,a=e.length,_=f-i;if(a>_){n.set(e.subarray(0,_),i);return}if(n.set(e,i),!c)return;let x=a;for(;x<_;){const S=c(x,e);for(let R=0;R<r;R++)n[i+x]=S[R]||0,x++}}function XB({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:c}){if(!r||!c)return cb({source:t,target:e,size:n,getData:i}),e;let f=0,a=0;const _=i&&((S,R)=>i(S+a,R)),x=Math.min(r.length,c.length);for(let S=1;S<x;S++){const R=r[S]*n,I=c[S]*n;cb({source:t.subarray(f,R),target:e,start:a,end:I,size:n,getData:_}),f=R,a=I}return a<e.length&&cb({source:[],target:e,start:a,size:n,getData:_}),e}function ZB(t){const{device:e,settings:n,value:i}=t,r=new mS(e,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}function gS(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function _S(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function yS(t){t.push(t.shift())}function YB(t,e){const{doublePrecision:n,settings:i,value:r,size:c}=t,f=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:_}=t.settings;if(_)for(const x of Object.values(_))a=Math.max(a,x.vertexOffset??0);return(i.noAlloc?r.length:(e+a)*c)*f}function bS({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n?.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function xS({device:t,buffer:e,attribute:n,fromLength:i,toLength:r,fromStartIndices:c,getData:f=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,_=n.size*a,x=n.byteOffset,S=n.settings.bytesPerElement<4?x/n.settings.bytesPerElement*4:x,R=n.startIndices,I=c&&R,N=n.isConstant;if(!I&&e&&i>=r)return e;const L=n.value instanceof Float64Array?Float32Array:n.value.constructor,H=N?n.value:new L(n.getBuffer().readSyncWebGL(x,r*L.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!N){const re=f;f=(ge,_e)=>n.normalizeConstant(re(ge,_e))}const ie=N?(re,ge)=>f(H,ge):(re,ge)=>f(H.subarray(re+x,re+x+_),ge),ne=e?new Float32Array(e.readSyncWebGL(S,i*4).buffer):new Float32Array(0),he=new Float32Array(r);return XB({source:ne,target:he,sourceStartIndices:c,targetStartIndices:R,size:_,getData:ie}),(!e||e.byteLength<he.byteLength+S)&&(e?.destroy(),e=t.createBuffer({byteLength:he.byteLength+S,usage:35050})),e.write(he,S),e}class vS{constructor({device:e,attribute:n,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new K_(i),this.attribute=n,this.attributeInTransition=ZB(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=YB(this.attribute,n),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class GB extends vS{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="interpolation",this.transform=eN(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:c,attribute:f}=this;yS(c),c[0]=xS({device:this.device,buffer:c[0],attribute:f,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),c[1]=bS({device:this.device,source:c[0],target:c[1]}),this.setBuffer(c[1]);const{transform:a}=this,_=a.model;let x=Math.floor(this.currentLength/f.size);wS(f)&&(x/=2),_.setVertexCount(x),f.isConstant?(_.setAttributes({aFrom:c[0]}),_.setConstantAttributes({aTo:f.value})):_.setAttributes({aFrom:c[0],aTo:f.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:c[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let r=i/e;n&&(r=n(r));const{model:c}=this.transform,f={time:r};c.shaderInputs.setProps({interpolation:f}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const KB=`uniform interpolationUniforms {
  float time;
} interpolation;
`,ew={name:"interpolation",vs:KB,uniformTypes:{time:"f32"}},QB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,JB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function wS(t){return t.doublePrecision&&t.value instanceof Float64Array}function eN(t,e){const n=e.size,i=gS(n),r=_S(n),c=e.getBufferLayout();return wS(e)?new zd(t,{vs:JB,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[uM,ew],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new zd(t,{vs:QB,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:c.attributes[0].format}],modules:[ew],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class tN extends vS{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="spring",this.texture=oN(e),this.framebuffer=lN(e,this.texture),this.transform=aN(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;super.start(e,n);const{buffers:c,attribute:f}=this;for(let _=0;_<2;_++)c[_]=xS({device:this.device,buffer:c[_],attribute:f,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});c[2]=bS({device:this.device,source:c[0],target:c[2]}),this.setBuffer(c[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?a.setConstantAttributes({aTo:f.value}):a.setAttributes({aTo:f.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this,c=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const f={stiffness:c.stiffness,damping:c.damping};n.model.shaderInputs.setProps({spring:f}),n.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),yS(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const nN=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,iN={name:"spring",vs:nN,uniformTypes:{damping:"f32",stiffness:"f32"}},rN=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,sN=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function aN(t,e){const n=gS(e.size),i=_S(e.size);return new zd(t,{vs:rN,fs:sN,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[iN],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function oN(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function lN(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const cN={interpolation:GB,spring:tN};class uN{constructor(e,{id:n,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const c=e[r],f=c.getTransitionSetting(n);f&&this._updateAttribute(r,c,f)}for(const r in this.transitions){const c=e[r];(!c||!c.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let c=!r||r.type!==i.type;if(c){r&&this._removeTransition(e);const f=cN[i.type];f?this.transitions[e]=new f({attribute:n,timeline:this.timeline,device:this.device}):(ji.error(`unsupported transition type '${i.type}'`)(),c=!1)}(c||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const tw="attributeManager.invalidate",hN="attributeManager.updateStart",fN="attributeManager.updateEnd",dN="attribute.updateStart",pN="attribute.allocate",mN="attribute.updateEnd";class gN{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){this.mergeBoundsMemoized=$m(ED),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new uN(e,{id:`${n}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);ta(tw,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ta(tw,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:c={},buffers:f={},context:a={}}){let _=!1;ta(hN,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const x in this.attributes){const S=this.attributes[x],R=S.settings.accessor;S.startIndices=i,S.numInstances=n,c[x]&&ji.removed(`props.${x}`,`data.attributes.${x}`)(),S.setExternalBuffer(f[x])||S.setBinaryValue(typeof R=="string"?f[R]:void 0,e.startIndices)||typeof R=="string"&&!f[R]&&S.setConstantValue(c[R])||S.needsUpdate()&&(_=!0,this._updateAttribute({attribute:S,numInstances:n,data:e,props:c,context:a})),this.needsRedraw=this.needsRedraw||S.needsRedraw()}_&&ta(fN,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const c in n){const f=n[c];f.needsRedraw(e)&&!i.hasAttribute(c)&&(r[c]=f)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const i in e){const r=e[i],c={...r,id:i,size:r.isIndexed&&1||r.size||1,...n};this.attributes[i]=new mS(this.device,c)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,c=r[e];return c&&c.forEach(f=>{const a=i[f];a&&a.setNeedsUpdate(a.id,n)}),c}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(ta(dN,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&ta(pN,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,ta(mN,n,i))}}class _N extends K_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:c}}=this,f=c(e/r);this._value=C_(n,i,f)}}const nw=1e-5;function iw(t,e,n,i,r){const c=e-t,a=(n-e)*r,_=-c*i;return a+_+c+e}function yN(t,e,n,i,r){if(Array.isArray(n)){const c=[];for(let f=0;f<n.length;f++)c[f]=iw(t[f],e[f],n[f],i,r);return c}return iw(t,e,n,i,r)}function rw(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class bN extends K_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:c=e,_currValue:f=e}=this;let a=yN(c,f,n,i,r);const _=rw(a,n),x=rw(a,f);_<nw&&x<nw&&(a=n,this.end()),this._prevValue=f,this._currValue=a}}const xN={interpolation:_N,spring:bN};class vN{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:c}=this;if(c.has(e)){const _=c.get(e),{value:x=_.settings.fromValue}=_;n=x,this.remove(e)}if(r=pS(r),!r)return;const f=xN[r.type];if(!f){ji.error(`unsupported transition type '${r.type}'`)();return}const a=new f(this.timeline);a.start({...r,fromValue:n,toValue:i}),c.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function wN(t){const e=t[lf];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function TN(t,e){const n=TS({newProps:t,oldProps:e,propTypes:t[lf],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=EN(t,e);let r=!1;return i||(r=AN(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:CN(t,e),transitionsChanged:SN(t,e)}}function SN(t,e){if(!t.transitions)return!1;const n={},i=t[lf];let r=!1;for(const c in t.transitions){const f=i[c],a=f&&f.type;(a==="number"||a==="color"||a==="array")&&nx(t[c],e[c],f)&&(n[c]=!0,r=!0)}return r?n:!1}function TS({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const c of Object.keys(t))if(!(c in n)){if(!(c in e))return`${r}.${c} added`;const f=nx(t[c],e[c],i[c]);if(f)return`${r}.${c} ${f}`}for(const c of Object.keys(e))if(!(c in n)){if(!(c in t))return`${r}.${c} dropped`;if(!Object.hasOwnProperty.call(t,c)){const f=nx(t[c],e[c],i[c]);if(f)return`${r}.${c} ${f}`}}return!1}function nx(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function EN(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function AN(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&sw(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&sw(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function CN(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function sw(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},TS({oldProps:r,newProps:i,triggerName:n})}const RN="count(): argument not an object",kN="count(): argument not a container";function IN(t){if(!PN(t))throw new Error(RN);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(MN(t))return Object.keys(t).length;throw new Error(kN)}function MN(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function PN(t){return t!==null&&typeof t=="object"}function aw(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const DN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},ix={};function ON(t,e,n,i){if(n instanceof Ri)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const c=e.createTexture({...n,sampler:{...DN,...r,...i},mipmaps:!0});return ix[c.id]=t,c}function BN(t,e){!e||!(e instanceof Ri)||ix[e.id]===t&&(e.delete(),delete ix[e.id])}const NN={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||rx(t)&&(t.length===3||t.length===4)},equal(t,e,n){return el(t,e,1)}},accessor:{validate(t,e){const n=B_(t);return n==="function"||n===B_(e.value)},equal(t,e,n){return typeof e=="function"?!0:el(t,e,1)}},array:{validate(t,e){return e.optional&&!t||rx(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?el(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?el(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:i}=n.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.device?null:ON(n.id,i.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{BN(n.id,t)}}};function zN(t){const e={},n={},i={};for(const[r,c]of Object.entries(t)){const f=c?.deprecatedFor;if(f)i[r]=Array.isArray(f)?f:[f];else{const a=LN(r,c);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function LN(t,e){switch(B_(e)){case"object":return om(t,e);case"array":return om(t,{type:"array",value:e,compare:!1});case"boolean":return om(t,{type:"boolean",value:e});case"number":return om(t,{type:"number",value:e});case"function":return om(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function om(t,e){return"type"in e?{name:t,...NN[e.type],...e}:"value"in e?{name:t,type:B_(e.value),...e}:{name:t,type:"object",value:e}}function rx(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function B_(t){return rx(t)?"array":t===null?"null":typeof t}function FN(t,e){let n;for(let c=e.length-1;c>=0;c--){const f=e[c];"extensions"in f&&(n=f.extensions)}const i=sx(t.constructor,n),r=Object.create(i);r[D_]=t,r[df]={},r[Zu]={};for(let c=0;c<e.length;++c){const f=e[c];for(const a in f)r[a]=f[a]}return Object.freeze(r),r}const UN="_mergedDefaultProps";function sx(t,e){if(!(t instanceof Q_.constructor))return{};let n=UN;if(e)for(const r of e){const c=r.constructor;c&&(n+=`:${c.extensionName||c.name}`)}const i=SS(t,n);return i||(t[n]=VN(t,e||[]))}function VN(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=sx(i),c=SS(t,"defaultProps")||{},f=zN(c),a=Object.assign(Object.create(null),r,f.defaultProps),_=Object.assign(Object.create(null),r?.[lf],f.propTypes),x=Object.assign(Object.create(null),r?.[rb],f.deprecatedProps);for(const S of e){const R=sx(S.constructor);R&&(Object.assign(a,R),Object.assign(_,R[lf]),Object.assign(x,R[rb]))}return jN(a,t),HN(a,_),$N(a,x),a[lf]=_,a[rb]=x,e.length===0&&!iv(t,"_propTypes")&&(t._propTypes=_),a}function jN(t,e){const n=WN(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function $N(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r=`${this.id}: ${n}`;for(const c of e[n])iv(this,c)||(this[c]=i);ji.deprecated(r,e[n].join("/"))()}})}function HN(t,e){const n={},i={};for(const r in e){const c=e[r],{name:f,value:a}=c;c.async&&(n[f]=a,i[f]=qN(f))}t[Ad]=n,t[df]={},Object.defineProperties(t,i)}function qN(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||dS(e)?this[df][t]=e:this[Zu][t]=e},get(){if(this[Zu]){if(t in this[Zu])return this[Zu][t]||this[Ad][t];if(t in this[df]){const e=this[D_]&&this[D_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Ad][t]}}return this[Ad][t]}}}function iv(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function SS(t,e){return iv(t,e)&&t[e]}function WN(t){const e=t.componentName;return e||ji.warn(`${t.name}.componentName not specified`)(),e||t.name}let XN=0;class Q_{constructor(...e){this.props=FN(this,e),this.id=this.props.id,this.count=XN++}clone(e){const{props:n}=this,i={};for(const r in n[Ad])r in n[Zu]?i[r]=n[Zu][r]:r in n[df]&&(i[r]=n[df][r]);return new this.constructor({...n,...i,...e})}}Q_.componentName="Component";Q_.defaultProps={};const ZN=Object.freeze({});class YN{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||ZN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[D_]||this.component;const n=e[Zu]||{},i=e[df]||e,r=e[Ad]||{};for(const c in n){const f=n[c];this._createAsyncPropData(c,r[c]),this._updateAsyncProp(c,f),n[c]=this.getAsyncProp(c)}for(const c in i){const f=i[c];this._createAsyncPropData(c,r[c]),this._updateAsyncProp(c,f)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(dS(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(c=>{this.component&&(c=this._postProcessValue(i,c),this._setAsyncPropValue(e,c,r),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let c=[],f=0;for await(const a of n){if(!this.component)return;const{dataTransform:_}=this.component.props;_?c=_(a,c):c=c.concat(a),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:f,endRow:c.length}]}),f=c.length,this._setAsyncPropValue(e,c,r)}this._onResolve(e,c)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[lf];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class GN extends YN{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i?.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,`loading ${e} of ${this.layer}`)}}const KN="layer.changeFlag",QN="layer.initialize",JN="layer.update",e6="layer.finalize",t6="layer.matched",ow=2**24-1,n6=Object.freeze([]),i6=$m(({oldViewport:t,viewport:e})=>t.equals(e));let Ko=new Uint8ClampedArray(0);const r6={data:{type:"data",value:n6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:c})=>{const{resourceManager:f}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,c&&(r={...r,fetch:{...r?.fetch,signal:c}});let a=f.contains(t);return!a&&!r&&(f.add({resourceId:t,data:kb(t,i),persistent:!1}),a=!0),a?f.subscribe({resourceId:t,onChange:_=>n.internalState?.reloadAsyncProp(e,_),consumerId:n.id,requestId:e}):kb(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:gi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class J_ extends Q_{constructor(){super(...arguments),this.internalState=null,this.lifecycle=gd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Us(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=VT(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,c,f]=zT(i,n.pixelProjectionMatrix);return e.length===2?[r,c]:[r,c,f]}unproject(e){return Us(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Us(this.internalState);const i=this.internalState.viewport||this.context.viewport;return MD(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===gi.DEFAULT||e===gi.LNGLAT||e===gi.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Us(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:IN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=aw(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=aw(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,c=this.internalState.hasPickingBuffer,f=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(c!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:a,instancePickingColors:_}=n.attributes,x=a||_;x&&(f&&x.constant&&(x.constant=!1,n.invalidate(x.id)),!x.value&&!f&&(x.constant=!0,x.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!i6({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const i in e)e[i].layoutChanged()&&(n=!0);for(const i of this.getModels())this._setModelAttributes(i,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Ko.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>ow&&ji.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ko=Dm.allocate(Ko,n,{size:4,copy:!0,maxCount:Math.max(n,ow)});const r=Math.floor(Ko.length/4),c=[0,0,0];for(let f=i;f<r;f++)this.encodePickingColor(f,c),Ko[f*4+0]=c[0],Ko[f*4+1]=c[1],Ko[f*4+2]=c[2],Ko[f*4+3]=0}e.value=Ko.subarray(0,n*4)}_setModelAttributes(e,n,i=!1){if(!Object.keys(n).length)return;if(i){const a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),n=a.getAttributes()}const r=e.userData?.excludeAttributes||{},c={},f={};for(const a in n){if(r[a])continue;const _=n[a].getValue();for(const x in _){const S=_[x];S instanceof $i?n[a].settings.isIndexed?e.setIndexBuffer(S):c[x]=S:S&&(f[x]=S)}}e.setAttributes(c),e.setConstantAttributes(f)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,c=i||r,f=c&&n.attributes&&n.attributes[c.id];if(f&&f.value){const a=f.value,_=this.encodePickingColor(e);for(let x=0;x<n.length;x++){const S=c.getVertexOffset(x);a[S]===_[0]&&a[S+1]===_[1]&&a[S+2]===_[2]&&this._disablePickingIndex(x)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const c=r.getVertexOffset(e),f=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(f-c),c)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Ko.buffer&&(i.value=Ko.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Us(!this.internalState),Us(Number.isFinite(this.props.coordinateSystem)),ta(QN,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new GN({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ji.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new vN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ta(t6,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ta(JN,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,c=i.viewport,f=this._updateUniformTransition();r.propsInTransition=f,i.viewport=r.viewport||c,this.props=f;try{const a=this._getUpdateParams(),_=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const S of this.props.extensions)S.updateState.call(this,a,S);this.setNeedsRedraw(),this._updateAttributes();const x=this.getModels()[0]!==_[0];this._postUpdate(a,x)}finally{i.viewport=c,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){ta(e6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:i={},parameters:r={}}){this._updateAttributeTransition();const c=this.props,f=this.context;this.props=this.internalState.propsInTransition||c;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:a}=this.props,_=a&&a(i)||[0,0];f.device instanceof Sd&&f.device.setParametersWebGL({polygonOffset:_});for(const x of this.getModels())x.device.type==="webgpu"?x.setParameters({...x.parameters,...r}):x.setParameters(r);if(f.device instanceof Sd)f.device.withParametersWebGL(r,()=>{const x={renderPass:e,shaderModuleProps:n,uniforms:i,parameters:r,context:f};for(const S of this.props.extensions)S.draw.call(this,x,S);this.draw(x)});else{const x={renderPass:e,shaderModuleProps:n,uniforms:i,parameters:r,context:f};for(const S of this.props.extensions)S.draw.call(this,x,S);this.draw(x)}}finally{this.props=c}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let c=!1;switch(r){case"dataChanged":const f=e[r],a=n[r];f&&Array.isArray(a)&&(n.dataChanged=Array.isArray(f)?a.concat(f):f,c=!0);default:n[r]||(n[r]=e[r],c=!0)}c&&ta(KN,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=TN(e,n);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,n[r],e[r],e.transitions?.[r]);return this.setChangeFlags(i)}validateProps(){wN(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.highlightColor=i(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new gN(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e,c=this.state.model;c?.isInstanced&&c.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:a,highlightColor:_}=i;if(n||r.autoHighlight!==f||r.highlightedObjectIndex!==a||r.highlightColor!==_){const x={};Array.isArray(_)&&(x.highlightColor=_),(n||r.autoHighlight!==f||a!==r.highlightedObjectIndex)&&(x.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:x})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}J_.defaultProps=r6;J_.layerName="Layer";const s6=typeof window<"u"?St.useLayoutEffect:St.useEffect;function N_(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const a6={position:"absolute",zIndex:-1};function ES(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>ES(n,e));if(ey(t)){if(o6(t))return e.style=a6,St.cloneElement(t,e);if(l6(t))return St.cloneElement(t,e)}return t}function ey(t){return t&&typeof t=="object"&&"type"in t||!1}function o6(t){return t.props?.mapStyle}function l6(t){const e=t.type;return e&&e.deckGLViewProps}function ax(t){if(typeof t=="function")return St.createElement(Ld,{},t);if(Array.isArray(t))return t.map(ax);if(ey(t)){if(t.type===St.Fragment)return ax(t.props.children);if(N_(t.type,Ld))return t}return t}function c6({children:t,layers:e=[],views:n=null}){const i=[],r=[],c={};return St.Children.forEach(ax(t),f=>{if(ey(f)){const a=f.type;if(N_(a,J_)){const _=u6(a,f.props);r.push(_)}else i.push(f);if(N_(a,Ld)&&a!==Ld&&f.props.id){const _=new a(f.props);c[_.id]=_}}else f&&i.push(f)}),Object.keys(c).length>0&&(Array.isArray(n)?n.forEach(f=>{c[f.id]=f}):n&&(c[n.id]=n),n=Object.values(c)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function u6(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}const h6=St.createContext();function f6({children:t,deck:e,ContextProvider:n=h6.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},c=i.views[0].id;for(const f of t){let a=c,_=f;ey(f)&&N_(f.type,Ld)&&(a=f.props.id||c,_=f.props.children);const x=i.getViewport(a),S=i.getViewState(a);if(x){S.padding=x.padding;const{x:R,y:I,width:N,height:L}=x;_=ES(_,{x:R,y:I,width:N,height:L,viewport:x,viewState:S}),r[a]||(r[a]={viewport:x,children:[]}),r[a].children.push(_)}}return Object.keys(r).map(f=>{const{viewport:a,children:_}=r[f],{x,y:S,width:R,height:I}=a,N={position:"absolute",left:x,top:S,width:R,height:I},L=`view-${f}`,H=St.createElement("div",{key:L,id:L,style:N},..._),ie={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:he=>{he.viewId=f,e._onViewStateChange(he)},widgets:[]},ne=`view-${f}-context`;return St.createElement(n,{key:ne,value:ie},H)})}const d6={mixBlendMode:null};function p6({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const c in n)c in d6?r[c]=n[c]:i[c]=n[c];return{containerStyle:i,canvasStyle:r}}function m6(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function AS(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function g6(t,e,n){const i=new e({...n,_customRender:n.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:r=>{t.redrawReason=r;const c=i.getViewports();t.lastRenderedViewports!==c?t.forceUpdate():AS(t)}});return i}function _6(t,e){const[n,i]=St.useState(0),c=St.useRef({control:null,version:n,forceUpdate:()=>i(_e=>_e+1)}).current,f=St.useRef(null),a=St.useRef(null),_=St.useMemo(()=>c6(t),[t.layers,t.views,t.children]);let x=!0;const S=_e=>x&&t.viewState?(c.viewStateUpdateRequested=_e,null):(c.viewStateUpdateRequested=null,t.onViewStateChange?.(_e)),R=_e=>{x?c.interactionStateUpdateRequested=_e:(c.interactionStateUpdateRequested=null,t.onInteractionStateChange?.(_e))},I=St.useMemo(()=>{const _e={widgets:[],...t,style:null,width:"100%",height:"100%",parent:f.current,canvas:a.current,layers:_.layers,views:_.views,onViewStateChange:S,onInteractionStateChange:R};return delete _e._customRender,c.deck&&c.deck.setProps(_e),_e},[t]);St.useEffect(()=>{const _e=t.Deck||nv;return c.deck=g6(c,_e,{...I,parent:f.current,canvas:a.current}),()=>c.deck?.finalize()},[]),s6(()=>{AS(c);const{viewStateUpdateRequested:_e,interactionStateUpdateRequested:pe}=c;_e&&S(_e),pe&&R(pe)}),St.useImperativeHandle(e,()=>m6(c),[]);const N=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:L,width:H="100%",height:ie="100%",id:ne,style:he}=t,{containerStyle:re,canvasStyle:ge}=St.useMemo(()=>p6({width:H,height:ie,style:he}),[H,ie,he]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===N||c.version!==n){c.lastRenderedViewports=N,c.version=n;const _e=f6({children:_.children,deck:c.deck,ContextProvider:L}),pe=St.createElement("canvas",{key:"canvas",id:ne||"deckgl-overlay",ref:a,style:ge});c.control=St.createElement("div",{id:`${ne||"deckgl"}-wrapper`,ref:f,style:re},[pe,_e])}return x=!1,c.control}const y6=St.forwardRef(_6),lw=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,b6={name:"scatterplot",vs:lw,fs:lw,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},x6=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,v6=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,w6=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,cw=[0,0,0,255],T6={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:cw},getLineColor:{type:"accessor",value:cw},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class z_ extends J_{getShaders(){return super.getShaders({vs:x6,fs:v6,source:w6,modules:[DP,iD,b6]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:c,stroked:f,filled:a,billboard:_,antialiasing:x,lineWidthUnits:S,lineWidthScale:R,lineWidthMinPixels:I,lineWidthMaxPixels:N}=this.props,L={stroked:f,filled:a,billboard:_,antialiasing:x,radiusUnits:Dd[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:c,lineWidthUnits:Dd[S],lineWidthScale:R,lineWidthMinPixels:I,lineWidthMaxPixels:N},H=this.state.model;H.shaderInputs.setProps({scatterplot:L}),H.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Om(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new JD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}z_.defaultProps=T6;z_.layerName="ScatterplotLayer";var lm={},xa={},cm={},um={},uw;function rv(){if(uw)return um;uw=1,Object.defineProperty(um,"__esModule",{value:!0}),um.Direction=void 0;var t;return function(e){e.Right="to right",e.Left="to left",e.Down="to bottom",e.Up="to top"}(t||(um.Direction=t={})),um}var hw;function CS(){return hw||(hw=1,function(t){var e=cm&&cm.__spreadArray||function(Me,Ve,Le){if(Le||arguments.length===2)for(var lt=0,we=Ve.length,Ye;lt<we;lt++)(Ye||!(lt in Ve))&&(Ye||(Ye=Array.prototype.slice.call(Ve,0,lt)),Ye[lt]=Ve[lt]);return Me.concat(Ye||Array.prototype.slice.call(Ve))};Object.defineProperty(t,"__esModule",{value:!0}),t.isIOS=t.useThumbOverlap=t.assertUnreachable=t.voidFn=t.getTrackBackground=t.replaceAt=t.schd=t.translate=t.getClosestThumbIndex=t.translateThumbs=t.getPaddingAndBorder=t.getMargin=t.checkInitialOverlap=t.checkValuesAgainstBoundaries=t.checkBoundaries=t.isVertical=t.relativeValue=t.normalizeValue=t.isStepDivisible=t.isTouchEvent=t.getStepDecimals=void 0;var n=zm(),i=rv(),r=function(Me){var Ve=Me.toString().split(".")[1];return Ve?Ve.length:0};t.getStepDecimals=r;function c(Me){return Me.touches&&Me.touches.length||Me.changedTouches&&Me.changedTouches.length}t.isTouchEvent=c;function f(Me,Ve,Le){var lt=(Ve-Me)/Le,we=8,Ye=Number(lt.toFixed(we));return parseInt(Ye.toString(),10)===Ye}t.isStepDivisible=f;function a(Me,Ve,Le,lt,we,Ye,gt){var Dt=1e11;if(Me=Math.round(Me*Dt)/Dt,!Ye){var X=gt[Ve-1],Ke=gt[Ve+1];if(X&&X>Me)return X;if(Ke&&Ke<Me)return Ke}if(Me>lt)return lt;if(Me<Le)return Le;var Tt=Math.floor(Me*Dt-Le*Dt)%Math.floor(we*Dt),ce=Math.floor(Me*Dt-Math.abs(Tt)),zt=Tt===0?Me:ce/Dt,qt=Math.abs(Tt/Dt)<we/2?zt:zt+we,Ot=(0,t.getStepDecimals)(we);return parseFloat(qt.toFixed(Ot))}t.normalizeValue=a;function _(Me,Ve,Le){return(Me-Ve)/(Le-Ve)}t.relativeValue=_;function x(Me){return Me===i.Direction.Up||Me===i.Direction.Down}t.isVertical=x;function S(Me,Ve,Le){if(Ve>=Le)throw new RangeError("min (".concat(Ve,") is equal/bigger than max (").concat(Le,")"));if(Me<Ve)throw new RangeError("value (".concat(Me,") is smaller than min (").concat(Ve,")"));if(Me>Le)throw new RangeError("value (".concat(Me,") is bigger than max (").concat(Le,")"))}t.checkBoundaries=S;function R(Me,Ve,Le){return Me<Ve?Ve:Me>Le?Le:Me}t.checkValuesAgainstBoundaries=R;function I(Me){if(!(Me.length<2)&&!Me.slice(1).every(function(Ve,Le){return Me[Le]<=Ve}))throw new RangeError("values={[".concat(Me,"]} needs to be sorted when allowOverlap={false}"))}t.checkInitialOverlap=I;function N(Me){var Ve=window.getComputedStyle(Me);return{top:parseInt(Ve["margin-top"],10),bottom:parseInt(Ve["margin-bottom"],10),left:parseInt(Ve["margin-left"],10),right:parseInt(Ve["margin-right"],10)}}t.getMargin=N;function L(Me){var Ve=window.getComputedStyle(Me);return{top:parseInt(Ve["padding-top"],10)+parseInt(Ve["border-top-width"],10),bottom:parseInt(Ve["padding-bottom"],10)+parseInt(Ve["border-bottom-width"],10),left:parseInt(Ve["padding-left"],10)+parseInt(Ve["border-left-width"],10),right:parseInt(Ve["padding-right"],10)+parseInt(Ve["border-right-width"],10)}}t.getPaddingAndBorder=L;function H(Me,Ve,Le){var lt=Le?-1:1;Me.forEach(function(we,Ye){return ne(we,lt*Ve[Ye].x,Ve[Ye].y)})}t.translateThumbs=H;function ie(Me,Ve,Le,lt){for(var we=0,Ye=Ce(Me[0],Ve,Le,lt),gt=1;gt<Me.length;gt++){var Dt=Ce(Me[gt],Ve,Le,lt);Dt<Ye&&(Ye=Dt,we=gt)}return we}t.getClosestThumbIndex=ie;function ne(Me,Ve,Le){Me.style.transform="translate(".concat(Ve,"px, ").concat(Le,"px)")}t.translate=ne;var he=function(Me){var Ve=[],Le=null,lt=function(){for(var we=[],Ye=0;Ye<arguments.length;Ye++)we[Ye]=arguments[Ye];Ve=we,!Le&&(Le=requestAnimationFrame(function(){Le=null,Me.apply(void 0,Ve)}))};return lt};t.schd=he;function re(Me,Ve,Le){var lt=Me.slice(0);return lt[Ve]=Le,lt}t.replaceAt=re;function ge(Me){var Ve=Me.values,Le=Me.colors,lt=Me.min,we=Me.max,Ye=Me.direction,gt=Ye===void 0?i.Direction.Right:Ye,Dt=Me.rtl,X=Dt===void 0?!1:Dt;X&&gt===i.Direction.Right?gt=i.Direction.Left:X&&i.Direction.Left&&(gt=i.Direction.Right);var Ke=Ve.slice(0).sort(function(ce,zt){return ce-zt}).map(function(ce){return(ce-lt)/(we-lt)*100}),Tt=Ke.reduce(function(ce,zt,qt){return"".concat(ce,", ").concat(Le[qt]," ").concat(zt,"%, ").concat(Le[qt+1]," ").concat(zt,"%")},"");return"linear-gradient(".concat(gt,", ").concat(Le[0]," 0%").concat(Tt,", ").concat(Le[Le.length-1]," 100%)")}t.getTrackBackground=ge;function _e(){}t.voidFn=_e;function pe(Me){throw new Error("Didn't expect to get here")}t.assertUnreachable=pe;var it=function(Me,Ve,Le,lt,we){we===void 0&&(we=function(gt){return gt});var Ye=Math.ceil(e([Me],Array.from(Me.children),!0).reduce(function(gt,Dt){var X=Math.ceil(Dt.getBoundingClientRect().width);if(Dt.innerText&&Dt.innerText.includes(Le)&&Dt.childElementCount===0){var Ke=Dt.cloneNode(!0);Ke.innerHTML=we(Ve.toFixed(lt)),Ke.style.visibility="hidden",document.body.appendChild(Ke),X=Math.ceil(Ke.getBoundingClientRect().width),document.body.removeChild(Ke)}return X>gt?X:gt},Me.getBoundingClientRect().width));return Ye},mt=function(Me,Ve,Le,lt,we,Ye,gt){gt===void 0&&(gt=function(Ke){return Ke});var Dt=[],X=function(Ke){var Tt=it(Le[Ke],lt[Ke],we,Ye,gt),ce=Ve[Ke].x;Ve.forEach(function(zt,qt){var Ot=zt.x,Fn=it(Le[qt],lt[qt],we,Ye,gt);Ke!==qt&&(ce>=Ot&&ce<=Ot+Fn||ce+Tt>=Ot&&ce+Tt<=Ot+Fn)&&(Dt.includes(qt)||(Dt.push(Ke),Dt.push(qt),Dt=e(e([],Dt,!0),[Ke,qt],!1),X(qt)))})};return X(Me),Array.from(new Set(Dt.sort()))},nt=function(Me,Ve,Le,lt,we,Ye){lt===void 0&&(lt=.1),we===void 0&&(we=" - "),Ye===void 0&&(Ye=function(qt){return qt});var gt=(0,t.getStepDecimals)(lt),Dt=(0,n.useState)({}),X=Dt[0],Ke=Dt[1],Tt=(0,n.useState)(Ye(Ve[Le].toFixed(gt))),ce=Tt[0],zt=Tt[1];return(0,n.useEffect)(function(){if(Me){var qt=Me.getThumbs();if(qt.length<1)return;var Ot={},Fn=Me.getOffsets(),vn=mt(Le,Fn,qt,Ve,we,gt,Ye),Qn=Ye(Ve[Le].toFixed(gt));if(vn.length){var Yi=vn.reduce(function(nr,xs,ir,$s){return nr.length?e(e([],nr,!0),[Fn[$s[ir]].x],!1):[Fn[$s[ir]].x]},[]);if(Math.min.apply(Math,Yi)===Fn[Le].x){var Pr=[];vn.forEach(function(nr){Pr.push(Ve[nr].toFixed(gt))}),Qn=Array.from(new Set(Pr.sort(function(nr,xs){return parseFloat(nr)-parseFloat(xs)}))).map(Ye).join(we);var Sr=Math.min.apply(Math,Yi),tr=Math.max.apply(Math,Yi),ia=qt[vn[Yi.indexOf(tr)]].getBoundingClientRect().width;Ot.left="".concat(Math.abs(Sr-(tr+ia))/2,"px"),Ot.transform="translate(-50%, 0)"}else Ot.visibility="hidden"}zt(Qn),Ke(Ot)}},[Me,Ve]),[ce,X]};t.useThumbOverlap=nt;function Ce(Me,Ve,Le,lt){var we=Me.getBoundingClientRect(),Ye=we.left,gt=we.top,Dt=we.width,X=we.height;return x(lt)?Math.abs(Le-(gt+X/2)):Math.abs(Ve-(Ye+Dt/2))}var ht=function(){var Me,Ve=((Me=navigator.userAgentData)===null||Me===void 0?void 0:Me.platform)||navigator.platform;return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Ve)||navigator.userAgent.includes("Mac")&&"ontouchend"in document};t.isIOS=ht}(cm)),cm}var fw;function S6(){if(fw)return xa;fw=1;var t=xa&&xa.__extends||function(){var R=function(I,N){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,H){L.__proto__=H}||function(L,H){for(var ie in H)Object.prototype.hasOwnProperty.call(H,ie)&&(L[ie]=H[ie])},R(I,N)};return function(I,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");R(I,N);function L(){this.constructor=I}I.prototype=N===null?Object.create(N):(L.prototype=N.prototype,new L)}}(),e=xa&&xa.__createBinding||(Object.create?function(R,I,N,L){L===void 0&&(L=N);var H=Object.getOwnPropertyDescriptor(I,N);(!H||("get"in H?!I.__esModule:H.writable||H.configurable))&&(H={enumerable:!0,get:function(){return I[N]}}),Object.defineProperty(R,L,H)}:function(R,I,N,L){L===void 0&&(L=N),R[L]=I[N]}),n=xa&&xa.__setModuleDefault||(Object.create?function(R,I){Object.defineProperty(R,"default",{enumerable:!0,value:I})}:function(R,I){R.default=I}),i=xa&&xa.__importStar||function(R){if(R&&R.__esModule)return R;var I={};if(R!=null)for(var N in R)N!=="default"&&Object.prototype.hasOwnProperty.call(R,N)&&e(I,R,N);return n(I,R),I},r=xa&&xa.__spreadArray||function(R,I,N){if(N||arguments.length===2)for(var L=0,H=I.length,ie;L<H;L++)(ie||!(L in I))&&(ie||(ie=Array.prototype.slice.call(I,0,L)),ie[L]=I[L]);return R.concat(ie||Array.prototype.slice.call(I))};Object.defineProperty(xa,"__esModule",{value:!0});var c=i(zm()),f=CS(),a=rv(),_=["ArrowRight","ArrowUp","k","PageUp"],x=["ArrowLeft","ArrowDown","j","PageDown"],S=function(R){t(I,R);function I(N){var L=R.call(this,N)||this;if(L.trackRef=c.createRef(),L.thumbRefs=[],L.state={draggedTrackPos:[-1,-1],draggedThumbIndex:-1,thumbZIndexes:new Array(L.props.values.length).fill(0).map(function(H,ie){return ie}),isChanged:!1,markOffsets:[]},L.getOffsets=function(){var H=L.props,ie=H.direction,ne=H.values,he=H.min,re=H.max,ge=L.trackRef.current;if(!ge)return console.warn("No track element found."),[];var _e=ge.getBoundingClientRect(),pe=(0,f.getPaddingAndBorder)(ge);return L.getThumbs().map(function(it,mt){var nt={x:0,y:0},Ce=it.getBoundingClientRect(),ht=(0,f.getMargin)(it);switch(ie){case a.Direction.Right:return nt.x=(ht.left+pe.left)*-1,nt.y=((Ce.height-_e.height)/2+pe.top)*-1,nt.x+=_e.width*(0,f.relativeValue)(ne[mt],he,re)-Ce.width/2,nt;case a.Direction.Left:return nt.x=(ht.right+pe.right)*-1,nt.y=((Ce.height-_e.height)/2+pe.top)*-1,nt.x+=_e.width-_e.width*(0,f.relativeValue)(ne[mt],he,re)-Ce.width/2,nt;case a.Direction.Up:return nt.x=((Ce.width-_e.width)/2+ht.left+pe.left)*-1,nt.y=-pe.left,nt.y+=_e.height-_e.height*(0,f.relativeValue)(ne[mt],he,re)-Ce.height/2,nt;case a.Direction.Down:return nt.x=((Ce.width-_e.width)/2+ht.left+pe.left)*-1,nt.y=-pe.left,nt.y+=_e.height*(0,f.relativeValue)(ne[mt],he,re)-Ce.height/2,nt;default:return(0,f.assertUnreachable)(ie)}})},L.getThumbs=function(){return L.trackRef&&L.trackRef.current?Array.from(L.trackRef.current.children).filter(function(H){return H.hasAttribute("aria-valuenow")}):(console.warn("No thumbs found in the track container. Did you forget to pass & spread the `props` param in renderTrack?"),[])},L.getTargetIndex=function(H){return L.getThumbs().findIndex(function(ie){return ie===H.target||ie.contains(H.target)})},L.addTouchEvents=function(H){document.addEventListener("touchmove",L.schdOnTouchMove,{passive:!1}),document.addEventListener("touchend",L.schdOnEnd,{passive:!1}),document.addEventListener("touchcancel",L.schdOnEnd,{passive:!1})},L.addMouseEvents=function(H){document.addEventListener("mousemove",L.schdOnMouseMove),document.addEventListener("mouseup",L.schdOnEnd)},L.onMouseDownTrack=function(H){var ie;if(!(H.button!==0||(0,f.isIOS)()))if(H.persist(),H.preventDefault(),L.addMouseEvents(H.nativeEvent),L.props.values.length>1&&L.props.draggableTrack){if(L.thumbRefs.some(function(he){var re;return(re=he.current)===null||re===void 0?void 0:re.contains(H.target)}))return;L.setState({draggedTrackPos:[H.clientX,H.clientY]},function(){return L.onMove(H.clientX,H.clientY)})}else{var ne=(0,f.getClosestThumbIndex)(L.thumbRefs.map(function(he){return he.current}),H.clientX,H.clientY,L.props.direction);(ie=L.thumbRefs[ne].current)===null||ie===void 0||ie.focus(),L.setState({draggedThumbIndex:ne},function(){return L.onMove(H.clientX,H.clientY)})}},L.onResize=function(){(0,f.translateThumbs)(L.getThumbs(),L.getOffsets(),L.props.rtl),L.calculateMarkOffsets()},L.onTouchStartTrack=function(H){var ie;if(H.persist(),L.addTouchEvents(H.nativeEvent),L.props.values.length>1&&L.props.draggableTrack){if(L.thumbRefs.some(function(he){var re;return(re=he.current)===null||re===void 0?void 0:re.contains(H.target)}))return;L.setState({draggedTrackPos:[H.touches[0].clientX,H.touches[0].clientY]},function(){return L.onMove(H.touches[0].clientX,H.touches[0].clientY)})}else{var ne=(0,f.getClosestThumbIndex)(L.thumbRefs.map(function(he){return he.current}),H.touches[0].clientX,H.touches[0].clientY,L.props.direction);(ie=L.thumbRefs[ne].current)===null||ie===void 0||ie.focus(),L.setState({draggedThumbIndex:ne},function(){return L.onMove(H.touches[0].clientX,H.touches[0].clientY)})}},L.onMouseOrTouchStart=function(H){if(!L.props.disabled){var ie=(0,f.isTouchEvent)(H);if(!(!ie&&H.button!==0)){var ne=L.getTargetIndex(H);ne!==-1&&(ie?L.addTouchEvents(H):L.addMouseEvents(H),L.setState({draggedThumbIndex:ne,thumbZIndexes:L.state.thumbZIndexes.map(function(he,re){return re===ne?Math.max.apply(Math,L.state.thumbZIndexes):he<=L.state.thumbZIndexes[ne]?he:he-1})}))}}},L.onMouseMove=function(H){H.preventDefault(),L.onMove(H.clientX,H.clientY)},L.onTouchMove=function(H){H.preventDefault(),L.onMove(H.touches[0].clientX,H.touches[0].clientY)},L.onKeyDown=function(H){var ie=L.props,ne=ie.values,he=ie.onChange,re=ie.step,ge=ie.rtl,_e=ie.direction,pe=L.state.isChanged,it=L.getTargetIndex(H.nativeEvent),mt=ge||_e===a.Direction.Left||_e===a.Direction.Down?-1:1;it!==-1&&(_.includes(H.key)?(H.preventDefault(),L.setState({draggedThumbIndex:it,isChanged:!0}),he((0,f.replaceAt)(ne,it,L.normalizeValue(ne[it]+mt*(H.key==="PageUp"?re*10:re),it)))):x.includes(H.key)?(H.preventDefault(),L.setState({draggedThumbIndex:it,isChanged:!0}),he((0,f.replaceAt)(ne,it,L.normalizeValue(ne[it]-mt*(H.key==="PageDown"?re*10:re),it)))):H.key==="Tab"?L.setState({draggedThumbIndex:-1},function(){pe&&L.fireOnFinalChange()}):pe&&L.fireOnFinalChange())},L.onKeyUp=function(H){var ie=L.state.isChanged;L.setState({draggedThumbIndex:-1},function(){ie&&L.fireOnFinalChange()})},L.onMove=function(H,ie){var ne=L.state,he=ne.draggedThumbIndex,re=ne.draggedTrackPos,ge=L.props,_e=ge.direction,pe=ge.min,it=ge.max,mt=ge.onChange,nt=ge.values,Ce=ge.step,ht=ge.rtl;if(he===-1&&re[0]===-1&&re[1]===-1)return null;var Me=L.trackRef.current;if(!Me)return null;var Ve=Me.getBoundingClientRect(),Le=(0,f.isVertical)(_e)?Ve.height:Ve.width;if(re[0]!==-1&&re[1]!==-1){var lt=H-re[0],we=ie-re[1],Ye=0;switch(_e){case a.Direction.Right:case a.Direction.Left:Ye=lt/Le*(it-pe);break;case a.Direction.Down:case a.Direction.Up:Ye=we/Le*(it-pe);break;default:(0,f.assertUnreachable)(_e)}if(ht&&(Ye*=-1),Math.abs(Ye)>=Ce/2){for(var gt=0;gt<L.thumbRefs.length;gt++){if(nt[gt]===it&&Math.sign(Ye)===1||nt[gt]===pe&&Math.sign(Ye)===-1)return;var Dt=nt[gt]+Ye;Dt>it?Ye=it-nt[gt]:Dt<pe&&(Ye=pe-nt[gt])}for(var X=nt.slice(0),gt=0;gt<L.thumbRefs.length;gt++)X=(0,f.replaceAt)(X,gt,L.normalizeValue(nt[gt]+Ye,gt));L.setState({draggedTrackPos:[H,ie]}),mt(X)}}else{var Ke=0;switch(_e){case a.Direction.Right:Ke=(H-Ve.left)/Le*(it-pe)+pe;break;case a.Direction.Left:Ke=(Le-(H-Ve.left))/Le*(it-pe)+pe;break;case a.Direction.Down:Ke=(ie-Ve.top)/Le*(it-pe)+pe;break;case a.Direction.Up:Ke=(Le-(ie-Ve.top))/Le*(it-pe)+pe;break;default:(0,f.assertUnreachable)(_e)}ht&&(Ke=it+pe-Ke),Math.abs(nt[he]-Ke)>=Ce/2&&mt((0,f.replaceAt)(nt,he,L.normalizeValue(Ke,he)))}},L.normalizeValue=function(H,ie){var ne=L.props,he=ne.min,re=ne.max,ge=ne.step,_e=ne.allowOverlap,pe=ne.values;return(0,f.normalizeValue)(H,ie,he,re,ge,_e,pe)},L.onEnd=function(H){if(H.preventDefault(),document.removeEventListener("mousemove",L.schdOnMouseMove),document.removeEventListener("touchmove",L.schdOnTouchMove),document.removeEventListener("mouseup",L.schdOnEnd),document.removeEventListener("touchend",L.schdOnEnd),document.removeEventListener("touchcancel",L.schdOnEnd),L.state.draggedThumbIndex===-1&&L.state.draggedTrackPos[0]===-1&&L.state.draggedTrackPos[1]===-1)return null;L.setState({draggedThumbIndex:-1,draggedTrackPos:[-1,-1]},function(){L.fireOnFinalChange()})},L.fireOnFinalChange=function(){L.setState({isChanged:!1});var H=L.props,ie=H.onFinalChange,ne=H.values;ie&&ie(ne)},L.updateMarkRefs=function(H){if(!H.renderMark){L.numOfMarks=void 0,L.markRefs=void 0;return}L.numOfMarks=(H.max-H.min)/L.props.step,L.markRefs=[];for(var ie=0;ie<L.numOfMarks+1;ie++)L.markRefs[ie]=c.createRef()},L.calculateMarkOffsets=function(){if(!(!L.props.renderMark||!L.trackRef||!L.numOfMarks||!L.markRefs||L.trackRef.current===null)){for(var H=window.getComputedStyle(L.trackRef.current),ie=parseInt(H.width,10),ne=parseInt(H.height,10),he=parseInt(H.paddingLeft,10),re=parseInt(H.paddingTop,10),ge=[],_e=0;_e<L.numOfMarks+1;_e++){var pe=9999,it=9999;if(L.markRefs[_e].current){var mt=L.markRefs[_e].current.getBoundingClientRect();pe=mt.height,it=mt.width}L.props.direction===a.Direction.Left||L.props.direction===a.Direction.Right?ge.push([Math.round(ie/L.numOfMarks*_e+he-it/2),-Math.round((pe-ne)/2)]):ge.push([Math.round(ne/L.numOfMarks*_e+re-pe/2),-Math.round((it-ie)/2)])}L.setState({markOffsets:ge})}},N.step===0)throw new Error('"step" property should be a positive number');return L.schdOnMouseMove=(0,f.schd)(L.onMouseMove),L.schdOnTouchMove=(0,f.schd)(L.onTouchMove),L.schdOnEnd=(0,f.schd)(L.onEnd),L.thumbRefs=N.values.map(function(){return c.createRef()}),L.updateMarkRefs(N),L}return I.prototype.componentDidMount=function(){var N=this,L=this.props,H=L.values,ie=L.min,ne=L.step;this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(this.onResize):{observe:function(){return window.addEventListener("resize",N.onResize)},unobserve:function(){return window.removeEventListener("resize",N.onResize)}},document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart,{passive:!1}),!this.props.allowOverlap&&(0,f.checkInitialOverlap)(this.props.values),this.props.values.forEach(function(he){return(0,f.checkBoundaries)(he,N.props.min,N.props.max)}),this.resizeObserver.observe(this.trackRef.current),(0,f.translateThumbs)(this.getThumbs(),this.getOffsets(),this.props.rtl),this.calculateMarkOffsets(),H.forEach(function(he){(0,f.isStepDivisible)(ie,he,ne)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")})},I.prototype.componentDidUpdate=function(N,L){var H=this.props,ie=H.max,ne=H.min,he=H.step,re=H.values,ge=H.rtl;(N.max!==ie||N.min!==ne||N.step!==he)&&this.updateMarkRefs(this.props),(0,f.translateThumbs)(this.getThumbs(),this.getOffsets(),ge),(N.max!==ie||N.min!==ne||N.step!==he||L.markOffsets.length!==this.state.markOffsets.length)&&(this.calculateMarkOffsets(),re.forEach(function(_e){(0,f.isStepDivisible)(ne,_e,he)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")}))},I.prototype.componentWillUnmount=function(){var N={passive:!1};document.removeEventListener("mousedown",this.onMouseOrTouchStart,N),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchend",this.schdOnEnd),this.resizeObserver.unobserve(this.trackRef.current)},I.prototype.render=function(){var N=this,L=this.props,H=L.label,ie=L.labelledBy,ne=L.renderTrack,he=L.renderThumb,re=L.renderMark,ge=re===void 0?function(){return null}:re,_e=L.values,pe=L.min,it=L.max,mt=L.allowOverlap,nt=L.disabled,Ce=this.state,ht=Ce.draggedThumbIndex,Me=Ce.thumbZIndexes,Ve=Ce.markOffsets;return ne({props:{style:{transform:"scale(1)",cursor:ht>-1?"grabbing":this.props.draggableTrack?(0,f.isVertical)(this.props.direction)?"ns-resize":"ew-resize":_e.length===1&&!nt?"pointer":"inherit"},onMouseDown:nt?f.voidFn:this.onMouseDownTrack,onTouchStart:nt?f.voidFn:this.onTouchStartTrack,ref:this.trackRef},isDragged:this.state.draggedThumbIndex>-1,disabled:nt,children:r(r([],Ve.map(function(Le,lt,we){return ge({props:{style:N.props.direction===a.Direction.Left||N.props.direction===a.Direction.Right?{position:"absolute",left:"".concat(Le[0],"px"),marginTop:"".concat(Le[1],"px")}:{position:"absolute",top:"".concat(Le[0],"px"),marginLeft:"".concat(Le[1],"px")},key:"mark".concat(lt),ref:N.markRefs[lt]},index:lt})}),!0),_e.map(function(Le,lt){var we=N.state.draggedThumbIndex===lt;return he({index:lt,value:Le,isDragged:we,props:{style:{position:"absolute",zIndex:Me[lt],cursor:nt?"inherit":we?"grabbing":"grab",userSelect:"none",touchAction:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},key:lt,tabIndex:nt?void 0:0,"aria-valuemax":mt?it:_e[lt+1]||it,"aria-valuemin":mt?pe:_e[lt-1]||pe,"aria-valuenow":Le,draggable:!1,ref:N.thumbRefs[lt],"aria-label":H,"aria-labelledby":ie,role:"slider",onKeyDown:nt?f.voidFn:N.onKeyDown,onKeyUp:nt?f.voidFn:N.onKeyUp}})}),!0)})},I.defaultProps={label:"Accessibility label",labelledBy:null,step:1,direction:a.Direction.Right,rtl:!1,disabled:!1,allowOverlap:!1,draggableTrack:!1,min:0,max:100},I}(c.Component);return xa.default=S,xa}var dw;function E6(){return dw||(dw=1,function(t){var e=lm&&lm.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkValuesAgainstBoundaries=t.relativeValue=t.useThumbOverlap=t.Direction=t.getTrackBackground=t.Range=void 0;var n=e(S6());t.Range=n.default;var i=CS();Object.defineProperty(t,"getTrackBackground",{enumerable:!0,get:function(){return i.getTrackBackground}}),Object.defineProperty(t,"useThumbOverlap",{enumerable:!0,get:function(){return i.useThumbOverlap}}),Object.defineProperty(t,"relativeValue",{enumerable:!0,get:function(){return i.relativeValue}}),Object.defineProperty(t,"checkValuesAgainstBoundaries",{enumerable:!0,get:function(){return i.checkValuesAgainstBoundaries}});var r=rv();Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return r.Direction}})}(lm)),lm}var pw=E6();function A6({range:t,min:e,max:n,onChange:i}){const[r,c]=St.useState(t);St.useEffect(()=>{_.current||c(t)},[t]);const[f,a]=St.useState(!1),_=St.useRef(!1);St.useEffect(()=>{_.current=f},[f]);const x=St.useRef(null),S=St.useRef(null),R=St.useRef(null),I=St.useRef(i);St.useEffect(()=>{I.current=i},[i]);const N=St.useRef(null),L=St.useRef(null),H=50,ie=St.useCallback(ge=>{N.current=ge,L.current==null&&(I.current(N.current),L.current=window.setTimeout(()=>{L.current=null,N.current&&I.current(N.current)},H))},[]);St.useEffect(()=>{function ge(pe){if(!_.current||x.current===null||!S.current)return;const it=pe.clientX-x.current,nt=R.current?.getBoundingClientRect()?.width??1,Ce=n-e,ht=Math.round(it/nt*Ce),[Me,Ve]=S.current,Le=Ve-Me,lt=Math.max(e,Math.min(n-Le,Me+ht)),we=lt+Le,Ye=[lt,we];c(Ye),ie(Ye)}function _e(){_.current&&(a(!1),x.current=null,S.current=null,i(r))}return window.addEventListener("mousemove",ge),window.addEventListener("mouseup",_e),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("mouseup",_e)}},[e,n,i,r,ie]);function ne({props:ge,children:_e}){const pe=nt=>{const Ce=nt.target;if(Ce&&Ce.closest('[data-range-thumb="true"]')){ge.onMouseDown?.(nt);return}const ht=R.current?.getBoundingClientRect();if(!ht){ge.onMouseDown?.(nt);return}const Me=n-e,Ve=(r[0]-e)/Me*ht.width,Le=(r[1]-e)/Me*ht.width,lt=Math.min(Ve,Le),we=Math.max(Ve,Le),Ye=nt.clientX-ht.left;if(Ye>=lt&&Ye<=we){nt.preventDefault(),a(!0),x.current=nt.clientX,S.current=r;return}ge.onMouseDown?.(nt)},it=nt=>{R.current=nt;const Ce=ge.ref;typeof Ce=="function"?Ce(nt):Ce&&typeof Ce=="object"&&(Ce.current=nt)},mt={...ge.style,height:"6px",background:pw.getTrackBackground({values:r,colors:["#ccc","#548BF4","#ccc"],min:e,max:n}),margin:"0 16px",cursor:f?"grabbing":"pointer"};return Yn.jsx("div",{...ge,ref:it,style:mt,onMouseDown:pe,children:_e})}function he({props:ge,index:_e}){const pe={...ge.style,height:"20px",width:"20px",borderRadius:"50%",backgroundColor:"#548BF4"};return Yn.jsx("div",{...ge,"data-range-thumb":"true","data-thumb-index":_e,style:pe})}return Yn.jsxs("div",{className:"time-slider",children:[Yn.jsx(pw.Range,{values:r,step:1,min:e,max:n,renderTrack:ne,renderThumb:he,onChange:ge=>{const _e=[ge[0],ge[1]];c(_e),ie(_e)},onFinalChange:ge=>{const _e=[ge[0],ge[1]];c(_e),i(_e)}}),Yn.jsxs("div",{style:{textAlign:"center",marginTop:"0.5rem"},children:[r[0],"  ",r[1]]})]})}class sv{async loadPersons(e){const r=(await(await fetch(e)).text()).split(`
`).filter(Boolean).map(sv.parsePerson).filter(Boolean),c=new Map;for(const f of r){let a=c.get(f.birthYear);a||c.set(f.birthYear,a=[]),a.push(f)}return c}static parsePerson(e){const n=JSON.parse(e),i=parseInt(n.birthDate?.match(/\+?(\d{4})/)?.[1]);let r=n.coordinates;return n.coordinates&&(r=[n.coordinates.longitude,n.coordinates.latitude]),n.birthPlace&&typeof n.birthPlace.longitude=="number"&&typeof n.birthPlace.latitude=="number"&&(r=[n.birthPlace.longitude,n.birthPlace.latitude]),r?{id:n.id,label:n.label,birthYear:i,coordinates:r}:void 0}}function C6({person:t,setSelected:e}){return t?Yn.jsxs("div",{className:"person-info",children:[Yn.jsxs("div",{children:[Yn.jsx("div",{style:{fontWeight:600},children:t.label}),Yn.jsxs("div",{style:{color:"#555"},children:["Born: ",t.birthYear]}),Yn.jsxs("div",{style:{color:"#555"},children:["Lon/Lat: ",t.coordinates[0].toFixed(3),", ",t.coordinates[1].toFixed(3)]}),t.id&&Yn.jsx("div",{style:{marginTop:6},children:Yn.jsx("a",{href:`https://www.wikidata.org/wiki/${t.id}`,target:"_blank",rel:"noreferrer",children:"Open on Wikidata"})})]}),Yn.jsx("button",{onClick:()=>e(null),style:{border:"none",background:"transparent",cursor:"pointer",fontSize:18,lineHeight:1},children:""})]}):null}const R6=new sv;function k6({onReady:t}){const[e,n]=St.useState(new globalThis.Map),[i,r]=St.useState([1500,1550]),[c,f]=St.useState(null),[a,_]=St.useState({min:1200,max:2025});St.useEffect(()=>{async function N(){const H=await R6.loadPersons("people_with_coords.jsonl");let ie=1/0,ne=-1/0;for(const he of H.keys())he<ie&&(ie=he),he>ne&&(ne=he);n(H),_({min:ie,max:ne}),t?.()}N()},[t]);const x=St.useMemo(()=>{const N=[];for(let L=i[0];L<=i[1];L++)N.push(...e.get(L)??[]);return N},[e,i]);St.useEffect(()=>{c&&(x.includes(c)||f(null))},[x,c]);const S=St.useMemo(()=>new z_({id:"scatter",data:x,getPosition:N=>N.coordinates,radiusUnits:"pixels",getRadius:6,getFillColor:()=>[255,0,0,180],autoHighlight:!0,highlightColor:[0,0,0,100],stroked:!1,pickable:!0}),[x]),R=St.useMemo(()=>c?new z_({id:"scatter-selected",data:[c],getPosition:N=>N.coordinates,radiusUnits:"pixels",getRadius:6,getFillColor:()=>[0,120,255,200],stroked:!0,getLineColor:[0,0,0,255],lineWidthMinPixels:2,pickable:!1}):null,[c]);return Yn.jsxs(Yn.Fragment,{children:[Yn.jsx(y6,{initialViewState:{latitude:50,longitude:10,zoom:4},controller:!0,layers:R?[S,R]:[S],pickingRadius:8,getCursor:({isDragging:N,isHovering:L})=>N?"grabbing":L?"pointer":"grab",onClick:N=>{const L=N?.object;f(L??null)},children:Yn.jsx(FA,{mapLib:fA,mapStyle:"https://demotiles.maplibre.org/style.json"})}),c&&Yn.jsx(C6,{person:c,setSelected:f}),Yn.jsx(A6,{range:i,min:a.min,max:a.max,onChange:r})]})}function I6(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const M6=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,P6=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,D6={};function mw(t,e){return(D6.jsx?P6:M6).test(t)}const O6=/[ \t\n\f\r]/g;function B6(t){return typeof t=="object"?t.type==="text"?gw(t.value):!1:gw(t)}function gw(t){return t.replace(O6,"")===""}class qm{constructor(e,n,i){this.normal=n,this.property=e,i&&(this.space=i)}}qm.prototype.normal={};qm.prototype.property={};qm.prototype.space=void 0;function RS(t,e){const n={},i={};for(const r of t)Object.assign(n,r.property),Object.assign(i,r.normal);return new qm(n,i,e)}function ox(t){return t.toLowerCase()}class wa{constructor(e,n){this.attribute=n,this.property=e}}wa.prototype.attribute="";wa.prototype.booleanish=!1;wa.prototype.boolean=!1;wa.prototype.commaOrSpaceSeparated=!1;wa.prototype.commaSeparated=!1;wa.prototype.defined=!1;wa.prototype.mustUseProperty=!1;wa.prototype.number=!1;wa.prototype.overloadedBoolean=!1;wa.prototype.property="";wa.prototype.spaceSeparated=!1;wa.prototype.space=void 0;let N6=0;const Nn=bf(),jr=bf(),lx=bf(),Rt=bf(),Vi=bf(),Cd=bf(),za=bf();function bf(){return 2**++N6}const cx=Object.freeze(Object.defineProperty({__proto__:null,boolean:Nn,booleanish:jr,commaOrSpaceSeparated:za,commaSeparated:Cd,number:Rt,overloadedBoolean:lx,spaceSeparated:Vi},Symbol.toStringTag,{value:"Module"})),ub=Object.keys(cx);class av extends wa{constructor(e,n,i,r){let c=-1;if(super(e,n),_w(this,"space",r),typeof i=="number")for(;++c<ub.length;){const f=ub[c];_w(this,ub[c],(i&cx[f])===cx[f])}}}av.prototype.defined=!0;function _w(t,e,n){n&&(t[e]=n)}function jd(t){const e={},n={};for(const[i,r]of Object.entries(t.properties)){const c=new av(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(c.mustUseProperty=!0),e[i]=c,n[ox(i)]=i,n[ox(c.attribute)]=i}return new qm(e,n,t.space)}const kS=jd({properties:{ariaActiveDescendant:null,ariaAtomic:jr,ariaAutoComplete:null,ariaBusy:jr,ariaChecked:jr,ariaColCount:Rt,ariaColIndex:Rt,ariaColSpan:Rt,ariaControls:Vi,ariaCurrent:null,ariaDescribedBy:Vi,ariaDetails:null,ariaDisabled:jr,ariaDropEffect:Vi,ariaErrorMessage:null,ariaExpanded:jr,ariaFlowTo:Vi,ariaGrabbed:jr,ariaHasPopup:null,ariaHidden:jr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Vi,ariaLevel:Rt,ariaLive:null,ariaModal:jr,ariaMultiLine:jr,ariaMultiSelectable:jr,ariaOrientation:null,ariaOwns:Vi,ariaPlaceholder:null,ariaPosInSet:Rt,ariaPressed:jr,ariaReadOnly:jr,ariaRelevant:null,ariaRequired:jr,ariaRoleDescription:Vi,ariaRowCount:Rt,ariaRowIndex:Rt,ariaRowSpan:Rt,ariaSelected:jr,ariaSetSize:Rt,ariaSort:null,ariaValueMax:Rt,ariaValueMin:Rt,ariaValueNow:Rt,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function IS(t,e){return e in t?t[e]:e}function MS(t,e){return IS(t,e.toLowerCase())}const z6=jd({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Cd,acceptCharset:Vi,accessKey:Vi,action:null,allow:null,allowFullScreen:Nn,allowPaymentRequest:Nn,allowUserMedia:Nn,alt:null,as:null,async:Nn,autoCapitalize:null,autoComplete:Vi,autoFocus:Nn,autoPlay:Nn,blocking:Vi,capture:null,charSet:null,checked:Nn,cite:null,className:Vi,cols:Rt,colSpan:null,content:null,contentEditable:jr,controls:Nn,controlsList:Vi,coords:Rt|Cd,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Nn,defer:Nn,dir:null,dirName:null,disabled:Nn,download:lx,draggable:jr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Nn,formTarget:null,headers:Vi,height:Rt,hidden:lx,high:Rt,href:null,hrefLang:null,htmlFor:Vi,httpEquiv:Vi,id:null,imageSizes:null,imageSrcSet:null,inert:Nn,inputMode:null,integrity:null,is:null,isMap:Nn,itemId:null,itemProp:Vi,itemRef:Vi,itemScope:Nn,itemType:Vi,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Nn,low:Rt,manifest:null,max:null,maxLength:Rt,media:null,method:null,min:null,minLength:Rt,multiple:Nn,muted:Nn,name:null,nonce:null,noModule:Nn,noValidate:Nn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Nn,optimum:Rt,pattern:null,ping:Vi,placeholder:null,playsInline:Nn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Nn,referrerPolicy:null,rel:Vi,required:Nn,reversed:Nn,rows:Rt,rowSpan:Rt,sandbox:Vi,scope:null,scoped:Nn,seamless:Nn,selected:Nn,shadowRootClonable:Nn,shadowRootDelegatesFocus:Nn,shadowRootMode:null,shape:null,size:Rt,sizes:null,slot:null,span:Rt,spellCheck:jr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Rt,step:null,style:null,tabIndex:Rt,target:null,title:null,translate:null,type:null,typeMustMatch:Nn,useMap:null,value:jr,width:Rt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Vi,axis:null,background:null,bgColor:null,border:Rt,borderColor:null,bottomMargin:Rt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Nn,declare:Nn,event:null,face:null,frame:null,frameBorder:null,hSpace:Rt,leftMargin:Rt,link:null,longDesc:null,lowSrc:null,marginHeight:Rt,marginWidth:Rt,noResize:Nn,noHref:Nn,noShade:Nn,noWrap:Nn,object:null,profile:null,prompt:null,rev:null,rightMargin:Rt,rules:null,scheme:null,scrolling:jr,standby:null,summary:null,text:null,topMargin:Rt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Rt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Nn,disableRemotePlayback:Nn,prefix:null,property:null,results:Rt,security:null,unselectable:null},space:"html",transform:MS}),L6=jd({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:za,accentHeight:Rt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Rt,amplitude:Rt,arabicForm:null,ascent:Rt,attributeName:null,attributeType:null,azimuth:Rt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Rt,by:null,calcMode:null,capHeight:Rt,className:Vi,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Rt,diffuseConstant:Rt,direction:null,display:null,dur:null,divisor:Rt,dominantBaseline:null,download:Nn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Rt,enableBackground:null,end:null,event:null,exponent:Rt,externalResourcesRequired:null,fill:null,fillOpacity:Rt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Cd,g2:Cd,glyphName:Cd,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Rt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Rt,horizOriginX:Rt,horizOriginY:Rt,id:null,ideographic:Rt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Rt,k:Rt,k1:Rt,k2:Rt,k3:Rt,k4:Rt,kernelMatrix:za,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Rt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Rt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Rt,overlineThickness:Rt,paintOrder:null,panose1:null,path:null,pathLength:Rt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Vi,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Rt,pointsAtY:Rt,pointsAtZ:Rt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:za,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:za,rev:za,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:za,requiredFeatures:za,requiredFonts:za,requiredFormats:za,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Rt,specularExponent:Rt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Rt,strikethroughThickness:Rt,string:null,stroke:null,strokeDashArray:za,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Rt,strokeOpacity:Rt,strokeWidth:null,style:null,surfaceScale:Rt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:za,tabIndex:Rt,tableValues:null,target:null,targetX:Rt,targetY:Rt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:za,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Rt,underlineThickness:Rt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Rt,values:null,vAlphabetic:Rt,vMathematical:Rt,vectorEffect:null,vHanging:Rt,vIdeographic:Rt,version:null,vertAdvY:Rt,vertOriginX:Rt,vertOriginY:Rt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Rt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:IS}),PS=jd({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),DS=jd({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:MS}),OS=jd({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),F6={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},U6=/[A-Z]/g,yw=/-[a-z]/g,V6=/^data[-\w.:]+$/i;function j6(t,e){const n=ox(e);let i=e,r=wa;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&V6.test(e)){if(e.charAt(4)==="-"){const c=e.slice(5).replace(yw,H6);i="data"+c.charAt(0).toUpperCase()+c.slice(1)}else{const c=e.slice(4);if(!yw.test(c)){let f=c.replace(U6,$6);f.charAt(0)!=="-"&&(f="-"+f),e="data"+f}}r=av}return new r(i,e)}function $6(t){return"-"+t.toLowerCase()}function H6(t){return t.charAt(1).toUpperCase()}const q6=RS([kS,z6,PS,DS,OS],"html"),ov=RS([kS,L6,PS,DS,OS],"svg");function W6(t){return t.join(" ").trim()}var pd={},hb,bw;function X6(){if(bw)return hb;bw=1;var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,n=/^\s*/,i=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,r=/^:\s*/,c=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,f=/^[;\s]*/,a=/^\s+|\s+$/g,_=`
`,x="/",S="*",R="",I="comment",N="declaration";hb=function(H,ie){if(typeof H!="string")throw new TypeError("First argument must be a string");if(!H)return[];ie=ie||{};var ne=1,he=1;function re(Ve){var Le=Ve.match(e);Le&&(ne+=Le.length);var lt=Ve.lastIndexOf(_);he=~lt?Ve.length-lt:he+Ve.length}function ge(){var Ve={line:ne,column:he};return function(Le){return Le.position=new _e(Ve),mt(),Le}}function _e(Ve){this.start=Ve,this.end={line:ne,column:he},this.source=ie.source}_e.prototype.content=H;function pe(Ve){var Le=new Error(ie.source+":"+ne+":"+he+": "+Ve);if(Le.reason=Ve,Le.filename=ie.source,Le.line=ne,Le.column=he,Le.source=H,!ie.silent)throw Le}function it(Ve){var Le=Ve.exec(H);if(Le){var lt=Le[0];return re(lt),H=H.slice(lt.length),Le}}function mt(){it(n)}function nt(Ve){var Le;for(Ve=Ve||[];Le=Ce();)Le!==!1&&Ve.push(Le);return Ve}function Ce(){var Ve=ge();if(!(x!=H.charAt(0)||S!=H.charAt(1))){for(var Le=2;R!=H.charAt(Le)&&(S!=H.charAt(Le)||x!=H.charAt(Le+1));)++Le;if(Le+=2,R===H.charAt(Le-1))return pe("End of comment missing");var lt=H.slice(2,Le-2);return he+=2,re(lt),H=H.slice(Le),he+=2,Ve({type:I,comment:lt})}}function ht(){var Ve=ge(),Le=it(i);if(Le){if(Ce(),!it(r))return pe("property missing ':'");var lt=it(c),we=Ve({type:N,property:L(Le[0].replace(t,R)),value:lt?L(lt[0].replace(t,R)):R});return it(f),we}}function Me(){var Ve=[];nt(Ve);for(var Le;Le=ht();)Le!==!1&&(Ve.push(Le),nt(Ve));return Ve}return mt(),Me()};function L(H){return H?H.replace(a,R):R}return hb}var xw;function Z6(){if(xw)return pd;xw=1;var t=pd&&pd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(pd,"__esModule",{value:!0}),pd.default=n;var e=t(X6());function n(i,r){var c=null;if(!i||typeof i!="string")return c;var f=(0,e.default)(i),a=typeof r=="function";return f.forEach(function(_){if(_.type==="declaration"){var x=_.property,S=_.value;a?r(x,S,_):S&&(c=c||{},c[x]=S)}}),c}return pd}var hm={},vw;function Y6(){if(vw)return hm;vw=1,Object.defineProperty(hm,"__esModule",{value:!0}),hm.camelCase=void 0;var t=/^--[a-zA-Z0-9_-]+$/,e=/-([a-z])/g,n=/^[^-]+$/,i=/^-(webkit|moz|ms|o|khtml)-/,r=/^-(ms)-/,c=function(x){return!x||n.test(x)||t.test(x)},f=function(x,S){return S.toUpperCase()},a=function(x,S){return"".concat(S,"-")},_=function(x,S){return S===void 0&&(S={}),c(x)?x:(x=x.toLowerCase(),S.reactCompat?x=x.replace(r,a):x=x.replace(i,a),x.replace(e,f))};return hm.camelCase=_,hm}var fm,ww;function G6(){if(ww)return fm;ww=1;var t=fm&&fm.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},e=t(Z6()),n=Y6();function i(r,c){var f={};return!r||typeof r!="string"||(0,e.default)(r,function(a,_){a&&_&&(f[(0,n.camelCase)(a,c)]=_)}),f}return i.default=i,fm=i,fm}var K6=G6();const Q6=yx(K6),BS=NS("end"),lv=NS("start");function NS(t){return e;function e(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function J6(t){const e=lv(t),n=BS(t);if(e&&n)return{start:e,end:n}}function Cm(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?Tw(t.position):"start"in t||"end"in t?Tw(t):"line"in t||"column"in t?ux(t):""}function ux(t){return Sw(t&&t.line)+":"+Sw(t&&t.column)}function Tw(t){return ux(t&&t.start)+"-"+ux(t&&t.end)}function Sw(t){return t&&typeof t=="number"?t:1}class js extends Error{constructor(e,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let r="",c={},f=!1;if(n&&("line"in n&&"column"in n?c={place:n}:"start"in n&&"end"in n?c={place:n}:"type"in n?c={ancestors:[n],place:n.position}:c={...n}),typeof e=="string"?r=e:!c.cause&&e&&(f=!0,r=e.message,c.cause=e),!c.ruleId&&!c.source&&typeof i=="string"){const _=i.indexOf(":");_===-1?c.ruleId=i:(c.source=i.slice(0,_),c.ruleId=i.slice(_+1))}if(!c.place&&c.ancestors&&c.ancestors){const _=c.ancestors[c.ancestors.length-1];_&&(c.place=_.position)}const a=c.place&&"start"in c.place?c.place.start:c.place;this.ancestors=c.ancestors||void 0,this.cause=c.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=a?a.line:void 0,this.name=Cm(c.place)||"1:1",this.place=c.place||void 0,this.reason=this.message,this.ruleId=c.ruleId||void 0,this.source=c.source||void 0,this.stack=f&&c.cause&&typeof c.cause.stack=="string"?c.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}js.prototype.file="";js.prototype.name="";js.prototype.reason="";js.prototype.message="";js.prototype.stack="";js.prototype.column=void 0;js.prototype.line=void 0;js.prototype.ancestors=void 0;js.prototype.cause=void 0;js.prototype.fatal=void 0;js.prototype.place=void 0;js.prototype.ruleId=void 0;js.prototype.source=void 0;const cv={}.hasOwnProperty,ez=new Map,tz=/[A-Z]/g,nz=new Set(["table","tbody","thead","tfoot","tr"]),iz=new Set(["td","th"]),zS="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function rz(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let i;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=fz(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=hz(n,e.jsx,e.jsxs)}const r={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:i,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?ov:q6,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},c=LS(r,t,void 0);return c&&typeof c!="string"?c:r.create(t,r.Fragment,{children:c||void 0},void 0)}function LS(t,e,n){if(e.type==="element")return sz(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return az(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return lz(t,e,n);if(e.type==="mdxjsEsm")return oz(t,e);if(e.type==="root")return cz(t,e,n);if(e.type==="text")return uz(t,e)}function sz(t,e,n){const i=t.schema;let r=i;e.tagName.toLowerCase()==="svg"&&i.space==="html"&&(r=ov,t.schema=r),t.ancestors.push(e);const c=US(t,e.tagName,!1),f=dz(t,e);let a=hv(t,e);return nz.has(e.tagName)&&(a=a.filter(function(_){return typeof _=="string"?!B6(_):!0})),FS(t,f,c,e),uv(f,a),t.ancestors.pop(),t.schema=i,t.create(e,c,f,n)}function az(t,e){if(e.data&&e.data.estree&&t.evaluater){const i=e.data.estree.body[0];return i.type,t.evaluater.evaluateExpression(i.expression)}Bm(t,e.position)}function oz(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Bm(t,e.position)}function lz(t,e,n){const i=t.schema;let r=i;e.name==="svg"&&i.space==="html"&&(r=ov,t.schema=r),t.ancestors.push(e);const c=e.name===null?t.Fragment:US(t,e.name,!0),f=pz(t,e),a=hv(t,e);return FS(t,f,c,e),uv(f,a),t.ancestors.pop(),t.schema=i,t.create(e,c,f,n)}function cz(t,e,n){const i={};return uv(i,hv(t,e)),t.create(e,t.Fragment,i,n)}function uz(t,e){return e.value}function FS(t,e,n,i){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=i)}function uv(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function hz(t,e,n){return i;function i(r,c,f,a){const x=Array.isArray(f.children)?n:e;return a?x(c,f,a):x(c,f)}}function fz(t,e){return n;function n(i,r,c,f){const a=Array.isArray(c.children),_=lv(i);return e(r,c,f,a,{columnNumber:_?_.column-1:void 0,fileName:t,lineNumber:_?_.line:void 0},void 0)}}function dz(t,e){const n={};let i,r;for(r in e.properties)if(r!=="children"&&cv.call(e.properties,r)){const c=mz(t,r,e.properties[r]);if(c){const[f,a]=c;t.tableCellAlignToStyle&&f==="align"&&typeof a=="string"&&iz.has(e.tagName)?i=a:n[f]=a}}if(i){const c=n.style||(n.style={});c[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function pz(t,e){const n={};for(const i of e.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&t.evaluater){const c=i.data.estree.body[0];c.type;const f=c.expression;f.type;const a=f.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else Bm(t,e.position);else{const r=i.name;let c;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&t.evaluater){const a=i.value.data.estree.body[0];a.type,c=t.evaluater.evaluateExpression(a.expression)}else Bm(t,e.position);else c=i.value===null?!0:i.value;n[r]=c}return n}function hv(t,e){const n=[];let i=-1;const r=t.passKeys?new Map:ez;for(;++i<e.children.length;){const c=e.children[i];let f;if(t.passKeys){const _=c.type==="element"?c.tagName:c.type==="mdxJsxFlowElement"||c.type==="mdxJsxTextElement"?c.name:void 0;if(_){const x=r.get(_)||0;f=_+"-"+x,r.set(_,x+1)}}const a=LS(t,c,f);a!==void 0&&n.push(a)}return n}function mz(t,e,n){const i=j6(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?I6(n):W6(n)),i.property==="style"){let r=typeof n=="object"?n:gz(t,String(n));return t.stylePropertyNameCase==="css"&&(r=_z(r)),["style",r]}return[t.elementAttributeNameCase==="react"&&i.space?F6[i.property]||i.property:i.attribute,n]}}function gz(t,e){try{return Q6(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const i=n,r=new js("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw r.file=t.filePath||void 0,r.url=zS+"#cannot-parse-style-attribute",r}}function US(t,e,n){let i;if(!n)i={type:"Literal",value:e};else if(e.includes(".")){const r=e.split(".");let c=-1,f;for(;++c<r.length;){const a=mw(r[c])?{type:"Identifier",name:r[c]}:{type:"Literal",value:r[c]};f=f?{type:"MemberExpression",object:f,property:a,computed:!!(c&&a.type==="Literal"),optional:!1}:a}i=f}else i=mw(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(i.type==="Literal"){const r=i.value;return cv.call(t.components,r)?t.components[r]:r}if(t.evaluater)return t.evaluater.evaluateExpression(i);Bm(t)}function Bm(t,e){const n=new js("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=zS+"#cannot-handle-mdx-estrees-without-createevaluater",n}function _z(t){const e={};let n;for(n in t)cv.call(t,n)&&(e[yz(n)]=t[n]);return e}function yz(t){let e=t.replace(tz,bz);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function bz(t){return"-"+t.toLowerCase()}const fb={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},xz={};function fv(t,e){const n=xz,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,r=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return VS(t,i,r)}function VS(t,e,n){if(vz(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return Ew(t.children,e,n)}return Array.isArray(t)?Ew(t,e,n):""}function Ew(t,e,n){const i=[];let r=-1;for(;++r<t.length;)i[r]=VS(t[r],e,n);return i.join("")}function vz(t){return!!(t&&typeof t=="object")}const Aw=document.createElement("i");function dv(t){const e="&"+t+";";Aw.innerHTML=e;const n=Aw.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Ua(t,e,n,i){const r=t.length;let c=0,f;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,n=n>0?n:0,i.length<1e4)f=Array.from(i),f.unshift(e,n),t.splice(...f);else for(n&&t.splice(e,n);c<i.length;)f=i.slice(c,c+1e4),f.unshift(e,0),t.splice(...f),c+=1e4,e+=1e4}function go(t,e){return t.length>0?(Ua(t,t.length,0,e),t):e}const Cw={}.hasOwnProperty;function jS(t){const e={};let n=-1;for(;++n<t.length;)wz(e,t[n]);return e}function wz(t,e){let n;for(n in e){const r=(Cw.call(t,n)?t[n]:void 0)||(t[n]={}),c=e[n];let f;if(c)for(f in c){Cw.call(r,f)||(r[f]=[]);const a=c[f];Tz(r[f],Array.isArray(a)?a:a?[a]:[])}}}function Tz(t,e){let n=-1;const i=[];for(;++n<e.length;)(e[n].add==="after"?t:i).push(e[n]);Ua(t,0,0,i)}function $S(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function tl(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const na=Qu(/[A-Za-z]/),Vs=Qu(/[\dA-Za-z]/),Sz=Qu(/[#-'*+\--9=?A-Z^-~]/);function L_(t){return t!==null&&(t<32||t===127)}const hx=Qu(/\d/),Ez=Qu(/[\dA-Fa-f]/),Az=Qu(/[!-/:-@[-`{-~]/);function cn(t){return t!==null&&t<-2}function Pi(t){return t!==null&&(t<0||t===32)}function Xn(t){return t===-2||t===-1||t===32}const ty=Qu(new RegExp("\\p{P}|\\p{S}","u")),pf=Qu(/\s/);function Qu(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function $d(t){const e=[];let n=-1,i=0,r=0;for(;++n<t.length;){const c=t.charCodeAt(n);let f="";if(c===37&&Vs(t.charCodeAt(n+1))&&Vs(t.charCodeAt(n+2)))r=2;else if(c<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(c))||(f=String.fromCharCode(c));else if(c>55295&&c<57344){const a=t.charCodeAt(n+1);c<56320&&a>56319&&a<57344?(f=String.fromCharCode(c,a),r=1):f=""}else f=String.fromCharCode(c);f&&(e.push(t.slice(i,n),encodeURIComponent(f)),i=n+r+1,f=""),r&&(n+=r,r=0)}return e.join("")+t.slice(i)}function ti(t,e,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let c=0;return f;function f(_){return Xn(_)?(t.enter(n),a(_)):e(_)}function a(_){return Xn(_)&&c++<r?(t.consume(_),a):(t.exit(n),e(_))}}const Cz={tokenize:Rz};function Rz(t){const e=t.attempt(this.parser.constructs.contentInitial,i,r);let n;return e;function i(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),ti(t,e,"linePrefix")}function r(a){return t.enter("paragraph"),c(a)}function c(a){const _=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=_),n=_,f(a)}function f(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return cn(a)?(t.consume(a),t.exit("chunkText"),c):(t.consume(a),f)}}const kz={tokenize:Iz},Rw={tokenize:Mz};function Iz(t){const e=this,n=[];let i=0,r,c,f;return a;function a(re){if(i<n.length){const ge=n[i];return e.containerState=ge[1],t.attempt(ge[0].continuation,_,x)(re)}return x(re)}function _(re){if(i++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&he();const ge=e.events.length;let _e=ge,pe;for(;_e--;)if(e.events[_e][0]==="exit"&&e.events[_e][1].type==="chunkFlow"){pe=e.events[_e][1].end;break}ne(i);let it=ge;for(;it<e.events.length;)e.events[it][1].end={...pe},it++;return Ua(e.events,_e+1,0,e.events.slice(ge)),e.events.length=it,x(re)}return a(re)}function x(re){if(i===n.length){if(!r)return I(re);if(r.currentConstruct&&r.currentConstruct.concrete)return L(re);e.interrupt=!!(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(Rw,S,R)(re)}function S(re){return r&&he(),ne(i),I(re)}function R(re){return e.parser.lazy[e.now().line]=i!==n.length,f=e.now().offset,L(re)}function I(re){return e.containerState={},t.attempt(Rw,N,L)(re)}function N(re){return i++,n.push([e.currentConstruct,e.containerState]),I(re)}function L(re){if(re===null){r&&he(),ne(0),t.consume(re);return}return r=r||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:c}),H(re)}function H(re){if(re===null){ie(t.exit("chunkFlow"),!0),ne(0),t.consume(re);return}return cn(re)?(t.consume(re),ie(t.exit("chunkFlow")),i=0,e.interrupt=void 0,a):(t.consume(re),H)}function ie(re,ge){const _e=e.sliceStream(re);if(ge&&_e.push(null),re.previous=c,c&&(c.next=re),c=re,r.defineSkip(re.start),r.write(_e),e.parser.lazy[re.start.line]){let pe=r.events.length;for(;pe--;)if(r.events[pe][1].start.offset<f&&(!r.events[pe][1].end||r.events[pe][1].end.offset>f))return;const it=e.events.length;let mt=it,nt,Ce;for(;mt--;)if(e.events[mt][0]==="exit"&&e.events[mt][1].type==="chunkFlow"){if(nt){Ce=e.events[mt][1].end;break}nt=!0}for(ne(i),pe=it;pe<e.events.length;)e.events[pe][1].end={...Ce},pe++;Ua(e.events,mt+1,0,e.events.slice(it)),e.events.length=pe}}function ne(re){let ge=n.length;for(;ge-- >re;){const _e=n[ge];e.containerState=_e[1],_e[0].exit.call(e,t)}n.length=re}function he(){r.write([null]),c=void 0,r=void 0,e.containerState._closeFlow=void 0}}function Mz(t,e,n){return ti(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Ud(t){if(t===null||Pi(t)||pf(t))return 1;if(ty(t))return 2}function ny(t,e,n){const i=[];let r=-1;for(;++r<t.length;){const c=t[r].resolveAll;c&&!i.includes(c)&&(e=c(e,n),i.push(c))}return e}const fx={name:"attention",resolveAll:Pz,tokenize:Dz};function Pz(t,e){let n=-1,i,r,c,f,a,_,x,S;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&e.sliceSerialize(t[i][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;_=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const R={...t[i][1].end},I={...t[n][1].start};kw(R,-_),kw(I,_),f={type:_>1?"strongSequence":"emphasisSequence",start:R,end:{...t[i][1].end}},a={type:_>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:I},c={type:_>1?"strongText":"emphasisText",start:{...t[i][1].end},end:{...t[n][1].start}},r={type:_>1?"strong":"emphasis",start:{...f.start},end:{...a.end}},t[i][1].end={...f.start},t[n][1].start={...a.end},x=[],t[i][1].end.offset-t[i][1].start.offset&&(x=go(x,[["enter",t[i][1],e],["exit",t[i][1],e]])),x=go(x,[["enter",r,e],["enter",f,e],["exit",f,e],["enter",c,e]]),x=go(x,ny(e.parser.constructs.insideSpan.null,t.slice(i+1,n),e)),x=go(x,[["exit",c,e],["enter",a,e],["exit",a,e],["exit",r,e]]),t[n][1].end.offset-t[n][1].start.offset?(S=2,x=go(x,[["enter",t[n][1],e],["exit",t[n][1],e]])):S=0,Ua(t,i-1,n-i+3,x),n=i+x.length-S-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function Dz(t,e){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,r=Ud(i);let c;return f;function f(_){return c=_,t.enter("attentionSequence"),a(_)}function a(_){if(_===c)return t.consume(_),a;const x=t.exit("attentionSequence"),S=Ud(_),R=!S||S===2&&r||n.includes(_),I=!r||r===2&&S||n.includes(i);return x._open=!!(c===42?R:R&&(r||!I)),x._close=!!(c===42?I:I&&(S||!R)),e(_)}}function kw(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const Oz={name:"autolink",tokenize:Bz};function Bz(t,e,n){let i=0;return r;function r(N){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(N),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),c}function c(N){return na(N)?(t.consume(N),f):N===64?n(N):x(N)}function f(N){return N===43||N===45||N===46||Vs(N)?(i=1,a(N)):x(N)}function a(N){return N===58?(t.consume(N),i=0,_):(N===43||N===45||N===46||Vs(N))&&i++<32?(t.consume(N),a):(i=0,x(N))}function _(N){return N===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(N),t.exit("autolinkMarker"),t.exit("autolink"),e):N===null||N===32||N===60||L_(N)?n(N):(t.consume(N),_)}function x(N){return N===64?(t.consume(N),S):Sz(N)?(t.consume(N),x):n(N)}function S(N){return Vs(N)?R(N):n(N)}function R(N){return N===46?(t.consume(N),i=0,S):N===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(N),t.exit("autolinkMarker"),t.exit("autolink"),e):I(N)}function I(N){if((N===45||Vs(N))&&i++<63){const L=N===45?I:R;return t.consume(N),L}return n(N)}}const Wm={partial:!0,tokenize:Nz};function Nz(t,e,n){return i;function i(c){return Xn(c)?ti(t,r,"linePrefix")(c):r(c)}function r(c){return c===null||cn(c)?e(c):n(c)}}const HS={continuation:{tokenize:Lz},exit:Fz,name:"blockQuote",tokenize:zz};function zz(t,e,n){const i=this;return r;function r(f){if(f===62){const a=i.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(f),t.exit("blockQuoteMarker"),c}return n(f)}function c(f){return Xn(f)?(t.enter("blockQuotePrefixWhitespace"),t.consume(f),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(f))}}function Lz(t,e,n){const i=this;return r;function r(f){return Xn(f)?ti(t,c,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(f):c(f)}function c(f){return t.attempt(HS,e,n)(f)}}function Fz(t){t.exit("blockQuote")}const qS={name:"characterEscape",tokenize:Uz};function Uz(t,e,n){return i;function i(c){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(c),t.exit("escapeMarker"),r}function r(c){return Az(c)?(t.enter("characterEscapeValue"),t.consume(c),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(c)}}const WS={name:"characterReference",tokenize:Vz};function Vz(t,e,n){const i=this;let r=0,c,f;return a;function a(R){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(R),t.exit("characterReferenceMarker"),_}function _(R){return R===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(R),t.exit("characterReferenceMarkerNumeric"),x):(t.enter("characterReferenceValue"),c=31,f=Vs,S(R))}function x(R){return R===88||R===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(R),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),c=6,f=Ez,S):(t.enter("characterReferenceValue"),c=7,f=hx,S(R))}function S(R){if(R===59&&r){const I=t.exit("characterReferenceValue");return f===Vs&&!dv(i.sliceSerialize(I))?n(R):(t.enter("characterReferenceMarker"),t.consume(R),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return f(R)&&r++<c?(t.consume(R),S):n(R)}}const Iw={partial:!0,tokenize:$z},Mw={concrete:!0,name:"codeFenced",tokenize:jz};function jz(t,e,n){const i=this,r={partial:!0,tokenize:_e};let c=0,f=0,a;return _;function _(pe){return x(pe)}function x(pe){const it=i.events[i.events.length-1];return c=it&&it[1].type==="linePrefix"?it[2].sliceSerialize(it[1],!0).length:0,a=pe,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),S(pe)}function S(pe){return pe===a?(f++,t.consume(pe),S):f<3?n(pe):(t.exit("codeFencedFenceSequence"),Xn(pe)?ti(t,R,"whitespace")(pe):R(pe))}function R(pe){return pe===null||cn(pe)?(t.exit("codeFencedFence"),i.interrupt?e(pe):t.check(Iw,H,ge)(pe)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),I(pe))}function I(pe){return pe===null||cn(pe)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),R(pe)):Xn(pe)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),ti(t,N,"whitespace")(pe)):pe===96&&pe===a?n(pe):(t.consume(pe),I)}function N(pe){return pe===null||cn(pe)?R(pe):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),L(pe))}function L(pe){return pe===null||cn(pe)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),R(pe)):pe===96&&pe===a?n(pe):(t.consume(pe),L)}function H(pe){return t.attempt(r,ge,ie)(pe)}function ie(pe){return t.enter("lineEnding"),t.consume(pe),t.exit("lineEnding"),ne}function ne(pe){return c>0&&Xn(pe)?ti(t,he,"linePrefix",c+1)(pe):he(pe)}function he(pe){return pe===null||cn(pe)?t.check(Iw,H,ge)(pe):(t.enter("codeFlowValue"),re(pe))}function re(pe){return pe===null||cn(pe)?(t.exit("codeFlowValue"),he(pe)):(t.consume(pe),re)}function ge(pe){return t.exit("codeFenced"),e(pe)}function _e(pe,it,mt){let nt=0;return Ce;function Ce(lt){return pe.enter("lineEnding"),pe.consume(lt),pe.exit("lineEnding"),ht}function ht(lt){return pe.enter("codeFencedFence"),Xn(lt)?ti(pe,Me,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(lt):Me(lt)}function Me(lt){return lt===a?(pe.enter("codeFencedFenceSequence"),Ve(lt)):mt(lt)}function Ve(lt){return lt===a?(nt++,pe.consume(lt),Ve):nt>=f?(pe.exit("codeFencedFenceSequence"),Xn(lt)?ti(pe,Le,"whitespace")(lt):Le(lt)):mt(lt)}function Le(lt){return lt===null||cn(lt)?(pe.exit("codeFencedFence"),it(lt)):mt(lt)}}}function $z(t,e,n){const i=this;return r;function r(f){return f===null?n(f):(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),c)}function c(f){return i.parser.lazy[i.now().line]?n(f):e(f)}}const db={name:"codeIndented",tokenize:qz},Hz={partial:!0,tokenize:Wz};function qz(t,e,n){const i=this;return r;function r(x){return t.enter("codeIndented"),ti(t,c,"linePrefix",5)(x)}function c(x){const S=i.events[i.events.length-1];return S&&S[1].type==="linePrefix"&&S[2].sliceSerialize(S[1],!0).length>=4?f(x):n(x)}function f(x){return x===null?_(x):cn(x)?t.attempt(Hz,f,_)(x):(t.enter("codeFlowValue"),a(x))}function a(x){return x===null||cn(x)?(t.exit("codeFlowValue"),f(x)):(t.consume(x),a)}function _(x){return t.exit("codeIndented"),e(x)}}function Wz(t,e,n){const i=this;return r;function r(f){return i.parser.lazy[i.now().line]?n(f):cn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),r):ti(t,c,"linePrefix",5)(f)}function c(f){const a=i.events[i.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(f):cn(f)?r(f):n(f)}}const Xz={name:"codeText",previous:Yz,resolve:Zz,tokenize:Gz};function Zz(t){let e=t.length-4,n=3,i,r;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(i=n;++i<e;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(i=n-1,e++;++i<=e;)r===void 0?i!==e&&t[i][1].type!=="lineEnding"&&(r=i):(i===e||t[i][1].type==="lineEnding")&&(t[r][1].type="codeTextData",i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),e-=i-r-2,i=r+2),r=void 0);return t}function Yz(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Gz(t,e,n){let i=0,r,c;return f;function f(R){return t.enter("codeText"),t.enter("codeTextSequence"),a(R)}function a(R){return R===96?(t.consume(R),i++,a):(t.exit("codeTextSequence"),_(R))}function _(R){return R===null?n(R):R===32?(t.enter("space"),t.consume(R),t.exit("space"),_):R===96?(c=t.enter("codeTextSequence"),r=0,S(R)):cn(R)?(t.enter("lineEnding"),t.consume(R),t.exit("lineEnding"),_):(t.enter("codeTextData"),x(R))}function x(R){return R===null||R===32||R===96||cn(R)?(t.exit("codeTextData"),_(R)):(t.consume(R),x)}function S(R){return R===96?(t.consume(R),r++,S):r===i?(t.exit("codeTextSequence"),t.exit("codeText"),e(R)):(c.type="codeTextData",x(R))}}class Kz{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(e,i):e>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(e,n,i){const r=n||0;this.setCursor(Math.trunc(e));const c=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return i&&dm(this.left,i),c.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),dm(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),dm(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);dm(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);dm(this.left,n.reverse())}}}function dm(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function XS(t){const e={};let n=-1,i,r,c,f,a,_,x;const S=new Kz(t);for(;++n<S.length;){for(;n in e;)n=e[n];if(i=S.get(n),n&&i[1].type==="chunkFlow"&&S.get(n-1)[1].type==="listItemPrefix"&&(_=i[1]._tokenizer.events,c=0,c<_.length&&_[c][1].type==="lineEndingBlank"&&(c+=2),c<_.length&&_[c][1].type==="content"))for(;++c<_.length&&_[c][1].type!=="content";)_[c][1].type==="chunkText"&&(_[c][1]._isInFirstContentOfListItem=!0,c++);if(i[0]==="enter")i[1].contentType&&(Object.assign(e,Qz(S,n)),n=e[n],x=!0);else if(i[1]._container){for(c=n,r=void 0;c--;)if(f=S.get(c),f[1].type==="lineEnding"||f[1].type==="lineEndingBlank")f[0]==="enter"&&(r&&(S.get(r)[1].type="lineEndingBlank"),f[1].type="lineEnding",r=c);else if(!(f[1].type==="linePrefix"||f[1].type==="listItemIndent"))break;r&&(i[1].end={...S.get(r)[1].start},a=S.slice(r,n),a.unshift(i),S.splice(r,n-r+1,a))}}return Ua(t,0,Number.POSITIVE_INFINITY,S.slice(0)),!x}function Qz(t,e){const n=t.get(e)[1],i=t.get(e)[2];let r=e-1;const c=[];let f=n._tokenizer;f||(f=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(f._contentTypeTextTrailing=!0));const a=f.events,_=[],x={};let S,R,I=-1,N=n,L=0,H=0;const ie=[H];for(;N;){for(;t.get(++r)[1]!==N;);c.push(r),N._tokenizer||(S=i.sliceStream(N),N.next||S.push(null),R&&f.defineSkip(N.start),N._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=!0),f.write(S),N._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=void 0)),R=N,N=N.next}for(N=n;++I<a.length;)a[I][0]==="exit"&&a[I-1][0]==="enter"&&a[I][1].type===a[I-1][1].type&&a[I][1].start.line!==a[I][1].end.line&&(H=I+1,ie.push(H),N._tokenizer=void 0,N.previous=void 0,N=N.next);for(f.events=[],N?(N._tokenizer=void 0,N.previous=void 0):ie.pop(),I=ie.length;I--;){const ne=a.slice(ie[I],ie[I+1]),he=c.pop();_.push([he,he+ne.length-1]),t.splice(he,2,ne)}for(_.reverse(),I=-1;++I<_.length;)x[L+_[I][0]]=L+_[I][1],L+=_[I][1]-_[I][0]-1;return x}const Jz={resolve:tL,tokenize:nL},eL={partial:!0,tokenize:iL};function tL(t){return XS(t),t}function nL(t,e){let n;return i;function i(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),r(a)}function r(a){return a===null?c(a):cn(a)?t.check(eL,f,c)(a):(t.consume(a),r)}function c(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function f(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}function iL(t,e,n){const i=this;return r;function r(f){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),ti(t,c,"linePrefix")}function c(f){if(f===null||cn(f))return n(f);const a=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(f):t.interrupt(i.parser.constructs.flow,n,e)(f)}}function ZS(t,e,n,i,r,c,f,a,_){const x=_||Number.POSITIVE_INFINITY;let S=0;return R;function R(ne){return ne===60?(t.enter(i),t.enter(r),t.enter(c),t.consume(ne),t.exit(c),I):ne===null||ne===32||ne===41||L_(ne)?n(ne):(t.enter(i),t.enter(f),t.enter(a),t.enter("chunkString",{contentType:"string"}),H(ne))}function I(ne){return ne===62?(t.enter(c),t.consume(ne),t.exit(c),t.exit(r),t.exit(i),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),N(ne))}function N(ne){return ne===62?(t.exit("chunkString"),t.exit(a),I(ne)):ne===null||ne===60||cn(ne)?n(ne):(t.consume(ne),ne===92?L:N)}function L(ne){return ne===60||ne===62||ne===92?(t.consume(ne),N):N(ne)}function H(ne){return!S&&(ne===null||ne===41||Pi(ne))?(t.exit("chunkString"),t.exit(a),t.exit(f),t.exit(i),e(ne)):S<x&&ne===40?(t.consume(ne),S++,H):ne===41?(t.consume(ne),S--,H):ne===null||ne===32||ne===40||L_(ne)?n(ne):(t.consume(ne),ne===92?ie:H)}function ie(ne){return ne===40||ne===41||ne===92?(t.consume(ne),H):H(ne)}}function YS(t,e,n,i,r,c){const f=this;let a=0,_;return x;function x(N){return t.enter(i),t.enter(r),t.consume(N),t.exit(r),t.enter(c),S}function S(N){return a>999||N===null||N===91||N===93&&!_||N===94&&!a&&"_hiddenFootnoteSupport"in f.parser.constructs?n(N):N===93?(t.exit(c),t.enter(r),t.consume(N),t.exit(r),t.exit(i),e):cn(N)?(t.enter("lineEnding"),t.consume(N),t.exit("lineEnding"),S):(t.enter("chunkString",{contentType:"string"}),R(N))}function R(N){return N===null||N===91||N===93||cn(N)||a++>999?(t.exit("chunkString"),S(N)):(t.consume(N),_||(_=!Xn(N)),N===92?I:R)}function I(N){return N===91||N===92||N===93?(t.consume(N),a++,R):R(N)}}function GS(t,e,n,i,r,c){let f;return a;function a(I){return I===34||I===39||I===40?(t.enter(i),t.enter(r),t.consume(I),t.exit(r),f=I===40?41:I,_):n(I)}function _(I){return I===f?(t.enter(r),t.consume(I),t.exit(r),t.exit(i),e):(t.enter(c),x(I))}function x(I){return I===f?(t.exit(c),_(f)):I===null?n(I):cn(I)?(t.enter("lineEnding"),t.consume(I),t.exit("lineEnding"),ti(t,x,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),S(I))}function S(I){return I===f||I===null||cn(I)?(t.exit("chunkString"),x(I)):(t.consume(I),I===92?R:S)}function R(I){return I===f||I===92?(t.consume(I),S):S(I)}}function Rm(t,e){let n;return i;function i(r){return cn(r)?(t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),n=!0,i):Xn(r)?ti(t,i,n?"linePrefix":"lineSuffix")(r):e(r)}}const rL={name:"definition",tokenize:aL},sL={partial:!0,tokenize:oL};function aL(t,e,n){const i=this;let r;return c;function c(N){return t.enter("definition"),f(N)}function f(N){return YS.call(i,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(N)}function a(N){return r=tl(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),N===58?(t.enter("definitionMarker"),t.consume(N),t.exit("definitionMarker"),_):n(N)}function _(N){return Pi(N)?Rm(t,x)(N):x(N)}function x(N){return ZS(t,S,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(N)}function S(N){return t.attempt(sL,R,R)(N)}function R(N){return Xn(N)?ti(t,I,"whitespace")(N):I(N)}function I(N){return N===null||cn(N)?(t.exit("definition"),i.parser.defined.push(r),e(N)):n(N)}}function oL(t,e,n){return i;function i(a){return Pi(a)?Rm(t,r)(a):n(a)}function r(a){return GS(t,c,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function c(a){return Xn(a)?ti(t,f,"whitespace")(a):f(a)}function f(a){return a===null||cn(a)?e(a):n(a)}}const lL={name:"hardBreakEscape",tokenize:cL};function cL(t,e,n){return i;function i(c){return t.enter("hardBreakEscape"),t.consume(c),r}function r(c){return cn(c)?(t.exit("hardBreakEscape"),e(c)):n(c)}}const uL={name:"headingAtx",resolve:hL,tokenize:fL};function hL(t,e){let n=t.length-2,i=3,r,c;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(r={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},c={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Ua(t,i,n-i+1,[["enter",r,e],["enter",c,e],["exit",c,e],["exit",r,e]])),t}function fL(t,e,n){let i=0;return r;function r(S){return t.enter("atxHeading"),c(S)}function c(S){return t.enter("atxHeadingSequence"),f(S)}function f(S){return S===35&&i++<6?(t.consume(S),f):S===null||Pi(S)?(t.exit("atxHeadingSequence"),a(S)):n(S)}function a(S){return S===35?(t.enter("atxHeadingSequence"),_(S)):S===null||cn(S)?(t.exit("atxHeading"),e(S)):Xn(S)?ti(t,a,"whitespace")(S):(t.enter("atxHeadingText"),x(S))}function _(S){return S===35?(t.consume(S),_):(t.exit("atxHeadingSequence"),a(S))}function x(S){return S===null||S===35||Pi(S)?(t.exit("atxHeadingText"),a(S)):(t.consume(S),x)}}const dL=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Pw=["pre","script","style","textarea"],pL={concrete:!0,name:"htmlFlow",resolveTo:_L,tokenize:yL},mL={partial:!0,tokenize:xL},gL={partial:!0,tokenize:bL};function _L(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function yL(t,e,n){const i=this;let r,c,f,a,_;return x;function x(ce){return S(ce)}function S(ce){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(ce),R}function R(ce){return ce===33?(t.consume(ce),I):ce===47?(t.consume(ce),c=!0,H):ce===63?(t.consume(ce),r=3,i.interrupt?e:X):na(ce)?(t.consume(ce),f=String.fromCharCode(ce),ie):n(ce)}function I(ce){return ce===45?(t.consume(ce),r=2,N):ce===91?(t.consume(ce),r=5,a=0,L):na(ce)?(t.consume(ce),r=4,i.interrupt?e:X):n(ce)}function N(ce){return ce===45?(t.consume(ce),i.interrupt?e:X):n(ce)}function L(ce){const zt="CDATA[";return ce===zt.charCodeAt(a++)?(t.consume(ce),a===zt.length?i.interrupt?e:Me:L):n(ce)}function H(ce){return na(ce)?(t.consume(ce),f=String.fromCharCode(ce),ie):n(ce)}function ie(ce){if(ce===null||ce===47||ce===62||Pi(ce)){const zt=ce===47,qt=f.toLowerCase();return!zt&&!c&&Pw.includes(qt)?(r=1,i.interrupt?e(ce):Me(ce)):dL.includes(f.toLowerCase())?(r=6,zt?(t.consume(ce),ne):i.interrupt?e(ce):Me(ce)):(r=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(ce):c?he(ce):re(ce))}return ce===45||Vs(ce)?(t.consume(ce),f+=String.fromCharCode(ce),ie):n(ce)}function ne(ce){return ce===62?(t.consume(ce),i.interrupt?e:Me):n(ce)}function he(ce){return Xn(ce)?(t.consume(ce),he):Ce(ce)}function re(ce){return ce===47?(t.consume(ce),Ce):ce===58||ce===95||na(ce)?(t.consume(ce),ge):Xn(ce)?(t.consume(ce),re):Ce(ce)}function ge(ce){return ce===45||ce===46||ce===58||ce===95||Vs(ce)?(t.consume(ce),ge):_e(ce)}function _e(ce){return ce===61?(t.consume(ce),pe):Xn(ce)?(t.consume(ce),_e):re(ce)}function pe(ce){return ce===null||ce===60||ce===61||ce===62||ce===96?n(ce):ce===34||ce===39?(t.consume(ce),_=ce,it):Xn(ce)?(t.consume(ce),pe):mt(ce)}function it(ce){return ce===_?(t.consume(ce),_=null,nt):ce===null||cn(ce)?n(ce):(t.consume(ce),it)}function mt(ce){return ce===null||ce===34||ce===39||ce===47||ce===60||ce===61||ce===62||ce===96||Pi(ce)?_e(ce):(t.consume(ce),mt)}function nt(ce){return ce===47||ce===62||Xn(ce)?re(ce):n(ce)}function Ce(ce){return ce===62?(t.consume(ce),ht):n(ce)}function ht(ce){return ce===null||cn(ce)?Me(ce):Xn(ce)?(t.consume(ce),ht):n(ce)}function Me(ce){return ce===45&&r===2?(t.consume(ce),we):ce===60&&r===1?(t.consume(ce),Ye):ce===62&&r===4?(t.consume(ce),Ke):ce===63&&r===3?(t.consume(ce),X):ce===93&&r===5?(t.consume(ce),Dt):cn(ce)&&(r===6||r===7)?(t.exit("htmlFlowData"),t.check(mL,Tt,Ve)(ce)):ce===null||cn(ce)?(t.exit("htmlFlowData"),Ve(ce)):(t.consume(ce),Me)}function Ve(ce){return t.check(gL,Le,Tt)(ce)}function Le(ce){return t.enter("lineEnding"),t.consume(ce),t.exit("lineEnding"),lt}function lt(ce){return ce===null||cn(ce)?Ve(ce):(t.enter("htmlFlowData"),Me(ce))}function we(ce){return ce===45?(t.consume(ce),X):Me(ce)}function Ye(ce){return ce===47?(t.consume(ce),f="",gt):Me(ce)}function gt(ce){if(ce===62){const zt=f.toLowerCase();return Pw.includes(zt)?(t.consume(ce),Ke):Me(ce)}return na(ce)&&f.length<8?(t.consume(ce),f+=String.fromCharCode(ce),gt):Me(ce)}function Dt(ce){return ce===93?(t.consume(ce),X):Me(ce)}function X(ce){return ce===62?(t.consume(ce),Ke):ce===45&&r===2?(t.consume(ce),X):Me(ce)}function Ke(ce){return ce===null||cn(ce)?(t.exit("htmlFlowData"),Tt(ce)):(t.consume(ce),Ke)}function Tt(ce){return t.exit("htmlFlow"),e(ce)}}function bL(t,e,n){const i=this;return r;function r(f){return cn(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),c):n(f)}function c(f){return i.parser.lazy[i.now().line]?n(f):e(f)}}function xL(t,e,n){return i;function i(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),t.attempt(Wm,e,n)}}const vL={name:"htmlText",tokenize:wL};function wL(t,e,n){const i=this;let r,c,f;return a;function a(X){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(X),_}function _(X){return X===33?(t.consume(X),x):X===47?(t.consume(X),_e):X===63?(t.consume(X),re):na(X)?(t.consume(X),mt):n(X)}function x(X){return X===45?(t.consume(X),S):X===91?(t.consume(X),c=0,L):na(X)?(t.consume(X),he):n(X)}function S(X){return X===45?(t.consume(X),N):n(X)}function R(X){return X===null?n(X):X===45?(t.consume(X),I):cn(X)?(f=R,Ye(X)):(t.consume(X),R)}function I(X){return X===45?(t.consume(X),N):R(X)}function N(X){return X===62?we(X):X===45?I(X):R(X)}function L(X){const Ke="CDATA[";return X===Ke.charCodeAt(c++)?(t.consume(X),c===Ke.length?H:L):n(X)}function H(X){return X===null?n(X):X===93?(t.consume(X),ie):cn(X)?(f=H,Ye(X)):(t.consume(X),H)}function ie(X){return X===93?(t.consume(X),ne):H(X)}function ne(X){return X===62?we(X):X===93?(t.consume(X),ne):H(X)}function he(X){return X===null||X===62?we(X):cn(X)?(f=he,Ye(X)):(t.consume(X),he)}function re(X){return X===null?n(X):X===63?(t.consume(X),ge):cn(X)?(f=re,Ye(X)):(t.consume(X),re)}function ge(X){return X===62?we(X):re(X)}function _e(X){return na(X)?(t.consume(X),pe):n(X)}function pe(X){return X===45||Vs(X)?(t.consume(X),pe):it(X)}function it(X){return cn(X)?(f=it,Ye(X)):Xn(X)?(t.consume(X),it):we(X)}function mt(X){return X===45||Vs(X)?(t.consume(X),mt):X===47||X===62||Pi(X)?nt(X):n(X)}function nt(X){return X===47?(t.consume(X),we):X===58||X===95||na(X)?(t.consume(X),Ce):cn(X)?(f=nt,Ye(X)):Xn(X)?(t.consume(X),nt):we(X)}function Ce(X){return X===45||X===46||X===58||X===95||Vs(X)?(t.consume(X),Ce):ht(X)}function ht(X){return X===61?(t.consume(X),Me):cn(X)?(f=ht,Ye(X)):Xn(X)?(t.consume(X),ht):nt(X)}function Me(X){return X===null||X===60||X===61||X===62||X===96?n(X):X===34||X===39?(t.consume(X),r=X,Ve):cn(X)?(f=Me,Ye(X)):Xn(X)?(t.consume(X),Me):(t.consume(X),Le)}function Ve(X){return X===r?(t.consume(X),r=void 0,lt):X===null?n(X):cn(X)?(f=Ve,Ye(X)):(t.consume(X),Ve)}function Le(X){return X===null||X===34||X===39||X===60||X===61||X===96?n(X):X===47||X===62||Pi(X)?nt(X):(t.consume(X),Le)}function lt(X){return X===47||X===62||Pi(X)?nt(X):n(X)}function we(X){return X===62?(t.consume(X),t.exit("htmlTextData"),t.exit("htmlText"),e):n(X)}function Ye(X){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(X),t.exit("lineEnding"),gt}function gt(X){return Xn(X)?ti(t,Dt,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(X):Dt(X)}function Dt(X){return t.enter("htmlTextData"),f(X)}}const pv={name:"labelEnd",resolveAll:AL,resolveTo:CL,tokenize:RL},TL={tokenize:kL},SL={tokenize:IL},EL={tokenize:ML};function AL(t){let e=-1;const n=[];for(;++e<t.length;){const i=t[e][1];if(n.push(t[e]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const r=i.type==="labelImage"?4:2;i.type="data",e+=r}}return t.length!==n.length&&Ua(t,0,t.length,n),t}function CL(t,e){let n=t.length,i=0,r,c,f,a;for(;n--;)if(r=t[n][1],c){if(r.type==="link"||r.type==="labelLink"&&r._inactive)break;t[n][0]==="enter"&&r.type==="labelLink"&&(r._inactive=!0)}else if(f){if(t[n][0]==="enter"&&(r.type==="labelImage"||r.type==="labelLink")&&!r._balanced&&(c=n,r.type!=="labelLink")){i=2;break}}else r.type==="labelEnd"&&(f=n);const _={type:t[c][1].type==="labelLink"?"link":"image",start:{...t[c][1].start},end:{...t[t.length-1][1].end}},x={type:"label",start:{...t[c][1].start},end:{...t[f][1].end}},S={type:"labelText",start:{...t[c+i+2][1].end},end:{...t[f-2][1].start}};return a=[["enter",_,e],["enter",x,e]],a=go(a,t.slice(c+1,c+i+3)),a=go(a,[["enter",S,e]]),a=go(a,ny(e.parser.constructs.insideSpan.null,t.slice(c+i+4,f-3),e)),a=go(a,[["exit",S,e],t[f-2],t[f-1],["exit",x,e]]),a=go(a,t.slice(f+1)),a=go(a,[["exit",_,e]]),Ua(t,c,t.length,a),t}function RL(t,e,n){const i=this;let r=i.events.length,c,f;for(;r--;)if((i.events[r][1].type==="labelImage"||i.events[r][1].type==="labelLink")&&!i.events[r][1]._balanced){c=i.events[r][1];break}return a;function a(I){return c?c._inactive?R(I):(f=i.parser.defined.includes(tl(i.sliceSerialize({start:c.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(I),t.exit("labelMarker"),t.exit("labelEnd"),_):n(I)}function _(I){return I===40?t.attempt(TL,S,f?S:R)(I):I===91?t.attempt(SL,S,f?x:R)(I):f?S(I):R(I)}function x(I){return t.attempt(EL,S,R)(I)}function S(I){return e(I)}function R(I){return c._balanced=!0,n(I)}}function kL(t,e,n){return i;function i(R){return t.enter("resource"),t.enter("resourceMarker"),t.consume(R),t.exit("resourceMarker"),r}function r(R){return Pi(R)?Rm(t,c)(R):c(R)}function c(R){return R===41?S(R):ZS(t,f,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(R)}function f(R){return Pi(R)?Rm(t,_)(R):S(R)}function a(R){return n(R)}function _(R){return R===34||R===39||R===40?GS(t,x,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(R):S(R)}function x(R){return Pi(R)?Rm(t,S)(R):S(R)}function S(R){return R===41?(t.enter("resourceMarker"),t.consume(R),t.exit("resourceMarker"),t.exit("resource"),e):n(R)}}function IL(t,e,n){const i=this;return r;function r(a){return YS.call(i,t,c,f,"reference","referenceMarker","referenceString")(a)}function c(a){return i.parser.defined.includes(tl(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function f(a){return n(a)}}function ML(t,e,n){return i;function i(c){return t.enter("reference"),t.enter("referenceMarker"),t.consume(c),t.exit("referenceMarker"),r}function r(c){return c===93?(t.enter("referenceMarker"),t.consume(c),t.exit("referenceMarker"),t.exit("reference"),e):n(c)}}const PL={name:"labelStartImage",resolveAll:pv.resolveAll,tokenize:DL};function DL(t,e,n){const i=this;return r;function r(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),c}function c(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),f):n(a)}function f(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):e(a)}}const OL={name:"labelStartLink",resolveAll:pv.resolveAll,tokenize:BL};function BL(t,e,n){const i=this;return r;function r(f){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(f),t.exit("labelMarker"),t.exit("labelLink"),c}function c(f){return f===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(f):e(f)}}const pb={name:"lineEnding",tokenize:NL};function NL(t,e){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),ti(t,e,"linePrefix")}}const p_={name:"thematicBreak",tokenize:zL};function zL(t,e,n){let i=0,r;return c;function c(x){return t.enter("thematicBreak"),f(x)}function f(x){return r=x,a(x)}function a(x){return x===r?(t.enter("thematicBreakSequence"),_(x)):i>=3&&(x===null||cn(x))?(t.exit("thematicBreak"),e(x)):n(x)}function _(x){return x===r?(t.consume(x),i++,_):(t.exit("thematicBreakSequence"),Xn(x)?ti(t,a,"whitespace")(x):a(x))}}const va={continuation:{tokenize:VL},exit:$L,name:"list",tokenize:UL},LL={partial:!0,tokenize:HL},FL={partial:!0,tokenize:jL};function UL(t,e,n){const i=this,r=i.events[i.events.length-1];let c=r&&r[1].type==="linePrefix"?r[2].sliceSerialize(r[1],!0).length:0,f=0;return a;function a(N){const L=i.containerState.type||(N===42||N===43||N===45?"listUnordered":"listOrdered");if(L==="listUnordered"?!i.containerState.marker||N===i.containerState.marker:hx(N)){if(i.containerState.type||(i.containerState.type=L,t.enter(L,{_container:!0})),L==="listUnordered")return t.enter("listItemPrefix"),N===42||N===45?t.check(p_,n,x)(N):x(N);if(!i.interrupt||N===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),_(N)}return n(N)}function _(N){return hx(N)&&++f<10?(t.consume(N),_):(!i.interrupt||f<2)&&(i.containerState.marker?N===i.containerState.marker:N===41||N===46)?(t.exit("listItemValue"),x(N)):n(N)}function x(N){return t.enter("listItemMarker"),t.consume(N),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||N,t.check(Wm,i.interrupt?n:S,t.attempt(LL,I,R))}function S(N){return i.containerState.initialBlankLine=!0,c++,I(N)}function R(N){return Xn(N)?(t.enter("listItemPrefixWhitespace"),t.consume(N),t.exit("listItemPrefixWhitespace"),I):n(N)}function I(N){return i.containerState.size=c+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(N)}}function VL(t,e,n){const i=this;return i.containerState._closeFlow=void 0,t.check(Wm,r,c);function r(a){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,ti(t,e,"listItemIndent",i.containerState.size+1)(a)}function c(a){return i.containerState.furtherBlankLines||!Xn(a)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,f(a)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(FL,e,f)(a))}function f(a){return i.containerState._closeFlow=!0,i.interrupt=void 0,ti(t,t.attempt(va,e,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function jL(t,e,n){const i=this;return ti(t,r,"listItemIndent",i.containerState.size+1);function r(c){const f=i.events[i.events.length-1];return f&&f[1].type==="listItemIndent"&&f[2].sliceSerialize(f[1],!0).length===i.containerState.size?e(c):n(c)}}function $L(t){t.exit(this.containerState.type)}function HL(t,e,n){const i=this;return ti(t,r,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function r(c){const f=i.events[i.events.length-1];return!Xn(c)&&f&&f[1].type==="listItemPrefixWhitespace"?e(c):n(c)}}const Dw={name:"setextUnderline",resolveTo:qL,tokenize:WL};function qL(t,e){let n=t.length,i,r,c;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(r=n)}else t[n][1].type==="content"&&t.splice(n,1),!c&&t[n][1].type==="definition"&&(c=n);const f={type:"setextHeading",start:{...t[i][1].start},end:{...t[t.length-1][1].end}};return t[r][1].type="setextHeadingText",c?(t.splice(r,0,["enter",f,e]),t.splice(c+1,0,["exit",t[i][1],e]),t[i][1].end={...t[c][1].end}):t[i][1]=f,t.push(["exit",f,e]),t}function WL(t,e,n){const i=this;let r;return c;function c(x){let S=i.events.length,R;for(;S--;)if(i.events[S][1].type!=="lineEnding"&&i.events[S][1].type!=="linePrefix"&&i.events[S][1].type!=="content"){R=i.events[S][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||R)?(t.enter("setextHeadingLine"),r=x,f(x)):n(x)}function f(x){return t.enter("setextHeadingLineSequence"),a(x)}function a(x){return x===r?(t.consume(x),a):(t.exit("setextHeadingLineSequence"),Xn(x)?ti(t,_,"lineSuffix")(x):_(x))}function _(x){return x===null||cn(x)?(t.exit("setextHeadingLine"),e(x)):n(x)}}const XL={tokenize:ZL};function ZL(t){const e=this,n=t.attempt(Wm,i,t.attempt(this.parser.constructs.flowInitial,r,ti(t,t.attempt(this.parser.constructs.flow,r,t.attempt(Jz,r)),"linePrefix")));return n;function i(c){if(c===null){t.consume(c);return}return t.enter("lineEndingBlank"),t.consume(c),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function r(c){if(c===null){t.consume(c);return}return t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const YL={resolveAll:QS()},GL=KS("string"),KL=KS("text");function KS(t){return{resolveAll:QS(t==="text"?QL:void 0),tokenize:e};function e(n){const i=this,r=this.parser.constructs[t],c=n.attempt(r,f,a);return f;function f(S){return x(S)?c(S):a(S)}function a(S){if(S===null){n.consume(S);return}return n.enter("data"),n.consume(S),_}function _(S){return x(S)?(n.exit("data"),c(S)):(n.consume(S),_)}function x(S){if(S===null)return!0;const R=r[S];let I=-1;if(R)for(;++I<R.length;){const N=R[I];if(!N.previous||N.previous.call(i,i.previous))return!0}return!1}}}function QS(t){return e;function e(n,i){let r=-1,c;for(;++r<=n.length;)c===void 0?n[r]&&n[r][1].type==="data"&&(c=r,r++):(!n[r]||n[r][1].type!=="data")&&(r!==c+2&&(n[c][1].end=n[r-1][1].end,n.splice(c+2,r-c-2),r=c+2),c=void 0);return t?t(n,i):n}}function QL(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],r=e.sliceStream(i);let c=r.length,f=-1,a=0,_;for(;c--;){const x=r[c];if(typeof x=="string"){for(f=x.length;x.charCodeAt(f-1)===32;)a++,f--;if(f)break;f=-1}else if(x===-2)_=!0,a++;else if(x!==-1){c++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const x={type:n===t.length||_||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:c?f:i.start._bufferIndex+f,_index:i.start._index+c,line:i.end.line,column:i.end.column-a,offset:i.end.offset-a},end:{...i.end}};i.end={...x.start},i.start.offset===i.end.offset?Object.assign(i,x):(t.splice(n,0,["enter",x,e],["exit",x,e]),n+=2)}n++}return t}const JL={42:va,43:va,45:va,48:va,49:va,50:va,51:va,52:va,53:va,54:va,55:va,56:va,57:va,62:HS},eF={91:rL},tF={[-2]:db,[-1]:db,32:db},nF={35:uL,42:p_,45:[Dw,p_],60:pL,61:Dw,95:p_,96:Mw,126:Mw},iF={38:WS,92:qS},rF={[-5]:pb,[-4]:pb,[-3]:pb,33:PL,38:WS,42:fx,60:[Oz,vL],91:OL,92:[lL,qS],93:pv,95:fx,96:Xz},sF={null:[fx,YL]},aF={null:[42,95]},oF={null:[]},lF=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:aF,contentInitial:eF,disable:oF,document:JL,flow:nF,flowInitial:tF,insideSpan:sF,string:iF,text:rF},Symbol.toStringTag,{value:"Module"}));function cF(t,e,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const r={},c=[];let f=[],a=[];const _={attempt:it(_e),check:it(pe),consume:he,enter:re,exit:ge,interrupt:it(pe,{interrupt:!0})},x={code:null,containerState:{},defineSkip:H,events:[],now:L,parser:t,previous:null,sliceSerialize:I,sliceStream:N,write:R};let S=e.tokenize.call(x,_);return e.resolveAll&&c.push(e),x;function R(ht){return f=go(f,ht),ie(),f[f.length-1]!==null?[]:(mt(e,0),x.events=ny(c,x.events,x),x.events)}function I(ht,Me){return hF(N(ht),Me)}function N(ht){return uF(f,ht)}function L(){const{_bufferIndex:ht,_index:Me,line:Ve,column:Le,offset:lt}=i;return{_bufferIndex:ht,_index:Me,line:Ve,column:Le,offset:lt}}function H(ht){r[ht.line]=ht.column,Ce()}function ie(){let ht;for(;i._index<f.length;){const Me=f[i._index];if(typeof Me=="string")for(ht=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===ht&&i._bufferIndex<Me.length;)ne(Me.charCodeAt(i._bufferIndex));else ne(Me)}}function ne(ht){S=S(ht)}function he(ht){cn(ht)?(i.line++,i.column=1,i.offset+=ht===-3?2:1,Ce()):ht!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===f[i._index].length&&(i._bufferIndex=-1,i._index++)),x.previous=ht}function re(ht,Me){const Ve=Me||{};return Ve.type=ht,Ve.start=L(),x.events.push(["enter",Ve,x]),a.push(Ve),Ve}function ge(ht){const Me=a.pop();return Me.end=L(),x.events.push(["exit",Me,x]),Me}function _e(ht,Me){mt(ht,Me.from)}function pe(ht,Me){Me.restore()}function it(ht,Me){return Ve;function Ve(Le,lt,we){let Ye,gt,Dt,X;return Array.isArray(Le)?Tt(Le):"tokenize"in Le?Tt([Le]):Ke(Le);function Ke(Ot){return Fn;function Fn(vn){const Qn=vn!==null&&Ot[vn],Yi=vn!==null&&Ot.null,Pr=[...Array.isArray(Qn)?Qn:Qn?[Qn]:[],...Array.isArray(Yi)?Yi:Yi?[Yi]:[]];return Tt(Pr)(vn)}}function Tt(Ot){return Ye=Ot,gt=0,Ot.length===0?we:ce(Ot[gt])}function ce(Ot){return Fn;function Fn(vn){return X=nt(),Dt=Ot,Ot.partial||(x.currentConstruct=Ot),Ot.name&&x.parser.constructs.disable.null.includes(Ot.name)?qt():Ot.tokenize.call(Me?Object.assign(Object.create(x),Me):x,_,zt,qt)(vn)}}function zt(Ot){return ht(Dt,X),lt}function qt(Ot){return X.restore(),++gt<Ye.length?ce(Ye[gt]):we}}}function mt(ht,Me){ht.resolveAll&&!c.includes(ht)&&c.push(ht),ht.resolve&&Ua(x.events,Me,x.events.length-Me,ht.resolve(x.events.slice(Me),x)),ht.resolveTo&&(x.events=ht.resolveTo(x.events,x))}function nt(){const ht=L(),Me=x.previous,Ve=x.currentConstruct,Le=x.events.length,lt=Array.from(a);return{from:Le,restore:we};function we(){i=ht,x.previous=Me,x.currentConstruct=Ve,x.events.length=Le,a=lt,Ce()}}function Ce(){i.line in r&&i.column<2&&(i.column=r[i.line],i.offset+=r[i.line]-1)}}function uF(t,e){const n=e.start._index,i=e.start._bufferIndex,r=e.end._index,c=e.end._bufferIndex;let f;if(n===r)f=[t[n].slice(i,c)];else{if(f=t.slice(n,r),i>-1){const a=f[0];typeof a=="string"?f[0]=a.slice(i):f.shift()}c>0&&f.push(t[r].slice(0,c))}return f}function hF(t,e){let n=-1;const i=[];let r;for(;++n<t.length;){const c=t[n];let f;if(typeof c=="string")f=c;else switch(c){case-5:{f="\r";break}case-4:{f=`
`;break}case-3:{f=`\r
`;break}case-2:{f=e?" ":"	";break}case-1:{if(!e&&r)continue;f=" ";break}default:f=String.fromCharCode(c)}r=c===-2,i.push(f)}return i.join("")}function fF(t){const i={constructs:jS([lF,...(t||{}).extensions||[]]),content:r(Cz),defined:[],document:r(kz),flow:r(XL),lazy:{},string:r(GL),text:r(KL)};return i;function r(c){return f;function f(a){return cF(i,c,a)}}}function dF(t){for(;!XS(t););return t}const Ow=/[\0\t\n\r]/g;function pF(){let t=1,e="",n=!0,i;return r;function r(c,f,a){const _=[];let x,S,R,I,N;for(c=e+(typeof c=="string"?c.toString():new TextDecoder(f||void 0).decode(c)),R=0,e="",n&&(c.charCodeAt(0)===65279&&R++,n=void 0);R<c.length;){if(Ow.lastIndex=R,x=Ow.exec(c),I=x&&x.index!==void 0?x.index:c.length,N=c.charCodeAt(I),!x){e=c.slice(R);break}if(N===10&&R===I&&i)_.push(-3),i=void 0;else switch(i&&(_.push(-5),i=void 0),R<I&&(_.push(c.slice(R,I)),t+=I-R),N){case 0:{_.push(65533),t++;break}case 9:{for(S=Math.ceil(t/4)*4,_.push(-2);t++<S;)_.push(-1);break}case 10:{_.push(-4),t=1;break}default:i=!0,t=1}R=I+1}return a&&(i&&_.push(-5),e&&_.push(e),_.push(null)),_}}const mF=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function gF(t){return t.replace(mF,_F)}function _F(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const r=n.charCodeAt(1),c=r===120||r===88;return $S(n.slice(c?2:1),c?16:10)}return dv(n)||t}const JS={}.hasOwnProperty;function yF(t,e,n){return typeof e!="string"&&(n=e,e=void 0),bF(n)(dF(fF(n).document().write(pF()(t,e,!0))))}function bF(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:c(wn),autolinkProtocol:nt,autolinkEmail:nt,atxHeading:c(nr),blockQuote:c(Yi),characterEscape:nt,characterReference:nt,codeFenced:c(Pr),codeFencedFenceInfo:f,codeFencedFenceMeta:f,codeIndented:c(Pr,f),codeText:c(Sr,f),codeTextData:nt,data:nt,codeFlowValue:nt,definition:c(tr),definitionDestinationString:f,definitionLabelString:f,definitionTitleString:f,emphasis:c(ia),hardBreakEscape:c(xs),hardBreakTrailing:c(xs),htmlFlow:c(ir,f),htmlFlowData:nt,htmlText:c(ir,f),htmlTextData:nt,image:c($s),label:f,link:c(wn),listItem:c(ra),listItemValue:I,listOrdered:c(qr,R),listUnordered:c(qr),paragraph:c(sa),reference:ce,referenceString:f,resourceDestinationString:f,resourceTitleString:f,setextHeading:c(nr),strong:c(Ta),thematicBreak:c(aa)},exit:{atxHeading:_(),atxHeadingSequence:_e,autolink:_(),autolinkEmail:Qn,autolinkProtocol:vn,blockQuote:_(),characterEscapeValue:Ce,characterReferenceMarkerHexadecimal:qt,characterReferenceMarkerNumeric:qt,characterReferenceValue:Ot,characterReference:Fn,codeFenced:_(ie),codeFencedFence:H,codeFencedFenceInfo:N,codeFencedFenceMeta:L,codeFlowValue:Ce,codeIndented:_(ne),codeText:_(lt),codeTextData:Ce,data:Ce,definition:_(),definitionDestinationString:ge,definitionLabelString:he,definitionTitleString:re,emphasis:_(),hardBreakEscape:_(Me),hardBreakTrailing:_(Me),htmlFlow:_(Ve),htmlFlowData:Ce,htmlText:_(Le),htmlTextData:Ce,image:_(Ye),label:Dt,labelText:gt,lineEnding:ht,link:_(we),listItem:_(),listOrdered:_(),listUnordered:_(),paragraph:_(),referenceString:zt,resourceDestinationString:X,resourceTitleString:Ke,resource:Tt,setextHeading:_(mt),setextHeadingLineSequence:it,setextHeadingText:pe,strong:_(),thematicBreak:_()}};eE(e,(t||{}).mdastExtensions||[]);const n={};return i;function i(ft){let Ee={type:"root",children:[]};const at={stack:[Ee],tokenStack:[],config:e,enter:a,exit:x,buffer:f,resume:S,data:n},nn=[];let Cn=-1;for(;++Cn<ft.length;)if(ft[Cn][1].type==="listOrdered"||ft[Cn][1].type==="listUnordered")if(ft[Cn][0]==="enter")nn.push(Cn);else{const Mn=nn.pop();Cn=r(ft,Mn,Cn)}for(Cn=-1;++Cn<ft.length;){const Mn=e[ft[Cn][0]];JS.call(Mn,ft[Cn][1].type)&&Mn[ft[Cn][1].type].call(Object.assign({sliceSerialize:ft[Cn][2].sliceSerialize},at),ft[Cn][1])}if(at.tokenStack.length>0){const Mn=at.tokenStack[at.tokenStack.length-1];(Mn[1]||Bw).call(at,void 0,Mn[0])}for(Ee.position={start:$u(ft.length>0?ft[0][1].start:{line:1,column:1,offset:0}),end:$u(ft.length>0?ft[ft.length-2][1].end:{line:1,column:1,offset:0})},Cn=-1;++Cn<e.transforms.length;)Ee=e.transforms[Cn](Ee)||Ee;return Ee}function r(ft,Ee,at){let nn=Ee-1,Cn=-1,Mn=!1,Jn,ri,Wr,li;for(;++nn<=at;){const wt=ft[nn];switch(wt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{wt[0]==="enter"?Cn++:Cn--,li=void 0;break}case"lineEndingBlank":{wt[0]==="enter"&&(Jn&&!li&&!Cn&&!Wr&&(Wr=nn),li=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:li=void 0}if(!Cn&&wt[0]==="enter"&&wt[1].type==="listItemPrefix"||Cn===-1&&wt[0]==="exit"&&(wt[1].type==="listUnordered"||wt[1].type==="listOrdered")){if(Jn){let rn=nn;for(ri=void 0;rn--;){const tn=ft[rn];if(tn[1].type==="lineEnding"||tn[1].type==="lineEndingBlank"){if(tn[0]==="exit")continue;ri&&(ft[ri][1].type="lineEndingBlank",Mn=!0),tn[1].type="lineEnding",ri=rn}else if(!(tn[1].type==="linePrefix"||tn[1].type==="blockQuotePrefix"||tn[1].type==="blockQuotePrefixWhitespace"||tn[1].type==="blockQuoteMarker"||tn[1].type==="listItemIndent"))break}Wr&&(!ri||Wr<ri)&&(Jn._spread=!0),Jn.end=Object.assign({},ri?ft[ri][1].start:wt[1].end),ft.splice(ri||nn,0,["exit",Jn,wt[2]]),nn++,at++}if(wt[1].type==="listItemPrefix"){const rn={type:"listItem",_spread:!1,start:Object.assign({},wt[1].start),end:void 0};Jn=rn,ft.splice(nn,0,["enter",rn,wt[2]]),nn++,at++,Wr=void 0,li=!0}}}return ft[Ee][1]._spread=Mn,at}function c(ft,Ee){return at;function at(nn){a.call(this,ft(nn),nn),Ee&&Ee.call(this,nn)}}function f(){this.stack.push({type:"fragment",children:[]})}function a(ft,Ee,at){this.stack[this.stack.length-1].children.push(ft),this.stack.push(ft),this.tokenStack.push([Ee,at||void 0]),ft.position={start:$u(Ee.start),end:void 0}}function _(ft){return Ee;function Ee(at){ft&&ft.call(this,at),x.call(this,at)}}function x(ft,Ee){const at=this.stack.pop(),nn=this.tokenStack.pop();if(nn)nn[0].type!==ft.type&&(Ee?Ee.call(this,ft,nn[0]):(nn[1]||Bw).call(this,ft,nn[0]));else throw new Error("Cannot close `"+ft.type+"` ("+Cm({start:ft.start,end:ft.end})+"): its not open");at.position.end=$u(ft.end)}function S(){return fv(this.stack.pop())}function R(){this.data.expectingFirstListItemValue=!0}function I(ft){if(this.data.expectingFirstListItemValue){const Ee=this.stack[this.stack.length-2];Ee.start=Number.parseInt(this.sliceSerialize(ft),10),this.data.expectingFirstListItemValue=void 0}}function N(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.lang=ft}function L(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.meta=ft}function H(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function ie(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.value=ft.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function ne(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.value=ft.replace(/(\r?\n|\r)$/g,"")}function he(ft){const Ee=this.resume(),at=this.stack[this.stack.length-1];at.label=Ee,at.identifier=tl(this.sliceSerialize(ft)).toLowerCase()}function re(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.title=ft}function ge(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.url=ft}function _e(ft){const Ee=this.stack[this.stack.length-1];if(!Ee.depth){const at=this.sliceSerialize(ft).length;Ee.depth=at}}function pe(){this.data.setextHeadingSlurpLineEnding=!0}function it(ft){const Ee=this.stack[this.stack.length-1];Ee.depth=this.sliceSerialize(ft).codePointAt(0)===61?1:2}function mt(){this.data.setextHeadingSlurpLineEnding=void 0}function nt(ft){const at=this.stack[this.stack.length-1].children;let nn=at[at.length-1];(!nn||nn.type!=="text")&&(nn=vs(),nn.position={start:$u(ft.start),end:void 0},at.push(nn)),this.stack.push(nn)}function Ce(ft){const Ee=this.stack.pop();Ee.value+=this.sliceSerialize(ft),Ee.position.end=$u(ft.end)}function ht(ft){const Ee=this.stack[this.stack.length-1];if(this.data.atHardBreak){const at=Ee.children[Ee.children.length-1];at.position.end=$u(ft.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Ee.type)&&(nt.call(this,ft),Ce.call(this,ft))}function Me(){this.data.atHardBreak=!0}function Ve(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.value=ft}function Le(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.value=ft}function lt(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.value=ft}function we(){const ft=this.stack[this.stack.length-1];if(this.data.inReference){const Ee=this.data.referenceType||"shortcut";ft.type+="Reference",ft.referenceType=Ee,delete ft.url,delete ft.title}else delete ft.identifier,delete ft.label;this.data.referenceType=void 0}function Ye(){const ft=this.stack[this.stack.length-1];if(this.data.inReference){const Ee=this.data.referenceType||"shortcut";ft.type+="Reference",ft.referenceType=Ee,delete ft.url,delete ft.title}else delete ft.identifier,delete ft.label;this.data.referenceType=void 0}function gt(ft){const Ee=this.sliceSerialize(ft),at=this.stack[this.stack.length-2];at.label=gF(Ee),at.identifier=tl(Ee).toLowerCase()}function Dt(){const ft=this.stack[this.stack.length-1],Ee=this.resume(),at=this.stack[this.stack.length-1];if(this.data.inReference=!0,at.type==="link"){const nn=ft.children;at.children=nn}else at.alt=Ee}function X(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.url=ft}function Ke(){const ft=this.resume(),Ee=this.stack[this.stack.length-1];Ee.title=ft}function Tt(){this.data.inReference=void 0}function ce(){this.data.referenceType="collapsed"}function zt(ft){const Ee=this.resume(),at=this.stack[this.stack.length-1];at.label=Ee,at.identifier=tl(this.sliceSerialize(ft)).toLowerCase(),this.data.referenceType="full"}function qt(ft){this.data.characterReferenceType=ft.type}function Ot(ft){const Ee=this.sliceSerialize(ft),at=this.data.characterReferenceType;let nn;at?(nn=$S(Ee,at==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):nn=dv(Ee);const Cn=this.stack[this.stack.length-1];Cn.value+=nn}function Fn(ft){const Ee=this.stack.pop();Ee.position.end=$u(ft.end)}function vn(ft){Ce.call(this,ft);const Ee=this.stack[this.stack.length-1];Ee.url=this.sliceSerialize(ft)}function Qn(ft){Ce.call(this,ft);const Ee=this.stack[this.stack.length-1];Ee.url="mailto:"+this.sliceSerialize(ft)}function Yi(){return{type:"blockquote",children:[]}}function Pr(){return{type:"code",lang:null,meta:null,value:""}}function Sr(){return{type:"inlineCode",value:""}}function tr(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function ia(){return{type:"emphasis",children:[]}}function nr(){return{type:"heading",depth:0,children:[]}}function xs(){return{type:"break"}}function ir(){return{type:"html",value:""}}function $s(){return{type:"image",title:null,url:"",alt:null}}function wn(){return{type:"link",title:null,url:"",children:[]}}function qr(ft){return{type:"list",ordered:ft.type==="listOrdered",start:null,spread:ft._spread,children:[]}}function ra(ft){return{type:"listItem",spread:ft._spread,checked:null,children:[]}}function sa(){return{type:"paragraph",children:[]}}function Ta(){return{type:"strong",children:[]}}function vs(){return{type:"text",value:""}}function aa(){return{type:"thematicBreak"}}}function $u(t){return{line:t.line,column:t.column,offset:t.offset}}function eE(t,e){let n=-1;for(;++n<e.length;){const i=e[n];Array.isArray(i)?eE(t,i):xF(t,i)}}function xF(t,e){let n;for(n in e)if(JS.call(e,n))switch(n){case"canContainEols":{const i=e[n];i&&t[n].push(...i);break}case"transforms":{const i=e[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=e[n];i&&Object.assign(t[n],i);break}}}function Bw(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Cm({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Cm({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Cm({start:e.start,end:e.end})+") is still open")}function vF(t){const e=this;e.parser=n;function n(i){return yF(i,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function wF(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function TF(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function SF(t,e){const n=e.value?e.value+`
`:"",i={};e.lang&&(i.className=["language-"+e.lang]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return e.meta&&(r.data={meta:e.meta}),t.patch(e,r),r=t.applyData(e,r),r={type:"element",tagName:"pre",properties:{},children:[r]},t.patch(e,r),r}function EF(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function AF(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function CF(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(e.identifier).toUpperCase(),r=$d(i.toLowerCase()),c=t.footnoteOrder.indexOf(i);let f,a=t.footnoteCounts.get(i);a===void 0?(a=0,t.footnoteOrder.push(i),f=t.footnoteOrder.length):f=c+1,a+=1,t.footnoteCounts.set(i,a);const _={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+r,id:n+"fnref-"+r+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(f)}]};t.patch(e,_);const x={type:"element",tagName:"sup",properties:{},children:[_]};return t.patch(e,x),t.applyData(e,x)}function RF(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function kF(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function tE(t,e){const n=e.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+i}];const r=t.all(e),c=r[0];c&&c.type==="text"?c.value="["+c.value:r.unshift({type:"text",value:"["});const f=r[r.length-1];return f&&f.type==="text"?f.value+=i:r.push({type:"text",value:i}),r}function IF(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return tE(t,e);const r={src:$d(i.url||""),alt:e.alt};i.title!==null&&i.title!==void 0&&(r.title=i.title);const c={type:"element",tagName:"img",properties:r,children:[]};return t.patch(e,c),t.applyData(e,c)}function MF(t,e){const n={src:$d(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,i),t.applyData(e,i)}function PF(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,i),t.applyData(e,i)}function DF(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return tE(t,e);const r={href:$d(i.url||"")};i.title!==null&&i.title!==void 0&&(r.title=i.title);const c={type:"element",tagName:"a",properties:r,children:t.all(e)};return t.patch(e,c),t.applyData(e,c)}function OF(t,e){const n={href:$d(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function BF(t,e,n){const i=t.all(e),r=n?NF(n):nE(e),c={},f=[];if(typeof e.checked=="boolean"){const S=i[0];let R;S&&S.type==="element"&&S.tagName==="p"?R=S:(R={type:"element",tagName:"p",properties:{},children:[]},i.unshift(R)),R.children.length>0&&R.children.unshift({type:"text",value:" "}),R.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),c.className=["task-list-item"]}let a=-1;for(;++a<i.length;){const S=i[a];(r||a!==0||S.type!=="element"||S.tagName!=="p")&&f.push({type:"text",value:`
`}),S.type==="element"&&S.tagName==="p"&&!r?f.push(...S.children):f.push(S)}const _=i[i.length-1];_&&(r||_.type!=="element"||_.tagName!=="p")&&f.push({type:"text",value:`
`});const x={type:"element",tagName:"li",properties:c,children:f};return t.patch(e,x),t.applyData(e,x)}function NF(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let i=-1;for(;!e&&++i<n.length;)e=nE(n[i])}return e}function nE(t){const e=t.spread;return e??t.children.length>1}function zF(t,e){const n={},i=t.all(e);let r=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++r<i.length;){const f=i[r];if(f.type==="element"&&f.tagName==="li"&&f.properties&&Array.isArray(f.properties.className)&&f.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const c={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(e,c),t.applyData(e,c)}function LF(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function FF(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function UF(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function VF(t,e){const n=t.all(e),i=n.shift(),r=[];if(i){const f={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(e.children[0],f),r.push(f)}if(n.length>0){const f={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=lv(e.children[1]),_=BS(e.children[e.children.length-1]);a&&_&&(f.position={start:a,end:_}),r.push(f)}const c={type:"element",tagName:"table",properties:{},children:t.wrap(r,!0)};return t.patch(e,c),t.applyData(e,c)}function jF(t,e,n){const i=n?n.children:void 0,c=(i?i.indexOf(e):1)===0?"th":"td",f=n&&n.type==="table"?n.align:void 0,a=f?f.length:e.children.length;let _=-1;const x=[];for(;++_<a;){const R=e.children[_],I={},N=f?f[_]:void 0;N&&(I.align=N);let L={type:"element",tagName:c,properties:I,children:[]};R&&(L.children=t.all(R),t.patch(R,L),L=t.applyData(R,L)),x.push(L)}const S={type:"element",tagName:"tr",properties:{},children:t.wrap(x,!0)};return t.patch(e,S),t.applyData(e,S)}function $F(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const Nw=9,zw=32;function HF(t){const e=String(t),n=/\r?\n|\r/g;let i=n.exec(e),r=0;const c=[];for(;i;)c.push(Lw(e.slice(r,i.index),r>0,!0),i[0]),r=i.index+i[0].length,i=n.exec(e);return c.push(Lw(e.slice(r),r>0,!1)),c.join("")}function Lw(t,e,n){let i=0,r=t.length;if(e){let c=t.codePointAt(i);for(;c===Nw||c===zw;)i++,c=t.codePointAt(i)}if(n){let c=t.codePointAt(r-1);for(;c===Nw||c===zw;)r--,c=t.codePointAt(r-1)}return r>i?t.slice(i,r):""}function qF(t,e){const n={type:"text",value:HF(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function WF(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const XF={blockquote:wF,break:TF,code:SF,delete:EF,emphasis:AF,footnoteReference:CF,heading:RF,html:kF,imageReference:IF,image:MF,inlineCode:PF,linkReference:DF,link:OF,listItem:BF,list:zF,paragraph:LF,root:FF,strong:UF,table:VF,tableCell:$F,tableRow:jF,text:qF,thematicBreak:WF,toml:n_,yaml:n_,definition:n_,footnoteDefinition:n_};function n_(){}const iE=-1,iy=0,km=1,F_=2,mv=3,gv=4,_v=5,yv=6,rE=7,sE=8,Fw=typeof self=="object"?self:globalThis,ZF=(t,e)=>{const n=(r,c)=>(t.set(c,r),r),i=r=>{if(t.has(r))return t.get(r);const[c,f]=e[r];switch(c){case iy:case iE:return n(f,r);case km:{const a=n([],r);for(const _ of f)a.push(i(_));return a}case F_:{const a=n({},r);for(const[_,x]of f)a[i(_)]=i(x);return a}case mv:return n(new Date(f),r);case gv:{const{source:a,flags:_}=f;return n(new RegExp(a,_),r)}case _v:{const a=n(new Map,r);for(const[_,x]of f)a.set(i(_),i(x));return a}case yv:{const a=n(new Set,r);for(const _ of f)a.add(i(_));return a}case rE:{const{name:a,message:_}=f;return n(new Fw[a](_),r)}case sE:return n(BigInt(f),r);case"BigInt":return n(Object(BigInt(f)),r);case"ArrayBuffer":return n(new Uint8Array(f).buffer,f);case"DataView":{const{buffer:a}=new Uint8Array(f);return n(new DataView(a),f)}}return n(new Fw[c](f),r)};return i},Uw=t=>ZF(new Map,t)(0),md="",{toString:YF}={},{keys:GF}=Object,pm=t=>{const e=typeof t;if(e!=="object"||!t)return[iy,e];const n=YF.call(t).slice(8,-1);switch(n){case"Array":return[km,md];case"Object":return[F_,md];case"Date":return[mv,md];case"RegExp":return[gv,md];case"Map":return[_v,md];case"Set":return[yv,md];case"DataView":return[km,n]}return n.includes("Array")?[km,n]:n.includes("Error")?[rE,n]:[F_,n]},i_=([t,e])=>t===iy&&(e==="function"||e==="symbol"),KF=(t,e,n,i)=>{const r=(f,a)=>{const _=i.push(f)-1;return n.set(a,_),_},c=f=>{if(n.has(f))return n.get(f);let[a,_]=pm(f);switch(a){case iy:{let S=f;switch(_){case"bigint":a=sE,S=f.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+_);S=null;break;case"undefined":return r([iE],f)}return r([a,S],f)}case km:{if(_){let I=f;return _==="DataView"?I=new Uint8Array(f.buffer):_==="ArrayBuffer"&&(I=new Uint8Array(f)),r([_,[...I]],f)}const S=[],R=r([a,S],f);for(const I of f)S.push(c(I));return R}case F_:{if(_)switch(_){case"BigInt":return r([_,f.toString()],f);case"Boolean":case"Number":case"String":return r([_,f.valueOf()],f)}if(e&&"toJSON"in f)return c(f.toJSON());const S=[],R=r([a,S],f);for(const I of GF(f))(t||!i_(pm(f[I])))&&S.push([c(I),c(f[I])]);return R}case mv:return r([a,f.toISOString()],f);case gv:{const{source:S,flags:R}=f;return r([a,{source:S,flags:R}],f)}case _v:{const S=[],R=r([a,S],f);for(const[I,N]of f)(t||!(i_(pm(I))||i_(pm(N))))&&S.push([c(I),c(N)]);return R}case yv:{const S=[],R=r([a,S],f);for(const I of f)(t||!i_(pm(I)))&&S.push(c(I));return R}}const{message:x}=f;return r([a,{name:_,message:x}],f)};return c},Vw=(t,{json:e,lossy:n}={})=>{const i=[];return KF(!(e||n),!!e,new Map,i)(t),i},U_=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?Uw(Vw(t,e)):structuredClone(t):(t,e)=>Uw(Vw(t,e));function QF(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function JF(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function eU(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||QF,i=t.options.footnoteBackLabel||JF,r=t.options.footnoteLabel||"Footnotes",c=t.options.footnoteLabelTagName||"h2",f=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let _=-1;for(;++_<t.footnoteOrder.length;){const x=t.footnoteById.get(t.footnoteOrder[_]);if(!x)continue;const S=t.all(x),R=String(x.identifier).toUpperCase(),I=$d(R.toLowerCase());let N=0;const L=[],H=t.footnoteCounts.get(R);for(;H!==void 0&&++N<=H;){L.length>0&&L.push({type:"text",value:" "});let he=typeof n=="string"?n:n(_,N);typeof he=="string"&&(he={type:"text",value:he}),L.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+I+(N>1?"-"+N:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(_,N),className:["data-footnote-backref"]},children:Array.isArray(he)?he:[he]})}const ie=S[S.length-1];if(ie&&ie.type==="element"&&ie.tagName==="p"){const he=ie.children[ie.children.length-1];he&&he.type==="text"?he.value+=" ":ie.children.push({type:"text",value:" "}),ie.children.push(...L)}else S.push(...L);const ne={type:"element",tagName:"li",properties:{id:e+"fn-"+I},children:t.wrap(S,!0)};t.patch(x,ne),a.push(ne)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:c,properties:{...U_(f),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const ry=function(t){if(t==null)return rU;if(typeof t=="function")return sy(t);if(typeof t=="object")return Array.isArray(t)?tU(t):nU(t);if(typeof t=="string")return iU(t);throw new Error("Expected function, string, or object as test")};function tU(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=ry(t[n]);return sy(i);function i(...r){let c=-1;for(;++c<e.length;)if(e[c].apply(this,r))return!0;return!1}}function nU(t){const e=t;return sy(n);function n(i){const r=i;let c;for(c in t)if(r[c]!==e[c])return!1;return!0}}function iU(t){return sy(e);function e(n){return n&&n.type===t}}function sy(t){return e;function e(n,i,r){return!!(sU(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function rU(){return!0}function sU(t){return t!==null&&typeof t=="object"&&"type"in t}const aE=[],aU=!0,dx=!1,oU="skip";function oE(t,e,n,i){let r;typeof e=="function"&&typeof n!="function"?(i=n,n=e):r=e;const c=ry(r),f=i?-1:1;a(t,void 0,[])();function a(_,x,S){const R=_&&typeof _=="object"?_:{};if(typeof R.type=="string"){const N=typeof R.tagName=="string"?R.tagName:typeof R.name=="string"?R.name:void 0;Object.defineProperty(I,"name",{value:"node ("+(_.type+(N?"<"+N+">":""))+")"})}return I;function I(){let N=aE,L,H,ie;if((!e||c(_,x,S[S.length-1]||void 0))&&(N=lU(n(_,S)),N[0]===dx))return N;if("children"in _&&_.children){const ne=_;if(ne.children&&N[0]!==oU)for(H=(i?ne.children.length:-1)+f,ie=S.concat(ne);H>-1&&H<ne.children.length;){const he=ne.children[H];if(L=a(he,H,ie)(),L[0]===dx)return L;H=typeof L[1]=="number"?L[1]:H+f}}return N}}}function lU(t){return Array.isArray(t)?t:typeof t=="number"?[aU,t]:t==null?aE:[t]}function bv(t,e,n,i){let r,c,f;typeof e=="function"&&typeof n!="function"?(c=void 0,f=e,r=n):(c=e,f=n,r=i),oE(t,c,a,r);function a(_,x){const S=x[x.length-1],R=S?S.children.indexOf(_):void 0;return f(_,R,S)}}const px={}.hasOwnProperty,cU={};function uU(t,e){const n=e||cU,i=new Map,r=new Map,c=new Map,f={...XF,...n.handlers},a={all:x,applyData:fU,definitionById:i,footnoteById:r,footnoteCounts:c,footnoteOrder:[],handlers:f,one:_,options:n,patch:hU,wrap:pU};return bv(t,function(S){if(S.type==="definition"||S.type==="footnoteDefinition"){const R=S.type==="definition"?i:r,I=String(S.identifier).toUpperCase();R.has(I)||R.set(I,S)}}),a;function _(S,R){const I=S.type,N=a.handlers[I];if(px.call(a.handlers,I)&&N)return N(a,S,R);if(a.options.passThrough&&a.options.passThrough.includes(I)){if("children"in S){const{children:H,...ie}=S,ne=U_(ie);return ne.children=a.all(S),ne}return U_(S)}return(a.options.unknownHandler||dU)(a,S,R)}function x(S){const R=[];if("children"in S){const I=S.children;let N=-1;for(;++N<I.length;){const L=a.one(I[N],S);if(L){if(N&&I[N-1].type==="break"&&(!Array.isArray(L)&&L.type==="text"&&(L.value=jw(L.value)),!Array.isArray(L)&&L.type==="element")){const H=L.children[0];H&&H.type==="text"&&(H.value=jw(H.value))}Array.isArray(L)?R.push(...L):R.push(L)}}}return R}}function hU(t,e){t.position&&(e.position=J6(t))}function fU(t,e){let n=e;if(t&&t.data){const i=t.data.hName,r=t.data.hChildren,c=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const f="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:f}}n.type==="element"&&c&&Object.assign(n.properties,U_(c)),"children"in n&&n.children&&r!==null&&r!==void 0&&(n.children=r)}return n}function dU(t,e){const n=e.data||{},i="value"in e&&!(px.call(n,"hProperties")||px.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function pU(t,e){const n=[];let i=-1;for(e&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function jw(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function $w(t,e){const n=uU(t,e),i=n.one(t,void 0),r=eU(n),c=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return r&&c.children.push({type:"text",value:`
`},r),c}function mU(t,e){return t&&"run"in t?async function(n,i){const r=$w(n,{file:i,...e});await t.run(r,i)}:function(n,i){return $w(n,{file:i,...t||e})}}function Hw(t){if(t)throw t}var mb,qw;function gU(){if(qw)return mb;qw=1;var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,r=function(x){return typeof Array.isArray=="function"?Array.isArray(x):e.call(x)==="[object Array]"},c=function(x){if(!x||e.call(x)!=="[object Object]")return!1;var S=t.call(x,"constructor"),R=x.constructor&&x.constructor.prototype&&t.call(x.constructor.prototype,"isPrototypeOf");if(x.constructor&&!S&&!R)return!1;var I;for(I in x);return typeof I>"u"||t.call(x,I)},f=function(x,S){n&&S.name==="__proto__"?n(x,S.name,{enumerable:!0,configurable:!0,value:S.newValue,writable:!0}):x[S.name]=S.newValue},a=function(x,S){if(S==="__proto__")if(t.call(x,S)){if(i)return i(x,S).value}else return;return x[S]};return mb=function _(){var x,S,R,I,N,L,H=arguments[0],ie=1,ne=arguments.length,he=!1;for(typeof H=="boolean"&&(he=H,H=arguments[1]||{},ie=2),(H==null||typeof H!="object"&&typeof H!="function")&&(H={});ie<ne;++ie)if(x=arguments[ie],x!=null)for(S in x)R=a(H,S),I=a(x,S),H!==I&&(he&&I&&(c(I)||(N=r(I)))?(N?(N=!1,L=R&&r(R)?R:[]):L=R&&c(R)?R:{},f(H,{name:S,newValue:_(he,L,I)})):typeof I<"u"&&f(H,{name:S,newValue:I}));return H},mb}var _U=gU();const gb=yx(_U);function mx(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function yU(){const t=[],e={run:n,use:i};return e;function n(...r){let c=-1;const f=r.pop();if(typeof f!="function")throw new TypeError("Expected function as last argument, not "+f);a(null,...r);function a(_,...x){const S=t[++c];let R=-1;if(_){f(_);return}for(;++R<r.length;)(x[R]===null||x[R]===void 0)&&(x[R]=r[R]);r=x,S?bU(S,a)(...x):f(null,...x)}}function i(r){if(typeof r!="function")throw new TypeError("Expected `middelware` to be a function, not "+r);return t.push(r),e}}function bU(t,e){let n;return i;function i(...f){const a=t.length>f.length;let _;a&&f.push(r);try{_=t.apply(this,f)}catch(x){const S=x;if(a&&n)throw S;return r(S)}a||(_&&_.then&&typeof _.then=="function"?_.then(c,r):_ instanceof Error?r(_):c(_))}function r(f,...a){n||(n=!0,e(f,...a))}function c(f){r(null,f)}}const Gl={basename:xU,dirname:vU,extname:wU,join:TU,sep:"/"};function xU(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Xm(t);let n=0,i=-1,r=t.length,c;if(e===void 0||e.length===0||e.length>t.length){for(;r--;)if(t.codePointAt(r)===47){if(c){n=r+1;break}}else i<0&&(c=!0,i=r+1);return i<0?"":t.slice(n,i)}if(e===t)return"";let f=-1,a=e.length-1;for(;r--;)if(t.codePointAt(r)===47){if(c){n=r+1;break}}else f<0&&(c=!0,f=r+1),a>-1&&(t.codePointAt(r)===e.codePointAt(a--)?a<0&&(i=r):(a=-1,i=f));return n===i?i=f:i<0&&(i=t.length),t.slice(n,i)}function vU(t){if(Xm(t),t.length===0)return".";let e=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){e=n;break}}else i||(i=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function wU(t){Xm(t);let e=t.length,n=-1,i=0,r=-1,c=0,f;for(;e--;){const a=t.codePointAt(e);if(a===47){if(f){i=e+1;break}continue}n<0&&(f=!0,n=e+1),a===46?r<0?r=e:c!==1&&(c=1):r>-1&&(c=-1)}return r<0||n<0||c===0||c===1&&r===n-1&&r===i+1?"":t.slice(r,n)}function TU(...t){let e=-1,n;for(;++e<t.length;)Xm(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":SU(n)}function SU(t){Xm(t);const e=t.codePointAt(0)===47;let n=EU(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function EU(t,e){let n="",i=0,r=-1,c=0,f=-1,a,_;for(;++f<=t.length;){if(f<t.length)a=t.codePointAt(f);else{if(a===47)break;a=47}if(a===47){if(!(r===f-1||c===1))if(r!==f-1&&c===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(_=n.lastIndexOf("/"),_!==n.length-1){_<0?(n="",i=0):(n=n.slice(0,_),i=n.length-1-n.lastIndexOf("/")),r=f,c=0;continue}}else if(n.length>0){n="",i=0,r=f,c=0;continue}}e&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(r+1,f):n=t.slice(r+1,f),i=f-r-1;r=f,c=0}else a===46&&c>-1?c++:c=-1}return n}function Xm(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const AU={cwd:CU};function CU(){return"/"}function gx(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function RU(t){if(typeof t=="string")t=new URL(t);else if(!gx(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return kU(t)}function kU(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const i=e.codePointAt(n+2);if(i===70||i===102){const r=new TypeError("File URL path must not include encoded / characters");throw r.code="ERR_INVALID_FILE_URL_PATH",r}}return decodeURIComponent(e)}const _b=["history","path","basename","stem","extname","dirname"];class lE{constructor(e){let n;e?gx(e)?n={path:e}:typeof e=="string"||IU(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":AU.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<_b.length;){const c=_b[i];c in n&&n[c]!==void 0&&n[c]!==null&&(this[c]=c==="history"?[...n[c]]:n[c])}let r;for(r in n)_b.includes(r)||(this[r]=n[r])}get basename(){return typeof this.path=="string"?Gl.basename(this.path):void 0}set basename(e){bb(e,"basename"),yb(e,"basename"),this.path=Gl.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Gl.dirname(this.path):void 0}set dirname(e){Ww(this.basename,"dirname"),this.path=Gl.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Gl.extname(this.path):void 0}set extname(e){if(yb(e,"extname"),Ww(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Gl.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){gx(e)&&(e=RU(e)),bb(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Gl.basename(this.path,this.extname):void 0}set stem(e){bb(e,"stem"),yb(e,"stem"),this.path=Gl.join(this.dirname||"",e+(this.extname||""))}fail(e,n,i){const r=this.message(e,n,i);throw r.fatal=!0,r}info(e,n,i){const r=this.message(e,n,i);return r.fatal=void 0,r}message(e,n,i){const r=new js(e,n,i);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function yb(t,e){if(t&&t.includes(Gl.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Gl.sep+"`")}function bb(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function Ww(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function IU(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const MU=function(t){const i=this.constructor.prototype,r=i[t],c=function(){return r.apply(c,arguments)};return Object.setPrototypeOf(c,i),c},PU={}.hasOwnProperty;class xv extends MU{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=yU()}copy(){const e=new xv;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];e.use(...i)}return e.data(gb(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(wb("data",this.frozen),this.namespace[e]=n,this):PU.call(this.namespace,e)&&this.namespace[e]||void 0:e?(wb("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const r=n.call(e,...i);typeof r=="function"&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=r_(e),i=this.parser||this.Parser;return xb("parse",i),i(String(n),n)}process(e,n){const i=this;return this.freeze(),xb("process",this.parser||this.Parser),vb("process",this.compiler||this.Compiler),n?r(void 0,n):new Promise(r);function r(c,f){const a=r_(e),_=i.parse(a);i.run(_,a,function(S,R,I){if(S||!R||!I)return x(S);const N=R,L=i.stringify(N,I);BU(L)?I.value=L:I.result=L,x(S,I)});function x(S,R){S||!R?f(S):c?c(R):n(void 0,R)}}}processSync(e){let n=!1,i;return this.freeze(),xb("processSync",this.parser||this.Parser),vb("processSync",this.compiler||this.Compiler),this.process(e,r),Zw("processSync","process",n),i;function r(c,f){n=!0,Hw(c),i=f}}run(e,n,i){Xw(e),this.freeze();const r=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?c(void 0,i):new Promise(c);function c(f,a){const _=r_(n);r.run(e,_,x);function x(S,R,I){const N=R||e;S?a(S):f?f(N):i(void 0,N,I)}}}runSync(e,n){let i=!1,r;return this.run(e,n,c),Zw("runSync","run",i),r;function c(f,a){Hw(f),r=a,i=!0}}stringify(e,n){this.freeze();const i=r_(n),r=this.compiler||this.Compiler;return vb("stringify",r),Xw(e),r(e,i)}use(e,...n){const i=this.attachers,r=this.namespace;if(wb("use",this.frozen),e!=null)if(typeof e=="function")_(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):f(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function c(x){if(typeof x=="function")_(x,[]);else if(typeof x=="object")if(Array.isArray(x)){const[S,...R]=x;_(S,R)}else f(x);else throw new TypeError("Expected usable value, not `"+x+"`")}function f(x){if(!("plugins"in x)&&!("settings"in x))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(x.plugins),x.settings&&(r.settings=gb(!0,r.settings,x.settings))}function a(x){let S=-1;if(x!=null)if(Array.isArray(x))for(;++S<x.length;){const R=x[S];c(R)}else throw new TypeError("Expected a list of plugins, not `"+x+"`")}function _(x,S){let R=-1,I=-1;for(;++R<i.length;)if(i[R][0]===x){I=R;break}if(I===-1)i.push([x,...S]);else if(S.length>0){let[N,...L]=S;const H=i[I][1];mx(H)&&mx(N)&&(N=gb(!0,H,N)),i[I]=[x,N,...L]}}}}const DU=new xv().freeze();function xb(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function vb(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function wb(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Xw(t){if(!mx(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Zw(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function r_(t){return OU(t)?t:new lE(t)}function OU(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function BU(t){return typeof t=="string"||NU(t)}function NU(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const zU="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Yw=[],Gw={allowDangerousHtml:!0},LU=/^(https?|ircs?|mailto|xmpp)$/i,FU=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function UU(t){const e=VU(t),n=jU(t);return $U(e.runSync(e.parse(n),n),t)}function VU(t){const e=t.rehypePlugins||Yw,n=t.remarkPlugins||Yw,i=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...Gw}:Gw;return DU().use(vF).use(n).use(mU,i).use(e)}function jU(t){const e=t.children||"",n=new lE;return typeof e=="string"&&(n.value=e),n}function $U(t,e){const n=e.allowedElements,i=e.allowElement,r=e.components,c=e.disallowedElements,f=e.skipHtml,a=e.unwrapDisallowed,_=e.urlTransform||HU;for(const S of FU)Object.hasOwn(e,S.from)&&(""+S.from+(S.to?"use `"+S.to+"` instead":"remove it")+zU+S.id,void 0);return e.className&&(t={type:"element",tagName:"div",properties:{className:e.className},children:t.type==="root"?t.children:[t]}),bv(t,x),rz(t,{Fragment:Yn.Fragment,components:r,ignoreInvalidStyle:!0,jsx:Yn.jsx,jsxs:Yn.jsxs,passKeys:!0,passNode:!0});function x(S,R,I){if(S.type==="raw"&&I&&typeof R=="number")return f?I.children.splice(R,1):I.children[R]={type:"text",value:S.value},R;if(S.type==="element"){let N;for(N in fb)if(Object.hasOwn(fb,N)&&Object.hasOwn(S.properties,N)){const L=S.properties[N],H=fb[N];(H===null||H.includes(S.tagName))&&(S.properties[N]=_(String(L||""),N,S))}}if(S.type==="element"){let N=n?!n.includes(S.tagName):c?c.includes(S.tagName):!1;if(!N&&i&&typeof R=="number"&&(N=!i(S,R,I)),N&&I&&typeof R=="number")return a&&S.children?I.children.splice(R,1,...S.children):I.children.splice(R,1),R}}}function HU(t){const e=t.indexOf(":"),n=t.indexOf("?"),i=t.indexOf("#"),r=t.indexOf("/");return e===-1||r!==-1&&e>r||n!==-1&&e>n||i!==-1&&e>i||LU.test(t.slice(0,e))?t:""}function Kw(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let i=0,r=n.indexOf(e);for(;r!==-1;)i++,r=n.indexOf(e,r+e.length);return i}function qU(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function WU(t,e,n){const r=ry((n||{}).ignore||[]),c=XU(e);let f=-1;for(;++f<c.length;)oE(t,"text",a);function a(x,S){let R=-1,I;for(;++R<S.length;){const N=S[R],L=I?I.children:void 0;if(r(N,L?L.indexOf(N):void 0,I))return;I=N}if(I)return _(x,S)}function _(x,S){const R=S[S.length-1],I=c[f][0],N=c[f][1];let L=0;const ie=R.children.indexOf(x);let ne=!1,he=[];I.lastIndex=0;let re=I.exec(x.value);for(;re;){const ge=re.index,_e={index:re.index,input:re.input,stack:[...S,x]};let pe=N(...re,_e);if(typeof pe=="string"&&(pe=pe.length>0?{type:"text",value:pe}:void 0),pe===!1?I.lastIndex=ge+1:(L!==ge&&he.push({type:"text",value:x.value.slice(L,ge)}),Array.isArray(pe)?he.push(...pe):pe&&he.push(pe),L=ge+re[0].length,ne=!0),!I.global)break;re=I.exec(x.value)}return ne?(L<x.value.length&&he.push({type:"text",value:x.value.slice(L)}),R.children.splice(ie,1,...he)):he=[x],ie+he.length}}function XU(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const r=n[i];e.push([ZU(r[0]),YU(r[1])])}return e}function ZU(t){return typeof t=="string"?new RegExp(qU(t),"g"):t}function YU(t){return typeof t=="function"?t:function(){return t}}const Tb="phrasing",Sb=["autolink","link","image","label"];function GU(){return{transforms:[i5],enter:{literalAutolink:QU,literalAutolinkEmail:Eb,literalAutolinkHttp:Eb,literalAutolinkWww:Eb},exit:{literalAutolink:n5,literalAutolinkEmail:t5,literalAutolinkHttp:JU,literalAutolinkWww:e5}}}function KU(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Tb,notInConstruct:Sb},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Tb,notInConstruct:Sb},{character:":",before:"[ps]",after:"\\/",inConstruct:Tb,notInConstruct:Sb}]}}function QU(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Eb(t){this.config.enter.autolinkProtocol.call(this,t)}function JU(t){this.config.exit.autolinkProtocol.call(this,t)}function e5(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(t)}function t5(t){this.config.exit.autolinkEmail.call(this,t)}function n5(t){this.exit(t)}function i5(t){WU(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,r5],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),s5]],{ignore:["link","linkReference"]})}function r5(t,e,n,i,r){let c="";if(!cE(r)||(/^w/i.test(e)&&(n=e+n,e="",c="http://"),!a5(n)))return!1;const f=o5(n+i);if(!f[0])return!1;const a={type:"link",title:null,url:c+e+f[0],children:[{type:"text",value:e+f[0]}]};return f[1]?[a,{type:"text",value:f[1]}]:a}function s5(t,e,n,i){return!cE(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function a5(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function o5(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],i=n.indexOf(")");const r=Kw(t,"(");let c=Kw(t,")");for(;i!==-1&&r>c;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),c++;return[t,n]}function cE(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||pf(n)||ty(n))&&(!e||n!==47)}uE.peek=g5;function l5(){this.buffer()}function c5(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function u5(){this.buffer()}function h5(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function f5(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=tl(this.sliceSerialize(t)).toLowerCase(),n.label=e}function d5(t){this.exit(t)}function p5(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=tl(this.sliceSerialize(t)).toLowerCase(),n.label=e}function m5(t){this.exit(t)}function g5(){return"["}function uE(t,e,n,i){const r=n.createTracker(i);let c=r.move("[^");const f=n.enter("footnoteReference"),a=n.enter("reference");return c+=r.move(n.safe(n.associationId(t),{after:"]",before:c})),a(),f(),c+=r.move("]"),c}function _5(){return{enter:{gfmFootnoteCallString:l5,gfmFootnoteCall:c5,gfmFootnoteDefinitionLabelString:u5,gfmFootnoteDefinition:h5},exit:{gfmFootnoteCallString:f5,gfmFootnoteCall:d5,gfmFootnoteDefinitionLabelString:p5,gfmFootnoteDefinition:m5}}}function y5(t){let e=!1;return t&&t.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:n,footnoteReference:uE},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,r,c,f){const a=c.createTracker(f);let _=a.move("[^");const x=c.enter("footnoteDefinition"),S=c.enter("label");return _+=a.move(c.safe(c.associationId(i),{before:_,after:"]"})),S(),_+=a.move("]:"),i.children&&i.children.length>0&&(a.shift(4),_+=a.move((e?`
`:" ")+c.indentLines(c.containerFlow(i,a.current()),e?hE:b5))),x(),_}}function b5(t,e,n){return e===0?t:hE(t,e,n)}function hE(t,e,n){return(n?"":"    ")+t}const x5=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];fE.peek=E5;function v5(){return{canContainEols:["delete"],enter:{strikethrough:T5},exit:{strikethrough:S5}}}function w5(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:x5}],handlers:{delete:fE}}}function T5(t){this.enter({type:"delete",children:[]},t)}function S5(t){this.exit(t)}function fE(t,e,n,i){const r=n.createTracker(i),c=n.enter("strikethrough");let f=r.move("~~");return f+=n.containerPhrasing(t,{...r.current(),before:f,after:"~"}),f+=r.move("~~"),c(),f}function E5(){return"~"}function A5(t){return t.length}function C5(t,e){const n=e||{},i=(n.align||[]).concat(),r=n.stringLength||A5,c=[],f=[],a=[],_=[];let x=0,S=-1;for(;++S<t.length;){const H=[],ie=[];let ne=-1;for(t[S].length>x&&(x=t[S].length);++ne<t[S].length;){const he=R5(t[S][ne]);if(n.alignDelimiters!==!1){const re=r(he);ie[ne]=re,(_[ne]===void 0||re>_[ne])&&(_[ne]=re)}H.push(he)}f[S]=H,a[S]=ie}let R=-1;if(typeof i=="object"&&"length"in i)for(;++R<x;)c[R]=Qw(i[R]);else{const H=Qw(i);for(;++R<x;)c[R]=H}R=-1;const I=[],N=[];for(;++R<x;){const H=c[R];let ie="",ne="";H===99?(ie=":",ne=":"):H===108?ie=":":H===114&&(ne=":");let he=n.alignDelimiters===!1?1:Math.max(1,_[R]-ie.length-ne.length);const re=ie+"-".repeat(he)+ne;n.alignDelimiters!==!1&&(he=ie.length+he+ne.length,he>_[R]&&(_[R]=he),N[R]=he),I[R]=re}f.splice(1,0,I),a.splice(1,0,N),S=-1;const L=[];for(;++S<f.length;){const H=f[S],ie=a[S];R=-1;const ne=[];for(;++R<x;){const he=H[R]||"";let re="",ge="";if(n.alignDelimiters!==!1){const _e=_[R]-(ie[R]||0),pe=c[R];pe===114?re=" ".repeat(_e):pe===99?_e%2?(re=" ".repeat(_e/2+.5),ge=" ".repeat(_e/2-.5)):(re=" ".repeat(_e/2),ge=re):ge=" ".repeat(_e)}n.delimiterStart!==!1&&!R&&ne.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&he==="")&&(n.delimiterStart!==!1||R)&&ne.push(" "),n.alignDelimiters!==!1&&ne.push(re),ne.push(he),n.alignDelimiters!==!1&&ne.push(ge),n.padding!==!1&&ne.push(" "),(n.delimiterEnd!==!1||R!==x-1)&&ne.push("|")}L.push(n.delimiterEnd===!1?ne.join("").replace(/ +$/,""):ne.join(""))}return L.join(`
`)}function R5(t){return t==null?"":String(t)}function Qw(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function k5(t,e,n,i){const r=n.enter("blockquote"),c=n.createTracker(i);c.move("> "),c.shift(2);const f=n.indentLines(n.containerFlow(t,c.current()),I5);return r(),f}function I5(t,e,n){return">"+(n?"":" ")+t}function M5(t,e){return Jw(t,e.inConstruct,!0)&&!Jw(t,e.notInConstruct,!1)}function Jw(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let i=-1;for(;++i<e.length;)if(t.includes(e[i]))return!0;return!1}function e2(t,e,n,i){let r=-1;for(;++r<n.unsafe.length;)if(n.unsafe[r].character===`
`&&M5(n.stack,n.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function P5(t,e){const n=String(t);let i=n.indexOf(e),r=i,c=0,f=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===r?++c>f&&(f=c):c=1,r=i+e.length,i=n.indexOf(e,r);return f}function D5(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function O5(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function B5(t,e,n,i){const r=O5(n),c=t.value||"",f=r==="`"?"GraveAccent":"Tilde";if(D5(t,n)){const R=n.enter("codeIndented"),I=n.indentLines(c,N5);return R(),I}const a=n.createTracker(i),_=r.repeat(Math.max(P5(c,r)+1,3)),x=n.enter("codeFenced");let S=a.move(_);if(t.lang){const R=n.enter(`codeFencedLang${f}`);S+=a.move(n.safe(t.lang,{before:S,after:" ",encode:["`"],...a.current()})),R()}if(t.lang&&t.meta){const R=n.enter(`codeFencedMeta${f}`);S+=a.move(" "),S+=a.move(n.safe(t.meta,{before:S,after:`
`,encode:["`"],...a.current()})),R()}return S+=a.move(`
`),c&&(S+=a.move(c+`
`)),S+=a.move(_),x(),S}function N5(t,e,n){return(n?"":"    ")+t}function vv(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function z5(t,e,n,i){const r=vv(n),c=r==='"'?"Quote":"Apostrophe",f=n.enter("definition");let a=n.enter("label");const _=n.createTracker(i);let x=_.move("[");return x+=_.move(n.safe(n.associationId(t),{before:x,after:"]",..._.current()})),x+=_.move("]: "),a(),!t.url||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),x+=_.move("<"),x+=_.move(n.safe(t.url,{before:x,after:">",..._.current()})),x+=_.move(">")):(a=n.enter("destinationRaw"),x+=_.move(n.safe(t.url,{before:x,after:t.title?" ":`
`,..._.current()}))),a(),t.title&&(a=n.enter(`title${c}`),x+=_.move(" "+r),x+=_.move(n.safe(t.title,{before:x,after:r,..._.current()})),x+=_.move(r),a()),f(),x}function L5(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function Nm(t){return"&#x"+t.toString(16).toUpperCase()+";"}function V_(t,e,n){const i=Ud(t),r=Ud(e);return i===void 0?r===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}dE.peek=F5;function dE(t,e,n,i){const r=L5(n),c=n.enter("emphasis"),f=n.createTracker(i),a=f.move(r);let _=f.move(n.containerPhrasing(t,{after:r,before:a,...f.current()}));const x=_.charCodeAt(0),S=V_(i.before.charCodeAt(i.before.length-1),x,r);S.inside&&(_=Nm(x)+_.slice(1));const R=_.charCodeAt(_.length-1),I=V_(i.after.charCodeAt(0),R,r);I.inside&&(_=_.slice(0,-1)+Nm(R));const N=f.move(r);return c(),n.attentionEncodeSurroundingInfo={after:I.outside,before:S.outside},a+_+N}function F5(t,e,n){return n.options.emphasis||"*"}function U5(t,e){let n=!1;return bv(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,dx}),!!((!t.depth||t.depth<3)&&fv(t)&&(e.options.setext||n))}function V5(t,e,n,i){const r=Math.max(Math.min(6,t.depth||1),1),c=n.createTracker(i);if(U5(t,n)){const S=n.enter("headingSetext"),R=n.enter("phrasing"),I=n.containerPhrasing(t,{...c.current(),before:`
`,after:`
`});return R(),S(),I+`
`+(r===1?"=":"-").repeat(I.length-(Math.max(I.lastIndexOf("\r"),I.lastIndexOf(`
`))+1))}const f="#".repeat(r),a=n.enter("headingAtx"),_=n.enter("phrasing");c.move(f+" ");let x=n.containerPhrasing(t,{before:"# ",after:`
`,...c.current()});return/^[\t ]/.test(x)&&(x=Nm(x.charCodeAt(0))+x.slice(1)),x=x?f+" "+x:f,n.options.closeAtx&&(x+=" "+f),_(),a(),x}pE.peek=j5;function pE(t){return t.value||""}function j5(){return"<"}mE.peek=$5;function mE(t,e,n,i){const r=vv(n),c=r==='"'?"Quote":"Apostrophe",f=n.enter("image");let a=n.enter("label");const _=n.createTracker(i);let x=_.move("![");return x+=_.move(n.safe(t.alt,{before:x,after:"]",..._.current()})),x+=_.move("]("),a(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),x+=_.move("<"),x+=_.move(n.safe(t.url,{before:x,after:">",..._.current()})),x+=_.move(">")):(a=n.enter("destinationRaw"),x+=_.move(n.safe(t.url,{before:x,after:t.title?" ":")",..._.current()}))),a(),t.title&&(a=n.enter(`title${c}`),x+=_.move(" "+r),x+=_.move(n.safe(t.title,{before:x,after:r,..._.current()})),x+=_.move(r),a()),x+=_.move(")"),f(),x}function $5(){return"!"}gE.peek=H5;function gE(t,e,n,i){const r=t.referenceType,c=n.enter("imageReference");let f=n.enter("label");const a=n.createTracker(i);let _=a.move("![");const x=n.safe(t.alt,{before:_,after:"]",...a.current()});_+=a.move(x+"]["),f();const S=n.stack;n.stack=[],f=n.enter("reference");const R=n.safe(n.associationId(t),{before:_,after:"]",...a.current()});return f(),n.stack=S,c(),r==="full"||!x||x!==R?_+=a.move(R+"]"):r==="shortcut"?_=_.slice(0,-1):_+=a.move("]"),_}function H5(){return"!"}_E.peek=q5;function _E(t,e,n){let i=t.value||"",r="`",c=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++c<n.unsafe.length;){const f=n.unsafe[c],a=n.compilePattern(f);let _;if(f.atBreak)for(;_=a.exec(i);){let x=_.index;i.charCodeAt(x)===10&&i.charCodeAt(x-1)===13&&x--,i=i.slice(0,x)+" "+i.slice(_.index+1)}}return r+i+r}function q5(){return"`"}function yE(t,e){const n=fv(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}bE.peek=W5;function bE(t,e,n,i){const r=vv(n),c=r==='"'?"Quote":"Apostrophe",f=n.createTracker(i);let a,_;if(yE(t,n)){const S=n.stack;n.stack=[],a=n.enter("autolink");let R=f.move("<");return R+=f.move(n.containerPhrasing(t,{before:R,after:">",...f.current()})),R+=f.move(">"),a(),n.stack=S,R}a=n.enter("link"),_=n.enter("label");let x=f.move("[");return x+=f.move(n.containerPhrasing(t,{before:x,after:"](",...f.current()})),x+=f.move("]("),_(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(_=n.enter("destinationLiteral"),x+=f.move("<"),x+=f.move(n.safe(t.url,{before:x,after:">",...f.current()})),x+=f.move(">")):(_=n.enter("destinationRaw"),x+=f.move(n.safe(t.url,{before:x,after:t.title?" ":")",...f.current()}))),_(),t.title&&(_=n.enter(`title${c}`),x+=f.move(" "+r),x+=f.move(n.safe(t.title,{before:x,after:r,...f.current()})),x+=f.move(r),_()),x+=f.move(")"),a(),x}function W5(t,e,n){return yE(t,n)?"<":"["}xE.peek=X5;function xE(t,e,n,i){const r=t.referenceType,c=n.enter("linkReference");let f=n.enter("label");const a=n.createTracker(i);let _=a.move("[");const x=n.containerPhrasing(t,{before:_,after:"]",...a.current()});_+=a.move(x+"]["),f();const S=n.stack;n.stack=[],f=n.enter("reference");const R=n.safe(n.associationId(t),{before:_,after:"]",...a.current()});return f(),n.stack=S,c(),r==="full"||!x||x!==R?_+=a.move(R+"]"):r==="shortcut"?_=_.slice(0,-1):_+=a.move("]"),_}function X5(){return"["}function wv(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function Z5(t){const e=wv(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function Y5(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function vE(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function G5(t,e,n,i){const r=n.enter("list"),c=n.bulletCurrent;let f=t.ordered?Y5(n):wv(n);const a=t.ordered?f==="."?")":".":Z5(n);let _=e&&n.bulletLastUsed?f===n.bulletLastUsed:!1;if(!t.ordered){const S=t.children?t.children[0]:void 0;if((f==="*"||f==="-")&&S&&(!S.children||!S.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(_=!0),vE(n)===f&&S){let R=-1;for(;++R<t.children.length;){const I=t.children[R];if(I&&I.type==="listItem"&&I.children&&I.children[0]&&I.children[0].type==="thematicBreak"){_=!0;break}}}}_&&(f=a),n.bulletCurrent=f;const x=n.containerFlow(t,i);return n.bulletLastUsed=f,n.bulletCurrent=c,r(),x}function K5(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function Q5(t,e,n,i){const r=K5(n);let c=n.bulletCurrent||wv(n);e&&e.type==="list"&&e.ordered&&(c=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+c);let f=c.length+1;(r==="tab"||r==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(f=Math.ceil(f/4)*4);const a=n.createTracker(i);a.move(c+" ".repeat(f-c.length)),a.shift(f);const _=n.enter("listItem"),x=n.indentLines(n.containerFlow(t,a.current()),S);return _(),x;function S(R,I,N){return I?(N?"":" ".repeat(f))+R:(N?c:c+" ".repeat(f-c.length))+R}}function J5(t,e,n,i){const r=n.enter("paragraph"),c=n.enter("phrasing"),f=n.containerPhrasing(t,i);return c(),r(),f}const e8=ry(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function t8(t,e,n,i){return(t.children.some(function(f){return e8(f)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function n8(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}wE.peek=i8;function wE(t,e,n,i){const r=n8(n),c=n.enter("strong"),f=n.createTracker(i),a=f.move(r+r);let _=f.move(n.containerPhrasing(t,{after:r,before:a,...f.current()}));const x=_.charCodeAt(0),S=V_(i.before.charCodeAt(i.before.length-1),x,r);S.inside&&(_=Nm(x)+_.slice(1));const R=_.charCodeAt(_.length-1),I=V_(i.after.charCodeAt(0),R,r);I.inside&&(_=_.slice(0,-1)+Nm(R));const N=f.move(r+r);return c(),n.attentionEncodeSurroundingInfo={after:I.outside,before:S.outside},a+_+N}function i8(t,e,n){return n.options.strong||"*"}function r8(t,e,n,i){return n.safe(t.value,i)}function s8(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function a8(t,e,n){const i=(vE(n)+(n.options.ruleSpaces?" ":"")).repeat(s8(n));return n.options.ruleSpaces?i.slice(0,-1):i}const TE={blockquote:k5,break:e2,code:B5,definition:z5,emphasis:dE,hardBreak:e2,heading:V5,html:pE,image:mE,imageReference:gE,inlineCode:_E,link:bE,linkReference:xE,list:G5,listItem:Q5,paragraph:J5,root:t8,strong:wE,text:r8,thematicBreak:a8};function o8(){return{enter:{table:l8,tableData:t2,tableHeader:t2,tableRow:u8},exit:{codeText:h8,table:c8,tableData:Ab,tableHeader:Ab,tableRow:Ab}}}function l8(t){const e=t._align;this.enter({type:"table",align:e.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function c8(t){this.exit(t),this.data.inTable=void 0}function u8(t){this.enter({type:"tableRow",children:[]},t)}function Ab(t){this.exit(t)}function t2(t){this.enter({type:"tableCell",children:[]},t)}function h8(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,f8));const n=this.stack[this.stack.length-1];n.type,n.value=e,this.exit(t)}function f8(t,e){return e==="|"?e:t}function d8(t){const e=t||{},n=e.tableCellPadding,i=e.tablePipeAlign,r=e.stringLength,c=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:I,table:f,tableCell:_,tableRow:a}};function f(N,L,H,ie){return x(S(N,H,ie),N.align)}function a(N,L,H,ie){const ne=R(N,H,ie),he=x([ne]);return he.slice(0,he.indexOf(`
`))}function _(N,L,H,ie){const ne=H.enter("tableCell"),he=H.enter("phrasing"),re=H.containerPhrasing(N,{...ie,before:c,after:c});return he(),ne(),re}function x(N,L){return C5(N,{align:L,alignDelimiters:i,padding:n,stringLength:r})}function S(N,L,H){const ie=N.children;let ne=-1;const he=[],re=L.enter("table");for(;++ne<ie.length;)he[ne]=R(ie[ne],L,H);return re(),he}function R(N,L,H){const ie=N.children;let ne=-1;const he=[],re=L.enter("tableRow");for(;++ne<ie.length;)he[ne]=_(ie[ne],N,L,H);return re(),he}function I(N,L,H){let ie=TE.inlineCode(N,L,H);return H.stack.includes("tableCell")&&(ie=ie.replace(/\|/g,"\\$&")),ie}}function p8(){return{exit:{taskListCheckValueChecked:n2,taskListCheckValueUnchecked:n2,paragraph:g8}}}function m8(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:_8}}}function n2(t){const e=this.stack[this.stack.length-2];e.type,e.checked=t.type==="taskListCheckValueChecked"}function g8(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const i=n.children[0];if(i&&i.type==="text"){const r=e.children;let c=-1,f;for(;++c<r.length;){const a=r[c];if(a.type==="paragraph"){f=a;break}}f===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function _8(t,e,n,i){const r=t.children[0],c=typeof t.checked=="boolean"&&r&&r.type==="paragraph",f="["+(t.checked?"x":" ")+"] ",a=n.createTracker(i);c&&a.move(f);let _=TE.listItem(t,e,n,{...i,...a.current()});return c&&(_=_.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,x)),_;function x(S){return S+f}}function y8(){return[GU(),_5(),v5(),o8(),p8()]}function b8(t){return{extensions:[KU(),y5(t),w5(),d8(t),m8()]}}const x8={tokenize:A8,partial:!0},SE={tokenize:C8,partial:!0},EE={tokenize:R8,partial:!0},AE={tokenize:k8,partial:!0},v8={tokenize:I8,partial:!0},CE={name:"wwwAutolink",tokenize:S8,previous:kE},RE={name:"protocolAutolink",tokenize:E8,previous:IE},$c={name:"emailAutolink",tokenize:T8,previous:ME},nc={};function w8(){return{text:nc}}let tf=48;for(;tf<123;)nc[tf]=$c,tf++,tf===58?tf=65:tf===91&&(tf=97);nc[43]=$c;nc[45]=$c;nc[46]=$c;nc[95]=$c;nc[72]=[$c,RE];nc[104]=[$c,RE];nc[87]=[$c,CE];nc[119]=[$c,CE];function T8(t,e,n){const i=this;let r,c;return f;function f(R){return!_x(R)||!ME.call(i,i.previous)||Tv(i.events)?n(R):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),a(R))}function a(R){return _x(R)?(t.consume(R),a):R===64?(t.consume(R),_):n(R)}function _(R){return R===46?t.check(v8,S,x)(R):R===45||R===95||Vs(R)?(c=!0,t.consume(R),_):S(R)}function x(R){return t.consume(R),r=!0,_}function S(R){return c&&r&&na(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(R)):n(R)}}function S8(t,e,n){const i=this;return r;function r(f){return f!==87&&f!==119||!kE.call(i,i.previous)||Tv(i.events)?n(f):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(x8,t.attempt(SE,t.attempt(EE,c),n),n)(f))}function c(f){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(f)}}function E8(t,e,n){const i=this;let r="",c=!1;return f;function f(R){return(R===72||R===104)&&IE.call(i,i.previous)&&!Tv(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),r+=String.fromCodePoint(R),t.consume(R),a):n(R)}function a(R){if(na(R)&&r.length<5)return r+=String.fromCodePoint(R),t.consume(R),a;if(R===58){const I=r.toLowerCase();if(I==="http"||I==="https")return t.consume(R),_}return n(R)}function _(R){return R===47?(t.consume(R),c?x:(c=!0,_)):n(R)}function x(R){return R===null||L_(R)||Pi(R)||pf(R)||ty(R)?n(R):t.attempt(SE,t.attempt(EE,S),n)(R)}function S(R){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(R)}}function A8(t,e,n){let i=0;return r;function r(f){return(f===87||f===119)&&i<3?(i++,t.consume(f),r):f===46&&i===3?(t.consume(f),c):n(f)}function c(f){return f===null?n(f):e(f)}}function C8(t,e,n){let i,r,c;return f;function f(x){return x===46||x===95?t.check(AE,_,a)(x):x===null||Pi(x)||pf(x)||x!==45&&ty(x)?_(x):(c=!0,t.consume(x),f)}function a(x){return x===95?i=!0:(r=i,i=void 0),t.consume(x),f}function _(x){return r||i||!c?n(x):e(x)}}function R8(t,e){let n=0,i=0;return r;function r(f){return f===40?(n++,t.consume(f),r):f===41&&i<n?c(f):f===33||f===34||f===38||f===39||f===41||f===42||f===44||f===46||f===58||f===59||f===60||f===63||f===93||f===95||f===126?t.check(AE,e,c)(f):f===null||Pi(f)||pf(f)?e(f):(t.consume(f),r)}function c(f){return f===41&&i++,t.consume(f),r}}function k8(t,e,n){return i;function i(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(t.consume(a),i):a===38?(t.consume(a),c):a===93?(t.consume(a),r):a===60||a===null||Pi(a)||pf(a)?e(a):n(a)}function r(a){return a===null||a===40||a===91||Pi(a)||pf(a)?e(a):i(a)}function c(a){return na(a)?f(a):n(a)}function f(a){return a===59?(t.consume(a),i):na(a)?(t.consume(a),f):n(a)}}function I8(t,e,n){return i;function i(c){return t.consume(c),r}function r(c){return Vs(c)?n(c):e(c)}}function kE(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Pi(t)}function IE(t){return!na(t)}function ME(t){return!(t===47||_x(t))}function _x(t){return t===43||t===45||t===46||t===95||Vs(t)}function Tv(t){let e=t.length,n=!1;for(;e--;){const i=t[e][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const M8={tokenize:F8,partial:!0};function P8(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:N8,continuation:{tokenize:z8},exit:L8}},text:{91:{name:"gfmFootnoteCall",tokenize:B8},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:D8,resolveTo:O8}}}}function D8(t,e,n){const i=this;let r=i.events.length;const c=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let f;for(;r--;){const _=i.events[r][1];if(_.type==="labelImage"){f=_;break}if(_.type==="gfmFootnoteCall"||_.type==="labelLink"||_.type==="label"||_.type==="image"||_.type==="link")break}return a;function a(_){if(!f||!f._balanced)return n(_);const x=tl(i.sliceSerialize({start:f.end,end:i.now()}));return x.codePointAt(0)!==94||!c.includes(x.slice(1))?n(_):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(_),t.exit("gfmFootnoteCallLabelMarker"),e(_))}}function O8(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const c={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},t[t.length-1][1].start)},f={type:"chunkString",contentType:"string",start:Object.assign({},c.start),end:Object.assign({},c.end)},a=[t[n+1],t[n+2],["enter",i,e],t[n+3],t[n+4],["enter",r,e],["exit",r,e],["enter",c,e],["enter",f,e],["exit",f,e],["exit",c,e],t[t.length-2],t[t.length-1],["exit",i,e]];return t.splice(n,t.length-n+1,...a),t}function B8(t,e,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let c=0,f;return a;function a(R){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(R),t.exit("gfmFootnoteCallLabelMarker"),_}function _(R){return R!==94?n(R):(t.enter("gfmFootnoteCallMarker"),t.consume(R),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",x)}function x(R){if(c>999||R===93&&!f||R===null||R===91||Pi(R))return n(R);if(R===93){t.exit("chunkString");const I=t.exit("gfmFootnoteCallString");return r.includes(tl(i.sliceSerialize(I)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(R),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(R)}return Pi(R)||(f=!0),c++,t.consume(R),R===92?S:x}function S(R){return R===91||R===92||R===93?(t.consume(R),c++,x):x(R)}}function N8(t,e,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let c,f=0,a;return _;function _(L){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(L),t.exit("gfmFootnoteDefinitionLabelMarker"),x}function x(L){return L===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(L),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",S):n(L)}function S(L){if(f>999||L===93&&!a||L===null||L===91||Pi(L))return n(L);if(L===93){t.exit("chunkString");const H=t.exit("gfmFootnoteDefinitionLabelString");return c=tl(i.sliceSerialize(H)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(L),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),I}return Pi(L)||(a=!0),f++,t.consume(L),L===92?R:S}function R(L){return L===91||L===92||L===93?(t.consume(L),f++,S):S(L)}function I(L){return L===58?(t.enter("definitionMarker"),t.consume(L),t.exit("definitionMarker"),r.includes(c)||r.push(c),ti(t,N,"gfmFootnoteDefinitionWhitespace")):n(L)}function N(L){return e(L)}}function z8(t,e,n){return t.check(Wm,e,t.attempt(M8,e,n))}function L8(t){t.exit("gfmFootnoteDefinition")}function F8(t,e,n){const i=this;return ti(t,r,"gfmFootnoteDefinitionIndent",5);function r(c){const f=i.events[i.events.length-1];return f&&f[1].type==="gfmFootnoteDefinitionIndent"&&f[2].sliceSerialize(f[1],!0).length===4?e(c):n(c)}}function U8(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:c,resolveAll:r};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function r(f,a){let _=-1;for(;++_<f.length;)if(f[_][0]==="enter"&&f[_][1].type==="strikethroughSequenceTemporary"&&f[_][1]._close){let x=_;for(;x--;)if(f[x][0]==="exit"&&f[x][1].type==="strikethroughSequenceTemporary"&&f[x][1]._open&&f[_][1].end.offset-f[_][1].start.offset===f[x][1].end.offset-f[x][1].start.offset){f[_][1].type="strikethroughSequence",f[x][1].type="strikethroughSequence";const S={type:"strikethrough",start:Object.assign({},f[x][1].start),end:Object.assign({},f[_][1].end)},R={type:"strikethroughText",start:Object.assign({},f[x][1].end),end:Object.assign({},f[_][1].start)},I=[["enter",S,a],["enter",f[x][1],a],["exit",f[x][1],a],["enter",R,a]],N=a.parser.constructs.insideSpan.null;N&&Ua(I,I.length,0,ny(N,f.slice(x+1,_),a)),Ua(I,I.length,0,[["exit",R,a],["enter",f[_][1],a],["exit",f[_][1],a],["exit",S,a]]),Ua(f,x-1,_-x+3,I),_=x+I.length-2;break}}for(_=-1;++_<f.length;)f[_][1].type==="strikethroughSequenceTemporary"&&(f[_][1].type="data");return f}function c(f,a,_){const x=this.previous,S=this.events;let R=0;return I;function I(L){return x===126&&S[S.length-1][1].type!=="characterEscape"?_(L):(f.enter("strikethroughSequenceTemporary"),N(L))}function N(L){const H=Ud(x);if(L===126)return R>1?_(L):(f.consume(L),R++,N);if(R<2&&!n)return _(L);const ie=f.exit("strikethroughSequenceTemporary"),ne=Ud(L);return ie._open=!ne||ne===2&&!!H,ie._close=!H||H===2&&!!ne,a(L)}}}class V8{constructor(){this.map=[]}add(e,n,i){j8(this,e,n,i)}consume(e){if(this.map.sort(function(c,f){return c[0]-f[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(e.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),e.length=this.map[n][0];i.push(e.slice()),e.length=0;let r=i.pop();for(;r;){for(const c of r)e.push(c);r=i.pop()}this.map.length=0}}function j8(t,e,n,i){let r=0;if(!(n===0&&i.length===0)){for(;r<t.map.length;){if(t.map[r][0]===e){t.map[r][1]+=n,t.map[r][2].push(...i);return}r+=1}t.map.push([e,n,i])}}function $8(t,e){let n=!1;const i=[];for(;e<t.length;){const r=t[e];if(n){if(r[0]==="enter")r[1].type==="tableContent"&&i.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const c=i.length-1;i[c]=i[c]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(n=!0);e+=1}return i}function H8(){return{flow:{null:{name:"table",tokenize:q8,resolveAll:W8}}}}function q8(t,e,n){const i=this;let r=0,c=0,f;return a;function a(Ce){let ht=i.events.length-1;for(;ht>-1;){const Le=i.events[ht][1].type;if(Le==="lineEnding"||Le==="linePrefix")ht--;else break}const Me=ht>-1?i.events[ht][1].type:null,Ve=Me==="tableHead"||Me==="tableRow"?pe:_;return Ve===pe&&i.parser.lazy[i.now().line]?n(Ce):Ve(Ce)}function _(Ce){return t.enter("tableHead"),t.enter("tableRow"),x(Ce)}function x(Ce){return Ce===124||(f=!0,c+=1),S(Ce)}function S(Ce){return Ce===null?n(Ce):cn(Ce)?c>1?(c=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(Ce),t.exit("lineEnding"),N):n(Ce):Xn(Ce)?ti(t,S,"whitespace")(Ce):(c+=1,f&&(f=!1,r+=1),Ce===124?(t.enter("tableCellDivider"),t.consume(Ce),t.exit("tableCellDivider"),f=!0,S):(t.enter("data"),R(Ce)))}function R(Ce){return Ce===null||Ce===124||Pi(Ce)?(t.exit("data"),S(Ce)):(t.consume(Ce),Ce===92?I:R)}function I(Ce){return Ce===92||Ce===124?(t.consume(Ce),R):R(Ce)}function N(Ce){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(Ce):(t.enter("tableDelimiterRow"),f=!1,Xn(Ce)?ti(t,L,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Ce):L(Ce))}function L(Ce){return Ce===45||Ce===58?ie(Ce):Ce===124?(f=!0,t.enter("tableCellDivider"),t.consume(Ce),t.exit("tableCellDivider"),H):_e(Ce)}function H(Ce){return Xn(Ce)?ti(t,ie,"whitespace")(Ce):ie(Ce)}function ie(Ce){return Ce===58?(c+=1,f=!0,t.enter("tableDelimiterMarker"),t.consume(Ce),t.exit("tableDelimiterMarker"),ne):Ce===45?(c+=1,ne(Ce)):Ce===null||cn(Ce)?ge(Ce):_e(Ce)}function ne(Ce){return Ce===45?(t.enter("tableDelimiterFiller"),he(Ce)):_e(Ce)}function he(Ce){return Ce===45?(t.consume(Ce),he):Ce===58?(f=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(Ce),t.exit("tableDelimiterMarker"),re):(t.exit("tableDelimiterFiller"),re(Ce))}function re(Ce){return Xn(Ce)?ti(t,ge,"whitespace")(Ce):ge(Ce)}function ge(Ce){return Ce===124?L(Ce):Ce===null||cn(Ce)?!f||r!==c?_e(Ce):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(Ce)):_e(Ce)}function _e(Ce){return n(Ce)}function pe(Ce){return t.enter("tableRow"),it(Ce)}function it(Ce){return Ce===124?(t.enter("tableCellDivider"),t.consume(Ce),t.exit("tableCellDivider"),it):Ce===null||cn(Ce)?(t.exit("tableRow"),e(Ce)):Xn(Ce)?ti(t,it,"whitespace")(Ce):(t.enter("data"),mt(Ce))}function mt(Ce){return Ce===null||Ce===124||Pi(Ce)?(t.exit("data"),it(Ce)):(t.consume(Ce),Ce===92?nt:mt)}function nt(Ce){return Ce===92||Ce===124?(t.consume(Ce),mt):mt(Ce)}}function W8(t,e){let n=-1,i=!0,r=0,c=[0,0,0,0],f=[0,0,0,0],a=!1,_=0,x,S,R;const I=new V8;for(;++n<t.length;){const N=t[n],L=N[1];N[0]==="enter"?L.type==="tableHead"?(a=!1,_!==0&&(i2(I,e,_,x,S),S=void 0,_=0),x={type:"table",start:Object.assign({},L.start),end:Object.assign({},L.end)},I.add(n,0,[["enter",x,e]])):L.type==="tableRow"||L.type==="tableDelimiterRow"?(i=!0,R=void 0,c=[0,0,0,0],f=[0,n+1,0,0],a&&(a=!1,S={type:"tableBody",start:Object.assign({},L.start),end:Object.assign({},L.end)},I.add(n,0,[["enter",S,e]])),r=L.type==="tableDelimiterRow"?2:S?3:1):r&&(L.type==="data"||L.type==="tableDelimiterMarker"||L.type==="tableDelimiterFiller")?(i=!1,f[2]===0&&(c[1]!==0&&(f[0]=f[1],R=s_(I,e,c,r,void 0,R),c=[0,0,0,0]),f[2]=n)):L.type==="tableCellDivider"&&(i?i=!1:(c[1]!==0&&(f[0]=f[1],R=s_(I,e,c,r,void 0,R)),c=f,f=[c[1],n,0,0])):L.type==="tableHead"?(a=!0,_=n):L.type==="tableRow"||L.type==="tableDelimiterRow"?(_=n,c[1]!==0?(f[0]=f[1],R=s_(I,e,c,r,n,R)):f[1]!==0&&(R=s_(I,e,f,r,n,R)),r=0):r&&(L.type==="data"||L.type==="tableDelimiterMarker"||L.type==="tableDelimiterFiller")&&(f[3]=n)}for(_!==0&&i2(I,e,_,x,S),I.consume(e.events),n=-1;++n<e.events.length;){const N=e.events[n];N[0]==="enter"&&N[1].type==="table"&&(N[1]._align=$8(e.events,n))}return t}function s_(t,e,n,i,r,c){const f=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",a="tableContent";n[0]!==0&&(c.end=Object.assign({},_d(e.events,n[0])),t.add(n[0],0,[["exit",c,e]]));const _=_d(e.events,n[1]);if(c={type:f,start:Object.assign({},_),end:Object.assign({},_)},t.add(n[1],0,[["enter",c,e]]),n[2]!==0){const x=_d(e.events,n[2]),S=_d(e.events,n[3]),R={type:a,start:Object.assign({},x),end:Object.assign({},S)};if(t.add(n[2],0,[["enter",R,e]]),i!==2){const I=e.events[n[2]],N=e.events[n[3]];if(I[1].end=Object.assign({},N[1].end),I[1].type="chunkText",I[1].contentType="text",n[3]>n[2]+1){const L=n[2]+1,H=n[3]-n[2]-1;t.add(L,H,[])}}t.add(n[3]+1,0,[["exit",R,e]])}return r!==void 0&&(c.end=Object.assign({},_d(e.events,r)),t.add(r,0,[["exit",c,e]]),c=void 0),c}function i2(t,e,n,i,r){const c=[],f=_d(e.events,n);r&&(r.end=Object.assign({},f),c.push(["exit",r,e])),i.end=Object.assign({},f),c.push(["exit",i,e]),t.add(n+1,0,c)}function _d(t,e){const n=t[e],i=n[0]==="enter"?"start":"end";return n[1][i]}const X8={name:"tasklistCheck",tokenize:Y8};function Z8(){return{text:{91:X8}}}function Y8(t,e,n){const i=this;return r;function r(_){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(_):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(_),t.exit("taskListCheckMarker"),c)}function c(_){return Pi(_)?(t.enter("taskListCheckValueUnchecked"),t.consume(_),t.exit("taskListCheckValueUnchecked"),f):_===88||_===120?(t.enter("taskListCheckValueChecked"),t.consume(_),t.exit("taskListCheckValueChecked"),f):n(_)}function f(_){return _===93?(t.enter("taskListCheckMarker"),t.consume(_),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),a):n(_)}function a(_){return cn(_)?e(_):Xn(_)?t.check({tokenize:G8},e,n)(_):n(_)}}function G8(t,e,n){return ti(t,i,"whitespace");function i(r){return r===null?n(r):e(r)}}function K8(t){return jS([w8(),P8(),U8(t),H8(),Z8()])}const Q8={};function J8(t){const e=this,n=t||Q8,i=e.data(),r=i.micromarkExtensions||(i.micromarkExtensions=[]),c=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),f=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);r.push(K8(n)),c.push(y8()),f.push(b8(n))}const eV=`# Henry World Map\r
\r
This application displays, on an interactive map, people named **Henry** (and its international variants), based on data from [Wikidata](https://www.wikidata.org/).\r
\r
## Data source\r
\r
- Data comes from the Wikidata database.\r
- Wikidata contains **112,550** people with the name Henryk or one of its variants.\r
- **72,042** of them do **not** have a geographic location  they cannot be shown on the map.\r
- The map shows only people with an assigned location.\r
\r
## Name variants used for filtering\r
\r
A Henry is defined here as a person whose given name (in Wikidata) matches one of the following variants:\r
\r
| Name variant | Language |\r
|--------------|----------|\r
| Henryk | Polish |\r
| Heinrich | German |\r
| Henricus | Medieval Latin |\r
| Henri | French |\r
| Henry | English |\r
| Enrique | Spanish |\r
| Enrico | Italian |\r
| Enric | Catalan / Occitan |\r
| Henrique | Portuguese |\r
| Henrik | Scandinavian / Hungarian / Slovenian / Finnish |\r
| Hendrik | Dutch / Afrikaans |\r
| Hinrik | Icelandic |\r
| Henrikh | Russian transliteration |\r
| Henrijs | Latvian |\r
| Henriks | Latvian |\r
| Henrikas | Lithuanian |\r
| Herkus | Lithuanian (historical form) |\r
| Jindich | Czech |\r
| Henrich | Slovak |\r
| Anra | Irish Gaelic |\r
| inr | Irish Gaelic |\r
| Eanraig | Scottish Gaelic |\r
| Eanruig | Scottish Gaelic (variant) |\r
| Endika | Basque |\r
| Indrek | Estonian |\r
| Indriis | Latvian (historical form) |\r
| Heikki | Finnish |\r
| Herri | Breton |\r
| Genrich | Russian (from German) |\r
|  | Russian (Cyrillic) |\r
|  | Belarusian (Cyrillic) |\r
| Anri | Georgian |\r
| Errikos | Greek |\r
|  | Armenian |\r
|  | Chinese |\r
|  | Korean |\r
|  | Hindi |\r
|  | Arabic |\r
|  | Hebrew |\r
\r
## Statistics\r
\r
- **112,550** total records after filtering for the variants above.\r
- **40,508** people have a mapped location.\r
- Most entries come from  Germany and  Poland.\r
- The most frequent variant in the dataset is **Heinrich**.\r
\r
## Limitations\r
\r
- People without geographic coordinates in Wikidata cannot be visualized.\r
- Wikidata is a community-driven database  data can be incomplete or inaccurate.\r
- The variant list is based on etymological sources; some rare or archaic forms may be missing.\r
`;function tV({setInfoOpen:t}){return Yn.jsxs("div",{className:"app-info-panel",role:"dialog","aria-modal":"true",children:[Yn.jsxs("div",{className:"app-info-header",children:[Yn.jsx("div",{className:"app-info-title",children:"About"}),Yn.jsx("button",{className:"app-close",onClick:()=>t(!1),"aria-label":"Close",children:""})]}),Yn.jsx("div",{className:"app-info-content markdown-body",children:Yn.jsx(UU,{remarkPlugins:[J8],children:eV})})]})}function nV(){const[t,e]=St.useState(!1);function n(){document.body.classList.remove("loading")}return Yn.jsxs(Yn.Fragment,{children:[Yn.jsxs("div",{className:"app-title",children:[Yn.jsx("button",{onClick:()=>e(!0),children:"Occurrence of the name Henry"}),t&&Yn.jsx(tV,{setInfoOpen:e})]}),Yn.jsx(k6,{onReady:n})]})}lA.createRoot(document.getElementById("root")).render(Yn.jsx(St.StrictMode,{children:Yn.jsx(nV,{})}));
